<!DOCTYPE html><html lang="en" translate="no"><head><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"/><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="google" content="notranslate"/><title>Берем процессы под контроль в .NET | Убежище инженера | YPermitin</title><meta name="robots" content="index,follow"/><meta name="description" content="Запуск внешних процессов и их контроль в C# (.NET)."/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://ypermitin.github.io/blog/.NET/2024-07/processes-under-control"/><meta property="og:title" content="Берем процессы под контроль в .NET | Убежище инженера | YPermitin"/><meta property="og:description" content="Запуск внешних процессов и их контроль в C# (.NET)."/><meta property="og:url" content="https://ypermitin.github.io/blog/.NET/2024-07/processes-under-control"/><meta property="og:type" content="website"/><meta property="og:image" content="https://ypermitin.github.io/imp_assets/.NET/2024-07/processes-under-control/logo.png"/><meta property="og:image:alt" content="Берем процессы под контроль в .NET | Убежище инженера | YPermitin"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:locale" content="en_IN"/><meta property="og:site_name" content="Убежище инженера"/><link rel="canonical" href="https://webexpe.com/"/><meta property="keywords" content=".NET, C#, разработка, процессы, контроль"/><meta property="al:web:url" content="https://ypermitin.github.io/blog/.NET/2024-07/processes-under-control"/><meta name="next-head-count" content="23"/><link rel="preload" href="/_next/static/css/9390881c82d58e40.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9390881c82d58e40.css" data-n-g=""/><link rel="preload" href="/_next/static/css/f381482cc81d5917.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f381482cc81d5917.css"/><link rel="preload" href="/_next/static/css/4a9df9e795bce52b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4a9df9e795bce52b.css"/><link rel="preload" href="/_next/static/css/ee5420a43edabb61.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ee5420a43edabb61.css"/><link rel="preload" href="/_next/static/css/88381d5dde4793c2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/88381d5dde4793c2.css"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script defer="" src="/_next/static/chunks/3a17f596-055cd9ef17181fc5.js"></script><script defer="" src="/_next/static/chunks/fea29d9f.0cfd8a10f65a727d.js"></script><script defer="" src="/_next/static/chunks/1664-468559f2e2a9395f.js"></script><script defer="" src="/_next/static/chunks/1274.6124caf478e7e4b5.js"></script><script defer="" src="/_next/static/chunks/8681.4514a8f7d45090c5.js"></script><script defer="" src="/_next/static/chunks/7897.b3984fce345297e6.js"></script><script defer="" src="/_next/static/chunks/7200.f56c768592bdb988.js"></script><script defer="" src="/_next/static/chunks/2726.5ee11496e940c0a2.js"></script><script src="/_next/static/chunks/webpack-e8a7f948ae318a2b.js" defer=""></script><script src="/_next/static/chunks/framework-945b357d4a851f4b.js" defer=""></script><script src="/_next/static/chunks/main-58191ff039d30768.js" defer=""></script><script src="/_next/static/chunks/pages/_app-acf79cc5654d0ec0.js" defer=""></script><script src="/_next/static/chunks/4104-89a1ab977b9431e5.js" defer=""></script><script src="/_next/static/chunks/pages/blog/.NET/2024-07/processes-under-control-a05b6105fd33792b.js" defer=""></script><script src="/_next/static/-bGN1hEP2YVpKeQylWsrE/_buildManifest.js" defer=""></script><script src="/_next/static/-bGN1hEP2YVpKeQylWsrE/_ssgManifest.js" defer=""></script></head><body class="bg-slate-100 dark:bg-slate-900 transition-all"><div id="__next"><div data-overlay-container="true"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><nav class="Navbar_navbar__W_ouQ bg-white  dark:bg-slate-900 dark:text-white text-black"><div class="container flex items-center justify-between px-2"><div class="flex items-center"><div class="Navbar_mobileBurgerToggle__Bj_52 mr-5  "><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="dark:text-white text-black text-2xl" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></div><a class="text-[22px] font-semibold" href="/">Убежище инженера</a></div><div class="flex items-center"><div class="text-[14px] font-normal items-center lg:flex hidden"><a class="cursor-pointer hover:text-blue-500 mx-2" href="/">Главная</a><div class="relative"><div class="flex items-center cursor-pointer mx-2"><p class="my-0">Блог</p><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="text-[20px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16.293 9.293 12 13.586 7.707 9.293l-1.414 1.414L12 16.414l5.707-5.707z"></path></svg></div><div class="overflow-auto absolute w-[180px] z-20 top-[30px] rounded-[4px] shadow-lg bg-white dark:bg-slate-800 border border-gray-300 dark:border-0 h-0 border-0"><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2" href="/blog/"><span>Все публикации</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=CPP"><span style="text-transform:capitalize">C++</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=.NET"><span style="text-transform:capitalize">.NET</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=DevOps"><span style="text-transform:capitalize">DevOps</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=PostgreSQL"><span style="text-transform:capitalize">PostgreSQL</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=SQL%20Server"><span style="text-transform:capitalize">SQL Server</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=1C:%D0%9F%D1%80%D0%B5%D0%B4%D0%BF%D1%80%D0%B8%D1%8F%D1%82%D0%B8%D0%B5"><span style="text-transform:capitalize">1C:Предприятие</span></a></div></div><a class="cursor-pointer hover:text-blue-500 mx-2" href="/instruments/">Инструменты</a><a class="cursor-pointer hover:text-blue-500 mx-2" href="/about/">Обо мне</a><a class="cursor-pointer hover:text-blue-500 mx-2" href="/contact/">Контакты</a><div class="ml-5 pt-1"><a href="https://github.com/YPermitin/" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a><a href="https://t.me/TinyDevVault" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"></path></svg></a><a href="mailto:i.need.ypermitin@yandex.ru" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0 0 68.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"></path></svg></a><a href="https://boosty.to/ypermitin" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 21h9.62a3.995 3.995 0 0 0 3.037-1.397l5.102-5.952a1 1 0 0 0-.442-1.6l-1.968-.656a3.043 3.043 0 0 0-2.823.503l-3.185 2.547-.617-1.235A3.98 3.98 0 0 0 9.146 11H4c-1.103 0-2 .897-2 2v6c0 1.103.897 2 2 2zm0-8h5.146c.763 0 1.448.423 1.789 1.105l.447.895H7v2h6.014a.996.996 0 0 0 .442-.11l.003-.001.004-.002h.003l.002-.001h.004l.001-.001c.009.003.003-.001.003-.001.01 0 .002-.001.002-.001h.001l.002-.001.003-.001.002-.001.002-.001.003-.001.002-.001c.003 0 .001-.001.002-.001l.003-.002.002-.001.002-.001.003-.001.002-.001h.001l.002-.001h.001l.002-.001.002-.001c.009-.001.003-.001.003-.001l.002-.001a.915.915 0 0 0 .11-.078l4.146-3.317c.262-.208.623-.273.94-.167l.557.186-4.133 4.823a2.029 2.029 0 0 1-1.52.688H4v-6zM16 2h-.017c-.163.002-1.006.039-1.983.705-.951-.648-1.774-.7-1.968-.704L12.002 2h-.004c-.801 0-1.555.313-2.119.878C9.313 3.445 9 4.198 9 5s.313 1.555.861 2.104l3.414 3.586a1.006 1.006 0 0 0 1.45-.001l3.396-3.568C18.688 6.555 19 5.802 19 5s-.313-1.555-.878-2.121A2.978 2.978 0 0 0 16.002 2H16zm1 3c0 .267-.104.518-.311.725L14 8.55l-2.707-2.843C11.104 5.518 11 5.267 11 5s.104-.518.294-.708A.977.977 0 0 1 11.979 4c.025.001.502.032 1.067.485.081.065.163.139.247.222l.707.707.707-.707c.084-.083.166-.157.247-.222.529-.425.976-.478 1.052-.484a.987.987 0 0 1 .701.292c.189.189.293.44.293.707z"></path></svg></a></div></div><div class="Navbar_search_icon_wrapper__1a_rL ml-5 dark:text-white"><button name="search-button" aria-label="search button"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="dark:text-white text-black text-[22px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg></button></div><div class=""><button name="share" aria-label="share page"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="dark:text-white text-black text-[16px] mt-[7px] ml-2 mr-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5"></path></svg></button></div><button name="theme-switch" aria-label="theme button" class="Navbar_theme_switch__q7F_Z pl-3 dark:text-white text-black"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-md " height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278"></path></svg></button></div></div></nav><aside class="Navbar_nav_sidebar_wrapper__M0KaI dark:bg-slate-900 dark:text-white bg-white text-black"><div class="flex items-center justify-between pb-3"><p class="">МЕНЮ</p><div><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="text-slate-800 dark:text-white text-[25px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg></div></div><hr/><div class="my-15"><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/">Главная</a><div class="relative"><div class="flex items-center cursor-pointer justify-between"><p class="my-0">Блог</p><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="text-[20px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16.293 9.293 12 13.586 7.707 9.293l-1.414 1.414L12 16.414l5.707-5.707z"></path></svg></div><div class="overflow-auto relative h-0 border-0"><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2" href="/blog/"><span>Все публикации</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=CPP"><span style="text-transform:capitalize">C++</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=.NET"><span style="text-transform:capitalize">.NET</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=DevOps"><span style="text-transform:capitalize">DevOps</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=PostgreSQL"><span style="text-transform:capitalize">PostgreSQL</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=SQL%20Server"><span style="text-transform:capitalize">SQL Server</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=1C:%D0%9F%D1%80%D0%B5%D0%B4%D0%BF%D1%80%D0%B8%D1%8F%D1%82%D0%B8%D0%B5"><span style="text-transform:capitalize">1C:Предприятие</span></a></div></div><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/instruments/">Инструменты</a><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/about/">Обо мне</a><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/contact/">Контакты</a></div><hr/><div class="my-5"><p class="font-light">Подписаться : </p> <a href="https://github.com/YPermitin/" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a><a href="https://t.me/TinyDevVault" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"></path></svg></a><a href="mailto:i.need.ypermitin@yandex.ru" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0 0 68.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"></path></svg></a><a href="https://boosty.to/ypermitin" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 21h9.62a3.995 3.995 0 0 0 3.037-1.397l5.102-5.952a1 1 0 0 0-.442-1.6l-1.968-.656a3.043 3.043 0 0 0-2.823.503l-3.185 2.547-.617-1.235A3.98 3.98 0 0 0 9.146 11H4c-1.103 0-2 .897-2 2v6c0 1.103.897 2 2 2zm0-8h5.146c.763 0 1.448.423 1.789 1.105l.447.895H7v2h6.014a.996.996 0 0 0 .442-.11l.003-.001.004-.002h.003l.002-.001h.004l.001-.001c.009.003.003-.001.003-.001.01 0 .002-.001.002-.001h.001l.002-.001.003-.001.002-.001.002-.001.003-.001.002-.001c.003 0 .001-.001.002-.001l.003-.002.002-.001.002-.001.003-.001.002-.001h.001l.002-.001h.001l.002-.001.002-.001c.009-.001.003-.001.003-.001l.002-.001a.915.915 0 0 0 .11-.078l4.146-3.317c.262-.208.623-.273.94-.167l.557.186-4.133 4.823a2.029 2.029 0 0 1-1.52.688H4v-6zM16 2h-.017c-.163.002-1.006.039-1.983.705-.951-.648-1.774-.7-1.968-.704L12.002 2h-.004c-.801 0-1.555.313-2.119.878C9.313 3.445 9 4.198 9 5s.313 1.555.861 2.104l3.414 3.586a1.006 1.006 0 0 0 1.45-.001l3.396-3.568C18.688 6.555 19 5.802 19 5s-.313-1.555-.878-2.121A2.978 2.978 0 0 0 16.002 2H16zm1 3c0 .267-.104.518-.311.725L14 8.55l-2.707-2.843C11.104 5.518 11 5.267 11 5s.104-.518.294-.708A.977.977 0 0 1 11.979 4c.025.001.502.032 1.067.485.081.065.163.139.247.222l.707.707.707-.707c.084-.083.166-.157.247-.222.529-.425.976-.478 1.052-.484a.987.987 0 0 1 .701.292c.189.189.293.44.293.707z"></path></svg></a><hr class="mt-5"/></div><div class="mt-5 mb-4"><p class="mb-2 font-light">Переключиться на <!-- -->светлую<!-- --> тему :</p><button name="theme-switch" aria-label="theme-switch" class="Navbar_theme_switch__q7F_Z dark:text-white text-black"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-lg" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278"></path></svg></button></div><hr/><div class="my-5"><p class="text-sm font-light dark:text-gray-400 text-gray-500 mb-1">Copyright © 2024</p></div></aside><div class="transition-all fixed h-screen w-screen flex items-center justify-center left-0 z-20 top-0 pointer-events-none opacity-0"><div class="absolute top-0 left-0 w-screen h-screen bg-black opacity-50"></div><div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded lg:w-1/6 mx-3 w-full relative z-10 transition-all top-10"><div class="flex border-gray-300 pb-2 mb-3 border-b"><p class="  font-medium w-full">Share:</p><span class="pl-5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="pt-1 text-[18px] cursor-pointer" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"></path></svg></span></div><div class="flex flex-wrap items-center"><a class="mr-3" aria-label="facebook-share" href="https://www.facebook.com/sharer/sharer.php?u=https://ypermitin.github.io" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-92.4 233.5h-63.9c-50.1 0-59.8 23.8-59.8 58.8v77.1h119.6l-15.6 120.7h-104V912H539.2V602.2H434.9V481.4h104.3v-89c0-103.3 63.1-159.6 155.3-159.6 44.2 0 82.1 3.3 93.2 4.8v107.9z"></path></svg></a><a class="mr-3" aria-label="twitter-share" href="http://twitter.com/share?text=Check out this article!! &amp;url=https://ypermitin.github.io&amp;hashtags=webdevelopment,javacript,javascriptdaily,webdevelopmenttutorial,tutorial" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm215.3 337.7c.3 4.7.3 9.6.3 14.4 0 146.8-111.8 315.9-316.1 315.9-63 0-121.4-18.3-170.6-49.8 9 1 17.6 1.4 26.8 1.4 52 0 99.8-17.6 137.9-47.4-48.8-1-89.8-33-103.8-77 17.1 2.5 32.5 2.5 50.1-2a111 111 0 0 1-88.9-109v-1.4c14.7 8.3 32 13.4 50.1 14.1a111.13 111.13 0 0 1-49.5-92.4c0-20.7 5.4-39.6 15.1-56a315.28 315.28 0 0 0 229 116.1C492 353.1 548.4 292 616.2 292c32 0 60.8 13.4 81.1 35 25.1-4.7 49.1-14.1 70.5-26.7-8.3 25.7-25.7 47.4-48.8 61.1 22.4-2.4 44-8.6 64-17.3-15.1 22.2-34 41.9-55.7 57.6z"></path></svg></a><a class="mr-3" aria-label="linkedin-share" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://ypermitin.github.io&amp;title=Check out this article!!&amp;source=LinkedIn" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[23px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"></path></svg></a><button class="mr-3" name="copy-link" aria-label="copy-link"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z"></path><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243z"></path></svg></button></div><div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded fixed flex transition-all right-[10px] -bottom-20 opacity-0" role="alert"><strong class="font-bold">Link Copied</strong><span class="pl-5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="pt-1 text-[18px] cursor-pointer" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"></path></svg></span></div></div></div><section class="PageLayout_centered_article_wrapper__gS3Af dark:bg-slate-900 dark:text-white"><div class="container px-0 md:px-[15px] pt-[50px] pb-[50px]"><article class="PageLayout_article_content__4dnq3 pb-[30px] px-3 bg-white dark:bg-slate-800 dark:border-none dark:drop-shadow-lg dark:text-white pt-10 md:pt-0 mx-auto font-regular text-lg leading-relaxed"><div class="mb-[30px]"><h1 class="ArticleHeader_articleTitle__3L1Bi text-center text-2xl md:text-4xl font-medium mt-[20px] mb-[5px]">Берем процессы под контроль в .NET</h1><div class="mb-[10px] mt-[15px] text-[14px] font-medium ArticleHeader_centered_article_header_author___gRtE"><p class="my-0 mx-[30px] font-medium">YPermitin<span class="px-1 font-light">в</span><a href="/blog/?category=.NET">.NET</a></p><p class="my-0">2024-07-31</p></div><div class="md:mt-2 flex flex-wrap justify-center"><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->.NET</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->C#</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->разработка</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->процессы</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->контроль</p></div></div><blockquote class="text_quoted_text__5DQLs" style="text-align:right"><q>Контроль - это очень опасная страсть, если вы зайдёте слишком далеко,<br/>то рискуете полностью его потерять.<br/>(с) Эрика Стрэйндж</q></blockquote><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">При разработке собственных решений не редко возникает потребность в запуске дополнительных исполняемых процессов. Не всегда эти процессы представлены собственными приложениями. Часто это внешние программы, доступа к исходному коду которых у нас нет. Поэтому нам приходится адаптироваться.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset">Содержание</h1><ul class="List_list__zLjGi list-disc pl-[30px]"><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-07/processes-under-control/#start"><b><u>Суть вопроса</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-07/processes-under-control/#source"><b><u>Исходный материал</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-07/processes-under-control/#good-and-bad"><b><u>Просто и плохо</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-07/processes-under-control/#are-you-ok"><b><u>Завис или не завис?</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-07/processes-under-control/#terminal-output"><b><u>Читаем вывод консоли</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-07/processes-under-control/#env-res-and-so-on"><b><u>Окружение, ресурсы и так далее</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-07/processes-under-control/#ideal-control"><b><u>Идеальный контроль</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-07/processes-under-control/#the-end"><b><u>Мысли напоследок</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-07/processes-under-control/#links"><b><u>Это интересно</u></b></a></li></ul><section id="section-start"><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="start">Суть вопроса</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Сегодня и здесь мы будем запускать процессы. Свои и не только. Но самое главное - мы будем контролировать их работу и разбирать их состояние. Запустить процесс дело не трудное, но контролировать его и убедиться, что он не завис - дело совсем непростое.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Мы пройдемся от самых простых и плохих примеров, до самых сложных. Здесь нет готовых и универсальных решений, только указание направления для поисков нужных ответов.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">В качестве подопытного стороннего приложения мы будем использовать утилиту <a href="https://learn.microsoft.com/en-us/sql/tools/bcp-utility" target="_blank" rel="noopener noreferrer"><b><u>&quot;Bulk Copy Insert&quot; (BCP.exe)</u></b></a>, используемую для массовой выгрузки / загрузки данных из баз данных SQL Server. Сама утилита устанавливается вместе с другими компонентами SQL Server, подробнее читайте по ссылке. Но и этим примеры не ограничатся.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">И хоть примеры будут сделаны в среде Windows, фактически информация актуальная как при разработке приложений для *.nix / MaxOS. Итак, поехали!</p></section><section id="section-source"><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="source">Исходный материал</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Для всех последующих примеров с утилитой <a href="https://learn.microsoft.com/en-us/sql/tools/bcp-utility" target="_blank" rel="noopener noreferrer"><b><u>&quot;Bulk Copy Insert&quot; (BCP.exe)</u></b></a> мы создадим базу &quot;TestDB&quot; со следующими объектами:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-dTWiOz sc-eJoXEY jchURK gqqoyp prism-code language-sql" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">dbo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">Programms</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">Id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">IDENTITY</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">nvarchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">50</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">AuhthorName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">nvarchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">50</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">Price</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">KEY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">CLUSTERED</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">Id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ASC</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token keyword" style="color:rgb(86, 156, 214)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">PAD_INDEX </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OFF</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> STATISTICS_NORECOMPUTE </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OFF</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> IGNORE_DUP_KEY </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OFF</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ALLOW_ROW_LOCKS </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ALLOW_PAGE_LOCKS </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token keyword" style="color:rgb(86, 156, 214)">PRIMARY</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token keyword" style="color:rgb(86, 156, 214)">PRIMARY</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Таблица <b>Programms</b> содержит некоторую сгенерированную информацию о программах. Чтобы создать достаточный объем данных для тестов, заполним ее следующим скриптом, добавив порядка 10 миллионов записей.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-goiVcJ sc-gSifMm iFNTDr paCGq prism-code language-sql" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">Declare</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">@count</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">Set</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">@count</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">DECLARE</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">	</span><span class="token variable" style="color:rgb(156, 220, 254)">@Name</span><span class="token plain"> nvarchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">50</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">	</span><span class="token variable" style="color:rgb(156, 220, 254)">@AuhthorName</span><span class="token plain"> nvarchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">50</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">	</span><span class="token variable" style="color:rgb(156, 220, 254)">@Price</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">While</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">@count</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">9000000</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">Begin</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token keyword" style="color:rgb(86, 156, 214)">Select</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">@Name</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Prog - &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Rand</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> nvarchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; - &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">GETDATE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> nvarchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token keyword" style="color:rgb(86, 156, 214)">Select</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">@AuhthorName</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Dev - &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Rand</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> nvarchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token keyword" style="color:rgb(86, 156, 214)">Select</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">@Price</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Rand</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">100</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token keyword" style="color:rgb(86, 156, 214)">Insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">Into</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">dbo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">Programms</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">@Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">@AuhthorName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">@Price</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token keyword" style="color:rgb(86, 156, 214)">Print</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">@count</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token keyword" style="color:rgb(86, 156, 214)">Set</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">@count</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">@count</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">End</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Допустим, нам нужно выгрузить эти данные в файл, чтобы потом загрузить на другом сервере в таблицу аналогичной структуры. Утилита BCP для этого дела подходящий вариант.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">В случае, если бы мы запускали утилиту полностью вручную, то команда выгрузки данных в файл выглядела бы следующим образом:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-ixcdjX sc-eQaGpr iBtGJd iPTXdp prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># Команда имеет следующие параметры:</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; bcp - имя утилиты для запуска.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; dbo.Programms - имя таблицы для выгрузки данных.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; out - это направление выгрузки. В данном случае выгрузка ИЗ базы В файл. </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#       Путь к файлу указан после этого параметра.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; -d - имя базы.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; -l - таймаут установки соединения. В примере 15 секунд.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; -P - пароль пользователя для входа.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; -S - имя инстанса SQL Server для подключения.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; -U - имя пользователя. В нашем примере это пользователь SA.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; -N - признак использования нативных типов данных базы данных для выгрузки.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#       О некоторых случаях значительно ускоряет операции выгрузки / загрузки данных.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; -o - путь к файлу вывода полного лога работы утилиты BCP.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">bcp dbo.Programms out </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C:\Temp\BCP\Programms.bak&quot;</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-d</span><span class="token plain"> TestDB </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-l</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-P</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;ПарольПользователя&gt;&quot;</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-S</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;SRV-SQL-1&quot;</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;sa&quot;</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-N</span><span class="token plain">  </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-o</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C:\Temp\BCP\Programms_Export.out&quot;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">В результате мы получим файл <b>&quot;C:\Temp\BCP\Programms.bak&quot;</b> c данными исходной таблицы. А по пути <b>&quot;C:\Temp\BCP\Programms_Export.out&quot;</b> можно посмотреть подробный лог работы утилиты. Пример части вывода в файл лога:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-VLMBG sc-gXbNzB hkuzhT gmIPNK prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">Starting copy...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 1000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 2000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 3000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 4000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 5000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 6000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 7000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 8000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 9000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 11000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 12000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">...</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Если бы мы выполняли команду, наоборот, для импорта данных из файла в, например, таблицу <b>dbo.Programms_New</b> той же структуры, то выглядела бы она следующим образом:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-dcMTLQ sc-bBhMX jBCHZS hPPyDs prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># Команда имеет следующие параметры:</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; bcp - имя утилиты для запуска.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; dbo.Programms_New - имя таблицы для загрузки данных.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; in - это направление загрузки. В данном случае загрузка ИЗ файла В базу. </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#       Путь к файлу указан после этого параметра.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; -b - размер пакета для загрузки данных. В примере 10000 записей.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; -d - имя базы.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; -l - таймаут установки соединения. В примере 15 секунд.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; -P - пароль пользователя для входа.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; -S - имя инстанса SQL Server для подключения.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; -U - имя пользователя. В нашем примере это пользователь SA.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; -N - признак использования нативных типов данных базы данных для загрузки.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#       О некоторых случаях значительно ускоряет операции выгрузки / загрузки данных.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   &gt; -o - путь к файлу вывода полного лога работы утилиты BCP.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">bcp dbo.Programms_New </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C:\Temp\BCP\Programms.bak&quot;</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-b</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10000</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-d</span><span class="token plain"> TestDB </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-l</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-P</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;ПарольПользователя&gt;&quot;</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-S</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;SRV-SQL-1&quot;</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;sa&quot;</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-N</span><span class="token plain">  </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-o</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C:\Temp\BCP\Programms_Import.out&quot;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">В целом, логика работы команды такая же, как и при выгрузке, за исключением направления выгрузки и параметра размера пакета.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Как итог, у нас есть тестовая база данных и команды для утилиты BCP, которые нам нужно выполнять программно. Хоть мы привели две команды - для выгрузки и для загрузки, в примерах мы будем использовать только первую, т.к. цель у нас это работа с процессами, а не манипуляции с данными.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Вперед и за дело!</p></section><section id="section-good-and-bad"><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="good-and-bad">Просто и плохо</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Сначала рассмотрим самое топорное решение для запуска приложения. Ну, если честно, он не совсем топорное, но что просто так точно. В .NET есть встроенный системный класс <a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.diagnostics.process" target="_blank" rel="noopener noreferrer"><b><u>Process</u></b></a>, который предоставляет доступ к локальным и удаленным процессам, в том числе и для управления ими. Ничто не мешает нам запустить нужный процесс через него.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Ниже представлен пример запуска команды экспорта через утилиту BCP:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-hwHXyi sc-ciCoXh iwyBsS rwwQv prism-code language-csharp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Параметры запуска утилиты</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> userName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;sa&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> userPassword </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;ПарольПользователя&gt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> objectName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;dbo.Programms&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> uploadFilePath </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C:\Temp\BCP\Programms.bak&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> databaseName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;TestDB&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> instanceName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;SRV-SQL-1&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> logFilePath </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C:\Temp\BCP\Programms_Export.out&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Инициализация объекта с параметрами запуска приложения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">ProcessStartInfo</span><span class="token plain"> startInfo </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">ProcessStartInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">WindowStyle </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ProcessWindowStyle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Hidden</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">FileName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;bcp&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Arguments </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">objectName</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)"> out &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">uploadFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-d </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">databaseName</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)"> &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-l 15 &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-P &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">userPassword</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-S &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">instanceName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-U &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">userName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-N &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-o &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">logFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Запуск процесса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">Process</span><span class="token plain"> process </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Start</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... и ожидание завершения приложения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Примечание: можно ожидать завершения таким способом, </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// но тогда мы не сможем интерактивно выводить</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// сообщение об ожидании process.WaitForExit()</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain">process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">HasExited</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Now</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">]: Ожидаем завершения...&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Thread</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Now</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">]: Работа процесса завершена.&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Выводим на экран последние 10 строк лога работы утилиты</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Now</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">]: Вывод работы программы (последние 10 строк):&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;&lt;&lt;&lt;&lt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">File</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Exists</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">logFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> lastOutputLines </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> File</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ReadAllLines</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">logFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">TakeLast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ToList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> line </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> lastOutputLines</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&gt;&gt;&gt;&gt;&gt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Тестовая программа сначала задает параметры запуска утилиты BCP, а после формирует параметры запуска процесса через класс <a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.diagnostics.processstartinfo" target="_blank" rel="noopener noreferrer"><b><u>ProcessStartInfo</u></b></a>, который задает набор параметров для запуска.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Затем выполняется запуск непосредственно процесса через класс <a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.diagnostics.process" target="_blank" rel="noopener noreferrer"><b><u>Process</u></b></a> вызовом метода <b>Start</b> и передачей объекта типа <a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.diagnostics.processstartinfo" target="_blank" rel="noopener noreferrer"><b><u>ProcessStartInfo</u></b></a>, который мы инициировали ранее.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Класс <a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.diagnostics.process" target="_blank" rel="noopener noreferrer"><b><u>Process</u></b></a> реализует интерфейс <a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.idisposable" target="_blank" rel="noopener noreferrer"><b><u>IDisposable</u></b></a>, поэтому используется конструкция <b>using</b> для освобождения ресурсов после завершения работы с процессом. Затем в цикле проверяем не завершился ли процесс и так ожидаем, пока он не сделает свое дело. Ну а после завершения выводим последние 10 строк файла с логом работы утилиты.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Пример можно было сделать еще проще, не обращаясь к классу <a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.diagnostics.processstartinfo" target="_blank" rel="noopener noreferrer"><b><u>ProcessStartInfo</u></b></a>, но здесь мы задействовали его для наглядности.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Пример вывода утилиты может быть таким:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-jDJeIs sc-eEHciv jiFJNe iNcVDR prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:27:18]: Ожидаем завершения...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:27:19]: Ожидаем завершения...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:27:20]: Ожидаем завершения...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:27:21]: Ожидаем завершения...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:27:22]: Ожидаем завершения...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:27:23]: Ожидаем завершения...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:27:24]: Ожидаем завершения...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:27:25]: Ожидаем завершения...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:27:26]: Ожидаем завершения...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:27:27]: Ожидаем завершения...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:27:28]: Ожидаем завершения...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:27:29]: Ожидаем завершения...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:27:30]: Ожидаем завершения...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:27:31]: Работа процесса завершена.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:27:31]: Вывод работы программы (последние 10 строк):</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;&lt;&lt;&lt;&lt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10395000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10396000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10397000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10398000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10399000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10400000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">10400008 rows copied.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Network packet size (bytes): 4096</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Clock Time (ms.) Total     : 12594  Average : (825790.69 rows per sec.)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">&gt;&gt;&gt;&gt;&gt;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Таким образом, запускать простые приложения уже можно, и даже ожидать их завершения. Но что, если запущенный процесс зависнет или начнет ожидать какого-то интерактивного действия от пользователя? Тогда мы будем ждать вечно!</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">А чтобы этого не произошло, усложним пример!</p></section><section id="section-are-you-ok"><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="are-you-ok">Завис или не завис?</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Теперь нам нужно модифицировать свою программу для решения следующих проблем:<ul class="List_list__zLjGi list-disc pl-[30px]"><li>Ограничение времени выполнения?</li><li>Зависло ли приложение?</li><li>Есть ли активность приложения?</li></ul></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Начнем по-порядку. Предположим, что для работы процесса отведено максимум 1 минута. Этот шаг реализовать не сложно, ведь мы уже в цикле проверяем завершено ли приложение. Ничто нам не мешает ограничить работу цикла указанным временем, а по окончанию времени принудительно завершить процесс. Например, мы можем сделать это так:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-KsiuK sc-hqtLyI enaQly diWUXg prism-code language-csharp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Параметры запуска утилиты</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> userName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;sa&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> userPassword </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;ПарольПользователя&gt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> objectName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;dbo.Programms&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> uploadFilePath </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C:TempBCPProgramms.bak&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> databaseName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;TestDB&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> instanceName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;SRV-SQL-1&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> logFilePath </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C:TempBCPProgramms_Export.out&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Таймаут выполнения процесса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> timeoutSeconds </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">60</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Инициализация объекта с параметрами запуска приложения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">ProcessStartInfo</span><span class="token plain"> startInfo </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">ProcessStartInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">WindowStyle </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ProcessWindowStyle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Hidden</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">FileName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;bcp&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Arguments </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">objectName</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)"> out &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">uploadFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-d </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">databaseName</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)"> &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-l 15 &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-P &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">userPassword</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-S &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">instanceName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-U &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">userName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-N &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-o &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">logFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Запуск процесса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">DateTime</span><span class="token plain"> startProcess </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Now</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">Process</span><span class="token plain"> process </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Start</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... и ожидание завершения приложения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Примечание: можно ожидать завершения таким способом, </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// но тогда мы не сможем интерактивно выводить</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// сообщение об ожидании.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// В качестве параметра передаем таймаут ожидания</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// process.WaitForExit(timeoutSeconds * 1000);</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Обновляем время работы программы</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> workingTimeSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Now </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> startProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TotalSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain">process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">HasExited</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">           </span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Проверка времени со старта процесса на превышение таймаута</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">           </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> workingTimeSec </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> timeoutSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Now</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">]: Ожидаем завершения. Время работы </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">workingTimeSec</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">/</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">timeoutSeconds</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)"> (с)...&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Thread</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Обновляем время работы программы</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        workingTimeSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Now </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> startProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TotalSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Если процесс еще активен, то завершаем его принудительно</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain">process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">HasExited</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Kill</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Now</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">]: Работа процесса завершена. Код завершения: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">process</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">ExitCode</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Выводим на экран последние 10 строк лога работы утилиты</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Now</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">]: Вывод работы программы (последние 10 строк):&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;&lt;&lt;&lt;&lt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">File</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Exists</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">logFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> lastOutputLines </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> File</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ReadAllLines</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">logFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">TakeLast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ToList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> line </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> lastOutputLines</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&gt;&gt;&gt;&gt;&gt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Теперь мы установили программе время на работу, при превышении которого процесс будет принудительно завершен. На каждой итерации цикла ожидания завершения процесса выводим время работы и проверяем превышения таймаута. При выходе за пределы времени ожидания, процесс завершаем принудительно, если он еще активен. Пример вывода программы, если программа уложилась в отведенное время и превышения таймаута не случилось:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-iVnIWt sc-hWgKua gydTzC gaoAfi prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:54:01]: Ожидаем завершения. Время работы 0/60 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:54:02]: Ожидаем завершения. Время работы 1/60 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:54:03]: Ожидаем завершения. Время работы 2/60 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:54:04]: Ожидаем завершения. Время работы 3/60 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:54:05]: Ожидаем завершения. Время работы 4/60 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:54:06]: Ожидаем завершения. Время работы 5/60 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:54:07]: Ожидаем завершения. Время работы 6/60 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:54:08]: Ожидаем завершения. Время работы 7/60 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:54:09]: Ожидаем завершения. Время работы 8/60 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:54:10]: Ожидаем завершения. Время работы 9/60 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:54:11]: Ожидаем завершения. Время работы 10/60 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:54:12]: Ожидаем завершения. Время работы 11/60 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:54:13]: Ожидаем завершения. Время работы 12/60 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:54:14]: Работа процесса завершена. Код завершения: 0</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:54:14]: Вывод работы программы (последние 10 строк):</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;&lt;&lt;&lt;&lt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10395000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10396000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10397000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10398000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10399000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10400000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">10400008 rows copied.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Network packet size (bytes): 4096</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Clock Time (ms.) Total     : 12141  Average : (856602.25 rows per sec.)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">&gt;&gt;&gt;&gt;&gt;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">При превышении таймаута вывод программы будет таким (для проверки поставили таймаут в 2 секунды):</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-jBaHRL sc-gFqXPY gxXpO inXTfw prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:55:25]: Ожидаем завершения. Время работы 0/2 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:55:26]: Ожидаем завершения. Время работы 1/2 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:55:27]: Ожидаем завершения. Время работы 2/2 (с)...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:55:28]: Работа процесса завершена. Код завершения: -1</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 12:55:28]: Вывод работы программы (последние 10 строк):</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;&lt;&lt;&lt;&lt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 2195000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 2196000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 2197000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 2198000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 2199000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 2200000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 2201000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 2202000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 2203000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows succ</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">&gt;&gt;&gt;&gt;&gt;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Таким образом, бесконечного ожидания завершения процесса уже не будет и окончательного &quot;подвисания&quot; не случится. Однако для полной надежности необходимо проверять активно ли приложение. Это можно сделать несколькими способами:<ul class="List_list__zLjGi list-disc pl-[30px]"><li>Есть ли вывод на консоль новых сообщений, если это, конечно, консольное приложение.</li><li>Есть ли какая-либо активность процесса в части потребления ЦП.</li></ul>Реализуем эти проверки, дополнив пример выше.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Для создания ситуации подвисания приложения закомментируем параметры запуска утилиты BCP:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-ikkVnJ sc-hldWLq gQzCG gIrYlf prism-code language-csharp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Инициализация объекта с параметрами запуска приложения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">ProcessStartInfo</span><span class="token plain"> startInfo </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">ProcessStartInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">WindowStyle </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ProcessWindowStyle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Hidden</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">FileName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;bcp&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Arguments </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">objectName</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)"> out &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">uploadFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-d </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">databaseName</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)"> &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-l 15 &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-P &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">userPassword</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-S &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">instanceName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-U &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">userName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Отключаем использование нативных типов базы данных</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// и вывод лога работы утилиты в файл.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">//&quot;-N &quot; +</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">//$&quot;-o &quot;{logFilePath}&quot;&quot;;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Если бы мы запустили утилиту с такими параметрами интерактивно в терминале, то получили бы интерактивный запрос на уточнение параметров:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-iPXUjb sc-hlweCQ dBERZB cLDXVt prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">Enter the file storage type of field Id [int]:</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Конечно, таймаут выполнения процесса через 60 секунд сработал бы и процесс был бы завершен. Но в некоторых сценариях этот вариант бы не сработал. Например, запускаемое приложение может делать какую-то тяжелую работу и выполняться 10 минут. Мы установим таймаут, например. 15 минут. Но если программа будет запущена и получит запрос на интерактивный ввод сразу же, то мы фактически теряем эти 15 минут на ожидание, хотя сразу можно было бы узнать, что ничего не произойдет.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">В таких случаях на поможет динамический анализ потребления ресурсов ЦП запущенным процессом. Можно сказать, что если процесс не использовал ресурсы ЦП какое-то обозначенное время, то процесс можно считать зависшим и завершить. Ниже дополненный пример с новым ограничительным параметром - <b>таймаутом простоя приложения</b>.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-iQqcaB sc-fcSHUR laBxHU fDRQRw prism-code language-csharp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Параметры запуска утилиты</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> userName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;sa&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> userPassword </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;ПарольПользователя&gt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> objectName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;dbo.Programms&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> uploadFilePath </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C:\Temp\BCP\Programms.bak&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> databaseName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;TestDB&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> instanceName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;SRV-SQL-1&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> logFilePath </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C:\Temp\BCP\Programms_Export.out&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Таймаут выполнения процесса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> timeoutSeconds </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">60</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Таймаут простоя процесса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> timeoutProcessCpuIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Последнее значение использования ресурсов ЦП процессом</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">TimeSpan</span><span class="token plain"> lastCpuProcessUsage </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> TimeSpan</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">MinValue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Дата последней активности процеса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">DateTime</span><span class="token plain"> lastCpuActivity </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">MinValue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Время простоя в секундах с последней активности</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> processCpuIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Инициализация объекта с параметрами запуска приложения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">ProcessStartInfo</span><span class="token plain"> startInfo </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">ProcessStartInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">WindowStyle </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ProcessWindowStyle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Hidden</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Переопредлеяем вывод сообщений из стандартной консоли</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">RedirectStandardOutput </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">RedirectStandardError </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">RedirectStandardInput </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">FileName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;bcp&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Arguments </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">objectName</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)"> out &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">uploadFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-d </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">databaseName</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)"> &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-l 15 &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-P &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">userPassword</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-S &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">instanceName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-U &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">userName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-N &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-o &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">logFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Запуск процесса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">DateTime</span><span class="token plain"> startProcess </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Now</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">Process</span><span class="token plain"> process </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Start</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... и ожидание завершения приложения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Примечание: можно ожидать завершения таким способом, </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// но тогда мы не сможем интерактивно выводить</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// сообщение об ожидании.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// В качестве параметра передаем таймаут ожидания</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// process.WaitForExit(timeoutSeconds * 1000);</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Обновляем время работы программы</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> workingTimeSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Now </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> startProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TotalSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain">process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">HasExited</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">           </span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Проверка времени со старта процесса на превышение таймаута</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">           </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> workingTimeSec </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> timeoutSeconds</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">           </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> processCpuIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> timeoutProcessCpuIdleSec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Now</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">]: Ожидаем завершения. Время работы </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">workingTimeSec</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">/</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">timeoutSeconds</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)"> (с). &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                          </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;Использование ЦП: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">process</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">TotalProcessorTime</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">...&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Thread</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Обновляем время работы программы</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        workingTimeSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Now </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> startProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TotalSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Обновлям информацию о последней активности процесса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">lastCpuProcessUsage </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TotalProcessorTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            lastCpuProcessUsage </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TotalProcessorTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            lastCpuActivity </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Now</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            processCpuIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">lastCpuActivity </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">MinValue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            processCpuIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Now </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> lastCpuActivity</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TotalSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Если процесс еще активен, то завершаем его принудительно</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain">process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">HasExited</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Kill</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Now</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">]: Работа процесса завершена. Код завершения: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">process</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">ExitCode</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Выводим на экран последние 10 строк лога работы утилиты</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Now</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">]: Вывод работы программы (последние 10 строк):&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;&lt;&lt;&lt;&lt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">File</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Exists</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">logFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> lastOutputLines </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> File</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ReadAllLines</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">logFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">TakeLast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ToList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> line </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> lastOutputLines</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&gt;&gt;&gt;&gt;&gt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Здесь мы в самом начале обозначили переменную для хранения таймаута простоя приложения <b>timeoutProcessCpuIdleSec</b> в значении 5 секунд. То есть, если запущенный процесс не использует ЦП 5 секунд, то приложение считаем зависшим. Вспомогательные переменные <b>lastCpuProcessUsage</b> и <b>lastCpuActivity</b> используются для отслеживания состояния процесса в динамике. По ним определяется изменилось ли потребление ресурсов ЦП с последней проверки, а результат в виде длительности простоя сохраняется в переменную <b>processCpuIdleSec</b>.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Затем в цикле проверяется, чтобы длительность простоя не привысила заданный в переменной <b>timeoutProcessCpuIdleSec</b> таймаут. Таким образом, у нас реализована двойная защита от зависания процесса:<ul class="List_list__zLjGi list-disc pl-[30px]"><li>Таймаут работы приложения (в нашем примере это 60 секунд), защищающий от общего подвисания или неприемлемо долгого выполнения процесса.</li><li>Таймаут простоя приложения (в нашем примере это 5 секунд), защищающий от зависания процесса.</li></ul>Стоит отметить, что параметры таймаута нужно подбирать в зависимости от типа процесса, а также специфики работы, которую он проделывает. Ниже пример вывода при срабатывании таймаута простоя процесса:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-jCWzJg sc-fvubMj dhtvMQ iHnNEd prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 14:21:56]: Ожидаем завершения. Время работы 0/60 (с). Использование ЦП: 00:00:00.0312500...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 14:21:57]: Ожидаем завершения. Время работы 1/60 (с). Использование ЦП: 00:00:00.0468750...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 14:21:58]: Ожидаем завершения. Время работы 2/60 (с). Использование ЦП: 00:00:00.0468750...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 14:21:59]: Ожидаем завершения. Время работы 3/60 (с). Использование ЦП: 00:00:00.0468750...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 14:22:00]: Ожидаем завершения. Время работы 4/60 (с). Использование ЦП: 00:00:00.0468750...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 14:22:01]: Ожидаем завершения. Время работы 5/60 (с). Использование ЦП: 00:00:00.0468750...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 14:22:02]: Ожидаем завершения. Время работы 6/60 (с). Использование ЦП: 00:00:00.0468750...</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 14:22:08]: Работа процесса завершена. Код завершения: -1</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[31.07.2024 14:22:08]: Вывод работы программы (последние 10 строк):</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">&lt;&lt;&lt;&lt;&lt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10395000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10396000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10397000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10398000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10399000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">1000 rows successfully bulk-copied to host-file. Total received: 10400000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">10400008 rows copied.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Network packet size (bytes): 4096</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Clock Time (ms.) Total     : 13016  Average : (799017.19 rows per sec.)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">&gt;&gt;&gt;&gt;&gt;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">В самом начале процесс использовал ЦП, а потом следующие 5 секунд никакой активности не было обнаружено. Процесс в итоге был принудительно завершен.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Однако, даже эти контроли не всегда могут удовлетворить решению задачи.</p></section><section id="section-terminal-output"><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="terminal-output">Читаем вывод консоли</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">В некоторых сценариях у приложения может не быть возможности вывода результата работы в файл лога, как мы это делали с помощью параметра <b>-o</b> с указанием результатирующего файла. В этих случаях остается единственный вариант получить вывод работы программы - это прочитать консольный вывод.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">На основе консольного вывода мы также можем сделать два вида проверок:<ul class="List_list__zLjGi list-disc pl-[30px]"><li><b>Таймаут вывода сообщений в консоль.</b> То есть, если приложение долго не подает никаких сообщений, то можем посчитать его зависшим.</li><li><b>Анализ вывода на наличие ошибок.</b> Если в консоль выведено сообщение об ошибке, и при этом ожидается какое-то интерактивное действия, то мы можем среагировать и завершить приложение.</li></ul></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Объект класса <a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.diagnostics.process" target="_blank" rel="noopener noreferrer"><b><u>Process</u></b></a> позволяет это сделать. Для этого достаточно перенаправить стандартный вывод консоли, включил следующие опции у процесса:<ul class="List_list__zLjGi list-disc pl-[30px]"><li><a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.diagnostics.processstartinfo.redirectstandardoutput" target="_blank" rel="noopener noreferrer"><b><u>RedirectStandardOutput</u></b></a> - перенаправление стандартного вывода.</li><li><a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.diagnostics.processstartinfo.redirectstandarderror" target="_blank" rel="noopener noreferrer"><b><u>RedirectStandardError</u></b></a> - перенаправление стандартного вывода об ошибках.</li></ul>Также установим свойству <b>CreateNoWindow</b> процесса флаг в <b>True</b>, чтобы для процесса не создавалось окна, ведь интерактивного взаимодействия с ним не предполагается.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Теперь мы можем подписаться на события объекта для обработки поступающих сообщений:<ul class="List_list__zLjGi list-disc pl-[30px]"><li><a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.diagnostics.process.outputdatareceived" target="_blank" rel="noopener noreferrer"><b><u>OutputDataReceived</u></b></a> - событие записи строки в перенаплавненный поток вывода.</li><li><a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.diagnostics.process.errordatareceived" target="_blank" rel="noopener noreferrer"><b><u>ErrorDataReceived</u></b></a> - событие записи строки в перенаплавненный поток вывода об ошибках.</li></ul>Но дьявол, как обычно, в деталях. Мы не можем просто так взять и подписаться на события получения событий вывода. Во-первых нам нужно учесть возможность ожидания вывода при ожидании завершения работы процесса. Во-вторых, нам необходимо учесть таймаут вывода сообщений на консоль и собирать их, в том числе для последующего вывода или передачи вызывающему коду приложения.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Также есть еще один важный нюанс, который нужно учесть. Это возможное переполнение внутреннего буфера консольного вывода при ожидании завершения процесса методом <a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.diagnostics.process.waitforexit" target="_blank" rel="noopener noreferrer"><b><u>ErrorDataReceived</u></b></a>. Такое происходит по двум основным причинам:<ul class="List_list__zLjGi list-disc pl-[30px]"><li>Если начать ожидание завершения процесса перед считыванием потоков вывода <b>StandardOutput</b> и <b>StandardError</b>. Процесс может заблокировать запись в них, из-за чего происходит взаимоблокировка и бесконечное ожидание потоков друг друга.</li><li>Если начать чтение потоков вывода <b>StandardOutput</b> и <b>StandardError</b> через вызов метода <b>ReadToEnd</b>, процесс также блокирует буфер, что также приводит к взаимоблокировке.</li></ul></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Для решения этих проблем нужно воспользоваться асинхронным чтением данных вывода из потоков, что позволит избежать ситуации переполнения внутреннего буфера. Ниже пример реализации такого чтения, а также таймаута активности консольного вывода приложения:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-jVxTAy sc-erPUmh hOqCoB yIIBG prism-code language-csharp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Параметры запуска утилиты</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> userName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;sa&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> userPassword </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;ПарольПользователя&gt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> objectName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;dbo.Programms&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> uploadFilePath </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C:\Temp\BCP\Programms.bak&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> databaseName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;TestDB&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> instanceName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;SRV-SQL-1&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> logFilePath </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C:\Temp\BCP\Programms_Export.out&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Таймаут выполнения процесса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> timeoutSeconds </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">60</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Таймаут простоя процесса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> timeoutProcessCpuIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">60</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Последнее значение использования ресурсов ЦП процессом</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">TimeSpan</span><span class="token plain"> lastCpuProcessUsage </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> TimeSpan</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">MinValue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Дата последней активности процеса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">DateTime</span><span class="token plain"> lastCpuActivity </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">MinValue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Время простоя в секундах с последней активности</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> processCpuIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Таймаут активности конольного вывода</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> timeoutConsoleOutputActivity </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Время простоя консольного вывода</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> consoleOutputIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Информация о выводе консольного приложения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">StringBuilder</span><span class="token plain"> outputMessage </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">StringBuilder</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">StringBuilder</span><span class="token plain"> outputErrorMessage </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">StringBuilder</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Даты последнего вывода</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">DateTime</span><span class="token plain"> lastOutputDate </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">MinValue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Объекты для синхронизации обновления дат последнего вывода на консоль</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">object</span><span class="token plain"> lockLastOutputDateUpdate </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name keyword" style="color:rgb(86, 156, 214)">object</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Инициализация объекта с параметрами запуска приложения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">ProcessStartInfo</span><span class="token plain"> startInfo </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">ProcessStartInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">WindowStyle </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ProcessWindowStyle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Hidden</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Переопредлеяем вывод сообщений из стандартной консоли</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">RedirectStandardOutput </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">RedirectStandardError </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Создание окна приложения отключаем</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CreateNoWindow </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">FileName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;bcp&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Arguments </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">objectName</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)"> out &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">uploadFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-d </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">databaseName</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)"> &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-l 15 &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-P &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">userPassword</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-S &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">instanceName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-U &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">userName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-N &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;-o &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">logFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Создаем события синхронизации потоков.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// outputWaitHandle - для вывода сообщений основного потока вывода.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// errorWaitHandle - для вывода сообщений потока вывода об ошибках.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">AutoResetEvent</span><span class="token plain"> outputWaitHandle </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">AutoResetEvent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">AutoResetEvent</span><span class="token plain"> errorWaitHandle </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">AutoResetEvent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token class-name" style="color:rgb(78, 201, 176)">DateTime</span><span class="token plain"> startProcess </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">UtcNow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        lastOutputDate </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">UtcNow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Запуск процесса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">Process</span><span class="token plain"> process </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">Process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">StartInfo </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> startInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Подписываемся на события получения сообщений в потоки вывода</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">OutputDataReceived </span><span class="token operator" style="color:rgb(212, 212, 212)">+=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Data </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Передаем сигнал на продолжение ожидающего потока</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    outputWaitHandle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Добаляем сообщение вывода и обновляем дату последней активности в консоли</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    outputMessage</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">AppendLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">lock</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">lockLastOutputDateUpdate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        lastOutputDate </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">UtcNow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ErrorDataReceived </span><span class="token operator" style="color:rgb(212, 212, 212)">+=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Data </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Передаем сигнал на продолжение ожидающего потока</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    errorWaitHandle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Добаляем сообщение вывода и обновляем дату последней активности в консоли</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    outputErrorMessage</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">AppendLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">lock</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">lockLastOutputDateUpdate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        lastOutputDate </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">UtcNow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Start</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// Инициируем чтение вывода сообщений на консоль</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">BeginOutputReadLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">BeginErrorReadLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... и ожидание завершения приложения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// Примечание: можно ожидать завершения таким способом, </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// но тогда мы не сможем интерактивно выводить</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// сообщение об ожидании.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! В качестве параметра передаем таймаут ожидания в мс.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// int timeoutMs = timeoutSeconds * 1000;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// process.WaitForExit(timeoutMs)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">//    &amp;&amp; outputWaitHandle.WaitOne(timeoutMs)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">//    &amp;&amp; errorWaitHandle.WaitOne(timeoutMs)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// Обновляем время работы программы</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> workingTimeSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">UtcNow </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> startProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TotalSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain">process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">HasExited</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                   </span><span class="token comment" style="color:rgb(106, 153, 85)">// Проверка времени со старта процесса на превышение таймаута</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                   </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">timeoutSeconds </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">||</span><span class="token plain"> workingTimeSec </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> timeoutSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                   </span><span class="token comment" style="color:rgb(106, 153, 85)">// Проверка времени простоя при использовании ЦП</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                   </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">timeoutProcessCpuIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">||</span><span class="token plain"> processCpuIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> timeoutProcessCpuIdleSec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                   </span><span class="token comment" style="color:rgb(106, 153, 85)">// Проверка времени простоя консоли вывода</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                   </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">timeoutConsoleOutputActivity </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">||</span><span class="token plain"> consoleOutputIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> timeoutConsoleOutputActivity</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">UtcNow</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">]: Ожидаем завершения. Время работы </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">workingTimeSec</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">/</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">timeoutSeconds</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)"> (с). &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;Использование ЦП: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">process</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">TotalProcessorTime</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">. Простой консоли: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">consoleOutputIdleSec</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">...&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                Thread</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token comment" style="color:rgb(106, 153, 85)">// Обновляем время работы программы</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                workingTimeSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">UtcNow </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> startProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TotalSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token comment" style="color:rgb(106, 153, 85)">// Обновлям информацию о последней активности процесса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">lastCpuProcessUsage </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TotalProcessorTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    lastCpuProcessUsage </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TotalProcessorTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    lastCpuActivity </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">UtcNow</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    processCpuIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">lastCpuActivity </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">MinValue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    processCpuIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">UtcNow </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> lastCpuActivity</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TotalSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Обновление состояния активности консоли</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                consoleOutputIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">UtcNow </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> lastOutputDate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TotalSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// Если процесс еще активен, то завершаем его принудительно</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain">process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">HasExited</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Kill</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Now</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">]: Работа процесса завершена. Код завершения: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">process</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">ExitCode</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Выводим на экран последние 10 строк лога работы утилиты</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Now</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">]: Вывод работы программы (последние 10 строк):&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;&lt;&lt;&lt;&lt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">File</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Exists</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">logFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> lastOutputLines </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> File</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ReadAllLines</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">logFilePath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">TakeLast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ToList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> line </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> lastOutputLines</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&gt;&gt;&gt;&gt;&gt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Листинг уже значительно расширился, по сравнению с первыми примерами. Рассмотрим что здесь поменялось.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">В самом начале мы объявили ряд новых переменных:<ul class="List_list__zLjGi list-disc pl-[30px]"><li><b>timeoutConsoleOutputActivity</b> - таймаут появления новых сообщений в консоли вывода. То есть, если в течении заданного периода времени в консоли не появлялось новых сообщений, то считаем процесс зависшим.</li><li><b>consoleOutputIdleSec</b> - здесь будет храниться текущий простой консольного вывода для сравнения его с таймаутом. Значение будет обновляться в цикле ниже.</li><li><b>outputMessage</b> и <b>outputErrorMessage</b> - это набор строк, которые пришли из потоков вывода консоли. В будущем эти даные можно использовать для анализа работы программы.</li><li><b>lastOutputDate</b> - дата последнего сообщения в консоли.</li><li><b>lockLastOutputDateUpdate</b> - объект синхронизации потоков, чтобы безопасно обновлять дату последнего сообщения в консоли <b>lastOutputDate</b>.</li></ul></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Кроме этого мы создаем два объекта типа <a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.threading.autoresetevent" target="_blank" rel="noopener noreferrer"><b><u>AutoResetEvent</u></b></a> для реализации надежного ожидания завершения процесса, если такое понадобиться использовать. Ведь мы делаем асинхронное чтение сообщений консоли из буфера и логичнее было бы дождаться, когда все они попадут в коллекции <b>outputMessage</b> и <b>outputErrorMessage</b> перед выходом. Это достигается путем вызова метода <b>Set</b> при обнаружении пустого буфера в событиях <b>OutputDataReceived</b> и <b>ErrorDataReceived</b>. Теперь при необходимости ожидать завершения процесса мы можем так:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-iRTMaw sc-eKrodz gNKVzl WZZQU prism-code language-csharp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> timeoutMs </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> timeoutSeconds </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WaitForExit</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">timeoutMs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> outputWaitHandle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WaitOne</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">timeoutMs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> errorWaitHandle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WaitOne</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">timeoutMs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Также, при превышении времени простоя сообщений в консоль процесс будет завершен принудительно. Вот пример вывода программы в такой ситуации:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-jkvfRO sc-eXVaYZ bOyzFB kIarxM prism-code language-csharp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">31.07</span><span class="token number" style="color:rgb(181, 206, 168)">.2024</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">13</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">31</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">13</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Ожидаем завершения</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Время работы </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">с</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Использование ЦП</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">00.0468750</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Простой консоли</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token range operator" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">31.07</span><span class="token number" style="color:rgb(181, 206, 168)">.2024</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">13</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">31</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">14</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Ожидаем завершения</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Время работы </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">с</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Использование ЦП</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">00.0468750</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Простой консоли</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token range operator" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">31.07</span><span class="token number" style="color:rgb(181, 206, 168)">.2024</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">13</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">31</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Ожидаем завершения</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Время работы </span><span class="token number" style="color:rgb(181, 206, 168)">6</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">с</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Использование ЦП</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">00.0468750</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Простой консоли</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">6</span><span class="token range operator" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">31.07</span><span class="token number" style="color:rgb(181, 206, 168)">.2024</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">13</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">31</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">16</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Ожидаем завершения</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Время работы </span><span class="token number" style="color:rgb(181, 206, 168)">7</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">с</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Использование ЦП</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">00.0468750</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Простой консоли</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">7</span><span class="token range operator" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">31.07</span><span class="token number" style="color:rgb(181, 206, 168)">.2024</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">13</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">31</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Ожидаем завершения</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Время работы </span><span class="token number" style="color:rgb(181, 206, 168)">8</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">с</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Использование ЦП</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">00.0468750</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Простой консоли</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">8</span><span class="token range operator" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">31.07</span><span class="token number" style="color:rgb(181, 206, 168)">.2024</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">13</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">31</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">18</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Ожидаем завершения</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Время работы </span><span class="token number" style="color:rgb(181, 206, 168)">9</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">с</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Использование ЦП</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">00.0468750</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Простой консоли</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">9</span><span class="token range operator" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">31.07</span><span class="token number" style="color:rgb(181, 206, 168)">.2024</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">13</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">31</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">19</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Ожидаем завершения</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Время работы </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">с</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Использование ЦП</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">00.0468750</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Простой консоли</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token range operator" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">31.07</span><span class="token number" style="color:rgb(181, 206, 168)">.2024</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">16</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">31</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Работа процесса завершена</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Код завершения</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">31.07</span><span class="token number" style="color:rgb(181, 206, 168)">.2024</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">16</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">31</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Вывод работы программы </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">последние </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"> строк</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;&lt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;&gt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;&gt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Таким образом, мы решили дополнительно несколько вопросов:<ul class="List_list__zLjGi list-disc pl-[30px]"><li>Реализован таймаут работы процесса при простое вывода сообщений на консоль.</li><li>Решена проблема ожидания завершения процесса при чтении консольного вывода, когда могло произойти зависание из-за взаимоблокировки потоков.</li><li>Возможность анализа вывода на консоль для поиска ошибок и их обработки.</li></ul></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Что еще для счастья нужно при запуске приложений?</p></section><section id="section-env-res-and-so-on"><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="env-res-and-so-on">Окружение, ресурсы и так далее</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">К идеалу можно идти бесконечно и запуск процессов не является исключением. Рассмотрим еще несколько сторон контроля запускаемых процессов, которые, возможно, стоит реализовать.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Самое первое, что приходит в голову - это потребление ресурсов. Кто Вам теперь может помешать контролировать, например, потребляемую память процессом. В цикле ожидания завершения процесса можно добавить проверку объема занимаемой памяти процессов и если значение превышено, то процесс также будет завершен принудительно. На листинге эта часть может выглядеть примерно так:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-jxYSNo sc-zOxLx dWylOs fCeOFg prism-code language-csharp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain">process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">HasExited</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token comment" style="color:rgb(106, 153, 85)">// Проверка времени со старта процесса на превышение таймаута</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">timeoutSeconds </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">||</span><span class="token plain"> workingTimeSec </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> timeoutSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token comment" style="color:rgb(106, 153, 85)">// Проверка времени простоя при использовании ЦП</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">timeoutProcessCpuIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">||</span><span class="token plain"> processCpuIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> timeoutProcessCpuIdleSec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token comment" style="color:rgb(106, 153, 85)">// Проверка времени простоя консоли вывода</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">timeoutConsoleOutputActivity </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">||</span><span class="token plain"> consoleOutputIdleSec </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> timeoutConsoleOutputActivity</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// !!! Контроль потребления процессов</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">WorkingSet64 </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1073741824</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Если память рабочего набора запущенного процесса больше 1 ГБ,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// то прерываем ожидание и завершаем процесс принудительно</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Но это лишь небольшой пример, ведь проверять можно любые свойства процессов, состояние операционной системы и так далее. Все ограничивается лишь Вашим воображением и потребностями.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Еще одна интересная ситуация - это завершение работы дочернего процесса приложения, в котором мы все эти контроли и непосредственно запуск реализовали. Может сложиться ситуация, что наше приложение запустило внешний процесс и даже контролировало его работу пару минут, но потом по какой-то причине было завершено (ошибка приложения, кто-то закрыл его через диспетчер задач и так далее). В этом случае, запущенный процесс BCP.exe останется активным, не смотря на то, что родительское приложение уже не работает. Все это может привести к непредсказуемым результатам и поломкам.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Решить такую неприятную ситуацию можно разными способами. Например, при запуске приложения можно проверять наличие уже запущенных процессов BCP.exe. Если они есть, то завершать.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-cgHfjM sc-fpikKz dlcYZA eYQYOo prism-code language-csharp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Завершаем все процессы BCP.exe при запуске основного приложения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">GetProcesses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Where</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">e </span><span class="token operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ProcessName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Equals</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;bcp&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> StringComparison</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CurrentCultureIgnoreCase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ToList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ForEach</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">p </span><span class="token operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Kill</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Но это тоже нужно делать осторожно. Иногда лучше дождаться завершения такого процесса. А что еще страшнее, еще может понадобиться исправлять подобный некорректный запуск какими-то более сложными действиям. В общем, тут есть разные сложные схемы, но в отрыве от контекста описывать их смысла будет немного.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">И еще стоит упомянуть, что в ходе работы приложения может иметь смысл анализировать вывод на консоль сразу при получении сообщений. Или общий лог работы приложения. Здесь варианты анализа полностью зависят от приложения и какие логи оно записывает, поэтому примера как такового не будет.</p></section><section id="section-ideal-control"><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="ideal-control">Идеальный контроль</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Мы рассмотрели последовательный пример усиления контроля над запускаемыми процессами на примере утилиты BCP. По итогу у нас реализованы следующие контроли:<ul class="List_list__zLjGi list-disc pl-[30px]"><li><b>Таймаут работы приложения</b> - это общее время ожидания, сколько может работать запущенный процесс.</li><li><b>Таймаут простоя процесса</b> - это время, которое процесс может ничего не делать, то есть не потреблять ресурсы ЦП.</li><li><b>Таймаут простоя консоли вывода</b> - это время, которое приложение может не подавать никаких сообщений в консоль вывода. То есть, если приложение не будет писать в консоль никаких сообщений некоторое время, то контроль может посчитать процесс зависшим.</li><li><b>Безопасное ожидание завершения</b> - учитывается ошибка взаимоблокировки потоков из-за блокировки внутреннего буфера процесса.</li><li><b>Контроль ресурсов, окружения и логов</b> - мы упомянули, что контроль процесса можно расширять до бесконечно. От потребляемой им памяти, то окружения ОС и прочего.</li></ul></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Все вышеперечисленное можно использовать по отдельному или вместе, все зависит от задачи. Но достаточно ли этого?</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Для тех случаев, когда мы запускаем какой-то сторонний процесс, к исходному коду которого у нас нет доступа, данный подход поможет решить большинство вопросов. Но если мы запускаем процесс приложения, которое мы программируем сами или хотя бы имеем доступ к его исходному коду, то возможно есть смысл сделать контроль и взаимодействие процессов более надежным.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Речь здесь идет о том, что в такой ситуации мы можем подружить процессы между собой, наладить межпроцессное взаимодействие между ними. Через обмен сообщений можно будет реализовать не только контроль выполнения, но и обмен другими полезными сообщениями.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Создадим для примера два простых консольных приложения с самым примитивным контролем. Первое консольное приложение будет дочерним (то есть запускаться из другого приложения). В качестве параметров командной строки оно будет принимать:<ul class="List_list__zLjGi list-disc pl-[30px]"><li>Идентификатор родительского процесса</li><li>Имя родительского процесса</li></ul></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Переданные параметры сохраняются на время работы приложения и периодически проверяется наличие такого процесса в системе. Если родительский процесс с такими параметрами отсутствует, то и это приложение само себя завершит.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Ниже листинг дочернего консольного приложения <b>ChildProcess</b>:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-gWaSiO sc-kSaXSp dA-dTUx deRjuj prism-code language-csharp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token namespace">Diagnostics</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> parentProcessId </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> parentProcessName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;Родительский процесс. ID: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">parentProcessId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;Родительский процесс. Имя: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">parentProcessName</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> currentProcess </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">GetCurrentProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> currentProcessId </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> currentProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ToString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> currentProcessName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> currentProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ProcessName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">bool</span><span class="token plain"> parentProcessExists </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Process</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">GetProcesses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Where</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">e </span><span class="token operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ProcessName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Equals</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">parentProcessName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> StringComparison</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CurrentCultureIgnoreCase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Any</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">e </span><span class="token operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Id </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Parse</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">parentProcessId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">parentProcessExists</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;Дочерний процесс. ID: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">currentProcessId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;Дочерний процесс. Имя: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">currentProcessName</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Родительский процесс активен. Продолжаем работу...&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    Thread</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    parentProcessExists </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Process</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">GetProcesses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Where</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">e </span><span class="token operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ProcessName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Equals</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">parentProcessName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> StringComparison</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CurrentCultureIgnoreCase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Any</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">e </span><span class="token operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Id </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Parse</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">parentProcessId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Родительский процесс остановлен. Завершаем работу...&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Листинг дочернего приложения <b>ParentProcess</b>:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-bjxVRI sc-erZbsv dmsIfI fEeIbT prism-code language-csharp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token namespace">Diagnostics</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> currentProcess </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">GetCurrentProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> parentProcessId </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> currentProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ToString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> parentProcessName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> currentProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ProcessName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> childApp </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;ChildProcess.exe&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> argumentsApp </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">parentProcessId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">parentProcessName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Start</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">childApp</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> argumentsApp</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Для выхода нажмите любую клавишу...&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ReadKey</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Файлы обоих приложений поместим в один каталог и запустим дочернее приложение <b>ParentProcess</b>. Вот как это будет выглядеть.</p><div class="Images_article_image__wrapper__QSTzx my-4 Images_size_full__CHi3X display-block mx-auto my-5"><div aria-owns="rmiz-modal-" data-rmiz=""><div data-rmiz-content="not-found" style="visibility:visible"><img src="/imp_assets/.NET/2024-07/processes-under-control/1. parent-chile-process.gif" alt="Запуск зависимых процессов" width="100%" class="block"/></div></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Нажав любую клавишу мы завершим родительский процесс, а дочерний процесс завершится сам, как только проверка это обнаружит.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Конечно, это лишь простейший пример. Но его суть и посыл должны быть понятны:<ul class="List_list__zLjGi list-disc pl-[30px]"><li>Зависимые процессы должны мониторить состояние друг друга.</li><li>Обмен сообщениями между процессами возможен через TCP-соединения, файлы, общую память, HTTP-запросы и многие другие способы.</li><li>Нужно обязательно предусмотреть на стороне родительского процесса поведение, если дочерний процесс был внезапно завершен.</li><li>Аналогично на стороне дочернего процесса предусмотреть действия, если родительский процесс был завершен.</li></ul></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Все это лишь базовая информация и межпроцессное взаимодействие более обширная и интересная тема. Но именно благодаря такому подходу взаимодействие и контроль процессов можно выстроить максимально эффективным. Но сегодня на этом все.</p></section><section id="section-the-end"><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="the-end">Мысли напоследок</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Путь был небольшой, но мы успели рассмотреть шаги по укреплению контроля за внешними процессами, запущенными из среды .NET (C#). По сути контролировать процесс, поведение которого не может быть гарантировано стабильным, дело неблагодарное. Хоть мы и добавили разные виды таймаутов работы процесса, анализируем его консольный вывод и вывод лога на примере утилиты BCP.exe для SQL Server, контролируем потребляемые ресурсы этого процесса и так далее, но гарантировать приемлемый результат работы все равно нельзя.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Описанный подход контроля запущенного процесса лишь дает возможность защититься от зависаний и обработать типичные ошибки. Но если результат работы запущенного процесса будет непредсказуемым, то и обработать такие &quot;внезапные&quot; ошибки у нас нормально не получится. Например, если BCP.exe внезапно удалит существующие таблицы, то такое развитие событий Вы никак предусмотреть не сможете. Отсюда следует, что запуск внешних процессов это всегда риск и нужно лишь определять приемлемо ли это для решения Вашей задачи или нет.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Под конец статьи мы коснулись такого способа контроля и взаимодействия с процессами, который позволяет выстроить более тесные проверки и даже способы взаимодействия между процессами. Это максимально эффективный подход, но требует доступа к исходным кодам всех приложений, что не всегда возможно. Конечно, примеры были совсем примитивными и мы даже не создали пример сетевого взаимодействия между процессами, но это здесь и не было нужно. Главное - показать, что для эффективной работы нужно наладить хоть какой-то канал связи между процессами.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">За рамками статьи остается обширная тема межпроцессного взаимодействия, создание дочерних процессов и многое другое. Ниже Вы найдете ссылки на некоторые интересные библиотеки, в которых описанные в статье подходы в какой-то мере используются. Также там Вы найдете и альтернативные подходы.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Спасибо, что дочитали до конца! Теперь Вы знаете в какую сторону держать путь, если Вам нужно работать с внешними процессами и приложениями. Удачи в делах!</p></section><section id="section-links"><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="links">Это интересно</h1><ul class="List_list__zLjGi list-disc pl-[30px]"><li><a href="https://github.com/YPermitin/YPermitin.DBTools/tree/master/Libs/YPermitin.DBTools.SQLServer.BulkCopyProgramWrapper" target="_blank" rel="noopener noreferrer"><u><b>BulkCopyProgramWrapper - библиотека-оболочка для использования утилиты BCP (Bulk Copy Program).</b></u></a></li><li><a href="https://github.com/Cysharp/ProcessX" target="_blank" rel="noopener noreferrer"><u><b>ProcessX - простая библиотека для вызова внешних процессов с поддержкой асинхронности.</b></u></a></li><li><a href="https://github.com/lolp1/Process.NET" target="_blank" rel="noopener noreferrer"><u><b>Process.NET - Process.NET is a tool for interacting with processes based around a library called &quot;MemorySharp&quot; by Jämes Ménétrey aka ZenLulz under the license on the pages linked below.</b></u></a></li><li><a href="https://github.com/huysentruitw/process-manager" target="_blank" rel="noopener noreferrer"><u><b>ProcessManager - управляемая библиотека для запуска очереди процессов и управления ею.</b></u></a></li><li><a href="https://github.com/asmichi/ChildProcess" target="_blank" rel="noopener noreferrer"><u><b>Asmichi.ChildProcess - библиотека для создания дочерних процессов и взаимодействия с ними.</b></u></a></li></ul></section></article><div class="Seperator_section_seperator_line__gdWIB dark:border-white border-black"></div><div class="PageLayout_author_and_more__wxN3W mx-auto"><div class="bg-white dark:bg-slate-800 dark:border-none border-slate-100 shadow-lg border md:rounded-[8px] px-[15px] py-[10px] mb-[30px] overflow-hidden"><div class="flex items-center"><div class="flex items-center justify-center shadow-xl rounded-full overflow-hidden bg-blue-500 shrink-0 w-[60px] h-[60px] mr-3 text-xl"><p class="text-center font-medium text-white">Y</p></div><div class="font-semibold"><p class="text-[20px]  mb-0 mt-0">YPermitin</p><p class="text-xs mt-0 mb-0">.NET, TSQL, DevOps, 1C:Enterprise</p></div></div><p class="text-[16px] mt-2">Developer, just developer.</p><div class="flex items-center flex-wrap mt-3"><a href="https://github.com/YPermitin" target="_blank" class="mr-[15px] text-[32px]" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a></div></div><div class="bg-white dark:bg-slate-800 dark:border-none border-slate-100 shadow-lg border md:rounded-[8px] px-[15px] py-[10px] mb-[30px] overflow-hidden"><p class="border-b border-gray-300 pb-2 mb-3 font-medium w-full">Поделиться</p><div class="flex flex-wrap items-center"><a class="mr-3" aria-label="facebook-share" href="https://www.facebook.com/sharer/sharer.php?u=https://ypermitin.github.io" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-92.4 233.5h-63.9c-50.1 0-59.8 23.8-59.8 58.8v77.1h119.6l-15.6 120.7h-104V912H539.2V602.2H434.9V481.4h104.3v-89c0-103.3 63.1-159.6 155.3-159.6 44.2 0 82.1 3.3 93.2 4.8v107.9z"></path></svg></a><a class="mr-3" aria-label="twitter-share" href="http://twitter.com/share?text=Check out this article!! &amp;url=https://ypermitin.github.io&amp;hashtags=webdevelopment,javacript,javascriptdaily,webdevelopmenttutorial,tutorial" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm215.3 337.7c.3 4.7.3 9.6.3 14.4 0 146.8-111.8 315.9-316.1 315.9-63 0-121.4-18.3-170.6-49.8 9 1 17.6 1.4 26.8 1.4 52 0 99.8-17.6 137.9-47.4-48.8-1-89.8-33-103.8-77 17.1 2.5 32.5 2.5 50.1-2a111 111 0 0 1-88.9-109v-1.4c14.7 8.3 32 13.4 50.1 14.1a111.13 111.13 0 0 1-49.5-92.4c0-20.7 5.4-39.6 15.1-56a315.28 315.28 0 0 0 229 116.1C492 353.1 548.4 292 616.2 292c32 0 60.8 13.4 81.1 35 25.1-4.7 49.1-14.1 70.5-26.7-8.3 25.7-25.7 47.4-48.8 61.1 22.4-2.4 44-8.6 64-17.3-15.1 22.2-34 41.9-55.7 57.6z"></path></svg></a><a class="mr-3" aria-label="linkedin-share" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://ypermitin.github.io&amp;title=Check out this article!!&amp;source=LinkedIn" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[23px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"></path></svg></a><button class="mr-3" name="copy-link" aria-label="copy-link"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z"></path><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243z"></path></svg></button></div><div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded fixed flex transition-all right-[10px] -bottom-20 opacity-0" role="alert"><strong class="font-bold">Link Copied</strong><span class="pl-5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="pt-1 text-[18px] cursor-pointer" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"></path></svg></span></div></div><div class="bg-white dark:bg-slate-800 dark:border-none border-slate-100 shadow-lg border md:rounded-[8px] px-[15px] py-[10px] mb-[30px] overflow-hidden"><p class="border-b border-gray-300 pb-2 mb-3 font-medium w-full">Другие статьи</p><div class="flex flex-wrap"><div class="mb-3 cursor-pointer lg:w-1/3 md:w-1/2 w-full md:pr-2" href="/blog/CPP/2025-07/cpp-path-to-gui/"><div class=" rounded-[3px] dark:bg-slate-800 border border-slate-200 dark:border-slate-900 flex items-center overflow-hidden shadow-lg hover:shadow-md "><div class="object-cover shrink-0"><img src="/imp_assets/CPP/2025-07/cpp-path-to-gui/logo.png" class="w-[120px] h-[70px] mr-2 object-cover" alt="Тернистый путь к графическому интерфейсу на C++"/></div><div class="pr-1 text-[16px] hover:text-blue-500 font-semibold">Тернистый путь к графическому интерфейсу на C++</div></div></div><div class="mb-3 cursor-pointer lg:w-1/3 md:w-1/2 w-full md:pr-2" href="/blog/.NET/2025-02/sqlserver-and-clickhouse-friendship/"><div class=" rounded-[3px] dark:bg-slate-800 border border-slate-200 dark:border-slate-900 flex items-center overflow-hidden shadow-lg hover:shadow-md "><div class="object-cover shrink-0"><img src="/imp_assets/.NET/2025-02/sqlserver-and-clickhouse-friendship/logo.png" class="w-[120px] h-[70px] mr-2 object-cover" alt="Дружба между SQL Server и ClickHouse. SQLCLR снова с нами"/></div><div class="pr-1 text-[16px] hover:text-blue-500 font-semibold">Дружба между SQL Server и ClickHouse. SQLCLR снова с нами</div></div></div><div class="mb-3 cursor-pointer lg:w-1/3 md:w-1/2 w-full md:pr-2" href="/blog/.NET/2024-12/protect-dublicate-process/"><div class=" rounded-[3px] dark:bg-slate-800 border border-slate-200 dark:border-slate-900 flex items-center overflow-hidden shadow-lg hover:shadow-md "><div class="object-cover shrink-0"><img src="/imp_assets/.NET/2024-12/protect-dublicate-process/logo.png" class="w-[120px] h-[70px] mr-2 object-cover" alt="Контроль дубликатов процессов в C# (.NET)"/></div><div class="pr-1 text-[16px] hover:text-blue-500 font-semibold">Контроль дубликатов процессов в C# (.NET)</div></div></div><a class="cursor-pointer hover:text-blue-500 block text-sm py-3 px-2 text-center dark:bg-slate-900 bg-blue-500 rounded text-white font-bold hover:!text-blue-900 dark:hover:!text-slate-400 transition-all" href="/blog/?author=YPermitin"><p>Все статьи от автора: <!-- -->YPermitin</p></a></div></div></div></div></section><div class="dark:bg-slate-900 dark:text-white bg-slate-100 text-black"><div class="md:container flex items-center md:justify-center justify-around flex-wrap md:text-[14px] text-[12px] py-5"><p class="my-0 mr-[10px] md:mr-3">Copyright © <!-- -->2025<!-- --> <!-- -->Убежище инженера</p></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/.NET/2024-07/processes-under-control","query":{},"buildId":"-bGN1hEP2YVpKeQylWsrE","nextExport":true,"autoExport":true,"isFallback":false,"dynamicIds":[91274,28681,97897,7200,2726],"scriptLoader":[]}</script></body></html>