<!DOCTYPE html><html lang="en" translate="no"><head><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"/><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="google" content="notranslate"/><title>Поиск устройств в сети с .NET (C#) | Убежище инженера | YPermitin</title><meta name="robots" content="index,follow"/><meta name="description" content="Поиск устройств в сети с помощью C# (.NET). Пинг, сканирование сети, UDP и др."/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://ypermitin.github.io/blog/.NET/2024-06/detect-devices-with-charp"/><meta property="og:title" content="Поиск устройств в сети с .NET (C#) | Убежище инженера | YPermitin"/><meta property="og:description" content="Поиск устройств в сети с помощью C# (.NET). Пинг, сканирование сети, UDP и др."/><meta property="og:url" content="https://ypermitin.github.io/blog/.NET/2024-06/detect-devices-with-charp"/><meta property="og:type" content="website"/><meta property="og:image" content="https://ypermitin.github.io/imp_assets/.NET/2024-06/detect-devices-with-charp/logo.png"/><meta property="og:image:alt" content="Поиск устройств в сети с .NET (C#) | Убежище инженера | YPermitin"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:locale" content="en_IN"/><meta property="og:site_name" content="Убежище инженера"/><link rel="canonical" href="https://webexpe.com/"/><meta property="keywords" content=".NET, C#, разработка, сеть, устройства"/><meta property="al:web:url" content="https://ypermitin.github.io/blog/.NET/2024-06/detect-devices-with-charp"/><meta name="next-head-count" content="23"/><link rel="preload" href="/_next/static/css/8b3cba25ed5aab85.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8b3cba25ed5aab85.css" data-n-g=""/><link rel="preload" href="/_next/static/css/0eb3a85c2cff7e2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0eb3a85c2cff7e2b.css"/><link rel="preload" href="/_next/static/css/4a9df9e795bce52b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4a9df9e795bce52b.css"/><link rel="preload" href="/_next/static/css/ee5420a43edabb61.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ee5420a43edabb61.css"/><link rel="preload" href="/_next/static/css/88381d5dde4793c2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/88381d5dde4793c2.css"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script defer="" src="/_next/static/chunks/3a17f596-bbda16a68580be6f.js"></script><script defer="" src="/_next/static/chunks/fea29d9f.d7e20b827bc1967e.js"></script><script defer="" src="/_next/static/chunks/1664-c723d321aa16b9fd.js"></script><script defer="" src="/_next/static/chunks/8765.c3068153c4a9a4e3.js"></script><script defer="" src="/_next/static/chunks/3220.0b189779e06b0c1b.js"></script><script defer="" src="/_next/static/chunks/935.1ba77160b2eb4873.js"></script><script defer="" src="/_next/static/chunks/7355.d7ae2aaed607b6ac.js"></script><script defer="" src="/_next/static/chunks/7651.8de5823eb659d9d7.js"></script><script src="/_next/static/chunks/webpack-ae7b17597bc76f2c.js" defer=""></script><script src="/_next/static/chunks/framework-0e8d27528ba61906.js" defer=""></script><script src="/_next/static/chunks/main-9a17b44c0e255394.js" defer=""></script><script src="/_next/static/chunks/pages/_app-23f6afd5d93a4ecb.js" defer=""></script><script src="/_next/static/chunks/4104-8bb1863d9058cd65.js" defer=""></script><script src="/_next/static/chunks/pages/blog/.NET/2024-06/detect-devices-with-charp-52cb6cb4495d9878.js" defer=""></script><script src="/_next/static/dVtbNnhxtAkTMvLMok3El/_buildManifest.js" defer=""></script><script src="/_next/static/dVtbNnhxtAkTMvLMok3El/_ssgManifest.js" defer=""></script></head><body class="bg-slate-100 dark:bg-slate-900 transition-all"><div id="__next"><div data-overlay-container="true"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><nav class="Navbar_navbar__W_ouQ bg-white  dark:bg-slate-900 dark:text-white text-black"><div class="container flex items-center justify-between px-2"><div class="flex items-center"><div class="Navbar_mobileBurgerToggle__Bj_52 mr-5  "><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="dark:text-white text-black text-2xl" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></div><a class="text-[22px] font-semibold" href="/">Убежище инженера</a></div><div class="flex items-center"><div class="text-[14px] font-normal items-center lg:flex hidden"><a class="cursor-pointer hover:text-blue-500 mx-2" href="/">Главная</a><div class="relative"><div class="flex items-center cursor-pointer mx-2"><p class="my-0">Блог</p><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="text-[20px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16.293 9.293 12 13.586 7.707 9.293l-1.414 1.414L12 16.414l5.707-5.707z"></path></svg></div><div class="overflow-auto absolute w-[180px] z-20 top-[30px] rounded-[4px] shadow-lg bg-white dark:bg-slate-800 border border-gray-300 dark:border-0 h-0 border-0"><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2" href="/blog/"><span>Все публикации</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=C++"><span style="text-transform:capitalize">C++</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=.NET"><span style="text-transform:capitalize">.NET</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=DevOps"><span style="text-transform:capitalize">DevOps</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=PostgreSQL"><span style="text-transform:capitalize">PostgreSQL</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=SQL%20Server"><span style="text-transform:capitalize">SQL Server</span></a></div></div><a class="cursor-pointer hover:text-blue-500 mx-2" href="/instruments/">Инструменты</a><a class="cursor-pointer hover:text-blue-500 mx-2" href="/about/">Обо мне</a><a class="cursor-pointer hover:text-blue-500 mx-2" href="/contact/">Контакты</a><div class="ml-5 pt-1"><a href="https://github.com/YPermitin/" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a><a href="https://t.me/TinyDevVault" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"></path></svg></a><a href="mailto:i.need.ypermitin@yandex.ru" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0 0 68.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"></path></svg></a><a href="https://boosty.to/ypermitin" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 21h9.62a3.995 3.995 0 0 0 3.037-1.397l5.102-5.952a1 1 0 0 0-.442-1.6l-1.968-.656a3.043 3.043 0 0 0-2.823.503l-3.185 2.547-.617-1.235A3.98 3.98 0 0 0 9.146 11H4c-1.103 0-2 .897-2 2v6c0 1.103.897 2 2 2zm0-8h5.146c.763 0 1.448.423 1.789 1.105l.447.895H7v2h6.014a.996.996 0 0 0 .442-.11l.003-.001.004-.002h.003l.002-.001h.004l.001-.001c.009.003.003-.001.003-.001.01 0 .002-.001.002-.001h.001l.002-.001.003-.001.002-.001.002-.001.003-.001.002-.001c.003 0 .001-.001.002-.001l.003-.002.002-.001.002-.001.003-.001.002-.001h.001l.002-.001h.001l.002-.001.002-.001c.009-.001.003-.001.003-.001l.002-.001a.915.915 0 0 0 .11-.078l4.146-3.317c.262-.208.623-.273.94-.167l.557.186-4.133 4.823a2.029 2.029 0 0 1-1.52.688H4v-6zM16 2h-.017c-.163.002-1.006.039-1.983.705-.951-.648-1.774-.7-1.968-.704L12.002 2h-.004c-.801 0-1.555.313-2.119.878C9.313 3.445 9 4.198 9 5s.313 1.555.861 2.104l3.414 3.586a1.006 1.006 0 0 0 1.45-.001l3.396-3.568C18.688 6.555 19 5.802 19 5s-.313-1.555-.878-2.121A2.978 2.978 0 0 0 16.002 2H16zm1 3c0 .267-.104.518-.311.725L14 8.55l-2.707-2.843C11.104 5.518 11 5.267 11 5s.104-.518.294-.708A.977.977 0 0 1 11.979 4c.025.001.502.032 1.067.485.081.065.163.139.247.222l.707.707.707-.707c.084-.083.166-.157.247-.222.529-.425.976-.478 1.052-.484a.987.987 0 0 1 .701.292c.189.189.293.44.293.707z"></path></svg></a></div></div><div class="Navbar_search_icon_wrapper__1a_rL ml-5 dark:text-white"><button name="search-button" aria-label="search button"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="dark:text-white text-black text-[22px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg></button></div><div class=""><button name="share" aria-label="share page"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="dark:text-white text-black text-[16px] mt-[7px] ml-2 mr-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5"></path></svg></button></div><button name="theme-switch" aria-label="theme button" class="Navbar_theme_switch__q7F_Z pl-3 dark:text-white text-black"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-md " height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278"></path></svg></button></div></div></nav><aside class="Navbar_nav_sidebar_wrapper__M0KaI dark:bg-slate-900 dark:text-white bg-white text-black"><div class="flex items-center justify-between pb-3"><p class="">МЕНЮ</p><div><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="text-slate-800 dark:text-white text-[25px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg></div></div><hr/><div class="my-15"><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/">Главная</a><div class="relative"><div class="flex items-center cursor-pointer justify-between"><p class="my-0">Блог</p><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="text-[20px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16.293 9.293 12 13.586 7.707 9.293l-1.414 1.414L12 16.414l5.707-5.707z"></path></svg></div><div class="overflow-auto relative h-0 border-0"><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2" href="/blog/"><span>Все публикации</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=C++"><span style="text-transform:capitalize">C++</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=.NET"><span style="text-transform:capitalize">.NET</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=DevOps"><span style="text-transform:capitalize">DevOps</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=PostgreSQL"><span style="text-transform:capitalize">PostgreSQL</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=SQL%20Server"><span style="text-transform:capitalize">SQL Server</span></a></div></div><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/instruments/">Инструменты</a><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/about/">Обо мне</a><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/contact/">Контакты</a></div><hr/><div class="my-5"><p class="font-light">Подписаться : </p> <a href="https://github.com/YPermitin/" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a><a href="https://t.me/TinyDevVault" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"></path></svg></a><a href="mailto:i.need.ypermitin@yandex.ru" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0 0 68.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"></path></svg></a><a href="https://boosty.to/ypermitin" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 21h9.62a3.995 3.995 0 0 0 3.037-1.397l5.102-5.952a1 1 0 0 0-.442-1.6l-1.968-.656a3.043 3.043 0 0 0-2.823.503l-3.185 2.547-.617-1.235A3.98 3.98 0 0 0 9.146 11H4c-1.103 0-2 .897-2 2v6c0 1.103.897 2 2 2zm0-8h5.146c.763 0 1.448.423 1.789 1.105l.447.895H7v2h6.014a.996.996 0 0 0 .442-.11l.003-.001.004-.002h.003l.002-.001h.004l.001-.001c.009.003.003-.001.003-.001.01 0 .002-.001.002-.001h.001l.002-.001.003-.001.002-.001.002-.001.003-.001.002-.001c.003 0 .001-.001.002-.001l.003-.002.002-.001.002-.001.003-.001.002-.001h.001l.002-.001h.001l.002-.001.002-.001c.009-.001.003-.001.003-.001l.002-.001a.915.915 0 0 0 .11-.078l4.146-3.317c.262-.208.623-.273.94-.167l.557.186-4.133 4.823a2.029 2.029 0 0 1-1.52.688H4v-6zM16 2h-.017c-.163.002-1.006.039-1.983.705-.951-.648-1.774-.7-1.968-.704L12.002 2h-.004c-.801 0-1.555.313-2.119.878C9.313 3.445 9 4.198 9 5s.313 1.555.861 2.104l3.414 3.586a1.006 1.006 0 0 0 1.45-.001l3.396-3.568C18.688 6.555 19 5.802 19 5s-.313-1.555-.878-2.121A2.978 2.978 0 0 0 16.002 2H16zm1 3c0 .267-.104.518-.311.725L14 8.55l-2.707-2.843C11.104 5.518 11 5.267 11 5s.104-.518.294-.708A.977.977 0 0 1 11.979 4c.025.001.502.032 1.067.485.081.065.163.139.247.222l.707.707.707-.707c.084-.083.166-.157.247-.222.529-.425.976-.478 1.052-.484a.987.987 0 0 1 .701.292c.189.189.293.44.293.707z"></path></svg></a><hr class="mt-5"/></div><div class="mt-5 mb-4"><p class="mb-2 font-light">Переключиться на <!-- -->светлую<!-- --> тему :</p><button name="theme-switch" aria-label="theme-switch" class="Navbar_theme_switch__q7F_Z dark:text-white text-black"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-lg" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278"></path></svg></button></div><hr/><div class="my-5"><p class="text-sm font-light dark:text-gray-400 text-gray-500 mb-1">Copyright © 2024</p></div></aside><div class="transition-all fixed h-screen w-screen flex items-center justify-center left-0 z-20 top-0 pointer-events-none opacity-0"><div class="absolute top-0 left-0 w-screen h-screen bg-black opacity-50"></div><div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded lg:w-1/6 mx-3 w-full relative z-10 transition-all top-10"><div class="flex border-gray-300 pb-2 mb-3 border-b"><p class="  font-medium w-full">Share:</p><span class="pl-5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="pt-1 text-[18px] cursor-pointer" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"></path></svg></span></div><div class="flex flex-wrap items-center"><a class="mr-3" aria-label="facebook-share" href="https://www.facebook.com/sharer/sharer.php?u=https://ypermitin.github.io" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-92.4 233.5h-63.9c-50.1 0-59.8 23.8-59.8 58.8v77.1h119.6l-15.6 120.7h-104V912H539.2V602.2H434.9V481.4h104.3v-89c0-103.3 63.1-159.6 155.3-159.6 44.2 0 82.1 3.3 93.2 4.8v107.9z"></path></svg></a><a class="mr-3" aria-label="twitter-share" href="http://twitter.com/share?text=Check out this article!! &amp;url=https://ypermitin.github.io&amp;hashtags=webdevelopment,javacript,javascriptdaily,webdevelopmenttutorial,tutorial" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm215.3 337.7c.3 4.7.3 9.6.3 14.4 0 146.8-111.8 315.9-316.1 315.9-63 0-121.4-18.3-170.6-49.8 9 1 17.6 1.4 26.8 1.4 52 0 99.8-17.6 137.9-47.4-48.8-1-89.8-33-103.8-77 17.1 2.5 32.5 2.5 50.1-2a111 111 0 0 1-88.9-109v-1.4c14.7 8.3 32 13.4 50.1 14.1a111.13 111.13 0 0 1-49.5-92.4c0-20.7 5.4-39.6 15.1-56a315.28 315.28 0 0 0 229 116.1C492 353.1 548.4 292 616.2 292c32 0 60.8 13.4 81.1 35 25.1-4.7 49.1-14.1 70.5-26.7-8.3 25.7-25.7 47.4-48.8 61.1 22.4-2.4 44-8.6 64-17.3-15.1 22.2-34 41.9-55.7 57.6z"></path></svg></a><a class="mr-3" aria-label="linkedin-share" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://ypermitin.github.io&amp;title=Check out this article!!&amp;source=LinkedIn" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[23px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"></path></svg></a><button class="mr-3" name="copy-link" aria-label="copy-link"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z"></path><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243z"></path></svg></button></div><div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded fixed flex transition-all right-[10px] -bottom-20 opacity-0" role="alert"><strong class="font-bold">Link Copied</strong><span class="pl-5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="pt-1 text-[18px] cursor-pointer" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"></path></svg></span></div></div></div><section class="PageLayout_centered_article_wrapper__gS3Af dark:bg-slate-900 dark:text-white"><div class="container px-0 md:px-[15px] pt-[50px] pb-[50px]"><article class="PageLayout_article_content__4dnq3 pb-[30px] px-3 bg-white dark:bg-slate-800 dark:border-none dark:drop-shadow-lg dark:text-white pt-10 md:pt-0 mx-auto font-regular text-lg leading-relaxed"><div class="mb-[30px]"><h1 class="ArticleHeader_articleTitle__3L1Bi text-center text-2xl md:text-4xl font-medium mt-[20px] mb-[5px]">Поиск устройств в сети с .NET (C#)</h1><div class="mb-[10px] mt-[15px] text-[14px] font-medium ArticleHeader_centered_article_header_author___gRtE"><p class="my-0 mx-[30px] font-medium">YPermitin<span class="px-1 font-light">в</span><a href="/blog/?category=.NET">.NET</a></p><p class="my-0">2024-06-28</p></div><div class="md:mt-2 flex flex-wrap justify-center"><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->.NET</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->C#</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->разработка</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->сеть</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->устройства</p></div></div><blockquote class="text_quoted_text__5DQLs" style="text-align:right"><q>Чтобы найти иголку в стоге сена, достаточно сжечь сено<br/>и провести магнитом над пеплом.<br/>(с) Бернар Вербер</q></blockquote><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Поиск устройств в сети с помощью C# (.NET). Пинг, сканирование сети, ARP, широковещательные сообщения UDP. А также делаем пример приложений для RasberryPi и Android с возможностью поиска устройства со смартфона.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset">Содержание</h1><ul class="List_list__zLjGi list-disc pl-[30px]"><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-06/detect-devices-with-charp/#network-araound-as"><b><u>Сеть вокруг нас</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-06/detect-devices-with-charp/#ping-pong"><b><u>Пинг-понг</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-06/detect-devices-with-charp/#check-and-arp"><b><u>Шах и ARP</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-06/detect-devices-with-charp/#scream-by-udp"><b><u>Крик через UDP</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-06/detect-devices-with-charp/#rasberry-pi-and-android"><b><u>Rasberry Pi + Android</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-06/detect-devices-with-charp/#malinka"><b><u>Прокаченная малинка</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-06/detect-devices-with-charp/#lets-maui"><b><u>MAUI в деле</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-06/detect-devices-with-charp/#fly"><b><u>Летим дальше!</u></b></a></li><li><a class="cursor-pointer hover:text-blue-500" href="/blog/.NET/2024-06/detect-devices-with-charp/#links"><b><u>Это интересно</u></b></a></li></ul><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="network-araound-as">Сеть вокруг нас</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Информация витает вокруг нас. Компьютерные сети стали повседневной нормальностью. Не важно дома ли Вы, на работе или прогуливаетесь на улице - сеть будет рядом, вы постоянно подключены. Глобальная сеть, он же <b>интернет</b>, доступна отовсюду: со смартфонов и компьютеров, из дома или за городом, на земле или в самолете. А количество подключенных к сети устройств имеет просто невероятное количество. Вот он, современный мир. Не зря же существует такое понятие как <a href="https://ru.wikipedia.org/wiki/%D0%98%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B5%D1%82_%D0%B2%D0%B5%D1%89%D0%B5%D0%B9" target="_blank" rel="noopener noreferrer"><b><u>интернет вещей</u></b></a>.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Давайте вернемся от высоких рассуждений к более практичным вопросам. Такое распостранение компьютерных сетей и устройств создают потребность в решении задач разработки ПО для таких устройств, их удобной интеграции, поиска и так далее. В большинстве языков программирования и платформ разработки имеются встроенные средства для работы с сетью. Платформа .NET и C# не являются исключениями.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Сегодня мы коснемся этой темы, но лишь в малой части. Мы будем искать устройства в сети от самых простых методов в виде <b>ping</b>&#x27;а, широковещательных UDP-сообщений, запроса информации с маршрутизатора и другое. Это ни в коем случае не всеобъемлющая информация. Это старт для написания собственных программ в части поиска устройств.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Завершим свою работу мы на приложениях для Rasberry Pi и Android. Со смартфона наше приложение сможет находить Rasberry Pi в сети и делать к нему запросы. Время пришло, начинаем!</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="ping-pong">Пинг-понг</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Самый простой способ для поиска устройств в сети, который первым приодит на ум, это конечно же использование операции <b>ping</b>. По своей сути, <b>ping</b> - это средство для проверки доступности узла в сети через отправку к нему эхо-запроса <a href="https://ru.wikipedia.org/wiki/ICMP" target="_blank" rel="noopener noreferrer"><b><u>ICMP</u></b></a>. В .NET доступен класс <a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.net.networkinformation.ping?view=net-8.0" target="_blank" rel="noopener noreferrer"><b><u>Ping</u></b></a>, который и позволяет делать отправку подобных запросов к узлам. Работа класса в целом аналогична одноименной утилите <b>ping</b> в Windows и *.nix.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Ниже представлен пример простейшей программы, которая &quot;пингует&quot; диапазон адресов с <b>192.168.88.1</b> по <b>192.168.88.255</b> и выводит список адресов, для которых успешно прошла проверка доступности.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-ddjGcj sc-dSCuSI bzSoxR gjxWVS prism-code language-csharp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token namespace">Net</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token namespace">Net</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token namespace">NetworkInformation</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> addressBase </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;192.168.88.&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Базовая часть адреса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> startAddress </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Начало диапазона сканирования адресов</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> endAddress </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">255</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Окончание диапазона сканирования адресов</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">List</span><span class="token class-name punctuation" style="color:rgb(212, 212, 212)">&lt;</span><span class="token class-name" style="color:rgb(78, 201, 176)">IPAddress</span><span class="token class-name punctuation" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> detectedAddresses </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">List</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(212, 212, 212)">&lt;</span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">IPAddress</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">Ping</span><span class="token plain"> ping </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">Ping</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Сканируем последовательно адресов на доступность</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> addressPart </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> startAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> addressPart </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> endAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> addressPart</span><span class="token operator" style="color:rgb(212, 212, 212)">++</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> currentAddressAsString </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">addressBase</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">addressPart</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name" style="color:rgb(78, 201, 176)">IPAddress</span><span class="token plain"> currentAddress </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> IPAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Parse</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">currentAddressAsString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Отправляем ICMP-запрос с таймаутом в 1 секунду</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> pingResult </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ping</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Send</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">currentAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Now</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">] </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">currentAddress</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">pingResult</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Status</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">pingResult</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Status </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> IPStatus</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Success</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        detectedAddresses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">currentAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Выводим результат сканирования в виде списка доступных узлов</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">detectedAddresses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Count </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Не найдено активных устройств.&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Найдены устройства на следующих адресах:&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> detectedAddress </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> detectedAddresses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Пытаемся определить имя хоста по его адресу</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> hostName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            hostName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Dns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">GetHostEntry</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">detectedAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">?.</span><span class="token plain">HostName </span><span class="token operator" style="color:rgb(212, 212, 212)">??</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;Неизвестно&gt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            hostName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;Неизвестно&gt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">         </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;- {0}: {1}&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> detectedAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> hostName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Для выхода нажмите любую клавишу...&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ReadKey</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">В программе сначала мы отправляем ICMP-пакеты на каждый из указанных адресов с таймаутом ожидания ответа в 1000 мс. Все узлы, для которых мы успешно получили ответ, сохраняем в список обнаруженных адресов. На последнем шаге выводим результат в виде обнаруженных узлов. Также для каждого адреса пытаемся получить DNS-имя.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Пример вывода программы может быть следующим. Сначала в процессе сканирования выводим ход процесса пинга узлов:<div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-fxwsqt sc-hIUIyC iBQgcK bpeFjG prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 11:16:07] 192.168.88.1: Success</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 11:16:08] 192.168.88.2: TimedOut</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 11:16:09] 192.168.88.3: TimedOut</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 11:16:10] 192.168.88.4: TimedOut</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 11:16:11] 192.168.88.5: TimedOut</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 11:16:12] 192.168.88.6: TimedOut</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 11:16:13] 192.168.88.7: TimedOut</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 11:16:14] 192.168.88.8: TimedOut</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 11:16:15] 192.168.88.9: TimedOut</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 11:16:16] 192.168.88.10: TimedOut</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 11:16:16] 192.168.88.11: Success</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 11:16:17] 192.168.88.12: TimedOut</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 11:16:18] 192.168.88.13: TimedOut</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 11:16:19] 192.168.88.14: TimedOut</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 11:16:19] 192.168.88.15: Success</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">...</span></div></pre></div></div>А на финальном шаге уже получим отчет по результатам:<div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-jnOFWn sc-dZodDb kouCPZ cpFLgi prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">Найдены устройства на следующих адресах:</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.1: router.lan</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.11: yy-nix</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.15: &lt;Неизвестно&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.16: &lt;Неизвестно&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.24: &lt;Неизвестно&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.26: &lt;Неизвестно&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.27: &lt;Неизвестно&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.28: &lt;Неизвестно&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Для выхода нажмите любую клавишу...</span></div></pre></div></div></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Особенностью работы класса <b>Ping</b> являются ограничения, при которых утилита успешно отправит и получит ICMP-пакеты. В некоторых случаях наличие прокси-серверов, включенного NAT или брэндмауэров и некоторых других особенностей конфигурации сети могут препятствовать работе проверки доступности узлов. Поэтому полностью доверять результатом не приходится.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Также данный подход проверяет лишь доступность узла в сети и не позволяет проверить наличие или доступность служб более высокого уровня, таких как веб-сервера или другое ПО, использующее передачу данных по сети.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Рассмотрим еще один способ поиска устройств в сети с помощью протокола определения адресов ARP.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="check-and-arp">Шах и ARP</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify"><a href="https://ru.wikipedia.org/wiki/ARP" target="_blank" rel="noopener noreferrer"><b><u>ARP (Address Resolution Protocol)</u></b></a> - это протокол определения адреса, позволяющий определить <a href="https://ru.wikipedia.org/wiki/MAC-%D0%B0%D0%B4%D1%80%D0%B5%D1%81" target="_blank" rel="noopener noreferrer"><b><u>MAC-адреса</u></b></a> других узлов по известным IP-адресам.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Ранее мы делали <b>ping</b> диапазона адресов сети, а с помощью протокола ARP мы можем получить больше информации об узлах сети. Для .NET нет штатной возможности работы с протоколом ARP, но в сообществе создана библоитека <a href="https://github.com/georg-jung/ArpLookup" target="_blank" rel="noopener noreferrer"><b><u>ArpLookup </u></b></a> за авторством <a href="https://github.com/georg-jung" target="_blank" rel="noopener noreferrer"><b><u>Georg Jung</u></b></a>. Библиотека кроссплатформенная, что не может не радовать!</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Хорошим примером использования данной библиотеки является приложение <a href="https://github.com/giuliocomi/arp-scanner" target="_blank" rel="noopener noreferrer"><b><u>arp-scanner</u></b></a> за авторством <a href="https://github.com/giuliocomi" target="_blank" rel="noopener noreferrer"><b><u>giuliocomi</u></b></a>. Приложение позволяет идентифицировать доступные узлы в локальной сети.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Пример работы <b>arp-scanner</b> Вы можете видеть ниже:</p><div class="Images_article_image__wrapper__QSTzx my-4 Images_size_full__CHi3X display-block mx-auto my-5"><div aria-owns="rmiz-modal-" data-rmiz=""><div data-rmiz-content="not-found" style="visibility:visible"><img src="/imp_assets/.NET/2024-06/detect-devices-with-charp/1. Arp-scanner.png" alt="ARP-SCANNER" width="100%" class="block"/></div></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Перед этим приложение сканирует все IP-адреса в указанном при запуске диапазоне.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Отличие данного подхода от простого <b>ping</b>&#x27;а в контексте обнаружения устройств заключается в том, что ICMP-пакеты часто блокируются брэндмауэром на узлах, в то время как ARP-запросы остаются доступными для использования. Поэтому шанс обнаружения активных устройств этим методом куда выше. Но не исключено, что администратор может и эти запросы заблокировать, тогда данный способ не сработает.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Напишем свою небольшую утилиту с использованием библиотеки <b>ArpLookup</b>, чтобы показать пример использования более наглядно.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-eZjPq sc-ggpkNl exvVPd gVUmMc prism-code language-csharp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token namespace">Net</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token namespace">Net</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token namespace">NetworkInformation</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token namespace">ArpLookup</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> addressBase </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;192.168.88.&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Базовая часть адреса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> startAddress </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Начало диапазона сканирования адресов</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> endAddress </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">255</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Окончание диапазона сканирования адресов</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">byte</span><span class="token class-name punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token class-name punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> emptyPhysicalAddress </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">0x00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0x00</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">List</span><span class="token class-name punctuation" style="color:rgb(212, 212, 212)">&lt;</span><span class="token class-name punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name" style="color:rgb(78, 201, 176)">IPAddress</span><span class="token class-name punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token class-name" style="color:rgb(78, 201, 176)">PhysicalAddress</span><span class="token class-name punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token class-name punctuation" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> detectedAddresses </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">List</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(212, 212, 212)">&lt;</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">IPAddress</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">PhysicalAddress</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Сканируем последовательно адреса на доступность</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> addressPart </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> startAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> addressPart </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> endAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> addressPart</span><span class="token operator" style="color:rgb(212, 212, 212)">++</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> currentAddressAsString </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">addressBase</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">addressPart</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name" style="color:rgb(78, 201, 176)">IPAddress</span><span class="token plain"> currentAddress </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> IPAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Parse</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">currentAddressAsString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Отправляем ARP-запрос для получения MAC-адреса.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Если MAC-адрес успешно получен, значит, узел в сети &quot;живой&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name" style="color:rgb(78, 201, 176)">PhysicalAddress</span><span class="token class-name punctuation" style="color:rgb(212, 212, 212)">?</span><span class="token plain"> physicalAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        physicalAddress </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Arp</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Lookup</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">currentAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Если получен пустой MAC-адрес,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// то присваиваем явно неопределенное значение</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">physicalAddress </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token operator" style="color:rgb(212, 212, 212)">||</span><span class="token plain"> physicalAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">GetAddressBytes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">SequenceEqual</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">emptyPhysicalAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token operator" style="color:rgb(212, 212, 212)">||</span><span class="token plain"> physicalAddress </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> PhysicalAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">None</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            physicalAddress </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        physicalAddress </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Отправляем ICMP-запрос с таймаутом в 1 секунду</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">physicalAddress </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        detectedAddresses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">ValueTuple</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(212, 212, 212)">&lt;</span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">IPAddress</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)"> PhysicalAddress</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">currentAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">physicalAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Now</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">] </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">currentAddress</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">physicalAddress</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Now</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">] </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">currentAddress</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">: &lt;Не доступен&gt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Выводим результат сканирования в виде списка доступных узлов</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">detectedAddresses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Count </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Не найдено активных устройств.&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Найдены устройства на следующих адресах:&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> detectedAddress </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> detectedAddresses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Пытаемся определить имя хоста по его адресу</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> hostName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            hostName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Dns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">GetHostEntry</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">detectedAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Item1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">?.</span><span class="token plain">HostName </span><span class="token operator" style="color:rgb(212, 212, 212)">??</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;Неизвестно&gt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            hostName </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;Неизвестно&gt;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">         </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;- {0}: {1}: {2}&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> detectedAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Item1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> detectedAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Item2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> hostName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Для выхода нажмите любую клавишу...&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ReadKey</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">В целом программа очень похожа на версию из раздела про <b>ping</b>, которую мы создали в предыдущем разделе. Главное отличие здесь - это использование <b>ArpLoockup</b> вместо класса <b>Ping</b>, где мы отправляем запрос.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-cmaqZA sc-kAkozD kvQiYo hYCcph prism-code language-csharp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Отправляем ARP-запрос для получения MAC-адреса.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">physicalAddress </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Arp</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Lookup</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">currentAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">В процессе сканирования сети будет выводиться прогресс операции вида:<div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-gFVuLS sc-brPMkR dUxOCE hLQzvJ prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 13:31:11] 192.168.88.1: 2CC81B4A9F8A</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 13:31:18] 192.168.88.2: &lt;Не доступен&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 13:31:19] 192.168.88.3: &lt;Не доступен&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 13:31:20] 192.168.88.4: &lt;Не доступен&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 13:31:21] 192.168.88.5: &lt;Не доступен&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 13:31:21] 192.168.88.6: &lt;Не доступен&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 13:31:22] 192.168.88.7: &lt;Не доступен&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 13:31:23] 192.168.88.8: &lt;Не доступен&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 13:31:24] 192.168.88.9: &lt;Не доступен&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 13:31:24] 192.168.88.10: &lt;Не доступен&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 13:31:24] 192.168.88.11: &lt;Не доступен&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 13:31:25] 192.168.88.12: &lt;Не доступен&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 13:31:26] 192.168.88.13: &lt;Не доступен&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 13:31:27] 192.168.88.14: &lt;Не доступен&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">[28.06.2024 13:31:27] 192.168.88.15: 2CC81B4A9F89</span></div></pre></div></div>По окончанию работы утилиты будет выведен финальный отчет:<div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-iMWBWc sc-fvtEUL gZBeko hOxlGl prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">Найдены устройства на следующих адресах:</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.1: 2CC8********: router.lan</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.15: 2CC8********: &lt;Неизвестно&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.16: CAC9********: &lt;Неизвестно&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.24: B060********: &lt;Неизвестно&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.26: 7089********: &lt;Неизвестно&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.27: 82D1********: &lt;Неизвестно&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.28: B887********: &lt;Неизвестно&gt;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.35: 000C********: fiastoolset.yy.corp</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">- 192.168.88.82: 18C0********: &lt;Неизвестно&gt;</span></div></pre></div></div></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Фактически мы получили тот же результат, что и при использовании класса <b>Ping</b>, но альтернативным путем.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Будем честными, искать устройства подобными методами можно, но только тогда, когда найти их нужно только одной стороне. Но что, если устройству нужно, чтобы его нашли?</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="scream-by-udp">Крик через UDP</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Устройство может самостоятельно сигнализировать в локальной сети, что оно включено и готово к работе. Самый распостраненный вариант реализации такого поведения это <a href="https://learn.microsoft.com/ru-ru/dotnet/framework/network-programming/using-udp-services" target="_blank" rel="noopener noreferrer"><b><u>широковещательные сообщения UDP</u></b></a>.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Платформа .NET имеет собственный класс <a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.net.sockets.udpclient?view=net-8.0" target="_blank" rel="noopener noreferrer"><b><u>UdpClient</u></b></a> для удобной работы с протоколом UDP, в том числе и для отправки и приема широковещательных сообщений.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Сделаем простое приложение для отправки и приема широковещательных сообщений UDP, причем в контексте одного узла и приложения. Это просто демонстрационный пример.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-bBeLha sc-ihgokY fWBPGd isKSDu prism-code language-csharp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token namespace">Net</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token namespace">Net</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token namespace">Sockets</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token namespace">Text</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Адрес группы для многоадресной рассылки</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name" style="color:rgb(78, 201, 176)">IPAddress</span><span class="token plain"> broadcastAddress </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> IPAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Parse</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;239.255.255.255&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Порт для отправки и прослушивания сообщений</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> localPort </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">25432</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Запускаем в фоне задание для получения сообщений</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Run</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ReceiveMessageAsync</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Запускаем в фоне задание для отправки сообщений</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Run</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">SendMessageAsync</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Отправка сообщений в группу</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">async</span><span class="token plain"> </span><span class="token return-type class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">SendMessageAsync</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Создаем клиента для отпрвки</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> sender </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">UdpClient</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// И точку подключения для отправки</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> endpoint </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">IPEndPoint</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">broadcastAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> localPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Формируем сообщение</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> messageContent </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">DateTime</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token interpolation-string interpolation expression language-csharp">Now</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">] Hello from UDP&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">byte</span><span class="token class-name punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token class-name punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> data </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Encoding</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">UTF8</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">GetBytes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">messageContent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Отправляем в группу</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">await</span><span class="token plain"> sender</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">SendAsync</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> endpoint</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;(Отправлено): </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">messageContent</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Ждем до следующей отправки</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Delay</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Получение сообщений из группы</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">async</span><span class="token plain"> </span><span class="token return-type class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ReceiveMessageAsync</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Создаем клиента для получения сообщений</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> receiver </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(78, 201, 176)">UdpClient</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">localPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Присоединяемся к группе многоадресной рассылки</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    receiver</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">JoinMulticastGroup</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">broadcastAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Отключаем получение собственных сообщений</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    receiver</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">MulticastLoopback </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Получаем сообщение при появлении</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">await</span><span class="token plain"> receiver</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ReceiveAsync</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Отображаем содержимое</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> messageContent </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Encoding</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">UTF8</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">GetString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Buffer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">$&quot;(Получено): </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token interpolation-string interpolation expression language-csharp">messageContent</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token interpolation-string string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">WriteLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Для выхода нажмите любую клавишу...&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ReadKey</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Здесь мы имеем два асинхронных метода <b>SendMessageAsync</b> для отправки широковещательных сообщений в группу и <b>ReceiveMessageAsync</b> для их приема. Перед их запуском инициализируются два важных параметра для рассылки и приема сообщений:<ul class="List_list__zLjGi list-disc pl-[30px]"><li><b>localPort</b> - порт, на который будут отправляться сообщения и, соответственно, прослушиваться сообщения для приема.</li><li><b>broadcastAddress</b> - адрес группы многоадресной рассылки. Это служебный адрес, который должен указываться в диапазоне от <b>224.0.0.0</b> до <b>239.255.255.255</b>. Если передать другой адрес, либо если маршрутизатор не поддерживает групповые рассылки, то будет получено исключение <b>SocketException</b>.</li></ul></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">При отправке сообщений инициализируется UDP-клиент в виде объекта класса <b>UdpClient</b> с точкой подключения <b>IPEndPoint</b> с указанным портом и адресом группы многоадресной рассылки.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">При получении сообщений инициализируется UDP-клиент также в виде объекта класса <b>UdpClient</b>, но в этот раз выполняется присоединение к группе многоадресной рассылки с помощью метода <a href="https://learn.microsoft.com/ru-ru/dotnet/api/system.net.sockets.udpclient.joinmulticastgroup?view=net-8.0" target="_blank" rel="noopener noreferrer"><b><u>JoinMulticastGroup</u></b></a>. Стоит отметить, что для отправки сообщений в группу нет необходимости выполнять присоединение к ней методом <b>JoinMulticastGroup</b>, достаточно того, чтобы в точке подключения адрес совпадал с адресом в точке подключения клиента, который эти сообщения отправляет.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Для удаления из группы нужно вызывать метод <a href="https://learn.microsoft.com/en-us/dotnet/api/system.net.sockets.udpclient.dropmulticastgroup?view=net-8.0" target="_blank" rel="noopener noreferrer"><b><u>DropMulticastGroup</u></b></a>, но в нашем примере в этом нет необходимости.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">При запуске приложения мы получим примерно такой вывод:<div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-jMalIJ sc-iMTngq gUpsZE mJTod prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">(Отправлено): [28.06.2024 15:20:57] Hello from UDP</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">(Получено): [28.06.2024 15:20:57] Hello from UDP</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">(Отправлено): [28.06.2024 15:20:58] Hello from UDP</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">(Получено): [28.06.2024 15:20:58] Hello from UDP</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">(Отправлено): [28.06.2024 15:20:59] Hello from UDP</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">(Получено): [28.06.2024 15:20:59] Hello from UDP</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">(Отправлено): [28.06.2024 15:21:00] Hello from UDP</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">(Получено): [28.06.2024 15:21:00] Hello from UDP</span></div></pre></div></div></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Таким образом, для задач обнаружения устройств в сети, если одно устройство должно найти другое, широковещательные сообщения UDP являются практически идеальным средством.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Тем более в теле сообщения можно отправлять любую необходимую информацию, чтобы получатель мог корректно идентифицировать устройство и сделать нужные действия. Ниже мы рассмотрим использование данного подхода на примере создания сервиса для RasberryPi и приложения для Android, которое будет этот сервис находить в сети. Итак, поехали дальше!</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="rasberry-pi-and-android">Rasberry Pi + Android</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Итак, у нас будет расширенный пример двух приложений. Первое - сервис на ASP.NET Core под *.nix (хотя и на Windows тоже будет работать), который мы запустим на устройстве Rasberry Pi. А также будет клиентское приложение для Android на базе<a href="https://learn.microsoft.com/ru-ru/dotnet/maui/what-is-maui?view=net-maui-8.0" target="_blank" rel="noopener noreferrer"><b><u>MAUI</u></b></a>, которое будет выполнять поиск устройства в той же сети, что и смартфон, и отправлять на него некоторые запросы.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Мы остановимся лишь на основных моментах, пока будем создавать эти приложения. Полный пример и вся кодовая база будет доступна в <a href="https://github.com/YPermitin/YPermitin.ExternalDevices" target="_blank" rel="noopener noreferrer"><b><u>репозитории YPermitin.ExternalDevices</u></b></a> на GitHub. Чтобы пример остался &quot;как есть&quot;, без изменений с течением времени, пример был сохранен в отдельной ветке<a href="https://github.com/YPermitin/YPermitin.ExternalDevices/tree/post-detect-devices-with-csharp" target="_blank" rel="noopener noreferrer"><b><u>post-detect-devices-with-csharp</u></b></a>.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Переходим к делу, сначала создадим сервис для &quot;малинки&quot;.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="malinka">Прокаченная малинка</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">На Rasberry Pi мы заблоговременно установили Ubuntu. Этот процесс здесь расписывать смысла нет, т.к. вопрос выходит за рамки темы статьи. Вы можете узнать всю нужную информацию <a href="https://ubuntu.com/download/raspberry-pi" target="_blank" rel="noopener noreferrer"><b><u>на официальном сайте</u></b></a>. Фактически, вместо Rasberry Pi может быть любая машина с Ubuntu, в том числе обычный ПК.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Созданный сервис на ASP.NET Core мы публикуем как любой другой сервис на *.nix. Процесс публикации мы также рассматривать не будем. При необходимости весь процесс установки и настройки с подробным разбором всех шагов Вы можете можете узнать в статье <a href="/blog/.NET/2024-03/deploy-asp-net-core-on-linux" target="_blank" rel="noopener noreferrer"><b><u>&quot;Развертывание ASP.NET Core приложений на Ubuntu Linux&quot;</u></b></a>.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">В решении сам сервис представлен в виде проекта <a href="https://github.com/YPermitin/YPermitin.ExternalDevices/tree/post-detect-devices-with-csharp/Web/YPermitin.ExternalDevices.ManagementService" target="_blank" rel="noopener noreferrer"><b><u>YPermitin.ExternalDevices.ManagementService</u></b></a>, который является REST-сервисом на базе ASP.NET Core и использует платформу .NET 8 версии. В контексте нашего примера нас интересуют следующие части этого приложения:<ul class="List_list__zLjGi list-disc pl-[30px]"><li><a href="https://github.com/YPermitin/YPermitin.ExternalDevices/blob/post-detect-devices-with-csharp/Web/YPermitin.ExternalDevices.ManagementService/Services/NetworkDiscoveryHostedService.cs" target="_blank" rel="noopener noreferrer"><b><u>NetworkDiscoveryHostedService</u></b></a> - это фоновая задача, которая раз в 10 секунд отправляет широковещательное сообщение UDP, чтобы клиентские приложения могли его обнаружить.<p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Для этого используется метод <b>SendBroadcastMessage</b> из библиотеки <a href="https://github.com/YPermitin/YPermitin.ExternalDevices/blob/post-detect-devices-with-csharp/Libs/YPermitin.ExternalDevices.NetworkUtils/DeviceDetector.cs" target="_blank" rel="noopener noreferrer"><b><u>DeviceDetector</u></b></a>, реализующей рассылку и прием многоадресных сообщений UDP, о которых шла речь в раздеах выше. Если Вы посмотрите исходный код библиотеки <b>DeviceDetector</b>, то увидите ту же самую логику создания и инициализации класса <b>UdpClient</b>, в том числе присоединение его к группе методом <b>JoinMulticastGroup</b>.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Единственным большим отличием будет метод приема сообщений, который реализован через <b>StartSearch</b>. В нем мы запускаем операцию приема через метод <b>ReceiveAsync</b>, а затем ожидаем получения сообщений с указанным текстовым содержимым. При получении каждого сообщения срабатывает событие <b>onDeviceDetected</b>, оповещающее вызывающий код о найденном устройстве.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Весь описанный процесс выполняется до тех пор, пока не будет отменен явно через токен отмены операции (передается в качестве аргумента метода), или по достижении таймаута из аргумента <b>timeoutMs</b>.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">В текущем сервисе мы используем только метод отправки сообщений <b>SendBroadcastMessage</b>, а метод обнаружения сообщений<b>StartSearch</b> будет использоваться в клиентском приложении для Android. О нем речь будет ниже.</p></li><li><a href="https://github.com/YPermitin/YPermitin.ExternalDevices/blob/post-detect-devices-with-csharp/Web/YPermitin.ExternalDevices.ManagementService/Controllers/ServiceInfoController.cs" target="_blank" rel="noopener noreferrer"><b><u>ServiceInfoController</u></b></a> - контроллер для реализации метода REST API с целью возвращения базовой информации о сервисе, а именно:<ul class="List_list__zLjGi list-disc pl-[30px]"><li>Hostname - имя хоста сервиса.</li><li>HostDateUTC - текущая дата по UTC.</li></ul><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Здесь нет чего-то особенного. Фактически метод используется лишь для проверки связи с сервисом со стороны клиентского приложения.</p></li></ul></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Остальные части сервиса явно не относятся к теме статьи. Например, там есть часть, отвечающая за проверку списка WiFi-сетей, доступных для устройства. Или интеграция с DBus для *.nix систем. Плюс некоторые другие вещи.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">При успешном запуске сервиса на Rassbery Pi Вы увидите примерно такой вывод:</p><div class="Images_article_image__wrapper__QSTzx my-4 Images_size_full__CHi3X display-block mx-auto my-5"><div aria-owns="rmiz-modal-" data-rmiz=""><div data-rmiz-content="not-found" style="visibility:visible"><img src="/imp_assets/.NET/2024-06/detect-devices-with-charp/2. Запуск сервиса на Rasberry Pi.png" alt="Запуск сервиса на Rasberry Pi" width="100%" class="block"/></div></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">У Вашего устройства может не быть модуля WIFi, тогда сканер сетей работать не будет и в большинстве случаев будут видны только логи о рассылке широковещательных сообщений UDP. Ничего страшного в этом нет, все-таки мы пришли сюда не по этой теме.</p><div class="Images_article_image__wrapper__QSTzx my-4 Images_size_medium__0iTcB display-block mx-auto my-5"><div aria-owns="rmiz-modal-" data-rmiz=""><div data-rmiz-content="not-found" style="visibility:visible"><img src="/imp_assets/.NET/2024-06/detect-devices-with-charp/3. Rasberry Pi с WiFi модулем.jpg" alt="Rasberry Pi с WiFi модулем" width="100%" class="block"/></div></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Итак, Rasberry Pi с опубликованным сервисом у нас готовы и подключены к сети. Теперь перейдем к мобильной разработке.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="lets-maui">MAUI в деле</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify"><a href="https://learn.microsoft.com/ru-ru/dotnet/maui/what-is-maui?view=net-maui-8.0" target="_blank" rel="noopener noreferrer"><b><u>MAUI</u></b></a> - это кросплатформенная среда для создания собственных мобильных и классических приложений на платформе .NET (C#). Для использования той же кодовой базы и библиотек, что и для серверного приложения, а также для простоты примера мы будем использовать именно MAUI, чтобы создать мобильное приложение.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">В решении само приложение представлено в проекте <a href="https://github.com/YPermitin/YPermitin.ExternalDevices/tree/post-detect-devices-with-csharp/Apps/YPermitin.ExternalDevices.YPED" target="_blank" rel="noopener noreferrer"><b><u>YPermitin.ExternalDevices.YPED</u></b></a>.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">К проекту подключена библиотека <a href="https://github.com/YPermitin/YPermitin.ExternalDevices/blob/post-detect-devices-with-csharp/Libs/YPermitin.ExternalDevices.NetworkUtils/DeviceDetector.cs" target="_blank" rel="noopener noreferrer"><b><u>DeviceDetector</u></b></a>, которую мы уже использовали в сервисе на Rasberry Pi. На этот раз из этой библиотеки мы будем использовать метод <b>StartSearch</b> для поиска устройств в сети.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify"><a href="https://github.com/YPermitin/YPermitin.ExternalDevices/blob/post-detect-devices-with-csharp/Apps/YPermitin.ExternalDevices.YPED/MainPage.xaml.cs" target="_blank" rel="noopener noreferrer"><b><u>В исходном коде главной страницы</u></b></a> приложения мы можем увидеть инициализацию объекта <b>DeviceDetector</b> при создании страницы. Вызов метода <b>StartSearch</b> выполняется при нажатии кнопки <b>&quot;Обнаружить устройства&quot;</b>, после чего в течении 60 секунд приложение слушает сеть на наличие широковещательных сообщений UDP. При этом присылаемые данные должны подходить по формату.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Как только сообщение нужного формата получено, из него получается информация о найденном устройстве и выводится на экран. Вот как это выглядит.</p><div class="Images_article_image__wrapper__QSTzx my-4 Images_size_xs__E5xhu display-block mx-auto my-5"><div aria-owns="rmiz-modal-" data-rmiz=""><div data-rmiz-content="not-found" style="visibility:visible"><img src="/imp_assets/.NET/2024-06/detect-devices-with-charp/4. Android. Поиск устройств.gif" alt="Android. Поиск устройств" width="100%" class="block"/></div></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">При нажатии на элемент списка найденных устройств, приложение отправки HTTP-запрос к API найденного сервиса для получения базовой информации (вызов метода контроллера <b>ServiceInfoController</b>, о котором речь шла выше). Смотри событие <b>DeviceItemTapped</b> на <a href="https://github.com/YPermitin/YPermitin.ExternalDevices/blob/post-detect-devices-with-csharp/Apps/YPermitin.ExternalDevices.YPED/MainPage.xaml.cs" target="_blank" rel="noopener noreferrer"><b><u>главной странице</u></b></a>.</p><div class="Images_article_image__wrapper__QSTzx my-4 Images_size_xs__E5xhu display-block mx-auto my-5"><div aria-owns="rmiz-modal-" data-rmiz=""><div data-rmiz-content="not-found" style="visibility:visible"><img src="/imp_assets/.NET/2024-06/detect-devices-with-charp/5. Android. Запрос к устройству.gif" alt="Android. Запрос к устройству" width="100%" class="block"/></div></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Таким образом, мы создали мобильное Android-приложение, используя ту же самую кодовую базу на языке C#, что используется и в сервисе для Rasberry Pi. Наше клиентское приложение находит устройства в сети и может отправлять к нему запросы. Еще бонусом в приложении добавлена функция определиня внешнего IP-адреса в сети интернет через обращение к API <a href="https://api.tinydevtools.ru" target="_blank" rel="noopener noreferrer"><b><u>api.tinydevtools.ru</u></b></a>, но к теме статьи это мало относится.</p><div class="Images_article_image__wrapper__QSTzx my-4 Images_size_xs__E5xhu display-block mx-auto my-5"><div aria-owns="rmiz-modal-" data-rmiz=""><div data-rmiz-content="not-found" style="visibility:visible"><img src="/imp_assets/.NET/2024-06/detect-devices-with-charp/6. Android. Мой IP.gif" alt="Android. Мой IP" width="100%" class="block"/></div></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Теперь обнаружить устройста в сети не составит труда!</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="fly">Летим дальше!</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Поиск устройств в сети не такая уж и редкая задача. Думаю, многие выполняли сопряжение со смартфоном гарнитуры или часов. Все это из той же области.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Сегодня мы рассмотрели поиск устройств через <b>ping</b> (т.е. через ICMP-пакеты), через протокол ARP, широковещательные сообщения UDP, а также рассмотрели пример приложений для Rasberry Pi и Android.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Но найти устройство это лишь начало, дальше нужно им управлять. А это уже другая история...</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:justify">Спасибо, что дочитали! Хорошего вам дня и успехов в делах!</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="links">Это интересно</h1><ul class="List_list__zLjGi list-disc pl-[30px]"><li><a href="https://www.cheatengine.org/" target="_blank" rel="noopener noreferrer"><u><b>YPermitin.ExternalDevices - репозиторий с примером приложения.</b></u></a></li><li><a href="/blog/.NET/2024-03/deploy-asp-net-core-on-linux" target="_blank" rel="noopener noreferrer"><b><u>Развертывание ASP.NET Core приложений на Ubuntu Linux</u></b></a></li><li><a href="https://learn.microsoft.com/en-us/dotnet/api/system.net.sockets.udpclient?view=net-8.0" target="_blank" rel="noopener noreferrer"><u><b>UdpClient Class</b></u></a></li><li><a href="https://metanit.com/sharp/net/5.2.php" target="_blank" rel="noopener noreferrer"><u><b>Широковещательная рассылка</b></u></a></li><li><a href="https://github.com/georg-jung/ArpLookup" target="_blank" rel="noopener noreferrer"><b><u>ArpLookup - библиотека для .NET по отправке запросов ARP</u></b></a></li></ul></article><div class="Seperator_section_seperator_line__gdWIB dark:border-white border-black"></div><div class="PageLayout_author_and_more__wxN3W mx-auto"><div class="bg-white dark:bg-slate-800 dark:border-none border-slate-100 shadow-lg border md:rounded-[8px] px-[15px] py-[10px] mb-[30px] overflow-hidden"><div class="flex items-center"><div class="flex items-center justify-center shadow-xl rounded-full overflow-hidden bg-blue-500 shrink-0 w-[60px] h-[60px] mr-3 text-xl"><p class="text-center font-medium text-white">Y</p></div><div class="font-semibold"><p class="text-[20px]  mb-0 mt-0">YPermitin</p><p class="text-xs mt-0 mb-0">.NET, TSQL, DevOps, 1C:Enterprise</p></div></div><p class="text-[16px] mt-2">Developer, just developer.</p><div class="flex items-center flex-wrap mt-3"><a href="https://github.com/YPermitin" target="_blank" class="mr-[15px] text-[32px]" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a></div></div><div class="bg-white dark:bg-slate-800 dark:border-none border-slate-100 shadow-lg border md:rounded-[8px] px-[15px] py-[10px] mb-[30px] overflow-hidden"><p class="border-b border-gray-300 pb-2 mb-3 font-medium w-full">Поделиться</p><div class="flex flex-wrap items-center"><a class="mr-3" aria-label="facebook-share" href="https://www.facebook.com/sharer/sharer.php?u=https://ypermitin.github.io" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-92.4 233.5h-63.9c-50.1 0-59.8 23.8-59.8 58.8v77.1h119.6l-15.6 120.7h-104V912H539.2V602.2H434.9V481.4h104.3v-89c0-103.3 63.1-159.6 155.3-159.6 44.2 0 82.1 3.3 93.2 4.8v107.9z"></path></svg></a><a class="mr-3" aria-label="twitter-share" href="http://twitter.com/share?text=Check out this article!! &amp;url=https://ypermitin.github.io&amp;hashtags=webdevelopment,javacript,javascriptdaily,webdevelopmenttutorial,tutorial" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm215.3 337.7c.3 4.7.3 9.6.3 14.4 0 146.8-111.8 315.9-316.1 315.9-63 0-121.4-18.3-170.6-49.8 9 1 17.6 1.4 26.8 1.4 52 0 99.8-17.6 137.9-47.4-48.8-1-89.8-33-103.8-77 17.1 2.5 32.5 2.5 50.1-2a111 111 0 0 1-88.9-109v-1.4c14.7 8.3 32 13.4 50.1 14.1a111.13 111.13 0 0 1-49.5-92.4c0-20.7 5.4-39.6 15.1-56a315.28 315.28 0 0 0 229 116.1C492 353.1 548.4 292 616.2 292c32 0 60.8 13.4 81.1 35 25.1-4.7 49.1-14.1 70.5-26.7-8.3 25.7-25.7 47.4-48.8 61.1 22.4-2.4 44-8.6 64-17.3-15.1 22.2-34 41.9-55.7 57.6z"></path></svg></a><a class="mr-3" aria-label="linkedin-share" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://ypermitin.github.io&amp;title=Check out this article!!&amp;source=LinkedIn" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[23px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"></path></svg></a><button class="mr-3" name="copy-link" aria-label="copy-link"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z"></path><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243z"></path></svg></button></div><div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded fixed flex transition-all right-[10px] -bottom-20 opacity-0" role="alert"><strong class="font-bold">Link Copied</strong><span class="pl-5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="pt-1 text-[18px] cursor-pointer" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"></path></svg></span></div></div><div class="bg-white dark:bg-slate-800 dark:border-none border-slate-100 shadow-lg border md:rounded-[8px] px-[15px] py-[10px] mb-[30px] overflow-hidden"><p class="border-b border-gray-300 pb-2 mb-3 font-medium w-full">Другие статьи</p><div class="flex flex-wrap"><div class="mb-3 cursor-pointer lg:w-1/3 md:w-1/2 w-full md:pr-2" href="/blog/CPP/2024-11/cpp-control-child-processes-with-winapi/"><div class=" rounded-[3px] dark:bg-slate-800 border border-slate-200 dark:border-slate-900 flex items-center overflow-hidden shadow-lg hover:shadow-md "><div class="object-cover shrink-0"><img src="/imp_assets/CPP/2024-11/cpp-control-child-processes-with-winapi/logo.png" class="w-[120px] h-[70px] mr-2 object-cover" alt="Контроль дочерних процессов с помощью C++ и WinAPI"/></div><div class="pr-1 text-[16px] hover:text-blue-500 font-semibold">Контроль дочерних процессов с помощью C++ и WinAPI</div></div></div><div class="mb-3 cursor-pointer lg:w-1/3 md:w-1/2 w-full md:pr-2" href="/blog/.NET/2024-09/simple-and-fast-sql-clr/"><div class=" rounded-[3px] dark:bg-slate-800 border border-slate-200 dark:border-slate-900 flex items-center overflow-hidden shadow-lg hover:shadow-md "><div class="object-cover shrink-0"><img src="/imp_assets/.NET/2024-09/simple-and-fast-sql-clr/logo.png" class="w-[120px] h-[70px] mr-2 object-cover" alt="Расширение для SQL Server. Быстро и просто. SQLCLR снова в деле"/></div><div class="pr-1 text-[16px] hover:text-blue-500 font-semibold">Расширение для SQL Server. Быстро и просто. SQLCLR снова в деле</div></div></div><div class="mb-3 cursor-pointer lg:w-1/3 md:w-1/2 w-full md:pr-2" href="/blog/DevOps/2024-08/ubuntu-vmware-kernel-modules-issue/"><div class=" rounded-[3px] dark:bg-slate-800 border border-slate-200 dark:border-slate-900 flex items-center overflow-hidden shadow-lg hover:shadow-md "><div class="object-cover shrink-0"><img src="/imp_assets/DevOps/2024-08/ubuntu-vmware-kernel-modules-issue/logo.png" class="w-[120px] h-[70px] mr-2 object-cover" alt="Решение проблем с модулями VMware в Ubuntu 22.04"/></div><div class="pr-1 text-[16px] hover:text-blue-500 font-semibold">Решение проблем с модулями VMware в Ubuntu 22.04</div></div></div><a class="cursor-pointer hover:text-blue-500 block text-sm py-3 px-2 text-center dark:bg-slate-900 bg-blue-500 rounded text-white font-bold hover:!text-blue-900 dark:hover:!text-slate-400 transition-all" href="/blog/?author=YPermitin"><p>Все статьи от автора: <!-- -->YPermitin</p></a></div></div></div></div></section><div class="dark:bg-slate-900 dark:text-white bg-slate-100 text-black"><div class="md:container flex items-center md:justify-center justify-around flex-wrap md:text-[14px] text-[12px] py-5"><p class="my-0 mr-[10px] md:mr-3">Copyright © <!-- -->2024<!-- --> <!-- -->Убежище инженера</p></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/.NET/2024-06/detect-devices-with-charp","query":{},"buildId":"dVtbNnhxtAkTMvLMok3El","nextExport":true,"autoExport":true,"isFallback":false,"dynamicIds":[28765,53220,30935,87355,47651],"scriptLoader":[]}</script></body></html>