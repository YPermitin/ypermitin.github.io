<!DOCTYPE html><html lang="en" translate="no"><head><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"/><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="google" content="notranslate"/><title>Занимательный PowerShell | Убежище инженера | YPermitin</title><meta name="robots" content="index,follow"/><meta name="description" content="PowerShell. Что, зачем, как и почему?"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://ypermitin.github.io/blog/DevOps/2021-05/amusing-powershell"/><meta property="og:title" content="Занимательный PowerShell | Убежище инженера | YPermitin"/><meta property="og:description" content="PowerShell. Что, зачем, как и почему?"/><meta property="og:url" content="https://ypermitin.github.io/blog/DevOps/2021-05/amusing-powershell"/><meta property="og:type" content="website"/><meta property="og:image" content="https://ypermitin.github.io/imp_assets/DevOps/2021-05/amusing-powershell/logo.png"/><meta property="og:image:alt" content="Занимательный PowerShell | Убежище инженера | YPermitin"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:locale" content="en_IN"/><meta property="og:site_name" content="Убежище инженера"/><link rel="canonical" href="https://webexpe.com/"/><meta property="keywords" content="DevOps, PowerShell, 1С:Предприятие"/><meta property="al:web:url" content="https://ypermitin.github.io/blog/DevOps/2021-05/amusing-powershell"/><meta name="next-head-count" content="23"/><link rel="preload" href="/_next/static/css/8b3cba25ed5aab85.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8b3cba25ed5aab85.css" data-n-g=""/><link rel="preload" href="/_next/static/css/0eb3a85c2cff7e2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0eb3a85c2cff7e2b.css"/><link rel="preload" href="/_next/static/css/4a9df9e795bce52b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4a9df9e795bce52b.css"/><link rel="preload" href="/_next/static/css/ee5420a43edabb61.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ee5420a43edabb61.css"/><link rel="preload" href="/_next/static/css/88381d5dde4793c2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/88381d5dde4793c2.css"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script defer="" src="/_next/static/chunks/3a17f596-537a4b2012a1e92f.js"></script><script defer="" src="/_next/static/chunks/fea29d9f.da8a8f09d3718005.js"></script><script defer="" src="/_next/static/chunks/1664-939297b106bd6802.js"></script><script defer="" src="/_next/static/chunks/8765.cad5003c27b9f0f8.js"></script><script defer="" src="/_next/static/chunks/3220.ec5fcfa981be0259.js"></script><script defer="" src="/_next/static/chunks/935.690ee438ec544a58.js"></script><script defer="" src="/_next/static/chunks/7355.94d3f9b1029286e4.js"></script><script defer="" src="/_next/static/chunks/7651.2742bb467d45fe42.js"></script><script src="/_next/static/chunks/webpack-5684f62579d6aace.js" defer=""></script><script src="/_next/static/chunks/framework-0995a3e8436ddc4f.js" defer=""></script><script src="/_next/static/chunks/main-01bf6de1df60b879.js" defer=""></script><script src="/_next/static/chunks/pages/_app-25642c783ff01c5e.js" defer=""></script><script src="/_next/static/chunks/6443-e0562366e025b4bf.js" defer=""></script><script src="/_next/static/chunks/pages/blog/DevOps/2021-05/amusing-powershell-577d24f6b9183310.js" defer=""></script><script src="/_next/static/HJvR8iaLzmAcQPPYr2tMK/_buildManifest.js" defer=""></script><script src="/_next/static/HJvR8iaLzmAcQPPYr2tMK/_ssgManifest.js" defer=""></script></head><body class="bg-slate-100 dark:bg-slate-900 transition-all"><div id="__next"><div data-overlay-container="true"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><nav class="Navbar_navbar__W_ouQ bg-white  dark:bg-slate-900 dark:text-white text-black"><div class="container flex items-center justify-between px-2"><div class="flex items-center"><div class="Navbar_mobileBurgerToggle__Bj_52 mr-5  "><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="dark:text-white text-black text-2xl" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></div><a class="text-[22px] font-semibold" href="/">Убежище инженера</a></div><div class="flex items-center"><div class="text-[14px] font-normal items-center lg:flex hidden"><a class="cursor-pointer hover:text-blue-500 mx-2" href="/">Главная</a><div class="relative"><div class="flex items-center cursor-pointer mx-2"><p class="my-0">Блог</p><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="text-[20px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16.293 9.293 12 13.586 7.707 9.293l-1.414 1.414L12 16.414l5.707-5.707z"></path></svg></div><div class="overflow-auto absolute w-[180px] z-20 top-[30px] rounded-[4px] shadow-lg bg-white dark:bg-slate-800 border border-gray-300 dark:border-0 h-0 border-0"><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2" href="/blog/"><span>Все публикации</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=.NET"><span style="text-transform:capitalize">.NET</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=DevOps"><span style="text-transform:capitalize">DevOps</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=PostgreSQL"><span style="text-transform:capitalize">PostgreSQL</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=SQL%20Server"><span style="text-transform:capitalize">SQL Server</span></a></div></div><a class="cursor-pointer hover:text-blue-500 mx-2" href="/instruments/">Инструменты</a><a class="cursor-pointer hover:text-blue-500 mx-2" href="/about/">Обо мне</a><a class="cursor-pointer hover:text-blue-500 mx-2" href="/contact/">Контакты</a><div class="ml-5 pt-1"><a href="https://github.com/YPermitin/" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a><a href="https://t.me/TinyDevVault" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"></path></svg></a><a href="mailto:i.need.ypermitin@yandex.ru" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0 0 68.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"></path></svg></a><a href="https://boosty.to/ypermitin" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 21h9.62a3.995 3.995 0 0 0 3.037-1.397l5.102-5.952a1 1 0 0 0-.442-1.6l-1.968-.656a3.043 3.043 0 0 0-2.823.503l-3.185 2.547-.617-1.235A3.98 3.98 0 0 0 9.146 11H4c-1.103 0-2 .897-2 2v6c0 1.103.897 2 2 2zm0-8h5.146c.763 0 1.448.423 1.789 1.105l.447.895H7v2h6.014a.996.996 0 0 0 .442-.11l.003-.001.004-.002h.003l.002-.001h.004l.001-.001c.009.003.003-.001.003-.001.01 0 .002-.001.002-.001h.001l.002-.001.003-.001.002-.001.002-.001.003-.001.002-.001c.003 0 .001-.001.002-.001l.003-.002.002-.001.002-.001.003-.001.002-.001h.001l.002-.001h.001l.002-.001.002-.001c.009-.001.003-.001.003-.001l.002-.001a.915.915 0 0 0 .11-.078l4.146-3.317c.262-.208.623-.273.94-.167l.557.186-4.133 4.823a2.029 2.029 0 0 1-1.52.688H4v-6zM16 2h-.017c-.163.002-1.006.039-1.983.705-.951-.648-1.774-.7-1.968-.704L12.002 2h-.004c-.801 0-1.555.313-2.119.878C9.313 3.445 9 4.198 9 5s.313 1.555.861 2.104l3.414 3.586a1.006 1.006 0 0 0 1.45-.001l3.396-3.568C18.688 6.555 19 5.802 19 5s-.313-1.555-.878-2.121A2.978 2.978 0 0 0 16.002 2H16zm1 3c0 .267-.104.518-.311.725L14 8.55l-2.707-2.843C11.104 5.518 11 5.267 11 5s.104-.518.294-.708A.977.977 0 0 1 11.979 4c.025.001.502.032 1.067.485.081.065.163.139.247.222l.707.707.707-.707c.084-.083.166-.157.247-.222.529-.425.976-.478 1.052-.484a.987.987 0 0 1 .701.292c.189.189.293.44.293.707z"></path></svg></a></div></div><div class="Navbar_search_icon_wrapper__1a_rL ml-5 dark:text-white"><button name="search-button" aria-label="search button"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="dark:text-white text-black text-[22px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg></button></div><div class=""><button name="share" aria-label="share page"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="dark:text-white text-black text-[16px] mt-[7px] ml-2 mr-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5"></path></svg></button></div><button name="theme-switch" aria-label="theme button" class="Navbar_theme_switch__q7F_Z pl-3 dark:text-white text-black"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-md " height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278"></path></svg></button></div></div></nav><aside class="Navbar_nav_sidebar_wrapper__M0KaI dark:bg-slate-900 dark:text-white bg-white text-black"><div class="flex items-center justify-between pb-3"><p class="">МЕНЮ</p><div><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="text-slate-800 dark:text-white text-[25px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg></div></div><hr/><div class="my-15"><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/">Главная</a><div class="relative"><div class="flex items-center cursor-pointer justify-between"><p class="my-0">Блог</p><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="text-[20px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16.293 9.293 12 13.586 7.707 9.293l-1.414 1.414L12 16.414l5.707-5.707z"></path></svg></div><div class="overflow-auto relative h-0 border-0"><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2" href="/blog/"><span>Все публикации</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=.NET"><span style="text-transform:capitalize">.NET</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=DevOps"><span style="text-transform:capitalize">DevOps</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=PostgreSQL"><span style="text-transform:capitalize">PostgreSQL</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=SQL%20Server"><span style="text-transform:capitalize">SQL Server</span></a></div></div><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/instruments/">Инструменты</a><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/about/">Обо мне</a><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/contact/">Контакты</a></div><hr/><div class="my-5"><p class="font-light">Подписаться : </p> <a href="https://github.com/YPermitin/" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a><a href="https://t.me/TinyDevVault" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"></path></svg></a><a href="mailto:i.need.ypermitin@yandex.ru" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0 0 68.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"></path></svg></a><a href="https://boosty.to/ypermitin" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 21h9.62a3.995 3.995 0 0 0 3.037-1.397l5.102-5.952a1 1 0 0 0-.442-1.6l-1.968-.656a3.043 3.043 0 0 0-2.823.503l-3.185 2.547-.617-1.235A3.98 3.98 0 0 0 9.146 11H4c-1.103 0-2 .897-2 2v6c0 1.103.897 2 2 2zm0-8h5.146c.763 0 1.448.423 1.789 1.105l.447.895H7v2h6.014a.996.996 0 0 0 .442-.11l.003-.001.004-.002h.003l.002-.001h.004l.001-.001c.009.003.003-.001.003-.001.01 0 .002-.001.002-.001h.001l.002-.001.003-.001.002-.001.002-.001.003-.001.002-.001c.003 0 .001-.001.002-.001l.003-.002.002-.001.002-.001.003-.001.002-.001h.001l.002-.001h.001l.002-.001.002-.001c.009-.001.003-.001.003-.001l.002-.001a.915.915 0 0 0 .11-.078l4.146-3.317c.262-.208.623-.273.94-.167l.557.186-4.133 4.823a2.029 2.029 0 0 1-1.52.688H4v-6zM16 2h-.017c-.163.002-1.006.039-1.983.705-.951-.648-1.774-.7-1.968-.704L12.002 2h-.004c-.801 0-1.555.313-2.119.878C9.313 3.445 9 4.198 9 5s.313 1.555.861 2.104l3.414 3.586a1.006 1.006 0 0 0 1.45-.001l3.396-3.568C18.688 6.555 19 5.802 19 5s-.313-1.555-.878-2.121A2.978 2.978 0 0 0 16.002 2H16zm1 3c0 .267-.104.518-.311.725L14 8.55l-2.707-2.843C11.104 5.518 11 5.267 11 5s.104-.518.294-.708A.977.977 0 0 1 11.979 4c.025.001.502.032 1.067.485.081.065.163.139.247.222l.707.707.707-.707c.084-.083.166-.157.247-.222.529-.425.976-.478 1.052-.484a.987.987 0 0 1 .701.292c.189.189.293.44.293.707z"></path></svg></a><hr class="mt-5"/></div><div class="mt-5 mb-4"><p class="mb-2 font-light">Переключиться на <!-- -->светлую<!-- --> тему :</p><button name="theme-switch" aria-label="theme-switch" class="Navbar_theme_switch__q7F_Z dark:text-white text-black"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-lg" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278"></path></svg></button></div><hr/><div class="my-5"><p class="text-sm font-light dark:text-gray-400 text-gray-500 mb-1">Copyright © 2024</p></div></aside><div class="transition-all fixed h-screen w-screen flex items-center justify-center left-0 z-20 top-0 pointer-events-none opacity-0"><div class="absolute top-0 left-0 w-screen h-screen bg-black opacity-50"></div><div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded lg:w-1/6 mx-3 w-full relative z-10 transition-all top-10"><div class="flex border-gray-300 pb-2 mb-3 border-b"><p class="  font-medium w-full">Share:</p><span class="pl-5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="pt-1 text-[18px] cursor-pointer" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"></path></svg></span></div><div class="flex flex-wrap items-center"><a class="mr-3" aria-label="facebook-share" href="https://www.facebook.com/sharer/sharer.php?u=https://ypermitin.github.io" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-92.4 233.5h-63.9c-50.1 0-59.8 23.8-59.8 58.8v77.1h119.6l-15.6 120.7h-104V912H539.2V602.2H434.9V481.4h104.3v-89c0-103.3 63.1-159.6 155.3-159.6 44.2 0 82.1 3.3 93.2 4.8v107.9z"></path></svg></a><a class="mr-3" aria-label="twitter-share" href="http://twitter.com/share?text=Check out this article!! &amp;url=https://ypermitin.github.io&amp;hashtags=webdevelopment,javacript,javascriptdaily,webdevelopmenttutorial,tutorial" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm215.3 337.7c.3 4.7.3 9.6.3 14.4 0 146.8-111.8 315.9-316.1 315.9-63 0-121.4-18.3-170.6-49.8 9 1 17.6 1.4 26.8 1.4 52 0 99.8-17.6 137.9-47.4-48.8-1-89.8-33-103.8-77 17.1 2.5 32.5 2.5 50.1-2a111 111 0 0 1-88.9-109v-1.4c14.7 8.3 32 13.4 50.1 14.1a111.13 111.13 0 0 1-49.5-92.4c0-20.7 5.4-39.6 15.1-56a315.28 315.28 0 0 0 229 116.1C492 353.1 548.4 292 616.2 292c32 0 60.8 13.4 81.1 35 25.1-4.7 49.1-14.1 70.5-26.7-8.3 25.7-25.7 47.4-48.8 61.1 22.4-2.4 44-8.6 64-17.3-15.1 22.2-34 41.9-55.7 57.6z"></path></svg></a><a class="mr-3" aria-label="linkedin-share" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://ypermitin.github.io&amp;title=Check out this article!!&amp;source=LinkedIn" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[23px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"></path></svg></a><button class="mr-3" name="copy-link" aria-label="copy-link"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z"></path><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243z"></path></svg></button></div><div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded fixed flex transition-all right-[10px] -bottom-20 opacity-0" role="alert"><strong class="font-bold">Link Copied</strong><span class="pl-5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="pt-1 text-[18px] cursor-pointer" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"></path></svg></span></div></div></div><section class="PageLayout_centered_article_wrapper__gS3Af dark:bg-slate-900 dark:text-white"><div class="container px-0 md:px-[15px] pt-[50px] pb-[50px]"><article class="PageLayout_article_content__4dnq3 pb-[30px] px-3 bg-white dark:bg-slate-800 dark:border-none dark:drop-shadow-lg dark:text-white pt-10 md:pt-0 mx-auto font-regular text-lg leading-relaxed"><div class="mb-[30px]"><h1 class="ArticleHeader_articleTitle__3L1Bi text-center text-2xl md:text-4xl font-medium mt-[20px] mb-[5px]">Занимательный PowerShell</h1><div class="mb-[10px] mt-[15px] text-[14px] font-medium ArticleHeader_centered_article_header_author___gRtE"><p class="my-0 mx-[30px] font-medium">YPermitin<span class="px-1 font-light">в</span><a href="/blog/?category=DevOps">DevOps</a></p><p class="my-0">2021-05-16</p></div><div class="md:mt-2 flex flex-wrap justify-center"><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->DevOps</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->PowerShell</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->1С:Предприятие</p></div></div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset">Оглавление</h1><ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#what-and-why">Что это и зачем</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#about-installation">Немного об установке</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#instruments">Инструментарий</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#tasks">Спектр задач</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#install-and-configure-1C">Установка и настройка 1С</a></u></b><ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#install-and-configure-1C-list">Список установленных версий платформы</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#install-and-configure-1C-command">Установка одной командой</a></u></b></li></ul></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#manage-service">Управление службой</a></u></b><ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#manage-service-list">Список установленных служб с информацией</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#manage-service-action">Запуск, остановка, перезапуск</a></u></b></li></ul></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#com-component">Старый, добрый COM</a></u></b><ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#com-component-check">Проверка регистрации COM</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#com-component-reg">Регистрация COM</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#com-component-unreg">Отмена регистрации COM</a></u></b></li></ul></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#cluster">Кластер под контролем</a></u></b><ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#cluster-info">Информация о кластере</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#cluster-reg-run">Регистрация и запуск консоли управления кластером</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#cluster-teminate-sessions">Завершаем все сеансы</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#cluster-cleat-session-data">Очистка сеансовых данных</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#cluster-block-infobases">Блокировка всех информационных баз</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#cluster-data-size-check">Контроль размера данных кластера</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#cluster-sessions-to-postgresql">Сохраняем ифнормацию о сеансах в базу PostgreSQL</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#cluster-working-processes-to-postgresql">Сохраняем ифнормацию о рабочих процессах в базу PostgreSQL</a></u></b></li></ul></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#start-1c">Запуск 1С</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#greate-sql-server">Великий SQL Server</a></u></b><ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#greate-sql-server-dbatools">Пример работы с модулем DBATools</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#greate-sql-server-shrink">Пример создания сжатой тествой базы со скрытым shrink’ом</a></u></b></li></ul></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#postgresql">Совсем немного PostgreSQL</a></u></b><ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#postgresql">Пример вызова psql</a></u></b></li></ul></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#api">Вызов стороннего API</a></u></b><ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#api-zabbix">Пример вызова API сервера Zabbix</a></u></b></li></ul></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#bot">Собственный бот</a></u></b><ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#bot-telegram">Отправка сообщений в Telegram</a></u></b></li></ul></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#email">Отправка писем</a></u></b><ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#email-yandex">Отправка электронной почты</a></u></b></li></ul></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#proc">Контролируй процессы</a></u></b><ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#proc-list">Список процессов</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#proc-kill">Убить нельзя помиловать</a></u></b></li></ul></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#port">Проверка свободного порта</a></u></b><ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#port-free">Свободный ли порт?</a></u></b></li></ul></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#remote">Удаленное управление</a></u></b><ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#remote-setup">Простейший пример настройки</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#remote-use">Как использовать</a></u></b></li></ul></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#more">Еще, еще, еще</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#nope">Меньше костылей</a></u></b></li><li><b><u><a class="cursor-pointer hover:text-blue-500" href="/blog/DevOps/2021-05/amusing-powershell/#theend">В самом конце</a></u></b></li></ul><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="what-and-why">Что это и зачем</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset"><b><u><a href="https://learn.microsoft.com/ru-ru/powershell/scripting/overview?view=powershell-7.3" target="_blank" rel="noopener noreferrer">PowerShell</a></u></b> - это средство автоматизации от компании Microsoft с <b><u><a href="https://github.com/PowerShell/PowerShell" target="_blank" rel="noopener noreferrer">открытым исходным кодом</a></u></b>, которое поддерживается в Windows, Linux, MacOS и даже под ARM. Представляет из себя объектно-ориентированный программный движок и скриптовый язык с интерфейсом командной строки.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Обладает обширными возможностями и позволяет решать практически любые задачи администрирования. Благодаря тесной интеграции с платформой .NET позволяет использовать все ее возможности. А огромное сообщество гарантирует большое количество готовых скриптов и модулей на любой вкус, цвет, платформу и требования. Из-за всего этого имеет достаточно большую распространенность и сферу применения.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Фактически, статья показывает как начать разработку скриптов на PowerShell, с каких материалов можно начать и дает примеры скриптов для старта.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Упор был сделан на контекст платформы 1С (но есть информация и по SQL Server, PostgreSQL и общим вопросам администрирования), чтобы показать наличие уже готовых инструментов для решений администрирования и не уходить с головой в “около1Сные” скриптовые движки. Не мучайте администраторов, развивайтесь, коллеги! Становитесь частью экомистемы и команды, а не отдельным изолированным миром, тогда и наладяться отношения системных администраторов и разработчиков 1С.</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="about-installation">Немного об установке</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Процесс установки PowerShell различается в зависимости от ОС, ее версии и т.д. Подробнее об установке и обновлении текущих версий рекомендую посмотреть <b><u><a href="https://learn.microsoft.com/ru-ru/powershell/scripting/install/installing-powershell?view=powershell-7.3" target="_blank" rel="noopener noreferrer">официальную документацию.</a></u></b></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Стоит отметить, что в операционной системе Windows есть встроенный движок “Windows PowerShell”, который уже немного отстает от актуальных версий. Иногда можно встретить путаницу между Windows PowerShell и актуальной версией PowerShell, которая выпускается уже в кроссплатформенном варианте. Все примеры скриптов ниже тестировались именно на Windows PowerShell, но все новые разработки и скрипты стараюсь делать на актуальных версиях PowerShell, что и Вам рекомендую.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Подробно расписывать шаги установки смысла нет - посмотрите ссылку выше. Там подробная инструкция как для Windows, так и для Linux.</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="instruments">Инструментарий</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Еще немного хотелось бы сказать об инструментах для работы с PowerShell. В составе Windows с древних времен идет среда разработки “Windows PowerShell ISE”, которой, конечно, можно пользоваться и сейчас. Но даже по внешнему виду можно понять, что она достаточно архаично выглядит, да и большинства удобств современных IDE там просто не найти. Поэтому лучший выбор - это использование <b><u><a href="https://code.visualstudio.com/" target="_blank" rel="noopener noreferrer">Visual Studio Code.</a></u></b></p><div class="Images_article_image__wrapper__QSTzx my-4 Images_size_medium__0iTcB display-block mx-auto my-5"><div aria-owns="rmiz-modal-" data-rmiz=""><div data-rmiz-content="not-found" style="visibility:visible"><img src="/imp_assets/DevOps/2021-05/amusing-powershell/logo.png" alt="Visual Studio Code" width="100%" class="block"/></div></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Достаточно установить расширение “PowerShell” и Вы получите отладку, удобный редактор с автоподсказками и многое другое. В статье <b><u><a href="https://learn.microsoft.com/ru-ru/powershell/scripting/dev-cross-plat/vscode/using-vscode?view=powershell-7.3" target="_blank" rel="noopener noreferrer">“Использование Visual Studio Code для разработки в PowerShell” </a></u></b> можно найти подробное описание что и как устанавливать, чтобы получить рабочую среду разработки. Также там есть описание дополнительных шагов настройки, которые в некоторых случаях могут понадобиться. Все вышесказанное актуально как для Windows, так и для Linux.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Еще немного слов про терминал. Как известно, в Windows работа с терминалом всегда была не очень удобной. Но с появлением <b><u><a href="https://apps.microsoft.com/store/detail/9N0DX20HK701?hl=ru-ru&amp;gl=RU" target="_blank" rel="noopener noreferrer">Windows Terminal</a></u></b> ситуация изменилась, хоть еще и есть куда стремиться. Теперь, как минимум, мы можем открывать несколько терминалов в одном окне и с разным типом. Вот, например, сразу один терминал PowerShell, два под Linux (через подсистему WSL) и один это старый добрый CMD.</p><div class="Images_article_image__wrapper__QSTzx my-4 Images_size_medium__0iTcB display-block mx-auto my-5"><div aria-owns="rmiz-modal-" data-rmiz=""><div data-rmiz-content="not-found" style="visibility:visible"><img src="/imp_assets/DevOps/2021-05/amusing-powershell/Windows Terminal.png" alt="Windows Terminal" width="100%" class="block"/></div></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Под Linux список инструментов для работы с терминалом намного больше и сами инструменты функциональней. Для себя использую простой терминал Gnome. Вот можете выбрать себе более подходящий.</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="tasks">Спектр задач</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">И целой книги не хватит, чтобы описать и пройтись по всему спектру задач, которые решает PowerShell. Но мы и не собирались. Ниже приведено несколько скриптов, которые позволяют примерно понять что и зачем можно делать. Также они могут быть стартовой точкой для начала написания собственных скриптов или целых решений автоматизации.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Это лишь примеры скриптов, не являющиеся готовым решением, поэтому они не оформляются в какой-либо отдельный модуль или пакет. Скорее всего в Вашей ситуации их придется дорабатывать.</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="install-and-configure-1C">Установка и настройка 1С</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Начнем с простого - списка установленных версий 1С и команда установки.</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="install-and-configure-1C-list">Список установленных версий платформы</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Из реестра Windows можно узнать список всех установленных версий 1С (32 и 64 битных).</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-aYaIB sc-gEvDqW iPTlYj dDyKkI prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token variable" style="color:rgb(156, 220, 254)">$installedApps</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> System</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Collections</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ArrayList</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Get-ItemProperty</span><span class="token plain"> HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain">  </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayName </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*1C:Предприятие*&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-or</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayName </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*1C:Enterprise*&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Select-Object</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Publisher</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> InstallDate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> InstallLocation </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$installedApps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token namespace">[PSCustomObject]</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;DisplayName&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;DisplayVersion&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayVersion</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Publisher&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Publisher</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;InstallDate&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">InstallDate</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;InstallLocation&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">InstallLocation</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Out-Null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Get-ItemProperty</span><span class="token plain"> HKLM:\oftware\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall* </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayName </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*1C:Предприятие*&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-or</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayName </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*1C:Enterprise*&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Select-Object</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Publisher</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> InstallDate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> InstallLocation </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$installedApps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token namespace">[PSCustomObject]</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;DisplayName&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;DisplayVersion&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayVersion</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Publisher&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Publisher</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;InstallDate&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">InstallDate</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;InstallLocation&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">InstallLocation</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Out-Null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$installedApps</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Format-Table</span><span class="token plain"> –AutoSize</span></div></pre></div></div><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-eqUzNf sc-fqkwJk iHgKgO UsweM prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;# Пример вывода</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    DisplayName                             DisplayVersion Publisher InstallDate InstallLocation</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    -----------                             -------------- --------- ----------- ---------------</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    1C:Предприятие 8 (x86-64) (8.3.16.1063) 8.3.16.1063    1С-Софт   20200106    C:\Program Files\1cv8\8.3.16.1063    1C:Предприятие 8 (8.3.12.1924)          8.3.12.1924    1С-Софт   20200224    C:\Program Files (x86)\1cv8\8.3.12.1924    1C:Предприятие 8 (8.3.5.1517)           8.3.5.1517     1C        20200110    C:\Program Files (x86)\1cv8\8.3.5.1517    1C:Предприятие 8 (8.3.6.2530)           8.3.6.2530     1C        20200221    C:\Program Files (x86)\1cv8\8.3.6.2530    #&gt;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Теперь мы можем легко получить список установленных версий платформы 1С на хосте.</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="install-and-configure-1C-command">Установка одной командой</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Как известно, установщики приложений от 1С имеют возможность запуска с указанием параметров в командной строке. Воспользуемся этим.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-dcJtft sc-iGgVNO fMboDu laIWNw prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token variable" style="color:rgb(156, 220, 254)">$installFilesDirectory</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C:\Soft\1C&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Каталог, где находится установочные файлы</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Set-Location</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$installFilesDirectory</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$msiInstallerPath</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$installFilesDirectory</span><span class="token string" style="color:rgb(206, 145, 120)">\1CEnterprise 8 (x86-64).msi&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$adminstallrelogonPath</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$installFilesDirectory</span><span class="token string" style="color:rgb(206, 145, 120)">\adminstallrelogon.mst&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$lang1049Path</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$installFilesDirectory</span><span class="token string" style="color:rgb(206, 145, 120)">\1049.mst&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DESIGNERALLCLIENTS</span><span class="token plain"> = 1</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$THICKCLIENT</span><span class="token plain">=1</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$THINCLIENTFILE</span><span class="token plain">=1</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$THINCLIENT</span><span class="token plain">=1</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$WEBSERVEREXT</span><span class="token plain">=0</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$SERVER</span><span class="token plain">=0</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$CONFREPOSSERVER</span><span class="token plain">=0</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$CONVERTER77</span><span class="token plain">=0</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$SERVERCLIENT</span><span class="token plain">=0</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$LANGUAGES</span><span class="token plain">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;RU&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$params</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;/i&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$msiInstallerPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)"># Сокращенный интерфейс. По сути, при установке пользователь увидит только бегущую полосу прогресса. Можно указать /qn и юзер вообще ничего при установке не увидит.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;/qr&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)"># Здесь мы подключаем рекомендованную фирмой 1С трансформацию adminstallrelogon.mst и пакет русского языка 1049.mst</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;TRANSFORMS=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$adminstallrelogonPath</span><span class="token string" style="color:rgb(206, 145, 120)">;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$lang1049Path</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)"># Это основные компоненты 1С:Предприятия, включая компоненты для администрирования, конфигуратор и толстый клиент. Без этого параметра ставится всегда только тонкий клиент, независимо от следующего параметра</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;DESIGNERALLCLIENTS=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$DESIGNERALLCLIENTS</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;THICKCLIENT=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$THICKCLIENT</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Толстый клиент</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;THINCLIENTFILE=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$THINCLIENTFILE</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Тонкий клиент, файловый вариант</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;THINCLIENT=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$THINCLIENT</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Тонкий клиент</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;WEBSERVEREXT=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$WEBSERVEREXT</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Модули расширения WEB-сервера</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;SERVER=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$SERVER</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Сервер 1С:Предприятия</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;CONFREPOSSERVER=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$CONFREPOSSERVER</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Сервер хранилища конфигураций</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;CONVERTER77=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$CONVERTER77</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Конвертер баз 1С:Предприятия 7.7</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;SERVERCLIENT=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$SERVERCLIENT</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Администрирование сервера</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;LANGUAGES=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$LANGUAGES</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Язык установки – русский.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$params</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    &amp; msiexec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">exe @params</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Примерно этот же способ используют для установки 1С на множестве компьютеров, только каталог с установщиком находится в сетевом каталоге. Но вариантов установки, конечно же, много.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Проще простого, не так ли?</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="manage-service">Управление службой</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Частой задачей может быть перезапуск службы 1С или по крайней мере просмотр их списка.</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="manage-service-list">Список установленных служб с информацией</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Просто получим список установленных служб Windows, где файл приложения “ragent.exe”. Искать службу по имени не всегда надежно, ведь их могут зарегистрировать вручную под любым именем.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-gsFSjX sc-kAycRU bZpKGG cjpRNV prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-WmiObject</span><span class="token plain"> win32_service </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> ?</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;*&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Select</span><span class="token plain"> Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> PathName </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName  </span><span class="token operator" style="color:rgb(212, 212, 212)">-Like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*ragent.exe*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$obj</span><span class="token plain"> = </span><span class="token namespace">[PSCustomObject]</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">data</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[PSCustomObject]</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Name&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;DisplayName&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;PathName&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;State&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">State</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$obj</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">data</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Format-Table</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Теперь у нас есть список с именем службы, ее состоянием и командой запуска.</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="manage-service-action">Запуск, остановка, перезапуск</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">И еще несколько примеров скриптов. Первый - это запуск остановленных служб 1С.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-imWZod sc-jXbVAB hNuImb hAayMH prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-WmiObject</span><span class="token plain"> win32_service </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> ?</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;*&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Select</span><span class="token plain"> Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> PathName </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName  </span><span class="token operator" style="color:rgb(212, 212, 212)">-Like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*ragent.exe*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$obj</span><span class="token plain"> = </span><span class="token namespace">[PSCustomObject]</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">data</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">State </span><span class="token operator" style="color:rgb(212, 212, 212)">-eq</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Stopped&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">Start-Service</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Запущена служба &quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Ошибка при запуске службы &quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Подробно:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$Error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Далее остановка запущенных служб.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-dhKdPU sc-kpDprT eNHaTr kuoBGL prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-WmiObject</span><span class="token plain"> win32_service </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> ?</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;*&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Select</span><span class="token plain"> Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> PathName </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName  </span><span class="token operator" style="color:rgb(212, 212, 212)">-Like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*ragent.exe*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$obj</span><span class="token plain"> = </span><span class="token namespace">[PSCustomObject]</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">data</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">State </span><span class="token operator" style="color:rgb(212, 212, 212)">-eq</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Running&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">Stop-Service</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Остановлена служба &quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Ошибка при остановке службы &quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Подробно:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$Error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">И, конечно же, перезапуск.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-dAlxHm sc-jlZhRR jFUmgV cIANJC prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-WmiObject</span><span class="token plain"> win32_service </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> ?</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;*&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Select</span><span class="token plain"> Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> PathName </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName  </span><span class="token operator" style="color:rgb(212, 212, 212)">-Like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*ragent.exe*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$obj</span><span class="token plain"> = </span><span class="token namespace">[PSCustomObject]</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">data</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">State </span><span class="token operator" style="color:rgb(212, 212, 212)">-eq</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Running&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">Restart-Service</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Перезапущена служба &quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Ошибка при перезапуске службы &quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Подробно:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$Error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Ничего особого тут нет, ничего сложного.</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="com-component">Старый, добрый COM</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">До сих пор с 1С во многих компаниях работа выполняется через COM, в том числе и с сервером 1С. Вот несколько команд в помощь для работы с COM.</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="com-component-check">Проверка регистрации COM</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Проверяем наличие зарегистрированных COM-объектов в системе для платформы 8.2 и 8.3.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-cwHqhk sc-jEABJj gbhKeT gPcqWW prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$v83COMConnector</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">COMObject </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;V83.COMConnector&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Компонента &quot;</span><span class="token plain">V83</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">COMConnector</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; зарегистрирована и готова к использованию.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Компонента &quot;</span><span class="token plain">V83</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">COMConnector</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; не зарегистрирована.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$v82COMConnector</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">COMObject </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;V82.COMConnector&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Компонента &quot;</span><span class="token plain">V82</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">COMConnector</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; зарегистрирована и готова к использованию.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Компонента &quot;</span><span class="token plain">V82</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">COMConnector</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; не зарегистрирована.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Проверяются только компоненты, зарегистрированные по стандартному имени.</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="com-component-reg">Регистрация COM</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Еще один скрипт - это регистрация COM-компоненты. Будьте осторожны, т.к. здесь выполняется регистрация для всех установленных служб 1С. Обычно она одна и поэтому будет зарегистрирована только одна компонента. Но мало ли что у Вас на сервере.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-cPiJYC sc-dLNtp hgJKrL jiwomU prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token variable" style="color:rgb(156, 220, 254)">$allServices1C</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-WmiObject</span><span class="token plain"> win32_service </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> ?</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;*&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Select</span><span class="token plain"> Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> PathName </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName  </span><span class="token operator" style="color:rgb(212, 212, 212)">-Like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*ragent.exe*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$allServices1C</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPathRagent</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&quot;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceDirectory</span><span class="token plain"> = </span><span class="token namespace">[System.IO.Path]</span><span class="token plain">::GetDirectoryName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPathRagent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$comcntrPath</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$serviceDirectory</span><span class="token string" style="color:rgb(206, 145, 120)">\comcntr.dll&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$regCommand</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;regsvr32.exe &quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$comcntrPath</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"> = </span><span class="token namespace">[System.Diagnostics.FileVersionInfo]</span><span class="token plain">::GetVersionInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPathRagent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">FileVersion</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Начало регистрации COM-компоненты 1С:Предприятия&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Версия платформы: </span><span class="token string variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Путь к DLL: &quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$comcntrPath</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Команда регистрации компоненты: &quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$regCommand</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        cmd </span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">c </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$regCommand</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Регистрация компоненты успешно выполнена!&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Ошибка при регистрации компоненты!&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Подробно:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$Error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Не забывайте запускать скрипт с правами администратора для успешной регистрации COM.</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="com-component-unreg">Отмена регистрации COM</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Аналогичная ситуация при отмене регистрации COM.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-eDPFhE sc-eldOKa eNmsPv irUebG prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token variable" style="color:rgb(156, 220, 254)">$allServices1C</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-WmiObject</span><span class="token plain"> win32_service </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> ?</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;*&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Select</span><span class="token plain"> Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> PathName </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName  </span><span class="token operator" style="color:rgb(212, 212, 212)">-Like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*ragent.exe*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$allServices1C</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPathRagent</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&quot;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceDirectory</span><span class="token plain"> = </span><span class="token namespace">[System.IO.Path]</span><span class="token plain">::GetDirectoryName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPathRagent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$comcntrPath</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$serviceDirectory</span><span class="token string" style="color:rgb(206, 145, 120)">\comcntr.dll&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$regCommand</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;regsvr32.exe /u &quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$comcntrPath</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"> = </span><span class="token namespace">[System.Diagnostics.FileVersionInfo]</span><span class="token plain">::GetVersionInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPathRagent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">FileVersion</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Начало отмены регистрации COM-компоненты 1С:Предприятия&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Версия платформы: </span><span class="token string variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Путь к DLL: &quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$comcntrPath</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Команда регистрации компоненты: &quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$regCommand</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        cmd </span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">c </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$regCommand</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Отмена регистрации компоненты успешно выполнена!&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Ошибка при отмене регистрации компоненты!&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Подробно:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$Error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Также необходимы права администратора.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">COM с нами еще надолго <!-- -->:)</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="cluster">Кластер под контролем</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Еще немного о взаимодействии с кластером 1С.</p><div class="Images_article_image__wrapper__QSTzx my-4 Images_size_medium__0iTcB display-block mx-auto my-5"><div aria-owns="rmiz-modal-" data-rmiz=""><div data-rmiz-content="not-found" style="visibility:visible"><img src="/imp_assets/DevOps/2021-05/amusing-powershell/Кластер под контролем.gif" alt="Кластер под контролем" width="100%" class="block"/></div></div></div><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="cluster-info">Кластер под контролем</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Получим немного информации о кластере 1С без COM, только по данным службы Windows.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-fPXMhL sc-gFqAYk fITTzq boWTGV prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-WmiObject</span><span class="token plain"> win32_service </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> ?</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;*&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Select</span><span class="token plain"> Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> PathName </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName  </span><span class="token operator" style="color:rgb(212, 212, 212)">-Like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*ragent.exe*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$obj</span><span class="token plain"> = </span><span class="token namespace">[PSCustomObject]</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">data</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token plain"> = </span><span class="token namespace">[ordered]</span><span class="token plain">@</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Trim</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Contains</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$value</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">split </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;\s+&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 2</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token variable" style="color:rgb(156, 220, 254)">$name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$value</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$parsePathAgentExe</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Substring</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Length </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$parsePathAgentExe</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$parsePathAgentExe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Substring</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$parsePathAgentExe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">IndexOf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&quot;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">Test-Path</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$parsePathAgentExe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"> = </span><span class="token namespace">[System.Diagnostics.FileVersionInfo]</span><span class="token plain">::GetVersionInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$parsePathAgentExe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">FileVersion</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-replace</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&quot;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegPort</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">regport</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPort</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">port</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPortRange</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">range</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegPath</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token string" style="color:rgb(206, 145, 120)">\reg_</span><span class="token string variable" style="color:rgb(156, 220, 254)">$clusterRegPort</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[PSCustomObject]</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Name&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;DisplayName&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayName            </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;State&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">State</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Version&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ClusterPath&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ClusterRegPort&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegPort</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ClusterPort&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPort</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ClusterPortRange&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPortRange</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ClusterRegPath&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegPath</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;PathName&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$obj</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">data</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Format-Table</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Теперь мы можем получить имя службы, состояние, версию платформы, путь к каталогу кластера 1С, используемые порты и каталог кластера.</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="cluster-reg-run">Регистрация и запуск консоли кластера</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Бывает ли у Вас такое, что используется несколько версий 1С и необходимо запускать консоль администрирования серверов 1С разных версий? Этот скрипт должен помочь.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-ikkyvV sc-dAbbbq eXHfyt grmDek prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Регистрация и запуск консоли администрирования нужной версии платформы 1С</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$installedApps</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> System</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Collections</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ArrayList</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Get-ItemProperty</span><span class="token plain"> HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain">  </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayName </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*1C:Предприятие*&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-or</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayName </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*1C:Enterprise*&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Select-Object</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Publisher</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> InstallDate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> InstallLocation </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$installedApps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[PSCustomObject]</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;DisplayName&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;DisplayVersion&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayVersion</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Publisher&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Publisher</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;InstallDate&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">InstallDate</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;InstallLocation&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">InstallLocation</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Out-Null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Get-ItemProperty</span><span class="token plain"> HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall* </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayName </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*1C:Предприятие*&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-or</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayName </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*1C:Enterprise*&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Select-Object</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Publisher</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> InstallDate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> InstallLocation </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$installedApps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[PSCustomObject]</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;DisplayName&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;DisplayVersion&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayVersion</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Publisher&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Publisher</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;InstallDate&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">InstallDate</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;InstallLocation&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">InstallLocation</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Out-Null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$menu</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$i</span><span class="token plain">=1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token variable" style="color:rgb(156, 220, 254)">$i</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-le</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$installedApps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$i</span><span class="token operator" style="color:rgb(212, 212, 212)">++</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$i</span><span class="token string" style="color:rgb(206, 145, 120)">. </span><span class="token string function" style="color:rgb(220, 220, 170)">$</span><span class="token string function punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string function variable" style="color:rgb(156, 220, 254)">$installedApps</span><span class="token string function punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string function variable" style="color:rgb(156, 220, 254)">$i</span><span class="token string function operator" style="color:rgb(212, 212, 212)">-</span><span class="token string function" style="color:rgb(220, 220, 170)">1</span><span class="token string function punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token string function punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token string function" style="color:rgb(220, 220, 170)">DisplayName</span><span class="token string function punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token string" style="color:rgb(206, 145, 120)"> (</span><span class="token string function" style="color:rgb(220, 220, 170)">$</span><span class="token string function punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string function variable" style="color:rgb(156, 220, 254)">$installedApps</span><span class="token string function punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string function variable" style="color:rgb(156, 220, 254)">$i</span><span class="token string function operator" style="color:rgb(212, 212, 212)">-</span><span class="token string function" style="color:rgb(220, 220, 170)">1</span><span class="token string function punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token string function punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token string function" style="color:rgb(220, 220, 170)">InstallLocation</span><span class="token string function punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token string" style="color:rgb(206, 145, 120)">)&quot;</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$menu</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$i</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$installedApps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token variable" style="color:rgb(156, 220, 254)">$i</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token namespace">[int]</span><span class="token variable" style="color:rgb(156, 220, 254)">$answer</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Read-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Выберите установленную платформу 1С&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$selection</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$menu</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Item</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$answer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$selection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$installLocation</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$selection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">InstallLocation</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$redminPath</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Join-Path</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Path </span><span class="token variable" style="color:rgb(156, 220, 254)">$installLocation</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ChildPath </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;bin\radmin.dll&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$1cv8Path</span><span class="token plain"> = </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">get-item</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$installLocation</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">parent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">FullName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$commonPath</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Join-Path</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Path </span><span class="token variable" style="color:rgb(156, 220, 254)">$1cv8Path</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ChildPath </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;common&quot;</span><span class="token plain">    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$consolePath</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain">    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$foundMscFiles</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-Childitem</span><span class="token plain"> –Path </span><span class="token variable" style="color:rgb(156, 220, 254)">$commonPath</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;1CV8 Servers*.msc&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$foundMscFiles</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-and</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$foundMscFiles</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Length </span><span class="token operator" style="color:rgb(212, 212, 212)">-ge</span><span class="token plain"> 0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$consolePath</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Join-Path</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Path </span><span class="token variable" style="color:rgb(156, 220, 254)">$commonPath</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ChildPath </span><span class="token variable" style="color:rgb(156, 220, 254)">$foundMscFiles</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Не найдена оснастка консоли администрирования (1CV8 Servers*.msc) в каталоге: </span><span class="token string variable" style="color:rgb(156, 220, 254)">$commonPath</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">BackgroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">Test-Path</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$redminPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Начало регистрации компоненты radmin.dll&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">BackgroundColor Blue</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        regsvr32 </span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">s </span><span class="token variable" style="color:rgb(156, 220, 254)">$redminPath</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Успешно зарегистрирована компонента radmin.dll&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">BackgroundColor Green</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        C:\Windows\System32\mmc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">exe </span><span class="token variable" style="color:rgb(156, 220, 254)">$consolePath</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Не найдена компонент radmin.dll по пути: </span><span class="token string variable" style="color:rgb(156, 220, 254)">$redminPath</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">BackgroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Выбрано некорректное значение.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">BackgroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Для регистрации компонентов нужны права администратора. А куда без них…</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="cluster-teminate-sessions">Завершаем все сеансы</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Пример скрипта, который завершит все сеансы 1С на сервере. Взаимодействие происходит через COM.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-feUYzb sc-fUnNpA jhbxmK dYAFdY prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-WmiObject</span><span class="token plain"> win32_service </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> ?</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;*&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Select</span><span class="token plain"> Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> PathName </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName  </span><span class="token operator" style="color:rgb(212, 212, 212)">-Like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*ragent.exe*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPathRagent</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&quot;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token plain"> = </span><span class="token namespace">[ordered]</span><span class="token plain">@</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Trim</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Contains</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$value</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">split </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;s+&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 2</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token variable" style="color:rgb(156, 220, 254)">$name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$value</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token namespace">[System.IO.File]</span><span class="token plain">::Exists</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPathRagent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"> = </span><span class="token namespace">[System.Diagnostics.FileVersionInfo]</span><span class="token plain">::GetVersionInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPathRagent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">FileVersion        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-replace</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&quot;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegPort</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">regport</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPort</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">port</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPortRange</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">range</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegPath</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token string" style="color:rgb(206, 145, 120)"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">eg_</span><span class="token string variable" style="color:rgb(156, 220, 254)">$clusterRegPort</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentPort</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentAddress</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;localhost&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Имя администратора кластера</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminPassword</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Пароль администратора кластера</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$fullAgentAddress</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;tcp://&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentAddress</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;8.2.*&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">            </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">COMObject </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;V82.COMConnector&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;8.3.*&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">COMObject </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;V83.COMConnector&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ConnectAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$fullAgentAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterList</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$ServerAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">GetClusters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$cluster</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Authenticate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$Cluster</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminPassword</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverSessionsData</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">GetSessions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$cluster</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverSessions</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverSessionsData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverSessionsData</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">                </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TerminateSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$cluster</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$userName</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">userName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$sessionId</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SessionID</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Завершен сеанс </span><span class="token string variable" style="color:rgb(156, 220, 254)">$sessionId</span><span class="token string" style="color:rgb(206, 145, 120)">. Пользователь: </span><span class="token string variable" style="color:rgb(156, 220, 254)">$userName</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">                </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Ошибка при выполнении скрипта.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Подробно:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$Error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Будьте осторожны при запуске. Не сбросьте сеансы в рабочей базе в рабочее время <!-- -->:)</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="cluster-cleat-session-data">Очистка сеансовых данных</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Периодически приходится чистить каталог сеансовых данных, особенно если встречаются непонятные “глюки” в работе сервера 1С.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-hzhKNl sc-fHjqbK eLCUcy gvURGq prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Очистка сеансовых данных 1С</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-WmiObject</span><span class="token plain"> win32_service </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> ? </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;*&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Select</span><span class="token plain"> Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> PathName </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName </span><span class="token operator" style="color:rgb(212, 212, 212)">-Like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*ragent.exe*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># 1. Останавливаем службу 1С</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Stop service 1C: </span><span class="token string variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">BackgroundColor Blue</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Stop-Service</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">NoWait</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$svc</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-Service</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$svc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Status</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$svc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">WaitForStatus</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Stopped&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$svc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Status</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Дополнительное ожидание для освобождения файлов процессами после остановки службы</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Start-Sleep</span><span class="token plain"> 15</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># 2. Ищем путь к каталогу с сеансовыми данными</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token plain"> = </span><span class="token namespace">[ordered]</span><span class="token plain">@</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Trim</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Contains</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$value</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">split </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;\s+&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 2</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token variable" style="color:rgb(156, 220, 254)">$name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$value</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-replace</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&quot;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegPort</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">regport</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegDirectory</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Join-Path</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Path </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ChildPath </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;reg_</span><span class="token string variable" style="color:rgb(156, 220, 254)">$clusterRegPort</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain">            </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$storageSessionDataSizeMb</span><span class="token plain"> = 0</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Get-ChildItem</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegDirectory</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;snccntx*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$storageSessionDataPath</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Join-Path</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Path </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegDirectory</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ChildPath </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)"># 3. Удаляем каталоги с сеансовыми данными</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Remove session storage directory: </span><span class="token string variable" style="color:rgb(156, 220, 254)">$storageSessionDataPath</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">BackgroundColor Blue</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Remove-Item</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">LiteralPath </span><span class="token variable" style="color:rgb(156, 220, 254)">$storageSessionDataPath</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Force </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Recurse</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># 4. Запускаем службу 1С</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Start service 1C: </span><span class="token string variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">BackgroundColor Blue</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Start-Service</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceName</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">COM не нужен, но права администратора все равно нужны для остановки и запуска служб.</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="cluster-block-infobases">Блокировка всех информационных баз</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Еще один пример работы через COM - блокировка работы со всеми информационными базами.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-hmdnzv sc-bXCLgj RwzUi jDFebW prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-WmiObject</span><span class="token plain"> win32_service </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> ?</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;*&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Select</span><span class="token plain"> Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> PathName </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName  </span><span class="token operator" style="color:rgb(212, 212, 212)">-Like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*ragent.exe*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPathRagent</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&quot;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token plain"> = </span><span class="token namespace">[ordered]</span><span class="token plain">@</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Trim</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Contains</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$value</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">split </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;\s+&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 2</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token variable" style="color:rgb(156, 220, 254)">$name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$value</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token namespace">[System.IO.File]</span><span class="token plain">::Exists</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPathRagent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"> = </span><span class="token namespace">[System.Diagnostics.FileVersionInfo]</span><span class="token plain">::GetVersionInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPathRagent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">FileVersion        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-replace</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&quot;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegPort</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">regport</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPort</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">port</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPortRange</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">range</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegPath</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token string" style="color:rgb(206, 145, 120)"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">eg_</span><span class="token string variable" style="color:rgb(156, 220, 254)">$clusterRegPort</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentPort</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentAddress</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;localhost&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Имя администратора кластера</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminPassword</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Пароль администратора кластера</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$fullAgentAddress</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;tcp://&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentAddress</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;8.2.*&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">            </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">COMObject </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;V82.COMConnector&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;8.3.*&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">COMObject </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;V83.COMConnector&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ConnectAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$SrvAddr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterList</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$ServerAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">GetClusters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$cluster</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Authenticate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$Cluster</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminPassword</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">                   </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$workingProcesses</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">GetWorkingProcesses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$cluster</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(156, 220, 254)">$workingProcesses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Running </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> 1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token keyword" style="color:rgb(86, 156, 214)">continue</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcessConnectionString</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;tcp://&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">HostName+</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;:&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">MainPort</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcessConnection</span><span class="token plain">= </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ConnectWorkingProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcessConnectionString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Здесь должна быть аутентификация пользователя, имеющего доступ к информационной базе                    </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$infobaseUserName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain">                    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$infobaseUserPassword</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain">                    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcessConnection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">AddAuthentication</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$infobaseUserName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$infobaseUserPassword</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$infoBases</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcessConnection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">GetInfoBases</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$infoBases</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">                </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfobase</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token comment" style="color:rgb(106, 153, 85)"># Установка запрета соединения с информационной базой</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfobase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ConnectDenied = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfobase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DeniedMessage = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;База недоступна. Ведутся регламентные работы. Отправьте SMS на номер 6666&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfobase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PermissionCode = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;123456&quot;</span><span class="token plain">                      </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfobase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DeniedFrom = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;2020-01-01 00:00:00&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfobase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DeniedTo = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;2020-12-31 23:59:59&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token comment" style="color:rgb(106, 153, 85)"># Блокировка регламентных заданий</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfobase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ScheduledJobsDenied = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token comment" style="color:rgb(106, 153, 85)"># Сохраняем измененные настройки</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcessConnection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">UpdateInfoBase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfobase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$infobaseName</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfobase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Установлена блокировка подключений к базе </span><span class="token string variable" style="color:rgb(156, 220, 254)">$infobaseName</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Установлена блокировка регламентных заданий в базе </span><span class="token string variable" style="color:rgb(156, 220, 254)">$infobaseName</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green                        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Ошибка при выполнении скрипта.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Подробно:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$Error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Не забудьте отправить SMS на указанный номер в примере скрипта <!-- -->:)</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Ну а для снятия блокировки можно использовать следующий скрипт.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-jsJARu sc-eeDSqt bsTHiw jxOdNY prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-WmiObject</span><span class="token plain"> win32_service </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> ?</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;*&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Select</span><span class="token plain"> Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> PathName </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName  </span><span class="token operator" style="color:rgb(212, 212, 212)">-Like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*ragent.exe*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPathRagent</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&quot;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token plain"> = </span><span class="token namespace">[ordered]</span><span class="token plain">@</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Trim</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Contains</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$value</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">split </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;\s+&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 2</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token variable" style="color:rgb(156, 220, 254)">$name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$value</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token namespace">[System.IO.File]</span><span class="token plain">::Exists</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPathRagent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"> = </span><span class="token namespace">[System.Diagnostics.FileVersionInfo]</span><span class="token plain">::GetVersionInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPathRagent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">FileVersion        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-replace</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&quot;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegPort</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">regport</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPort</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">port</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPortRange</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">range</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegPath</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token string" style="color:rgb(206, 145, 120)"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">eg_</span><span class="token string variable" style="color:rgb(156, 220, 254)">$clusterRegPort</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentPort</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentAddress</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;localhost&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Имя администратора кластера</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminPassword</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Пароль администратора кластера</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$fullAgentAddress</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;tcp://&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentAddress</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;8.2.*&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">            </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">COMObject </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;V82.COMConnector&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;8.3.*&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">COMObject </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;V83.COMConnector&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ConnectAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$SrvAddr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterList</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$ServerAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">GetClusters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$cluster</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Authenticate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$Cluster</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminPassword</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">                   </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$workingProcesses</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">GetWorkingProcesses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$cluster</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(156, 220, 254)">$workingProcesses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Running </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> 1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token keyword" style="color:rgb(86, 156, 214)">continue</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcessConnectionString</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;tcp://&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">HostName+</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;:&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">MainPort</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcessConnection</span><span class="token plain">= </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ConnectWorkingProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcessConnectionString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Здесь должна быть аутентификация пользователя, имеющего доступ к информационной базе                    </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$infobaseUserName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain">                    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$infobaseUserPassword</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain">                    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcessConnection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">AddAuthentication</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$infobaseUserName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$infobaseUserPassword</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$infoBases</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcessConnection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">GetInfoBases</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$infoBases</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">                </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfobase</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token comment" style="color:rgb(106, 153, 85)"># Снятие запрета соединения с информационной базой</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfobase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ConnectDenied = </span><span class="token boolean">$false</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token comment" style="color:rgb(106, 153, 85)"># Снятие блокировки регламентных заданий</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfobase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ScheduledJobsDenied = </span><span class="token boolean">$false</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token comment" style="color:rgb(106, 153, 85)"># Сохраняем измененные настройки</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcessConnection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">UpdateInfoBase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfobase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$infobaseName</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfobase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Снята блокировка подключений к базе </span><span class="token string variable" style="color:rgb(156, 220, 254)">$infobaseName</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Снята блокировка регламентных заданий в базе </span><span class="token string variable" style="color:rgb(156, 220, 254)">$infobaseName</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green                        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Ошибка при выполнении скрипта.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Подробно:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$Error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Профит!</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="cluster-data-size-check">Контроль размера данных кластера</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Еще один простой скрипт для получения размера сеансовых данных сервера 1С.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-koYCI sc-bmzXxz hwcYdi hJFCvp prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Получение информации о размере каталога кластера 1С и каталога сеансовых данных</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Get-Size</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">param</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token namespace">[string]</span><span class="token variable" style="color:rgb(156, 220, 254)">$pth</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">gci</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">path </span><span class="token variable" style="color:rgb(156, 220, 254)">$pth</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">recurse </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">measure-object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">property length </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">sum</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">sum </span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain"> 1mb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-WmiObject</span><span class="token plain"> win32_service </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> ? </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;*&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Select</span><span class="token plain"> Name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> PathName </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName </span><span class="token operator" style="color:rgb(212, 212, 212)">-Like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;*ragent.exe*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$obj</span><span class="token plain"> = </span><span class="token namespace">[PSCustomObject]</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">data</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$services1C</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PathName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token plain"> = </span><span class="token namespace">[ordered]</span><span class="token plain">@</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceExecPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;-&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Trim</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Contains</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$value</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">split </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;\s+&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 2</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token variable" style="color:rgb(156, 220, 254)">$name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$value</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-replace</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&quot;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterDataSize</span><span class="token plain"> = 0</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">Test-Path</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterDataSize</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-Size</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegPort</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">regport</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegDirectory</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Join-Path</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Path </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ChildPath </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;reg_</span><span class="token string variable" style="color:rgb(156, 220, 254)">$clusterRegPort</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$storageSessionDataSizeMb</span><span class="token plain"> = 0</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token function" style="color:rgb(220, 220, 170)">Get-ChildItem</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegDirectory</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;snccntx*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$storageSessionDataPath</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Join-Path</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Path </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterRegDirectory</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ChildPath </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$folderSize</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-Size</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$storageSessionDataPath</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$storageSessionDataSizeMb</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$storageSessionDataSizeMb</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$folderSize</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token namespace">[PSCustomObject]</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Name&#x27;</span><span class="token plain">              = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;DisplayName&#x27;</span><span class="token plain">       = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serviceInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DisplayName        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ClusterPath&#x27;</span><span class="token plain">       = </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterPath</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;ClusterFolderSizeMb&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterDataSize</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;SessionStorageSizeMb&#x27;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$storageSessionDataSizeMb</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$obj</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">data</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Format-Table</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Может пригодиться для отслеживания работы сервера.</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="cluster-sessions-to-postgresql">Сохраняем информацию о сеансах в базу PostgreSQL</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Многие системы мониторинга сохраняют информацию о сеансах. Следующие скрипты делают это, отправляя данные в базы данных PostgreSQL. Этот для сеансов.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-iHGNiK sc-dtBeHJ jMfLSz hGCART prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Перед работой скрипта сохранения информации о сеансах 1С необходимо создать базу данных PostgreSQL</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">с соответствующей таблицей и индексом.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">CREATE TABLE public.sessions1c (</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	servername varchar(25) NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	infobase varchar(25) NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	sessionid int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	started_at timestamp(0) NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	last_active_at timestamp(0) NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	host varchar(25) NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	appid varchar(25) NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	username varchar(50) NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	work_process_id int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	connectionid int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	&quot;period&quot; timestamp(0) NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	db_proc_info int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	db_proc_took_at timestamp(0) NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	db_proc_took int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	blocked_by_dbms int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	blocked_by_ls int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	duration_current_dbms int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	duration_last_5_min_dbms int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	duration_all_dbms int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	dbms_bytes_last_5_min int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	dbms_bytes_all int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	duration_current int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	duration_last_5_min int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	duration_all int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	calls_last_5_min int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	calls_all int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	bytes_last_5_min int8 NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	bytes_all int8 NULL</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">);</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">CREATE INDEX sessions1c_period_idx ON public.sessions1c (&quot;period&quot; timestamp_ops,servername text_ops,infobase text_ops);</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Также нужно установить ODBC-драйвер для работы с PostgreSQL: https://odbc.postgresql.org/</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Настройки сервера PostgreSQL</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$DBIP</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;127.0.0.1&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Адрес сервера PostgreSQL</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$DBPort</span><span class="token plain"> = 5432 </span><span class="token comment" style="color:rgb(106, 153, 85)"># Порт сервера PostgreSQL</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$DBName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;MyDatabase&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># База данных для сохранения информации</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$DBUser</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;MyUser&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Пользователь PostgreSQL</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$DBPass</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;MyPassword&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Пароль пользователь PostgreSQL</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConnectionString</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Driver={PostgreSQL UNICODE};Server=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$DBIP</span><span class="token string" style="color:rgb(206, 145, 120)">;Port=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$DBPort</span><span class="token string" style="color:rgb(206, 145, 120)">;Database=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$DBName</span><span class="token string" style="color:rgb(206, 145, 120)">;Uid=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$DBUser</span><span class="token string" style="color:rgb(206, 145, 120)">;Pwd=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$DBPass</span><span class="token string" style="color:rgb(206, 145, 120)">;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Настройки сервера 1С</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$server1CSettings</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Добавляем настройки сервера 1С для сбора данных.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Аналогично можно добавить сколько угодно серверов</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$server1CSettings</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> PSCustomObject </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Property @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    agentPort = 1540 </span><span class="token comment" style="color:rgb(106, 153, 85)"># Порт сервера 1С</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    agentAddress = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;my.server.1c.ru&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Адрес сервера 1С</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    clusterAdminName = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Имя администратора кластера (пустой, если его нет)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    clusterAdminPassword = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Пароль администратора кластера (пустой, если его нет)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Сервер 1С для сбора данных</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Получаем информацию о сеансах для каждого сервера</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$server1CSettings</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">  </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">COMObject </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;V83.COMConnector&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)"># Для 8.2</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">#$COMConnector = New-Object -COMObject &quot;V82.COMConnector&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Компонента &quot;</span><span class="token plain">COMConnector</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; зарегистрирована и готова к использованию.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Компонента &quot;</span><span class="token plain">V82</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">COMConnector</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; не зарегистрирована.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> System</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">Data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Odbc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">OdbcConnection</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ConnectionString = </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConnectionString</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Open</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Установлено соединение с базой данных мониторинга.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Не удалось установить соединение с базой данных мониторинга.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentAddress</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">agentAddress</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentPort</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">agentPort</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminName</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">clusterAdminName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminPassword</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">clusterAdminPassword</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$fullAgentAddress</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;tcp://&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentAddress</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$fullAgentAddress</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-and</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ConnectAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$fullAgentAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterList</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$ServerAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">GetClusters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$cluster</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Authenticate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$Cluster</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminPassword</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$period</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-Date</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverSessionsData</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">GetSessions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$cluster</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverSessionsData</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">                </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CreateCommand</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Connection = </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$insertQuery</span><span class="token plain"> = </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">@</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">        INSERT INTO sessions1c</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">        (</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            period,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            servername,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            infobase,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            sessionid,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            started_at,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            last_active_at,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            host,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            appid,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            username,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            work_process_id,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            connectionid,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            db_proc_info,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            db_proc_took_at,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            db_proc_took,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            blocked_by_dbms,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            blocked_by_ls,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            duration_current_dbms,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            duration_last_5_min_dbms,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            duration_all_dbms,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            dbms_bytes_last_5_min,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            dbms_bytes_all,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            duration_current,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            duration_last_5_min,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            duration_all,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            calls_last_5_min,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            calls_all,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            bytes_last_5_min,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            bytes_all</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">        )</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">        VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain">@</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CommandText = </span><span class="token variable" style="color:rgb(156, 220, 254)">$insertQuery</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@period&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 26</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@servername&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 25</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@infobase&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 25</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@sessionid&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@started_at&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 26</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@last_active_at&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 26</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@host&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 25</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@appid&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 25</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@username&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 50</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@work_process_id&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@connectionid&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@db_proc_info&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@db_proc_took_at&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 26</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@db_proc_took&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@blocked_by_dbms&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@blocked_by_ls&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@duration_current_dbms&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@duration_last_5_min_dbms&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@duration_all_dbms&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::Int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@dbms_bytes_last_5_min&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@dbms_bytes_all&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@duration_current&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@duration_last_5_min&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@duration_all&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@calls_last_5_min&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@calls_all&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@bytes_last_5_min&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@bytes_all&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Дата получения информации о сеансах</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@period&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$period</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ToString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Имя сервера 1С</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@servername&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentAddress</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит описание информационной базы, с которой установлен сеанс.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">infoBase </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@infobase&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">infoBase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Name                                             </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@infobase&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит номер сеанса. Целое число, уникальное среди всех сеансов данной информационной базы.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@sessionid&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SessionID   </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Дата/ время начала сеанса.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@started_at&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">StartedAt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ToString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Дата/ время последней активности сеанса.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@last_active_at&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">LastActiveAt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ToString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит имя или адрес компьютера, установившего сеанс.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@host&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Host</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит идентификатор приложения, установившего сеанс.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@appid&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">AppID</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит имя аутентифицированного пользователя информационной базы.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@username&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">userName </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Идентификатор активного рабочего процесса в терминах операционной системы.               </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@work_process_id&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PID</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@work_process_id&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = 0</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит идентификатор соединения. Позволяет различить разные соединения, </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># установленные одним и тем же приложением с одного и того же клиентского компьютера.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">connection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@connectionid&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">connection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ConnID</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@connectionid&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = 0</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">              </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит номер соединения с СУБД в терминах СУБД в том случае, если в момент получения списка выполняется запрос к СУБД, </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># открыта транзакция или определены временные таблицы (это означает, что захвачено соединение с СУБД). </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@db_proc_info&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token namespace">[int]</span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">dbProcInfo</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@db_proc_info&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = 0</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">                </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит момент времени, когда соединение с СУБД было захвачено данным сеансом последний раз.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@db_proc_took_at&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">dbProcTookAt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ToString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит время соединение с СУБД с момента захвата в миллисекундах.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@db_proc_took&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">dbProcTook                </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит номер сеанса, который является причиной ожидания транзакционной блокировки</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@blocked_by_dbms&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">blockedByDBMS</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит номер сеанса, который является причиной ожидания управляемой транзакционной блокировки</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@blocked_by_ls&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">blockedByLS</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит интервал времени в миллисекундах, прошедший с момента начала выполнения запроса, в случае, если сеанс выполняет запрос к СУБД.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@duration_current_dbms&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">durationCurrentDBMS</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит суммарное время исполнения запросов к СУБД от имени данного сеанса за последние 5 минут, в миллисекундах.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@duration_last_5_min_dbms&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">durationLast5MinDBMS</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит суммарное время исполнения запросов к СУБД от имени данного сеанса с момента начала сеанса, в миллисекундах.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@duration_all_dbms&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">durationAllDBMS</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит количество данных, переданных и полученных от СУБД от имени данного сеанса за последние 5 минут, в байтах.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@dbms_bytes_last_5_min&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">dbmsBytesLast5Min</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит количество данных, переданных и полученных от СУБД от имени данного сеанса с момента начала сеанса, в байтах.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@dbms_bytes_all&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">dbmsBytesAll</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит интервал времени в миллисекундах, прошедший с момента начала обращения, в случае, если сеанс выполняет обращение к серверу 1С:Предприятия.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@duration_current&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">durationCurrent</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит время исполнения вызовов сервера 1С:Предприятия от имени данного сеанса за последние 5 минут, в миллисекундах.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@duration_last_5_min&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">durationLast5Min</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит время исполнения вызовов сервера 1С:Предприятия от имени данного сеанса с момента начала сеанса, в секундах.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@duration_all&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">durationAll</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит количество вызовов сервера 1С:Предприятия от имени данного сеанса за последние 5 минут.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@calls_last_5_min&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">callsLast5Min</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит количество вызовов сервера 1С:Предприятия от имени данного сеанса с момента начала сеанса.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@calls_all&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">callsAll</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит объем данных, переданных между сервером 1С:Предприятия и клиентским приложением данного сеанса за последние 5 минут, в байтах.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@bytes_last_5_min&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">bytesLast5Min</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит объем данных, переданных между сервером 1С:Предприятия и клиентским приложением данного сеанса с момента начала сеанса, в байтах.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@bytes_all&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemSession</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">bytesAll               </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ExecuteNonQuery</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">                            </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Ошибка при выполнении скрипта.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Подробно:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$Error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Внутри скрипта также команды для создания базы данных.</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="cluster-working-processes-to-postgresql">Сохраняем информацию о рабочих процессах в базу PostgreSQL</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">А это скрипт для рабочих процессов.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-kOHUsU sc-dtImxT fSzhNq QlCQC prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Перед работой скрипта сохранения информации о рабочих процессах 1С необходимо создать базу данных PostgreSQL</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">с соответствующей таблицей и индексом.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">CREATE TABLE public.work_processes1c (</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	hostname varchar(25) NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	main_port int8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	sync_port int8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	&quot;enable&quot; bool NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	running int8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	connections int8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	started_at timestamp(0) NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	avg_call_time float8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	avg_server_call_time float8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	avg_db_call_time float8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	avg_back_call_time float8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	avg_lock_call_time float8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	selection_size int8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	avg_threads float8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	capacity int8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	memory_size int8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	memory_excess_time int8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	available_perfomance int8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	pid int8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	use int8 NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	is_enable bool NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	&quot;period&quot; timestamp(0) NOT NULL,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">	servername varchar(25) NOT NULL</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">);</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">CREATE INDEX work_processes1c_period_idx ON public.work_processes1c USING btree (period, servername, hostname);</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Также нужно установить ODBC-драйвер для работы с PostgreSQL: https://odbc.postgresql.org/</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Настройки сервера PostgreSQL</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$DBIP</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;127.0.0.1&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Адрес сервера PostgreSQL</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$DBPort</span><span class="token plain"> = 5432 </span><span class="token comment" style="color:rgb(106, 153, 85)"># Порт сервера PostgreSQL</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$DBName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;MyDatabase&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># База данных для сохранения информации</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$DBUser</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;MyUser&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Пользователь PostgreSQL</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$DBPass</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;MyPassword&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Пароль пользователь PostgreSQL</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConnectionString</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Driver={PostgreSQL UNICODE};Server=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$DBIP</span><span class="token string" style="color:rgb(206, 145, 120)">;Port=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$DBPort</span><span class="token string" style="color:rgb(206, 145, 120)">;Database=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$DBName</span><span class="token string" style="color:rgb(206, 145, 120)">;Uid=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$DBUser</span><span class="token string" style="color:rgb(206, 145, 120)">;Pwd=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$DBPass</span><span class="token string" style="color:rgb(206, 145, 120)">;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Настройки сервера 1С</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$server1CSettings</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Добавляем настройки сервера 1С для сбора данных.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Аналогично можно добавить сколько угодно серверов</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$server1CSettings</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> PSCustomObject </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Property @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    agentPort = 1540 </span><span class="token comment" style="color:rgb(106, 153, 85)"># Порт сервера 1С</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    agentAddress = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;my.server.1c.ru&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Адрес сервера 1С</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    clusterAdminName = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Имя администратора кластера (пустой, если его нет)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    clusterAdminPassword = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Пароль администратора кластера (пустой, если его нет)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Сервер 1С для сбора данных</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Получаем информацию о рабочих процессах для каждого сервера</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$server1CSettings</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">  </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">COMObject </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;V83.COMConnector&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)"># Для 8.2</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">#$COMConnector = New-Object -COMObject &quot;V82.COMConnector&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Компонента &quot;</span><span class="token plain">COMConnector</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; зарегистрирована и готова к использованию.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Компонента &quot;</span><span class="token plain">V82</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">COMConnector</span><span class="token string" style="color:rgb(206, 145, 120)">&quot; не зарегистрирована.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> System</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">Data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Odbc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">OdbcConnection</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ConnectionString = </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConnectionString</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Open</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Установлено соединение с базой данных мониторинга.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Не удалось установить соединение с базой данных мониторинга.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentAddress</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">agentAddress</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentPort</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">agentPort</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminName</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">clusterAdminName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminPassword</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">clusterAdminPassword</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$fullAgentAddress</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;tcp://&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentAddress</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$fullAgentAddress</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-and</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ConnectAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$fullAgentAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterList</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$ServerAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">GetClusters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$cluster</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Authenticate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$Cluster</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterAdminPassword</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$period</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-Date</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$workingProcesses</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$serverAgent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">GetWorkingProcesses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$cluster</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(156, 220, 254)">$workingProcesses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CreateCommand</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Connection = </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$insertQuery</span><span class="token plain"> = </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">@</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">        INSERT INTO work_processes1c</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">        (</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">            period,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        servername,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        hostname,    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        main_port,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        sync_port,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        enable,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        running,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        connections,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        started_at,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        avg_call_time,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        avg_server_call_time,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        avg_db_call_time,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        avg_back_call_time,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        avg_lock_call_time,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        selection_size,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        avg_threads,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        capacity,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        memory_size,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        memory_excess_time,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        available_perfomance,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        pid,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        use,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	        is_enable</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">        )</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">        VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain">@</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CommandText = </span><span class="token variable" style="color:rgb(156, 220, 254)">$insertQuery</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@period&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 26</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@servername&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 25</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@hostname&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 25</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@main_port&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@sync_port&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@enable&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::Bit</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@running&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@connections&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@started_at&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::varchar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> 26</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@avg_call_time&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::Double</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@avg_server_call_time&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::Double</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@avg_db_call_time&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::Double</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@avg_back_call_time&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::Double</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@avg_lock_call_time&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::Double</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@selection_size&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@avg_threads&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::Double</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@capacity&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@memory_size&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@memory_excess_time&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@available_perfomance&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@pid&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@use&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::BigInt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@is_enable&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token namespace">[System.Data.Odbc.OdbcType]</span><span class="token plain">::Bit</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Дата получения информации о рабочих процессах</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@period&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$period</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ToString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Имя сервера 1С</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@servername&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$agentAddress</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит имя или IP-адрес компьютера, на котором должен быть запущен рабочий процесс.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@hostname&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">HostName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит номер основного IP-порта рабочего процесса. Этот порт выделяется динамически </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># при старте рабочего процесса из диапазонов портов, определенных для соответствующего рабочего сервера.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@main_port&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">MainPort</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@sync_port&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SyncPort</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Признак включения рабочего процесса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@enable&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Enable</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># 0 – процесс неактивен (либо не загружен в память, либо не может выполнять клиентские запросы); 1 – процесс активен (работает).</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@running&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Running</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Connections</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@connections&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">connections</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит момент запуска рабочего процесса. Если процесс не запущен, то содержит нулевую дату.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@started_at&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">StartedAt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ToString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Показывает среднее время обслуживания рабочим процессом одного клиентского обращения. </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Оно складывается из: значений свойств AvgServerCallTime, AvgDBCallTime, AvgLockCallTime.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@avg_call_time&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">AvgCallTime</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Показывает среднее время, затрачиваемое самим рабочим процессом на выполнение одного клиентского обращения.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@avg_server_call_time&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">AvgServerCallTime</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Показывает среднее время, затрачиваемое рабочим процессом на обращения к серверу баз данных при выполнении одного клиентского обращения.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@avg_db_call_time&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">AvgDBCallTime					</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@avg_back_call_time&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">AvgBackCallTime</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Показывает среднее время обращения к менеджеру блокировок.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@avg_lock_call_time&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">AvgLockCallTime</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Количество вызовов, по которым посчитана статистика.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@selection_size&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SelectionSize</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Показывает среднее количество клиентских потоков, исполняемых рабочим процессом кластера.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@avg_threads&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">AvgThreads</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Относительная производительность процесса. </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Может находиться в диапазоне от 1 до 1000. Используется в процессе выбора рабочего процесса, к которому будет подсоединен очередной клиент. </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@capacity&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Capacity</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит объем виртуальной памяти, занимаемой рабочим процессом, в килобайтах.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@memory_size&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">MemorySize</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Содержит время, в течение которого объем виртуальной памяти рабочего процесса превышает критическое значение, установленное для кластера, в секундах.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@memory_excess_time&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">MemoryExcessTime</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Средняя за последние 5 минут доступная производительность. </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Определяется по времени реакции рабочего процесса на эталонный запрос.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># В соответствии с доступной производительностью кластер серверов принимает решение о распределении клиентов между рабочими процессами.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@available_perfomance&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">AvailablePerfomance</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)"># Идентификатор активного рабочего процесса в терминах операционной системы.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@pid&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">PID</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">					Определяет использование рабочего процесса кластером. Устанавливается администратором. </span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">						Возможные значения:</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">						0 – не использовать, процесс не должен быть запущен;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">						1 – использовать, процесс должен быть запущен;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">						2 – использовать как резервный, процесс должен быть запущен только при невозможности запуска процесса со значением 1 этого свойства.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">					#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@use&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Use</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">					</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">IsEnables</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@is_enable&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token variable" style="color:rgb(156, 220, 254)">$workProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">IsEnables</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Parameters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;@is_enable&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Value = </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">1</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token namespace">[void]</span><span class="token variable" style="color:rgb(156, 220, 254)">$DBCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ExecuteNonQuery</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">                </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Ошибка при выполнении скрипта.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Подробно:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$Error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$COMConnector</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$DBConn</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Принцип тот же, что и для сеансов.</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="rac">Прочь COM, да здравствует RAC</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Работа через COM в какой-то мере устарела и все скрипты относятся теперь к легаси. Эффективнее теперь все подобные действия <b><u><a href="https://v8.1c.ru/platforma/administrirovanie-klastera-serverov/" target="_blank" rel="noopener noreferrer">выполнять через RAC</a></u></b>.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="rac-common">Общий пример работы с RAC</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Вот пример скрипта для блокировки выполнения фоновых заданий для информационных баз.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-kOPcje sc-cWSIco kCQmZV hhYCuo prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># Функция для выполнения произвольной команды с аргументами</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">Function</span><span class="token plain"> Execute-Command </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$commandTitle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$commandPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$commandArguments</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$pinfo</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> System</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Diagnostics</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ProcessStartInfo</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$pinfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">FileName = </span><span class="token variable" style="color:rgb(156, 220, 254)">$commandPath</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$pinfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">RedirectStandardError = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$pinfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">RedirectStandardOutput = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$pinfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">UseShellExecute = </span><span class="token boolean">$false</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$pinfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CreateNoWindow = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$pinfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">WindowStyle = </span><span class="token namespace">[System.Diagnostics.ProcessWindowStyle]</span><span class="token plain">::Hidden</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$pinfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Arguments = </span><span class="token variable" style="color:rgb(156, 220, 254)">$commandArguments</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$p</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> System</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Diagnostics</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">Process</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$p</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">StartInfo = </span><span class="token variable" style="color:rgb(156, 220, 254)">$pinfo</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$p</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Start</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Out-Null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$p</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">WaitForExit</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">100</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Out-Null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$resultObject</span><span class="token plain"> = </span><span class="token namespace">[pscustomobject]</span><span class="token plain">@</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        commandTitle = </span><span class="token variable" style="color:rgb(156, 220, 254)">$commandTitle</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        stdout = </span><span class="token variable" style="color:rgb(156, 220, 254)">$p</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">StandardOutput</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ReadToEnd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        stderr = </span><span class="token variable" style="color:rgb(156, 220, 254)">$p</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">StandardError</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ReadToEnd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        ExitCode = </span><span class="token variable" style="color:rgb(156, 220, 254)">$p</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ExitCode</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$resultObject</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Функция для преобразования консольного вывода в список объектов</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">Function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Convert-StdOut</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ToObjectList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$sourceResult</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$collectionResult</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> System</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Collections</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ArrayList</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$paramsResult</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$sourceResult</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">split </span><span class="token namespace">[System.Environment]</span><span class="token plain">::NewLine</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$resultObject</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$paramsResult</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$paramResult</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$indexDelimeter</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$paramResult</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">IndexOf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;:&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$indexDelimeter</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-gt</span><span class="token plain"> 0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-eq</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$resultObject</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$resultObject</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">TypeName PSObject</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$paramName</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$paramResult</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Substring</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$indexDelimeter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Trim</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$paramValue</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$paramResult</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Substring</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$indexDelimeter</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> 1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$paramResult</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Length </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$indexDelimeter</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> 1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Trim</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">       </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$paramName</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-and</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$paramValue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token variable" style="color:rgb(156, 220, 254)">$resultObject</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Add-Member</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">MemberType NoteProperty </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(156, 220, 254)">$paramName</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Value </span><span class="token variable" style="color:rgb(156, 220, 254)">$paramValue</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$collectionResult</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$resultObject</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Out-Null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$resultObject</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$collectionResult</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Параметры</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;8.3.18.1208&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$racExecPath</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C:\Program Files\1cv8\&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$platformVersion</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;\bin\rac.exe&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Получаем список кластеров</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$commandClusterInfoResult</span><span class="token plain"> = Execute-Command </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">commandTitle </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Clusters List&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">commandPath </span><span class="token variable" style="color:rgb(156, 220, 254)">$racExecPath</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">commandArguments </span><span class="token string" style="color:rgb(206, 145, 120)">&quot; cluster list&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$commandClusterInfoResultAsObjectList</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Convert-StdOut</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ToObjectList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$commandClusterInfoResult</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">stdout</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ToString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$commandClusterInfoResultAsObjectList</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterObject</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterObject</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-eq</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">continue</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">  </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Получаем список информационных баз</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterId</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterObject</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">cluster</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$commandInfobasesInfoArguments</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot; infobase summary list --cluster=&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterId</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$commandInfobasesInfo</span><span class="token plain"> = Execute-Command </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">commandTitle </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Infobases List&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">commandPath </span><span class="token variable" style="color:rgb(156, 220, 254)">$racExecPath</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">commandArguments </span><span class="token variable" style="color:rgb(156, 220, 254)">$commandInfobasesInfoArguments</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$commandInfobasesInfoAsObjectList</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Convert-StdOut</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ToObjectList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$commandInfobasesInfo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">stdout</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ToString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$commandInfobasesInfoAsObjectList</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfoBase</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfoBase</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-eq</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">continue</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)"># Изменяем параметры информационной базы</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$infobaseId</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfoBase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">infobase</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$userName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Имя пользователя информационной базы</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$userPassword</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Пароль пользователя информационной базы</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$commandInfobasesDisableJobs</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot; infobase update --cluster=&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$clusterId</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot; --infobase=&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$infobaseId</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;  --infobase-user=&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$userName</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;  --infobase-pwd=&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$userPassword</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot; --scheduled-jobs-deny=on&quot;</span><span class="token plain">        </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$commandInfobasesInfo</span><span class="token plain"> = Execute-Command </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">commandTitle </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Infobases Scheduled Jobs Deny&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">commandPath </span><span class="token variable" style="color:rgb(156, 220, 254)">$racExecPath</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">commandArguments </span><span class="token variable" style="color:rgb(156, 220, 254)">$commandInfobasesDisableJobs</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$infobaseName</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemInfoBase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">name</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Изменены настройки для базы </span><span class="token string variable" style="color:rgb(156, 220, 254)">$infobaseName</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ForegroundColor Green</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Для других действий необходимо изучить документацию по RAC.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset"><b><u><a href="https://www.powershellgallery.com/packages/1C.Utils/0.1.9/Content/1C.Utils.psm1" target="_blank" rel="noopener noreferrer">Вооооооооооооот тут скрипт.</a></u></b></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Только не заставляйте переписать все скрипты с COM на RAC <!-- -->:)</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="start-1c">Запуск 1С</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Пару лет назад был выпущен модуль <b><u><a href="https://www.powershellgallery.com/packages/1C.Utils/0.3.0" target="_blank" rel="noopener noreferrer">“1C.Utils”</a></u></b>. Там есть хороший скрипт для запуска приложений 1С.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Жаль, что модуль больше не обновляется, но даже эти наработки можно использовать.</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="greate-sql-server">Великий SQL Server</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Для работы со SQL Server также есть огромный функционал. Работу можно выполнять через ODBC, SMO и многими другими путями. Ниже два небольших примера.</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="greate-sql-server-dbatools">Пример работы с модулем DBATools</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Здесь мы будем использовать готовый модуль <b><u><a href="https://dbatools.io/" target="_blank" rel="noopener noreferrer">DBATools</a></u></b>, о возможностях которого нам не хватит и целой статьи рассказать.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-eBMFzZ sc-dCFGXG iuXjB fjSxrH prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Пример запуска простого запроса с помощью DBATools</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">GitHub: https://github.com/sqlcollaborative/dbatools</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$instance</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;localhost&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Получаем список файлов баз данных</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Get-DbaFile</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">SqlInstance </span><span class="token variable" style="color:rgb(156, 220, 254)">$instance</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Читаем данные событий Extended Events</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Get-DbaXESession</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">SqlInstance </span><span class="token variable" style="color:rgb(156, 220, 254)">$instance</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Session system_health </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Read-DbaXEFile</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Out-GridView</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Сбос доступа администратора</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Reset-DbaAdmin</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">SqlInstance </span><span class="token variable" style="color:rgb(156, 220, 254)">$instance</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Login sqladmin </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Verbose</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Get-DbaDatabase</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">SqlInstance </span><span class="token variable" style="color:rgb(156, 220, 254)">$instance</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">SqlCredential sqladmin</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset"><b><u><a href="https://dbatools.io/" target="_blank" rel="noopener noreferrer">На официальной странице</a></u></b> проекта Вы можете найти все что нужно.</p><h2 class="font-semibold text-xl md:text-2xl my-[10px] mt-10 md:text" style="text-align:unset" id="greate-sql-server-shrink">Пример создания сжатой тестовой базы со скрытым shrink’ом</h2><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Еще один пример работы, но уже с помощью SMO. Здесь мы создаем копию базы данных с включенным сжатием PAGE. Может пригодиться для создания тестовых баз.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-fhzEvr sc-jxOSYQ jiJdME ccRQnw prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Экспериментальный скрипт для копирования базы данных по объектам.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Для копирования используется SQL Servet Managment Object</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    https://docs.microsoft.com/ru-ru/sql/relational-databases/server-management-objects-smo/overview-smo?view=sql-server-2017</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Этапы работы скрипта:</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">        1. Создаем соединения со SQL Server</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">        2. Создаем пустую базу данных назначения</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">        3. Передаем все объекты базы данных в в базу назначения (данные не передаются)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">        4. Включаем сжатие для всех объектов базы данных</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">        5. Передаем все данные для ранее скопированных объектов</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">        6. Закрываем соединения со SQL Server</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    TODO: Скрипт эксперементальный и не для рабочего окружения. </span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Требует серьезного рефакторинга и доработок.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token namespace">[string]</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$SourceSQLInstance</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;localhost&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token namespace">[string]</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$SourceDatabase</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;source_db_name&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token namespace">[string]</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$TargetSQLInstance</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;localhost&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token namespace">[string]</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$TargetDatabase</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;target_db_name&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#$sourceConnStr = &quot;Data Source=$SourceSQLInstance;Initial Catalog=$SourceDatabase;Integrated Security=True;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#$TargetConnStr = &quot;Data Source=$TargetSQLInstance;Initial Catalog=$TargetDatabase;Integrated Security=True;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$sourceConnStr</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Data Source=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$SourceSQLInstance</span><span class="token string" style="color:rgb(206, 145, 120)">;Initial Catalog=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$SourceDatabase</span><span class="token string" style="color:rgb(206, 145, 120)">;User Id=&lt;userName&gt;;Password=&lt;userPassword&gt;;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$TargetConnStr</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Data Source=</span><span class="token string variable" style="color:rgb(156, 220, 254)">$TargetSQLInstance</span><span class="token string" style="color:rgb(206, 145, 120)">;User Id=&lt;userName&gt;;Password=&lt;userPassword&gt;;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Import-Module</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Name SQLPS</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">write-host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;SQLPS module loaded&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">write-host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Connecting...&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$sourceSQLServer</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> Microsoft</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SqlServer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Management</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Smo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Server </span><span class="token variable" style="color:rgb(156, 220, 254)">$SourceSQLInstance</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$sourceDB</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$sourceSQLServer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Databases</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token variable" style="color:rgb(156, 220, 254)">$SourceDatabase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$sourceConn</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> System</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">Data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SqlClient</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SQLConnection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$sourceConnStr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$sourceConn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Open</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$targetSQLServer</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> Microsoft</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SqlServer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Management</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Smo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Server </span><span class="token variable" style="color:rgb(156, 220, 254)">$TargetSQLInstance</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$targetDB</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$sourceSQLServer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Databases</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token variable" style="color:rgb(156, 220, 254)">$TargetDatabase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$targetConn</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> System</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">Data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SqlClient</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SQLConnection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$TargetConnStr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$targetConn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Open</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">write-host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Connection established!&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">write-host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Creating target database...&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$targetDB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$targetSQLServer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">KillAllprocesses</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$TargetDatabase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$targetDB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Drop</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$targetDBNew</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> Microsoft</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SqlServer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Management</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Smo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Database</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$targetSQLServer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$TargetDatabase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$targetDBNew</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">write-host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Database created!&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">write-host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Transferring database objects...&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">TypeName Microsoft</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SqlServer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Management</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SMO</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Transfer </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ArgumentList </span><span class="token variable" style="color:rgb(156, 220, 254)">$SourceDB</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Options</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">AllowSystemObjects = </span><span class="token boolean">$false</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Options</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ContinueScriptingOnError = </span><span class="token boolean">$false</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Options</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Indexes = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Options</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">IncludeIfNotExists = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Options</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DriAll = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Options</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SchemaQualify = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Options</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ScriptSchema = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Options</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ScriptData = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Options</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">WithDependencies = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllTables = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Options</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">WithDependencies = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Options</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ContinueScriptingOnError = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DestinationDatabase = </span><span class="token variable" style="color:rgb(156, 220, 254)">$TargetDatabase</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DestinationServer = </span><span class="token variable" style="color:rgb(156, 220, 254)">$TargetSQLInstance</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DestinationLoginSecure = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllDatabaseTriggers = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllDefaults = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllFullTextCatalogs = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllFullTextStopLists = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllPartitionFunctions = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllPartitionSchemes = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllPlanGuides = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllRoles = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllRules = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllSchemas = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllSearchPropertyLists = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllSequences = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllSqlAssemblies = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllStoredProcedures = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllSynonyms = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllTables = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllUsers = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllViews = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllXmlSchemaCollections = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopySchema = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyData = </span><span class="token boolean">$false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$ObjTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TransferData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">write-host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Database objects transferred!&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">write-host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Enabling compression for database objects...&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$targetConn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ChangeDatabase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$TargetDatabase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$cmdObjectCompression</span><span class="token plain"> = </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token string" style="color:rgb(206, 145, 120)">&quot;declare @table_name sys.sysname, @IS_CLUSTERED bit, @SQL nvarchar(1000)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">    declare @c cursor</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">    set @c = cursor local fast_forward for   </span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">    select distinct s.name + &#x27;.&#x27; + o.name, coalesce( (select 1 from sys.indexes i where o.object_id = i.object_id and i.type_desc = &#x27;CLUSTERED&#x27; ), 0 ) IS_CLUSTERED</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">    from sys.partitions p</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">      inner join sys.objects o on p.object_id = o.object_id and o.type_desc = &#x27;USER_TABLE&#x27; and p.partition_number = 1</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">      inner join sys.schemas s on s.schema_id = o.schema_id</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">    where p.data_compression_desc = &#x27;NONE&#x27;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">    open @c</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">    fetch next from @c into @table_name, @IS_CLUSTERED</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">    while (@@fetch_status = 0) begin</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">      set @sql = &#x27;ALTER INDEX ALL ON &#x27; + @table_name + &#x27; REBUILD WITH (DATA_COMPRESSION = PAGE);&#x27; -- DATA_COMPRESSION = PAGE / DATA_COMPRESSION = NONE</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">      execute (@sql)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">      print @sql</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">      if ( @IS_CLUSTERED = 0 ) begin</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">        set @sql = &#x27;ALTER TABLE &#x27; + @table_name + &#x27; REBUILD WITH (DATA_COMPRESSION = PAGE);&#x27; -- DATA_COMPRESSION = PAGE / DATA_COMPRESSION = NONE</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">        execute (@sql)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">        print @sql</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">      end</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">      fetch next from @c into @table_name, @IS_CLUSTERED</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">    end&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$commandObjectCompression</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">new-object</span><span class="token plain"> system</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">sqlclient</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">sqlcommand</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$cmdObjectCompression</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$targetConn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$commandObjectCompressionResult</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$commandObjectCompression</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ExecuteNonQuery</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">write-host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Compression for database objects enabled!&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">write-host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Transferring data...&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$sqlCmd</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> System</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">Data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SqlClient</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SqlCommand</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$sqlCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Connection = </span><span class="token variable" style="color:rgb(156, 220, 254)">$sourceConn</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$sqlCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CommandText = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">SELECT</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	a3.name AS [schemaname],</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	a2.name AS [tablename],</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	a1.rows as row_count</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">FROM</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	(SELECT </span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">		ps.object_id,</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">		SUM (</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">			CASE</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">				WHEN (ps.index_id &lt; 2) THEN row_count</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">				ELSE 0</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">			END</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">			) AS [rows]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	FROM sys.dm_db_partition_stats ps</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	GROUP BY ps.object_id) AS a1</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">INNER JOIN sys.all_objects a2  ON ( a1.object_id = a2.object_id ) </span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">INNER JOIN sys.schemas a3 ON (a2.schema_id = a3.schema_id)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">WHERE</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	a2.type &lt;&gt; N&#x27;S&#x27; and a2.type &lt;&gt; N&#x27;IT&#x27;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">	AND a1.rows &gt; 0</span></div><div class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">ORDER BY row_count DESC&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$Tables</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$reader</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$sqlCmd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ExecuteReader</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$reader</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Read</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$Tables</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+=</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$reader</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;tablename&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$reader</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$countTables</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$Tables</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$numberTable</span><span class="token plain"> = 1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$table</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(156, 220, 254)">$Tables</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$numberTable</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$numberTable</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> 1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$numberTable</span><span class="token string" style="color:rgb(206, 145, 120)"> / </span><span class="token string variable" style="color:rgb(156, 220, 254)">$countTables</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$Tables</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Contains</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$table</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-eq</span><span class="token plain"> </span><span class="token boolean">$false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">continue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$dataTransfer</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">TypeName Microsoft</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SqlServer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Management</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SMO</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Transfer </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ArgumentList </span><span class="token variable" style="color:rgb(156, 220, 254)">$SourceDB</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$dataTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DestinationDatabase = </span><span class="token variable" style="color:rgb(156, 220, 254)">$TargetDatabase</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$dataTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">DestinationServer = </span><span class="token variable" style="color:rgb(156, 220, 254)">$TargetSQLInstance</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$dataTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyData = </span><span class="token boolean">$true</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$dataTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopySchema = </span><span class="token boolean">$false</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$dataTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">CopyAllObjects = </span><span class="token boolean">$false</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$dataTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">BatchSize = 10000</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$itemTableFilter</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$dataTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ObjectList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$sourceDB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Tables</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token variable" style="color:rgb(156, 220, 254)">$table</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$dataTransferResult</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$dataTransfer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">TransferData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">write-host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Data transferred!&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">write-host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Closing connections...&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$sourceConn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$targetConn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Close</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">write-host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Connections closed!&#x27;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">У такого подхода есть и еще один плюс - не нужно делать шринк, т.к. данные с нуля создаются в копии базы. Поэтому пустого зарезервированного места в файле данных просто не будет.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Капля в море, но нужно же с чего-то начинать <!-- -->:)</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="postgresql">Совсем немного PostgreSQL</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Для работы с PostgreSQL также можно использовать PowerShell, даже если установка выполнена на Linux. Следующий скрипт показывает простейший вызов команд с помощью psql.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-lcIQwB sc-kdBRUi czurxv bSvSwN prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Пример вызова PSQL из скрипта с установкой логина и пароля пользователя</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Путь PostgreSQL</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$pgDirectory</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C:\Program Files\PostgreSQL\13\bin&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Устанавливаем текущий каталог PostgreSQL для простого вызова утилиты psql</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Альтернативный подход - добавить этот каталог в параметры окружения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Set-Location</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$pgDirectory</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># База данных для подключения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$pgDatabase</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;postgres&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Имя пользователя</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$pgUser</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;postgres&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Пароль пользователя</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$pgPassword</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Pas$w0rd&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># psql не имеет параметра установки пароля явно в параметрах вызова,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># но вместо этого можно установить пароль через параметр окружения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$env</span><span class="token plain">:PGPASSWORD = </span><span class="token variable" style="color:rgb(156, 220, 254)">$pgPassword</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Выполнение произвольной команды</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">\psql</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">exe </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">p 5432 </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">U </span><span class="token variable" style="color:rgb(156, 220, 254)">$pgUser</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token variable" style="color:rgb(156, 220, 254)">$pgDatabase</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">c </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;select now()&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Завершение всех соединений с указанной базой данных</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#.\psql.exe -p 5432 -U $pgUser -c &quot;SELECT pg_terminate_backend(pid) FROM pg_stat_activity WHERE pid &lt;&gt; pg_backend_pid() AND datname = &#x27;$pgDatabase&#x27;;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Выполнение скрипта из файла. Таким же образом можно выполнить восстановление из дампа (*.sql)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#.\psql.exe -p 5432 -U $pgUser -d $pgDatabase -1 -f $scriptFilePath</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Фишкой здесь является установка пароля пользователя, от которого выполняется обращение к СУБД, т.к. psql не имеет такого параметра явно. В остальном ничего сложного.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Можно выполнять множество других действий, но для примера оставим только этот скрипт.</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="api">Вызов стороннего API</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Часто приходится иметь дело с различными REST-сервисами:</p><ul class="List_list__zLjGi list-disc pl-[30px]"><li>Проверять их доступность</li><li>Управлять учетными записями</li><li>Автоматизировать настройку</li><li>И др.</li></ul><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">В этом случае с помощью PowerShell также можно решать поставленные задачи.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="api-zabbix">Пример вызова API сервера Zabbix</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Например, с помощью следующего скрипта можно проверить доступность API сервера Zabbix.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-tafSX sc-esYjtY jPNsJp cvMkDq prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Пример вызова JSON-API Zabbix</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> CheckZabbixApi</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$zbxUserName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$zbxUserPassword</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$zbxBaseUrl</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$params</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        body =  @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;jsonrpc&quot;</span><span class="token plain">= </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;2.0&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;method&quot;</span><span class="token plain">= </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;user.login&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;params&quot;</span><span class="token plain">= @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;user&quot;</span><span class="token plain">= </span><span class="token variable" style="color:rgb(156, 220, 254)">$zbxUserName</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;password&quot;</span><span class="token plain">= </span><span class="token variable" style="color:rgb(156, 220, 254)">$zbxUserPassword</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;id&quot;</span><span class="token plain">= 1</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;auth&quot;</span><span class="token plain">= </span><span class="token variable" style="color:rgb(156, 220, 254)">$null</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ConvertTo-Json</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        uri = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string variable" style="color:rgb(156, 220, 254)">$zbxBaseUrl</span><span class="token string" style="color:rgb(206, 145, 120)">/api_jsonrpc.php&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        headers = @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Content-Type&quot;</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;application/json&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        method = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Post&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$result</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Invoke-WebRequest</span><span class="token plain"> @params</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$statusCode</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$result</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">StatusCode</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$statusCode</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> 200</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">throw</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Wrong answer from API: </span><span class="token string variable" style="color:rgb(156, 220, 254)">$statusCode</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Пример использования</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    CheckZabbixApi</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;API доступен!&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">BackgroundColor Green</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;API недоступен!&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">BackgroundColor Red</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Аналогично можно обращаться к любым REST-сервисам. Главное формировать запрос с учетом их требований.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Подобная тема актуальная и при работе с облаками (Azure, AWS и др.) или любыми другими сервисами.</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="bot">Собственный бот</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Использование мессенджеров для уведомления о важных событиях мониторинга трудно переоценить. Ниже скрипт для отправки сообщений в Telegram.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="bot-telegram">Пример вызова API сервера Zabbix</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Для отправки сообщений достаточно знать ID бота и идентификатор чата.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-fXSgRJ sc-JrEyx faRnqX CtKKW prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># Настройки Телеграм</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$telegramBotId</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;BotId&gt;&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Идентификатор бота</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$telegramChacId</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;ChatId&gt;&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Идентификатор чата</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Send-TelegramTextMessage</span><span class="token plain"> `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">BotToken </span><span class="token variable" style="color:rgb(156, 220, 254)">$telegramBotId</span><span class="token plain"> `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ChatID </span><span class="token variable" style="color:rgb(156, 220, 254)">$telegramChacId</span><span class="token plain"> `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Message </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Hello from Telegram!&quot;</span><span class="token plain"> `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ParseMode Markdown `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Preview </span><span class="token boolean">$false</span><span class="token plain"> `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Notification </span><span class="token boolean">$false</span><span class="token plain"> `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Verbose</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">В результате сообщение будет отправлено и важное событие не будет пропущено. Вот служебные функции из скрипта выше.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-fjvwmM sc-bbSYpP iycoQw cLQVUo prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Функция для отправки сообщений в Telegram</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Автор оригинального скрипта:</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">https://gist.github.com/techthoughts2</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Сам скрипт взят отсюда:</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">https://gist.github.com/techthoughts2/8b1c20b1bf145103c71bc64704e272bc</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Также есть более функциональный модуль для PowerShell:</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">https://github.com/techthoughts2/PoshGram</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">.Synopsis</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Sends Telegram text message via Bot API</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">.DESCRIPTION</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Uses Telegram Bot API to send text message to specified Telegram chat. Several options can be specified to adjust message parameters.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">.EXAMPLE</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    $bot = &quot;#########:xxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    $chat = &quot;-#########&quot;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Send-TelegramTextMessage -BotToken $bot -ChatID $chat -Message &quot;Hello&quot;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">.EXAMPLE</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    $bot = &quot;#########:xxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    $chat = &quot;-#########&quot;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Send-TelegramTextMessage `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">        -BotToken $bot `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">        -ChatID $chat `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">        -Message &quot;Hello *chat* _channel_, check out this link: [TechThoughts](http://techthoughts.info/)&quot; `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">        -ParseMode Markdown `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">        -Preview $false `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">        -Notification $false `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">        -Verbose</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">.PARAMETER BotToken</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Use this token to access the HTTP API</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">.PARAMETER ChatID</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Unique identifier for the target chat</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">.PARAMETER Message</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Text of the message to be sent</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">.PARAMETER ParseMode</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Send Markdown or HTML, if you want Telegram apps to show bold, italic, fixed-width text or inline URLs in your bot&#x27;s message. Default is Markdown.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">.PARAMETER Preview</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Disables link previews for links in this message. Default is $false</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">.PARAMETER Notification</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Sends the message silently. Users will receive a notification with no sound. Default is $false</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">.OUTPUTS</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    System.Boolean</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">.NOTES</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Author: Jake Morrison - @jakemorrison - http://techthoughts.info/</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    This works with PowerShell Versions 5.1, 6.0, 6.1</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    For a description of the Bot API, see this page: https://core.telegram.org/bots/api</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    How do I get my channel ID? Use the getidsbot https://telegram.me/getidsbot</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    How do I set up a bot and get a token? Use the BotFather https://t.me/BotFather</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">.COMPONENT</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   PoshGram - https://github.com/techthoughts2/PoshGram</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">.FUNCTIONALITY</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    https://core.telegram.org/bots/api#sendmessage</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    Parameters 					Type 				Required 	Description</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    chat_id 				    Integer or String 	Yes 		Unique identifier for the target chat or username of the target channel (in the format @channelusername)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    text 						String 				Yes 		Text of the message to be sent</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    parse_mode 					String 				Optional 	Send Markdown or HTML, if you want Telegram apps to show bold, italic, fixed-width text or inline URLs in your bot&#x27;s message.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    disable_web_page_preview 	Boolean 			Optional 	Disables link previews for links in this message</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    disable_notification 		Boolean 			Optional 	Sends the message silently. Users will receive a notification with no sound.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    reply_to_message_id 	    Integer 			Optional 	If the message is a reply, ID of the original message</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Send-TelegramTextMessage</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token namespace">[CmdletBinding()]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">Param</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">Parameter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Mandatory = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            HelpMessage = </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;#########:xxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxx&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[ValidateNotNull()]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[ValidateNotNullOrEmpty()]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[string]</span><span class="token variable" style="color:rgb(156, 220, 254)">$BotToken</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">#you could set a token right here if you wanted</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">Parameter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Mandatory = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            HelpMessage = </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;-#########&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[ValidateNotNull()]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[ValidateNotNullOrEmpty()]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[string]</span><span class="token variable" style="color:rgb(156, 220, 254)">$ChatID</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">#you could set a Chat ID right here if you wanted</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">Parameter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Mandatory = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            HelpMessage = </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Text of the message to be sent&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[ValidateNotNull()]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[ValidateNotNullOrEmpty()]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[string]</span><span class="token variable" style="color:rgb(156, 220, 254)">$Message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">Parameter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Mandatory = </span><span class="token boolean">$false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            HelpMessage = </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;HTML vs Markdown for message formatting&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">ValidateSet</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Markdown&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;HTML&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[string]</span><span class="token variable" style="color:rgb(156, 220, 254)">$ParseMode</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Markdown&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">#set to Markdown by default</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">Parameter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Mandatory = </span><span class="token boolean">$false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            HelpMessage = </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Disables link previews&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[bool]</span><span class="token variable" style="color:rgb(156, 220, 254)">$Preview</span><span class="token plain"> = </span><span class="token boolean">$false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">#set to false by default</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">Parameter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Mandatory = </span><span class="token boolean">$false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            HelpMessage = </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Sends the message silently&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token namespace">[bool]</span><span class="token variable" style="color:rgb(156, 220, 254)">$Notification</span><span class="token plain"> = </span><span class="token boolean">$false</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">#set to false by default</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">#------------------------------------------------------------------------</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$results</span><span class="token plain"> = </span><span class="token boolean">$true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">#assume the best</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">#------------------------------------------------------------------------</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$payload</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;chat_id&quot;</span><span class="token plain">                   = </span><span class="token variable" style="color:rgb(156, 220, 254)">$ChatID</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;text&quot;</span><span class="token plain">                      = </span><span class="token variable" style="color:rgb(156, 220, 254)">$Message</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;parse_mode&quot;</span><span class="token plain">                = </span><span class="token variable" style="color:rgb(156, 220, 254)">$ParseMode</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;disable_web_page_preview&quot;</span><span class="token plain">  = </span><span class="token variable" style="color:rgb(156, 220, 254)">$Preview</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;disable_notification&quot;</span><span class="token plain">      = </span><span class="token variable" style="color:rgb(156, 220, 254)">$Notification</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token comment" style="color:rgb(106, 153, 85)">#payload</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">#------------------------------------------------------------------------</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Verbose</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Message </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Sending message...&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)"># Раскоментируйте эту строку, если при отправке получаете ошибку вида </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)"># &quot;Не удалось создать безопасный канал SSL / TLS&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">#[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12   </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$eval</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Invoke-RestMethod</span><span class="token plain"> `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Uri </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;https://api.telegram.org/bot{0}/sendMessage&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">f </span><span class="token variable" style="color:rgb(156, 220, 254)">$BotToken</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Method Post `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ContentType </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;application/json&quot;</span><span class="token plain"> `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Body </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">ConvertTo-Json</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Compress </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">InputObject </span><span class="token variable" style="color:rgb(156, 220, 254)">$payload</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> `</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ErrorAction Stop</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$eval</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ok </span><span class="token operator" style="color:rgb(212, 212, 212)">-eq</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;True&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Warning</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Message </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Message did not send successfully&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token variable" style="color:rgb(156, 220, 254)">$results</span><span class="token plain"> = </span><span class="token boolean">$false</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token comment" style="color:rgb(106, 153, 85)">#if_StatusDescription</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token comment" style="color:rgb(106, 153, 85)">#try_messageSend</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Warning</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;An error was encountered sending the Telegram message:&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Write-Error</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token variable" style="color:rgb(156, 220, 254)">$results</span><span class="token plain"> = </span><span class="token boolean">$false</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token comment" style="color:rgb(106, 153, 85)">#catch_messageSend</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$results</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">#------------------------------------------------------------------------</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token comment" style="color:rgb(106, 153, 85)">#function_Send-TelegramTextMessage</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Очень удобно с этим работать, если оформить в модуль. Но это уже другая история.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Есть решения и для других мессенджеров (WhatsApp, Viber и т.д.), но рассматривать их сейчас не будем.</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="email">Отправка писем</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Электронная почта также до сих пор остается важным инструментом коммуникаций. Отправка туда сообщений иногда является самым универсальным способом уведомлений, ведь не все предпочитают одинаковые мессенджеры. А вот почта, по крайней мере корпоративная, есть почти всегда.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="email-yandex">Отправка писем через Yandex.Mail</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Этот скрипт отправляет почту через сервис Yandex.Mail.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-fBWQee sc-hknPuZ dDoTSr fYDKyo prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Пример скрипта отправки почтовых сообщений сервисом Yandex Mail.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Для других сервисов скрипт будет примерно таким же, но могут отличатсья параметры. См. инструкции сервиса.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Параметры почтового сервера</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$serverSmtp</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;smtp.yandex.ru&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Адрес сервера</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$port</span><span class="token plain"> = 587 </span><span class="token comment" style="color:rgb(106, 153, 85)"># Порт</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$From</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;login@yandex.ru&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Отправитель</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$To</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;login@mail.ru&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Получатель</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$subject</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Всем привет!&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Тема</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$user</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;login@yandex.ru&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Пользователь</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$pass</span><span class="token plain"> = </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&lt;Pas$w0rd&gt;&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Пароль</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Формируем письмо</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$mes</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> System</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Net</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Mail</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">MailMessage</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$mes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">From</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$from</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Отправитель</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$mes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">To</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$to</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Добавляем получателя</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$mes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Subject = </span><span class="token variable" style="color:rgb(156, 220, 254)">$subject</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Указываем тему</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$mes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">IsBodyHTML = </span><span class="token boolean">$true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Устанавливаем флаг, что письмо в формате HTML</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$mes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Body = </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&lt;h1&gt;Доброго дня!&lt;/h1&gt;&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Задаем тело письма</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#Добавляем файл по указанному пути в качестве вложения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># $file = &quot;C:\Docs\SomeDoc.xlsx&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># $att = New-object Net.Mail.Attachment($file)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># $mes.Attachments.Add($att) </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Настраиваем подключение к почтовому серверу</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$smtp</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> Net</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Mail</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">SmtpClient</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$serverSmtp</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$port</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$smtp</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">EnableSSL = </span><span class="token boolean">$true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Включаем использование SSL</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Настраиваем данные аутентификации</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$smtp</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Credentials = </span><span class="token function" style="color:rgb(220, 220, 170)">New-Object</span><span class="token plain"> System</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Net</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">NetworkCredential</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$user</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$pass</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Отправляем письмо</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$smtp</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Send</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$mes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Очищаем данные присоединенных файлов</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># $att.Dispose()</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">У Яндекс есть различные ограничения, о которых стоит прочитать в документации. Например, двухфакторная аутентификация уже не позволит таким способом отправлять почту. Есть и другие нюансы.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">А Вы используете электронную почту для уведомлений?</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="proc">Контролируй процессы</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Часто приходится управлять различными процессами в системе. Например, завершить зависшие процессы или узнать потребляемые ими ресурсы. Тут то на сцену выходит PowerShell <!-- -->:)</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="proc-list">Список процессов</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Примеры команд для получения информации о процессах различными способами.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-uVXKs sc-hCPjmr dwTABu gWZlxw prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Примеры команд для управления процессами</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 1. Получение списка всех активных процессов</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Get-Process</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">&lt;# Пример вывода</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">NPM(K)    PM(M)      WS(M)     CPU(s)      Id  SI ProcessName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">------    -----      -----     ------      --  -- -----------</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    16    13,52      19,33       0,00    4808   0 AdjustService</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    33    56,60      27,76     109,02   18204   1 Agent</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    15     3,80      12,36       0,00    5232   0 AGMService</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    14     3,52      12,30       0,00    5216   0 AGSService</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    51    91,05      96,21      14,02   15216   1 ApCent</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    28    28,86      34,76       0,23   16380   1 ApplicationFrameHost</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    11     8,20      14,98       0,06   23244   0 audiodg</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 2. Получение информации о конкретном процессе</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Get-Process</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Id 18204</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">&lt;# Пример вывода</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> NPM(K)    PM(M)      WS(M)     CPU(s)      Id  SI ProcessName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> ------    -----      -----     ------      --  -- -----------</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">     33    56,67      27,79     109,20   18204   1 Agent</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 3. Получение процессов по имени (полному или по шаблону)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Get-Process</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Name rph*</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">&lt;# Пример вывода</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> NPM(K)    PM(M)      WS(M)     CPU(s)      Id  SI ProcessName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> ------    -----      -----     ------      --  -- -----------</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">     97    73,46      88,60       0,00    6804   0 rphost</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Также можно применить несколько условий по отбором по имени.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Get-Process</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Name rph*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">ragent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">rmngr</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">&lt;# Пример вывода</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> NPM(K)    PM(M)      WS(M)     CPU(s)      Id  SI ProcessName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> ------    -----      -----     ------      --  -- -----------</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">     73    46,81      34,77       0,00    1172   0 ragent</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">    108   108,90      64,94       0,00   17296   0 rmngr</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">     97    73,64      88,70       0,00    6804   0 rphost</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Проще простого!</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="proc-kill">Убить нельзя помиловать</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Кроме получения информации о процессах нужно еще и уметь их останавливать.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-NxrBK sc-cfxfQh fFQVyo lhxdmE prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># 1. Остановка процессов по имени</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Stop-Process</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Name rphost</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 2. Остановка процессов, которые не отвечают</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Get-Process</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Name rphost </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">FilterScript </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Responding </span><span class="token operator" style="color:rgb(212, 212, 212)">-eq</span><span class="token plain"> </span><span class="token boolean">$false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Stop-Process</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 3. Остановка процесса по тексту в заголовке. Может быть полезно для завершения процессов, у которых &quot;всплыла&quot; ошибка с Visual C++ Runtime.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$processData</span><span class="token plain"> = </span><span class="token function" style="color:rgb(220, 220, 170)">Get-Process</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">mainwindowhandle </span><span class="token operator" style="color:rgb(212, 212, 212)">-ne</span><span class="token plain"> 0 </span><span class="token operator" style="color:rgb(212, 212, 212)">-and</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ProcessName </span><span class="token operator" style="color:rgb(212, 212, 212)">-eq</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&lt;Отбор по имени процесса&gt;&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Select-Object</span><span class="token plain"> MainWindowTitle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ProcessName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Id</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token variable" style="color:rgb(156, 220, 254)">$processData</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># Проверяем наличие нужного текста в заголовке приложения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">MainWindowTitle </span><span class="token operator" style="color:rgb(212, 212, 212)">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;*Visual C++*&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">Stop-Process</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Id </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Id</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">В первом примере выполняется остановка процессов по имени. Во втором остановка процессов, которые не отвечают. А третий пример наиболее интересен - завершаются процессы, во время выполнения которых появилась ошибка вида “Visual C++ Runtime Library”.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Вот такие процессы и будут завершены.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Имей власть над процессами и будешь властвовать над ОС <!-- -->:)</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="port">Проверка свободного порта</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Почти каждый сталкивался с проблемой, когда служба 1С могла не запускаться из-за занятого порта другим приложением. Для диагностики нужно проверить кто нужный порт занял. Тут на сцену выходит…</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="port-free">Свободный ли порт?</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">С помощью скрипта можно узнать кто и как занял порт.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-gFAXEw sc-gmPhgS jguAgb dqbzmA prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Пример скрипта для получения информации о том кто и какой порт использует.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Можно искать информацию для конкретного порта или процесса.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">netstat </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ano </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Where-Object</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-match</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;LISTENING|UDP&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token variable" style="color:rgb(156, 220, 254)">$split</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Trim</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">split </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;\s+&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token namespace">[pscustomobject]</span><span class="token namespace">[ordered]</span><span class="token plain">@</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Protocol&quot;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;LocalAddress&quot;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;ForeignAddress&quot;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)"># Some might not have a state. Check to see if the last element is a number. If it is ignore it</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;State&quot;</span><span class="token plain"> = </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token variable" style="color:rgb(156, 220, 254)">$split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-notmatch</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;\d+&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token variable" style="color:rgb(156, 220, 254)">$split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)"># The last element in every case will be a PID</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;ProcessName&quot;</span><span class="token plain"> = $</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">Get-Process</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Id </span><span class="token variable" style="color:rgb(156, 220, 254)">$split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ProcessName</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;ProcessId&quot;</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(156, 220, 254)">$split</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Where-Object{$_.ProcessId -eq 15151} | # Фильтр по идентификатору процесса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Where-Object{$_.ProcessName -like &#x27;rmng*&#x27;} | # Фильтр по имени приложения</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Where-Object{$_.LocalAddress -like &#x27;*:1560&#x27;} | # Фильтр по порту</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Select</span><span class="token plain"> Protocol</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> LocalAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ForeignAddress</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ProcessName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ProcessId</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Главное раскомментировать нужное условие для фильтрации результата.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Теперь можно не гадать, почему служба 1С не запустилась <!-- -->:)</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="remote">Удаленное управление</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">PowerShell позволяет выполнять скрипты / команды на удаленных машинах, что значительно упрощает решение задач администрирования. Решается это с помощью PSRemoting. Ранее все удаленные взаимодействия выполнялись через WinRM, теперь же появилась возможность работать и через SSH.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Ниже пример настройки для Windows и выполнение удаленной команды.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="remote-setup">Простейший пример настройки</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">На обоих машинах нужно обязательно установить PowerShell и включить удаленное управление. Ниже пример скрипта для настройки.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-hRJeED sc-iHbTvc fSyujZ hbaISU prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Простейшая настройка удаленного доступа через PSRemoting</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Внимание! Скрипт не для рабочего окружения.</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Подробнее можно прочитать:</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">https://www.howtogeek.com/117192/how-to-run-powershell-commands-on-remote-computers/</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">https://docs.microsoft.com/ru-ru/powershell/module/microsoft.powershell.core/about/about_remote_faq?view=powershell-7.1#can-i-create-a-persistent-connection</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">https://docs.microsoft.com/ru-ru/powershell/scripting/learn/remoting/running-remote-commands?view=powershell-7.1</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Включаем использование PSRemoting</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Enable-PSRemoting</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Force</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Включаем доступ для других машин (в этом случае для всех)</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Set-Item</span><span class="token plain"> wsman:\localhost\client\trustedhosts </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Перезапускаем службу WinRM</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Restart-Service</span><span class="token plain"> WinRM</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Проверяем доступ</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Test-WsMan</span><span class="token plain"> HostNameForTest</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Нужно учитывать, что это лишь пример скрипта, который не годится для рабочего окружения.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="remote-use">Как использовать</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">После настройки можно выполнять любой скрипт на удаленной машине. Ниже пример перезапуска удаленного хоста.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-klVQSN sc-bypIEy eQqNTA hRvUnE prism-code language-powershell" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">&lt;#</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">Пример выполнения простейшей команды</span></div><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">#&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Перезапускаем удаленный компьютер</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">Invoke-Command</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ComputerName HostName </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ScriptBlock </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Restart-Computer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">Force</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">credential UserName</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Никто не мешает удаленно выполнить любой скрипт из тех, что были показаны выше.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Один PowerShell, чтоб править всеми … хостами.</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="more">Еще, еще, еще</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">На этом примеры скриптов закончим. Многие другие скрипты и примеры можно найти в таких источниках:</p><ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a href="https://github.com/fleschutz/PowerShell" target="_blank" rel="noopener noreferrer">PowerShell</a></u></b> - набор публичных скриптов под разные задачи.</li><li><b><u><a href="https://github.com/YPermitin/PowerShellTools" target="_blank" rel="noopener noreferrer">PowerShellTools</a></u></b> - еще один репозиторий со скриптами.</li></ul><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">А теперь пойдем дальше.</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="nope">Меньше костылей</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Создавать свои скрипты - это нормально, но некоторые задачи уже были решены до нас и мы можем этот опыт использовать. В контексте PowerShell это либо использовать скрипты других разработчиков, либо брать на вооружение целые готовые модули PowerShell от сообщества или компаний (обычно выпускают вместе с каким-либо продуктом, как это делает та же Microsoft).</p><ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a href="https://www.planetpowershell.com/" target="_blank" rel="noopener noreferrer">Planet PowerShell</a></u></b> и <b><u><a href="https://powershell.org/" target="_blank" rel="noopener noreferrer">PowerShell.org</a></u></b> - сообщество разработчиков PowerShell.</li><li><b><u><a href="https://www.powershellgallery.com/" target="_blank" rel="noopener noreferrer">PoweShell Galery</a></u></b> - галерея готовых скриптов и решений на PowerShell. В разделе просмотра списка пакетов Вы можете найти такие популярные модули как:<ul class="List_list__zLjGi list-disc pl-[30px]"><li><b><u><a href="https://dbatools.io/" target="_blank" rel="noopener noreferrer">dbatools</a></u></b> - модуль автоматизации работы со SQL Server.</li><li><b><u><a href="https://github.com/TheTaylorLee/AdminToolbox" target="_blank" rel="noopener noreferrer">AdminToolbox.ActiveDirectory</a></u></b> - инструменты для управления Active Directory.</li><li><b><u><a href="https://github.com/mithrandyr/SimplySql" target="_blank" rel="noopener noreferrer">SimplySql</a></u></b> - удобный инструмент для формирования запросов к разным СУБД (SQL Server, PostgreSQL, Oracle и др.).</li></ul></li><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">И очень много всего еще.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Есть даже 1C.Utils (о нем говорили выше) - небольшой набор инструментов для 1С, правда автор забросил его пару лет назад, а жаль.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">В общем, готовых решений много, а участников сообщества еще больше!</p></ul><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">А теперь пойдем дальше.</p></div><div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset" id="theend">В самом конце</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Все что я хотел сказать в этой статье, так это недооцененный инструмент для решения повседневных задач - PowerShell. Недооцененный именно в среде разработчиков 1С, тогда как в мире .NET, CI/CD и для управления некоторых облачных решений - PowerShell занял хорошие позиции.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Вместо использования готовых решений, сообщество и сама фирма “1С” пошли своим путем, создавая собственные инструменты автоматизации. Причем фирма “1С” проигнорировала труды сообщества в виде OneScript и создает собственный инструмент - 1С:Исполнитель.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Конечно, чем больше инструментов, тем лучше. Но средства автоматизации создаются не только для разработчиков 1С, но и для администраторов, DevOps\’ов и других специалистов, которые могут и не иметь прямого отношения к 1С. А если администратору нужно будет автоматизировать процесс разворачивания клиентов 1С, сбор информации с сервера 1С или другую задачу автоматизации, то зачем ему изучать OneScript или 1С:Исполнитель? А ставить для их работы дополнительные компоненты, о которых в не1Сном сообществе не слышали и не могут доверять им.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Автор не противник OneScript или 1С:Исполнитель. Я фанат PowerShell и немного Bash. Понимаю, что коллеги проделали большую работу и продукт взлетел в определенном смысле. Но может сообществу 1С пора быть более открытым и не замыкаться свою экосистему саму на себя?</p></div></article><div class="Seperator_section_seperator_line__gdWIB dark:border-white border-black"></div><div class="PageLayout_author_and_more__wxN3W mx-auto"><div class="bg-white dark:bg-slate-800 dark:border-none border-slate-100 shadow-lg border md:rounded-[8px] px-[15px] py-[10px] mb-[30px] overflow-hidden"><div class="flex items-center"><div class="flex items-center justify-center shadow-xl rounded-full overflow-hidden bg-blue-500 shrink-0 w-[60px] h-[60px] mr-3 text-xl"><p class="text-center font-medium text-white">Y</p></div><div class="font-semibold"><p class="text-[20px]  mb-0 mt-0">YPermitin</p><p class="text-xs mt-0 mb-0">.NET, TSQL, DevOps, 1C:Enterprise</p></div></div><p class="text-[16px] mt-2">Developer, just developer.</p><div class="flex items-center flex-wrap mt-3"><a href="https://github.com/YPermitin" target="_blank" class="mr-[15px] text-[32px]" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a></div></div><div class="bg-white dark:bg-slate-800 dark:border-none border-slate-100 shadow-lg border md:rounded-[8px] px-[15px] py-[10px] mb-[30px] overflow-hidden"><p class="border-b border-gray-300 pb-2 mb-3 font-medium w-full">Поделиться</p><div class="flex flex-wrap items-center"><a class="mr-3" aria-label="facebook-share" href="https://www.facebook.com/sharer/sharer.php?u=https://ypermitin.github.io" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-92.4 233.5h-63.9c-50.1 0-59.8 23.8-59.8 58.8v77.1h119.6l-15.6 120.7h-104V912H539.2V602.2H434.9V481.4h104.3v-89c0-103.3 63.1-159.6 155.3-159.6 44.2 0 82.1 3.3 93.2 4.8v107.9z"></path></svg></a><a class="mr-3" aria-label="twitter-share" href="http://twitter.com/share?text=Check out this article!! &amp;url=https://ypermitin.github.io&amp;hashtags=webdevelopment,javacript,javascriptdaily,webdevelopmenttutorial,tutorial" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm215.3 337.7c.3 4.7.3 9.6.3 14.4 0 146.8-111.8 315.9-316.1 315.9-63 0-121.4-18.3-170.6-49.8 9 1 17.6 1.4 26.8 1.4 52 0 99.8-17.6 137.9-47.4-48.8-1-89.8-33-103.8-77 17.1 2.5 32.5 2.5 50.1-2a111 111 0 0 1-88.9-109v-1.4c14.7 8.3 32 13.4 50.1 14.1a111.13 111.13 0 0 1-49.5-92.4c0-20.7 5.4-39.6 15.1-56a315.28 315.28 0 0 0 229 116.1C492 353.1 548.4 292 616.2 292c32 0 60.8 13.4 81.1 35 25.1-4.7 49.1-14.1 70.5-26.7-8.3 25.7-25.7 47.4-48.8 61.1 22.4-2.4 44-8.6 64-17.3-15.1 22.2-34 41.9-55.7 57.6z"></path></svg></a><a class="mr-3" aria-label="linkedin-share" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://ypermitin.github.io&amp;title=Check out this article!!&amp;source=LinkedIn" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[23px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"></path></svg></a><button class="mr-3" name="copy-link" aria-label="copy-link"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z"></path><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243z"></path></svg></button></div><div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded fixed flex transition-all right-[10px] -bottom-20 opacity-0" role="alert"><strong class="font-bold">Link Copied</strong><span class="pl-5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="pt-1 text-[18px] cursor-pointer" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"></path></svg></span></div></div><div class="bg-white dark:bg-slate-800 dark:border-none border-slate-100 shadow-lg border md:rounded-[8px] px-[15px] py-[10px] mb-[30px] overflow-hidden"><p class="border-b border-gray-300 pb-2 mb-3 font-medium w-full">Другие статьи</p><div class="flex flex-wrap"><div class="mb-3 cursor-pointer lg:w-1/3 md:w-1/2 w-full md:pr-2" href="/blog/.NET/2024-09/simple-and-fast-sql-clr/"><div class=" rounded-[3px] dark:bg-slate-800 border border-slate-200 dark:border-slate-900 flex items-center overflow-hidden shadow-lg hover:shadow-md "><div class="object-cover shrink-0"><img src="/imp_assets/.NET/2024-09/simple-and-fast-sql-clr/logo.png" class="w-[120px] h-[70px] mr-2 object-cover" alt="Расширение для SQL Server. Быстро и просто. SQLCLR снова в деле"/></div><div class="pr-1 text-[16px] hover:text-blue-500 font-semibold">Расширение для SQL Server. Быстро и просто. SQLCLR снова в деле</div></div></div><div class="mb-3 cursor-pointer lg:w-1/3 md:w-1/2 w-full md:pr-2" href="/blog/DevOps/2024-08/ubuntu-vmware-kernel-modules-issue/"><div class=" rounded-[3px] dark:bg-slate-800 border border-slate-200 dark:border-slate-900 flex items-center overflow-hidden shadow-lg hover:shadow-md "><div class="object-cover shrink-0"><img src="/imp_assets/DevOps/2024-08/ubuntu-vmware-kernel-modules-issue/logo.png" class="w-[120px] h-[70px] mr-2 object-cover" alt="Решение проблем с модулями VMware в Ubuntu 22.04"/></div><div class="pr-1 text-[16px] hover:text-blue-500 font-semibold">Решение проблем с модулями VMware в Ubuntu 22.04</div></div></div><div class="mb-3 cursor-pointer lg:w-1/3 md:w-1/2 w-full md:pr-2" href="/blog/.NET/2024-07/processes-under-control/"><div class=" rounded-[3px] dark:bg-slate-800 border border-slate-200 dark:border-slate-900 flex items-center overflow-hidden shadow-lg hover:shadow-md "><div class="object-cover shrink-0"><img src="/imp_assets/.NET/2024-07/processes-under-control/logo.png" class="w-[120px] h-[70px] mr-2 object-cover" alt="Берем процессы под контроль в .NET"/></div><div class="pr-1 text-[16px] hover:text-blue-500 font-semibold">Берем процессы под контроль в .NET</div></div></div><a class="cursor-pointer hover:text-blue-500 block text-sm py-3 px-2 text-center dark:bg-slate-900 bg-blue-500 rounded text-white font-bold hover:!text-blue-900 dark:hover:!text-slate-400 transition-all" href="/blog/?author=YPermitin"><p>Все статьи от автора: <!-- -->YPermitin</p></a></div></div></div></div></section><div class="dark:bg-slate-900 dark:text-white bg-slate-100 text-black"><div class="md:container flex items-center md:justify-center justify-around flex-wrap md:text-[14px] text-[12px] py-5"><p class="my-0 mr-[10px] md:mr-3">Copyright © <!-- -->2024<!-- --> <!-- -->Убежище инженера</p></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/DevOps/2021-05/amusing-powershell","query":{},"buildId":"HJvR8iaLzmAcQPPYr2tMK","nextExport":true,"autoExport":true,"isFallback":false,"dynamicIds":[8765,3220,935,7355,7651],"scriptLoader":[]}</script></body></html>