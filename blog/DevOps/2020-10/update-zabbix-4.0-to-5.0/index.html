<!DOCTYPE html><html lang="en" translate="no"><head><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"/><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="google" content="notranslate"/><title>Обновляем Zabbix с 4.0 до 5.0 через грабли | Убежище инженера | YPermitin</title><meta name="robots" content="index,follow"/><meta name="description" content="Обновляем Zabbix с версии 4.0 до 5.0 в несколько шагов, а также разбираем некоторые “грабли”."/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://ypermitin.github.io/blog/DevOps/2020-10/update-zabbix-4.0-to-5.0"/><meta property="og:title" content="Обновляем Zabbix с 4.0 до 5.0 через грабли | Убежище инженера | YPermitin"/><meta property="og:description" content="Обновляем Zabbix с версии 4.0 до 5.0 в несколько шагов, а также разбираем некоторые “грабли”."/><meta property="og:url" content="https://ypermitin.github.io/blog/DevOps/2020-10/update-zabbix-4.0-to-5.0"/><meta property="og:type" content="website"/><meta property="og:image" content="https://ypermitin.github.io/imp_assets/DevOps/2020-10/update-zabbix-4.0-to-5.0/logo.png"/><meta property="og:image:alt" content="Обновляем Zabbix с 4.0 до 5.0 через грабли | Убежище инженера | YPermitin"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:locale" content="en_IN"/><meta property="og:site_name" content="Убежище инженера"/><link rel="canonical" href="https://webexpe.com/"/><meta property="keywords" content="Zabbix, мониторинг, DevOps, обновление, *.nix, Linux, PostgreSQL"/><meta property="al:web:url" content="https://ypermitin.github.io/blog/DevOps/2020-10/update-zabbix-4.0-to-5.0"/><meta name="next-head-count" content="23"/><link rel="preload" href="/_next/static/css/8b3cba25ed5aab85.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8b3cba25ed5aab85.css" data-n-g=""/><link rel="preload" href="/_next/static/css/0eb3a85c2cff7e2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0eb3a85c2cff7e2b.css"/><link rel="preload" href="/_next/static/css/4a9df9e795bce52b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4a9df9e795bce52b.css"/><link rel="preload" href="/_next/static/css/ee5420a43edabb61.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ee5420a43edabb61.css"/><link rel="preload" href="/_next/static/css/88381d5dde4793c2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/88381d5dde4793c2.css"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script defer="" src="/_next/static/chunks/fea29d9f.da8a8f09d3718005.js"></script><script defer="" src="/_next/static/chunks/3a17f596.d968b285fd30f253.js"></script><script defer="" src="/_next/static/chunks/1664-939297b106bd6802.js"></script><script defer="" src="/_next/static/chunks/8765.cad5003c27b9f0f8.js"></script><script defer="" src="/_next/static/chunks/3220.ec5fcfa981be0259.js"></script><script defer="" src="/_next/static/chunks/935.690ee438ec544a58.js"></script><script defer="" src="/_next/static/chunks/7355.94d3f9b1029286e4.js"></script><script defer="" src="/_next/static/chunks/7651.2742bb467d45fe42.js"></script><script src="/_next/static/chunks/webpack-451d3a1cddcb1b37.js" defer=""></script><script src="/_next/static/chunks/framework-0995a3e8436ddc4f.js" defer=""></script><script src="/_next/static/chunks/main-01bf6de1df60b879.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2e20dbd49f483ff8.js" defer=""></script><script src="/_next/static/chunks/6443-e0562366e025b4bf.js" defer=""></script><script src="/_next/static/chunks/pages/blog/DevOps/2020-10/update-zabbix-4.0-to-5.0-e98907612d2344ef.js" defer=""></script><script src="/_next/static/YQm1KLnUPuRbgh1UDWeUw/_buildManifest.js" defer=""></script><script src="/_next/static/YQm1KLnUPuRbgh1UDWeUw/_ssgManifest.js" defer=""></script></head><body class="bg-slate-100 dark:bg-slate-900 transition-all"><div id="__next"><div data-overlay-container="true"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><nav class="Navbar_navbar__W_ouQ bg-white  dark:bg-slate-900 dark:text-white text-black"><div class="container flex items-center justify-between px-2"><div class="flex items-center"><div class="Navbar_mobileBurgerToggle__Bj_52 mr-5  "><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="dark:text-white text-black text-2xl" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></div><a class="text-[22px] font-semibold" href="/">Убежище инженера</a></div><div class="flex items-center"><div class="text-[14px] font-normal items-center lg:flex hidden"><a class="cursor-pointer hover:text-blue-500 mx-2" href="/">Главная</a><div class="relative"><div class="flex items-center cursor-pointer mx-2"><p class="my-0">Блог</p><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="text-[20px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16.293 9.293 12 13.586 7.707 9.293l-1.414 1.414L12 16.414l5.707-5.707z"></path></svg></div><div class="overflow-auto absolute w-[180px] z-20 top-[30px] rounded-[4px] shadow-lg bg-white dark:bg-slate-800 border border-gray-300 dark:border-0 h-0 border-0"><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2" href="/blog/"><span>Все публикации</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=.NET"><span style="text-transform:capitalize">.NET</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=PostgreSQL"><span style="text-transform:capitalize">PostgreSQL</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=DevOps"><span style="text-transform:capitalize">DevOps</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=SQL%20Server"><span style="text-transform:capitalize">SQL Server</span></a></div></div><a class="cursor-pointer hover:text-blue-500 mx-2" href="/instruments/">Инструменты</a><a class="cursor-pointer hover:text-blue-500 mx-2" href="/about/">Обо мне</a><a class="cursor-pointer hover:text-blue-500 mx-2" href="/contact/">Контакты</a><div class="ml-5 pt-1"><a href="https://github.com/YPermitin/" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a><a href="https://t.me/TinyDevVault" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"></path></svg></a><a href="mailto:i.need.ypermitin@yandex.ru" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0 0 68.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"></path></svg></a><a href="https://boosty.to/ypermitin" target="_blank" rel="noopener noreferrer" class="text-[18px] inline-block mr-4"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 21h9.62a3.995 3.995 0 0 0 3.037-1.397l5.102-5.952a1 1 0 0 0-.442-1.6l-1.968-.656a3.043 3.043 0 0 0-2.823.503l-3.185 2.547-.617-1.235A3.98 3.98 0 0 0 9.146 11H4c-1.103 0-2 .897-2 2v6c0 1.103.897 2 2 2zm0-8h5.146c.763 0 1.448.423 1.789 1.105l.447.895H7v2h6.014a.996.996 0 0 0 .442-.11l.003-.001.004-.002h.003l.002-.001h.004l.001-.001c.009.003.003-.001.003-.001.01 0 .002-.001.002-.001h.001l.002-.001.003-.001.002-.001.002-.001.003-.001.002-.001c.003 0 .001-.001.002-.001l.003-.002.002-.001.002-.001.003-.001.002-.001h.001l.002-.001h.001l.002-.001.002-.001c.009-.001.003-.001.003-.001l.002-.001a.915.915 0 0 0 .11-.078l4.146-3.317c.262-.208.623-.273.94-.167l.557.186-4.133 4.823a2.029 2.029 0 0 1-1.52.688H4v-6zM16 2h-.017c-.163.002-1.006.039-1.983.705-.951-.648-1.774-.7-1.968-.704L12.002 2h-.004c-.801 0-1.555.313-2.119.878C9.313 3.445 9 4.198 9 5s.313 1.555.861 2.104l3.414 3.586a1.006 1.006 0 0 0 1.45-.001l3.396-3.568C18.688 6.555 19 5.802 19 5s-.313-1.555-.878-2.121A2.978 2.978 0 0 0 16.002 2H16zm1 3c0 .267-.104.518-.311.725L14 8.55l-2.707-2.843C11.104 5.518 11 5.267 11 5s.104-.518.294-.708A.977.977 0 0 1 11.979 4c.025.001.502.032 1.067.485.081.065.163.139.247.222l.707.707.707-.707c.084-.083.166-.157.247-.222.529-.425.976-.478 1.052-.484a.987.987 0 0 1 .701.292c.189.189.293.44.293.707z"></path></svg></a></div></div><div class="Navbar_search_icon_wrapper__1a_rL ml-5 dark:text-white"><button name="search-button" aria-label="search button"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="dark:text-white text-black text-[22px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg></button></div><div class=""><button name="share" aria-label="share page"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="dark:text-white text-black text-[16px] mt-[7px] ml-2 mr-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5"></path></svg></button></div><button name="theme-switch" aria-label="theme button" class="Navbar_theme_switch__q7F_Z pl-3 dark:text-white text-black"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-md " height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278"></path></svg></button></div></div></nav><aside class="Navbar_nav_sidebar_wrapper__M0KaI dark:bg-slate-900 dark:text-white bg-white text-black"><div class="flex items-center justify-between pb-3"><p class="">МЕНЮ</p><div><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="text-slate-800 dark:text-white text-[25px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg></div></div><hr/><div class="my-15"><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/">Главная</a><div class="relative"><div class="flex items-center cursor-pointer justify-between"><p class="my-0">Блог</p><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="text-[20px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16.293 9.293 12 13.586 7.707 9.293l-1.414 1.414L12 16.414l5.707-5.707z"></path></svg></div><div class="overflow-auto relative h-0 border-0"><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2" href="/blog/"><span>Все публикации</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=.NET"><span style="text-transform:capitalize">.NET</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=PostgreSQL"><span style="text-transform:capitalize">PostgreSQL</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=DevOps"><span style="text-transform:capitalize">DevOps</span></a><a class="cursor-pointer hover:text-blue-500 block text-sm py-2 px-2 border-t border-gray-400" href="/blog/?category=SQL%20Server"><span style="text-transform:capitalize">SQL Server</span></a></div></div><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/instruments/">Инструменты</a><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/about/">Обо мне</a><a class="cursor-pointer hover:text-blue-500 text-[16px] block my-3" href="/contact/">Контакты</a></div><hr/><div class="my-5"><p class="font-light">Подписаться : </p> <a href="https://github.com/YPermitin/" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a><a href="https://t.me/TinyDevVault" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"></path></svg></a><a href="mailto:i.need.ypermitin@yandex.ru" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0 0 68.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"></path></svg></a><a href="https://boosty.to/ypermitin" target="_blank" rel="noopener noreferrer" class="text-[28px] inline-block mr-5 mt-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 21h9.62a3.995 3.995 0 0 0 3.037-1.397l5.102-5.952a1 1 0 0 0-.442-1.6l-1.968-.656a3.043 3.043 0 0 0-2.823.503l-3.185 2.547-.617-1.235A3.98 3.98 0 0 0 9.146 11H4c-1.103 0-2 .897-2 2v6c0 1.103.897 2 2 2zm0-8h5.146c.763 0 1.448.423 1.789 1.105l.447.895H7v2h6.014a.996.996 0 0 0 .442-.11l.003-.001.004-.002h.003l.002-.001h.004l.001-.001c.009.003.003-.001.003-.001.01 0 .002-.001.002-.001h.001l.002-.001.003-.001.002-.001.002-.001.003-.001.002-.001c.003 0 .001-.001.002-.001l.003-.002.002-.001.002-.001.003-.001.002-.001h.001l.002-.001h.001l.002-.001.002-.001c.009-.001.003-.001.003-.001l.002-.001a.915.915 0 0 0 .11-.078l4.146-3.317c.262-.208.623-.273.94-.167l.557.186-4.133 4.823a2.029 2.029 0 0 1-1.52.688H4v-6zM16 2h-.017c-.163.002-1.006.039-1.983.705-.951-.648-1.774-.7-1.968-.704L12.002 2h-.004c-.801 0-1.555.313-2.119.878C9.313 3.445 9 4.198 9 5s.313 1.555.861 2.104l3.414 3.586a1.006 1.006 0 0 0 1.45-.001l3.396-3.568C18.688 6.555 19 5.802 19 5s-.313-1.555-.878-2.121A2.978 2.978 0 0 0 16.002 2H16zm1 3c0 .267-.104.518-.311.725L14 8.55l-2.707-2.843C11.104 5.518 11 5.267 11 5s.104-.518.294-.708A.977.977 0 0 1 11.979 4c.025.001.502.032 1.067.485.081.065.163.139.247.222l.707.707.707-.707c.084-.083.166-.157.247-.222.529-.425.976-.478 1.052-.484a.987.987 0 0 1 .701.292c.189.189.293.44.293.707z"></path></svg></a><hr class="mt-5"/></div><div class="mt-5 mb-4"><p class="mb-2 font-light">Переключиться на <!-- -->светлую<!-- --> тему :</p><button name="theme-switch" aria-label="theme-switch" class="Navbar_theme_switch__q7F_Z dark:text-white text-black"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-lg" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278"></path></svg></button></div><hr/><div class="my-5"><p class="text-sm font-light dark:text-gray-400 text-gray-500 mb-1">Copyright © 2024</p></div></aside><div class="transition-all fixed h-screen w-screen flex items-center justify-center left-0 z-20 top-0 pointer-events-none opacity-0"><div class="absolute top-0 left-0 w-screen h-screen bg-black opacity-50"></div><div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded lg:w-1/6 mx-3 w-full relative z-10 transition-all top-10"><div class="flex border-gray-300 pb-2 mb-3 border-b"><p class="  font-medium w-full">Share:</p><span class="pl-5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="pt-1 text-[18px] cursor-pointer" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"></path></svg></span></div><div class="flex flex-wrap items-center"><a class="mr-3" aria-label="facebook-share" href="https://www.facebook.com/sharer/sharer.php?u=https://ypermitin.github.io" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-92.4 233.5h-63.9c-50.1 0-59.8 23.8-59.8 58.8v77.1h119.6l-15.6 120.7h-104V912H539.2V602.2H434.9V481.4h104.3v-89c0-103.3 63.1-159.6 155.3-159.6 44.2 0 82.1 3.3 93.2 4.8v107.9z"></path></svg></a><a class="mr-3" aria-label="twitter-share" href="http://twitter.com/share?text=Check out this article!! &amp;url=https://ypermitin.github.io&amp;hashtags=webdevelopment,javacript,javascriptdaily,webdevelopmenttutorial,tutorial" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm215.3 337.7c.3 4.7.3 9.6.3 14.4 0 146.8-111.8 315.9-316.1 315.9-63 0-121.4-18.3-170.6-49.8 9 1 17.6 1.4 26.8 1.4 52 0 99.8-17.6 137.9-47.4-48.8-1-89.8-33-103.8-77 17.1 2.5 32.5 2.5 50.1-2a111 111 0 0 1-88.9-109v-1.4c14.7 8.3 32 13.4 50.1 14.1a111.13 111.13 0 0 1-49.5-92.4c0-20.7 5.4-39.6 15.1-56a315.28 315.28 0 0 0 229 116.1C492 353.1 548.4 292 616.2 292c32 0 60.8 13.4 81.1 35 25.1-4.7 49.1-14.1 70.5-26.7-8.3 25.7-25.7 47.4-48.8 61.1 22.4-2.4 44-8.6 64-17.3-15.1 22.2-34 41.9-55.7 57.6z"></path></svg></a><a class="mr-3" aria-label="linkedin-share" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://ypermitin.github.io&amp;title=Check out this article!!&amp;source=LinkedIn" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[23px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"></path></svg></a><button class="mr-3" name="copy-link" aria-label="copy-link"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z"></path><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243z"></path></svg></button></div><div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded fixed flex transition-all right-[10px] -bottom-20 opacity-0" role="alert"><strong class="font-bold">Link Copied</strong><span class="pl-5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="pt-1 text-[18px] cursor-pointer" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"></path></svg></span></div></div></div><section class="PageLayout_centered_article_wrapper__gS3Af dark:bg-slate-900 dark:text-white"><div class="container px-0 md:px-[15px] pt-[50px] pb-[50px]"><article class="PageLayout_article_content__4dnq3 pb-[30px] px-3 bg-white dark:bg-slate-800 dark:border-none dark:drop-shadow-lg dark:text-white pt-10 md:pt-0 mx-auto font-regular text-lg leading-relaxed"><div class="mb-[30px]"><h1 class="ArticleHeader_articleTitle__3L1Bi text-center text-2xl md:text-4xl font-medium mt-[20px] mb-[5px]">Обновляем Zabbix с 4.0 до 5.0 через грабли</h1><div class="mb-[10px] mt-[15px] text-[14px] font-medium ArticleHeader_centered_article_header_author___gRtE"><p class="my-0 mx-[30px] font-medium">YPermitin<span class="px-1 font-light">в</span><a href="/blog/?category=DevOps">DevOps</a></p><p class="my-0">2020-10-18</p></div><div class="md:mt-2 flex flex-wrap justify-center"><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->Zabbix</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->мониторинг</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->DevOps</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->обновление</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->*.nix</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->Linux</p><p class="text-[12px] font-normal mr-2 mb-1 inline-block text-gray-500 dark:text-gray-400">#<!-- -->PostgreSQL</p></div></div><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset">Стоит ли обновлять</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Первый вопрос: для чего может понадобиться переход с Zabbix 4.0 на 5.0, если и так все работает. Ответ простой: для получения новых возможностей мониторинга и улучшенного текущего функционала. На <b><u><a href="https://www.zabbix.com/ru/whats_new_5_0" target="_blank" rel="noopener noreferrer">официальной странице Вы можете найти описание нововведений,</a></u></b> а сейчас перечислю плюсы перехода в моем случае:</p><ul class="List_list__zLjGi list-disc pl-[30px]"><li>Поддержка сжатия собранных данных в TimescaleDB (автоматическое партицирование, производительность и масштабируемость) при использовании PostgreSQL.</li><li>Улучшенные агенты сбора данных.</li><li>Улучшена работа со счетчиками производительности Windows, в т.ч. и для ОС на разных языках.</li><li>Улучшенная работа с JSON.</li><li>Расширенные возможности при работе с ODBC.</li><li>Встроенная интеграция с популярными системами оповещения, в т.ч. и Telegram.</li><li>Новый состав улучшенных шаблонов для многих популярных сервисов и приложений.</li></ul><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Раньше обновление на новые версии могли приводить к проблемам, т.к. старые шаблоны собираемых метрик были не совместимы. Сейчас же Zabbix 5.0 поддерживает большинство старых шаблонов, что не может не радовать.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">В любом случае, обновлять или нет - это Ваш выбор. Но рекомендую это сделать.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset">План действий</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Обычный процесс обновления Zabbix на новую версию имеет такой план.</p><ul class="List_list__zLjGi list-disc pl-[30px]"><li>Останавливаем Zabbix и делаем бэкап</li><li>Обновляем пакеты Zabbix</li><li>Первый запуск</li><li>Проверяем результаты</li><li>Обновляем прокси и агентов</li><li>Разбираем возникшие проблемы</li></ul><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Будем придерживаться этого плана и сейчас. Подробную информацию по обновлению также можно получить в <b><u><a href="https://www.zabbix.com/documentation/current/ru/manual/installation/upgrade" target="_blank" rel="noopener noreferrer">официальной документации.</a></u></b></p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset">Перед началом</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Стоит напомнить, что все действия выполняются в операционной системе CentOS 7. Сервер Zabbix установлен версии 4.0, а в качестве СУБД используется PostgreSQL 11. Для веб-интерфейса используется Apache.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Для других дистрибутивов Linux и СУБД для Zabbix будут различия в синтаксисе команд и некоторых нюансах, но общая процедура будет такой же.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset">Останавливаем Zabbix и делаем бэкап</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Первым делом нам нужно подстраховаться и сделать бэкап всех настроек. Это может быть бэкап всей виртуальной машины, если такое возможно. Или же можно сделать бэкап отдельных частей мониторинга. Остановимся на втором варианте, т.к. он более сложный по количеству выполняемых действий.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">И так, начнем! Остановим службу сервера Zabbix.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-krNkEb sc-hwdACo jhNAbu dYJsQc prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">systemctl stop zabbix-server</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Теперь мы можем сделать бэкап всех настроек и базы данных. Для примера мы сохраним бэкап всех настроек, компонентов и базу данных в каталог “/opt/zabbix_backup_data”.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-jaXxZZ sc-ibQzxG kvHfDK boLtit prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># Подготавливаем каталоги для бэкапа данных</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-p</span><span class="token plain"> /opt/zabbix_backup_data/bin</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-p</span><span class="token plain"> /opt/zabbix_backup_data/conf</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-p</span><span class="token plain"> /opt/zabbix_backup_data/doc</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-p</span><span class="token plain"> /opt/zabbix_backup_data/web</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-p</span><span class="token plain"> /opt/zabbix_backup_data/db</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Копируем данные в созданные каталоги</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Конфигурация сервера Zabbix</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">cp</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-rp</span><span class="token plain"> /etc/zabbix/zabbix_server.conf /opt/zabbix_backup_data/conf</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Файлы сервера Zabbix</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">cp</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-rp</span><span class="token plain"> /usr/sbin/zabbix_server /opt/zabbix_backup_data/bin</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">cp</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-rp</span><span class="token plain"> /usr/share/doc/zabbix-* /opt/zabbix_backup_data/doc</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Конфигурация веб-сервера</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">cp</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-rp</span><span class="token plain"> /etc/httpd/conf.d/zabbix.conf /opt/zabbix_backup_data/conf </span><span class="token operator file-descriptor important" style="color:rgb(212, 212, 212)">2</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain">/dev/null</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">cp</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-rp</span><span class="token plain"> /etc/apache2/conf-enabled/zabbix.conf /opt/zabbix_backup_data/conf </span><span class="token operator file-descriptor important" style="color:rgb(212, 212, 212)">2</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain">/dev/null</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Конфигурация PHP</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">cp</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-rp</span><span class="token plain"> /etc/zabbix/php-fpm.conf /opt/zabbix_backup_data/conf </span><span class="token operator file-descriptor important" style="color:rgb(212, 212, 212)">2</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain">/dev/null</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Файлы веб-интерфейса</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">cp</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-rp</span><span class="token plain"> /usr/share/zabbix/ /opt/zabbix_backup_data/web</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Делаем бэкап базы zabbix с помощью утилиты pg_dump</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Внимание! Вы должны быть аутентифицированы под пользователем, который имеет доступ</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># к экземпляру PostgreSQL и базе Zabbix. Также убедитесь, что у него есть доступ</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># к каталогу, куда собираетесь сохранить бэкап.</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">pg_dump zabbix </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> /opt/zabbix_backup_data/db/zabbix_db_backup.bak</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Процесс создания бэкапа может занимать длительное время. </span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Все зависит от размера базы.</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Мы сохранили все необходимое на случай отката изменений. Пойдем дальше.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset">Обновляем пакеты Zabbix</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Процесс сервера Zabbix мы уже остановили ранее. Теперь настал момент обновить пакеты. Сначала проверим какие пакеты Zabbix установлены в системе.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-jGKwVr sc-guJBQA hCkjQo fTanrs prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">yum list installed </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">grep</span><span class="token plain"> zabbix</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">В выводе будут присутствовать все пакеты, связанные с Zabbix и их версии. В нашем случае список пакетов будет таким.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-hZDzol sc-fTFkHh jVGcMe jZgLVN prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">zabbix-agent.x86_64</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">zabbix-apache-conf.noarch</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">zabbix-get.x86_64</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">zabbix-release.noarch</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">zabbix-server-pgsql.x86_64</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">zabbix-web.noarch</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">zabbix-web-pgsql.noarch</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Настало время обновить их. Идем на официальную страницу загрузки пакетов и выбираем версии Zabbix, ОС, СУБД и веб-сервера. В результате нам дадут ссылку на репозиторий с пакетами, из которого и нужно поставить обновления. В нашем примере <b><u><a href="https://www.zabbix.com/ru/download?zabbix=5.0&amp;os_distribution=centos&amp;os_version=7&amp;db=postgresql&amp;ws=apache" target="_blank" rel="noopener noreferrer">это выглядит так.</a></u></b></p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Выполним обновление ссылок на репозиторий.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-ktJcvw sc-gmgEyz kItAmu qNHTd prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token function" style="color:rgb(220, 220, 170)">rpm</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-Uvh</span><span class="token plain"> https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">yum clean all</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Теперь мы можем обновить эти пакеты.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-kMkwmO sc-fiCwYx wHbpV dyFcbY prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">yum upgrade </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-y</span><span class="token plain"> zabbix-server-pgsql zabbix-get zabbix-web-pgsql zabbix-web zabbix-apache-conf zabbix-agent</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Если Вы используете Apache, то может понадобиться выполнить команду повторной установки.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-jIGoMM sc-fBdQPP kiOxCy kVYbqD prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">yum </span><span class="token function" style="color:rgb(220, 220, 170)">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-y</span><span class="token plain"> zabbix-apache-conf</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">После завершения обновления можно перейти к первому запуску.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset">Обновляем пакеты Zabbix</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Первый запуск</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Большая часть работы позади, и мы можем попытаться запустить сервер и перейти в веб-интерфейс.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-kbhIEe sc-ehiymJ iIKjId hJvjrc prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">systemctl start zabbix-server</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">После первого запуска не стоит сразу бежать в браузер. Дайте процессу Zabbix обновить базу данных на новую версию. Прогресс этой операции можно посмотреть с помощью логов.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-iHmqaY sc-kYxEyd diqGmM jlFKyU prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">cat /var/log/zabbix/zabbix_server.log | grep database | tail -n 20</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.112 completed 87% of database upgrade</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.115 completed 88% of database upgrade</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.118 completed 89% of database upgrade</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.120 completed 90% of database upgrade</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.123 completed 91% of database upgrade</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.126 completed 92% of database upgrade</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.128 completed 93% of database upgrade</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.130 completed 94% of database upgrade</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.133 completed 95% of database upgrade</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.135 completed 96% of database upgrade</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.136 completed 97% of database upgrade</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.137 completed 98% of database upgrade</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.138 completed 99% of database upgrade</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.139 completed 100% of database upgrade</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.139 database upgrade fully completed</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  2949:20201018:110534.155 database is not upgraded to use double precision values</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Команда показывает последние 20 записей из логов, связанных с процессом обновления базы данных. Как мы видим, в конце написано, что база успешно обновлена.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Но радоваться еще рано. Если перейти в веб-интерфейс, то мы увидим сообщение об ошибке.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-bpUCxw sc-eyvHYj kOoiVm oNTZb prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">The Zabbix database version does not match current requirements. Your database version: 5000000. Required version: 4000000. Please contact your system administrator.</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">То есть база данных для версии 5.0, а веб-интерфейсу требуется версия 4.0. Но как так? Мы же обновили все пакеты!</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Все связано с тем, что версия PHP 7.2, которая нужна для 5 версии Zabbix, отсутствует в базовых репозиториях CentOS 7. Из-за этого фактически пакеты zabbix-web и zabbix-web-pgsql не обновились и до сих пор остаются от 4 версии. Для решения проблемы подключим репозиторий “centos-release-scl” и переустановим эти два пакета. Первым делом удалим предыдущие версии:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-gfopwy sc-kbovfZ bMTneJ graJPS prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">yum remove zabbix-web-*</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Теперь подключим репозиторий “centos-release-scl”:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-sLtfs sc-dBmyGf QaAwv eEkNBd prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">yum </span><span class="token function" style="color:rgb(220, 220, 170)">install</span><span class="token plain"> centos-release-scl</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">После этого активируем новые настройки Zabbix для Apache. Для этого в файле “/etc/httpd/conf.d/zabbix.conf” должна быть такая строка:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-fifgeu sc-bDunJF gAPEkL dCgxjP prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">yum install centos-release-scl</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">SetHandler &quot;proxy:unix:/var/opt/rh/rh-php72/run/php-fpm/zabbix.sock|fcgi://localhost&quot;</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Эта настройка позволяет использовать PHP 7.2 из пакета PHP-FPM. Перезапускаем все службы:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-dkmVhU sc-ejfMNw jsHFvM bHnabn prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># Перезапускаем сервер Zabbix и веб-сервер</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">systemctl restart zabbix-server httpd</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Включаем автозапуск PHP-FPM</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">systemctl </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">enable</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--now</span><span class="token plain"> rh-php72-php-fpm</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Теперь мы можем перейти в браузере в веб-интерфейс и успешно авторизоваться.</p><div class="Images_article_image__wrapper__QSTzx my-4 Images_size_medium__0iTcB display-block mx-auto my-5"><div aria-owns="rmiz-modal-" data-rmiz=""><div data-rmiz-content="not-found" style="visibility:visible"><img src="/imp_assets/DevOps/2020-10/update-zabbix-4.0-to-5.0/1. Успешный вход после обновления.png" alt="Успешный вход после обновления" width="100%" class="block"/></div></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Единственный нюанс - может потребоваться очистка кэша браузера, т.к. кэш от старой версии веб-интерфейса может привести к некорректному отображению разметки или выполнению некоторых функций. Нажмите Ctrl+F5 для обновления кэша браузера текущей страницы.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset">Проверяем результаты</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset"><b><u><a href="/blog/DevOps/2020-10/zabbix-diagnostic" target="_blank" rel="noopener noreferrer">В прошлой публикации</a></u></b> мы рассмотрели основные способы диагностики работы мониторинга. Там же было сказано, что логи сервера - основной источник данных о его работе и возможных проблемах. Посмотрим есть ли ошибки в логах.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-iEXLnV sc-EgOky eKckZx hPUfxN prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token function" style="color:rgb(220, 220, 170)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-i</span><span class="token plain"> error /var/log/zabbix/zabbix_server.log</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">В моем случае ошибок никаких не возникало. Тогда можно посмотреть последние 50 событий.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-eZYMKX sc-dlWDvs jIFyKB gKktLU prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">tail -n 30 /var/log/zabbix/zabbix_server.log</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4954:20201018:115732.058 server #25 started [icmp pinger #1]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4958:20201018:115732.059 server #29 started [alerter #3]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4964:20201018:115732.059 server #35 started [lld worker #1]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4944:20201018:115732.059 server #15 started [poller #2]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4951:20201018:115732.064 server #22 started [trapper #3]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4963:20201018:115732.070 server #34 started [lld manager #1]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4932:20201018:115732.070 server #3 started [timer #1]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4953:20201018:115732.074 server #24 started [trapper #5]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4955:20201018:115732.083 server #26 started [alert manager #1]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4956:20201018:115732.084 server #27 started [alerter #1]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4957:20201018:115732.084 server #28 started [alerter #2]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4959:20201018:115732.084 server #30 started [preprocessing manager #1]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4960:20201018:115732.085 server #31 started [preprocessing worker #1]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4962:20201018:115732.085 server #33 started [preprocessing worker #3]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4965:20201018:115732.085 server #36 started [lld worker #2]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4961:20201018:115732.118 server #32 started [preprocessing worker #2]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4931:20201018:122734.734 executing housekeeper</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4931:20201018:122734.909 housekeeper [deleted 3168 hist/trends, 7 items/triggers, 0 events, 0 problems, 0 sessions, 0 alarms, 0 audit, 0 records in 0.171355 sec, idle for 1 hour(s)]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4931:20201018:132741.474 executing housekeeper</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4931:20201018:132741.539 housekeeper [deleted 4599 hist/trends, 0 items/triggers, 0 events, 0 problems, 0 sessions, 0 alarms, 0 audit, 0 records in 0.060424 sec, idle for 1 hour(s)]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4931:20201018:142748.409 executing housekeeper</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4931:20201018:142748.480 housekeeper [deleted 4595 hist/trends, 0 items/triggers, 0 events, 2 problems, 0 sessions, 0 alarms, 0 audit, 0 records in 0.066891 sec, idle for 1 hour(s)]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4931:20201018:152754.686 executing housekeeper</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4931:20201018:152754.761 housekeeper [deleted 4601 hist/trends, 0 items/triggers, 0 events, 1 problems, 0 sessions, 0 alarms, 0 audit, 0 records in 0.071199 sec, idle for 1 hour(s)]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4931:20201018:162801.570 executing housekeeper</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4931:20201018:162801.634 housekeeper [deleted 4607 hist/trends, 0 items/triggers, 0 events, 1 problems, 0 sessions, 0 alarms, 0 audit, 0 records in 0.060641 sec, idle for 1 hour(s)]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4931:20201018:172808.511 executing housekeeper</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4931:20201018:172808.574 housekeeper [deleted 4598 hist/trends, 0 items/triggers, 0 events, 1 problems, 0 sessions, 0 alarms, 0 audit, 0 records in 0.058850 sec, idle for 1 hour(s)]</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4931:20201018:182815.213 executing housekeeper</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  4931:20201018:182815.285 housekeeper [deleted 4601 hist/trends, 0 items/triggers, 0 events, 0 problems, 0 sessions, 0 alarms, 0 audit, 0 records in 0.067710 sec, idle for 1 hour(s)]</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Ничего особенно в логах не видим: процессы запущены, работает housekeeper, все штатно. Тогда зайдем в список хостов в веб-интерфейсе и проверим собираются ли метрики.</p><div class="Images_article_image__wrapper__QSTzx my-4 Images_size_medium__0iTcB display-block mx-auto my-5"><div aria-owns="rmiz-modal-" data-rmiz=""><div data-rmiz-content="not-found" style="visibility:visible"><img src="/imp_assets/DevOps/2020-10/update-zabbix-4.0-to-5.0/2. Сбор данных продолжается.png" alt="Сбор данных продолжается" width="100%" class="block"/></div></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Тоже все хорошо. Несмотря на то, что агентов мы не обновляли (кроме агента на Zabbix-сервере), мониторинг продолжает работать в штатном режиме.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Однако, на основной панели веб-интерфейса можно увидеть вот такую информацию об ошибке.</p><div class="Images_article_image__wrapper__QSTzx my-4 Images_size_medium__0iTcB display-block mx-auto my-5"><div aria-owns="rmiz-modal-" data-rmiz=""><div data-rmiz-content="not-found" style="visibility:visible"><img src="/imp_assets/DevOps/2020-10/update-zabbix-4.0-to-5.0/3. Ошибка с настройкой часового пояса PHP.png" alt="Ошибка с настройкой часового пояса PHP" width="100%" class="block"/></div></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Для исправления достаточно в файле “/etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf” исправить параметр “date.timezone” (расскоментировать и поставить нужный часовой пояс). Вот так в моем случае выглядит параметр до и после изменения:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-hHOBVR sc-kWtorq cUcPAI ckXVOi prism-code language-text" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain"># До</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">; php_value[date.timezone] = Europe/Riga</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"># После</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">php_value[date.timezone] = Asia/Yekaterinburg</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">После изменения параметров обязательно нужно перезапустить службы и включить их запуск автоматически при загрузке ОС.</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-ecPDsT sc-gdyfxU kKBXoE bepIPz prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">systemctl restart zabbix-server zabbix-agent httpd rh-php72-php-fpm</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">systemctl </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">enable</span><span class="token plain"> zabbix-server zabbix-agent httpd rh-php72-php-fpm</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">После этого ошибка настройки часового пояса больше не появится.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset">Добавляем новые шаблоны</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">В 5 версии Zabbix появились новые усовершенствованные шаблоны, но после обновления они не появились автоматически. Добавим их вручную.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Для этого идем на официальный сайт и скачиваем шаблоны. Например, <b><u><a href="https://share.zabbix.com/official-templates/zabbix-official-template-pack" target="_blank" rel="noopener noreferrer">вот эти</a></u></b>. Добавляем все что необходимо и используем в своих узлах мониторинга.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Конечно, возможно придется отказаться от старых шаблонов, но это уже другая история.</p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset">Обновляем прокси и агентов</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Обновление Zabbix-прокси практически такое же как и для сервера, но с одним исключением. Вместо команды:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-kzqdYt sc-bDoQz eIQAvw eQqUMg prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">yum upgrade </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-y</span><span class="token plain"> zabbix-server-pgsql zabbix-frontend-php</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">нужно использовать:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-bVHBsO sc-dSIJcR htjfwj eRLZdT prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">yum upgrade </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-y</span><span class="token plain"> zabbix-proxy</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">В остальном никаких проблем быть не должно. Вы всегда можете проверить какие пакеты Zabbix установлены на сервере с Zabbix-прокси, чтобы знать что обновлять. Команды для просмотра списка мы уже рассматривали выше.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Что касается агентов, то тут тоже ничего нового. Просто актуализируйте репозиторий и выполните:</p><div class="bg-blue-500 md:p-1 p-2 my-5"><div class="shadow-lg"><pre class="sc-fMMVFg sc-ktPOXr gPtJWs eEPGxQ prism-code language-bash" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">yum upgrade </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-y</span><span class="token plain"> zabbix-agent</span></div></pre></div></div><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">На самом деле мы это уже сделали на сервере в примере выше.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Обновить агентов в других ОС также не сложная: скачивайте новый дистрибутив и устанавливайте / обновляете его компоненты. Никаких сложностей не должно быть. Если же будут, то обратитесь к <b><u><a href="https://www.zabbix.com/documentation/current/ru/manual/installation/upgrade/packages/rhel_centos" target="_blank" rel="noopener noreferrer">официальной документации.</a></u></b></p><h1 class="font-bold text-3xl md:text-4xl my-[10px] mt-10 md:text" style="text-align:unset">Продолжение следует</h1><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Теперь мы используем Zabbix 5 версии, задача успешно выполнена.</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Это была еще одна небольшая публикация по теме мониторинга с помощью Zabbix. В следующих статьях мы поговорим о создании своего шаблон для сбора метрик и рассмотрим некоторые особенности этого процесса, настроим уведомления в Telegram-канал, а также получении данных с Prometheus и визуализации данных в Grafana. И, конечно же, оптимизация производительности сервера мониторинга Zabbix!</p><p class="font-regular mb-3 text-lg leading-relaxed" style="text-align:unset">Будьте на связи <!-- -->:)</p></article><div class="Seperator_section_seperator_line__gdWIB dark:border-white border-black"></div><div class="PageLayout_author_and_more__wxN3W mx-auto"><div class="bg-white dark:bg-slate-800 dark:border-none border-slate-100 shadow-lg border md:rounded-[8px] px-[15px] py-[10px] mb-[30px] overflow-hidden"><div class="flex items-center"><div class="flex items-center justify-center shadow-xl rounded-full overflow-hidden bg-blue-500 shrink-0 w-[60px] h-[60px] mr-3 text-xl"><p class="text-center font-medium text-white">Y</p></div><div class="font-semibold"><p class="text-[20px]  mb-0 mt-0">YPermitin</p><p class="text-xs mt-0 mb-0">.NET, TSQL, DevOps, 1C:Enterprise</p></div></div><p class="text-[16px] mt-2">Developer, just developer.</p><div class="flex items-center flex-wrap mt-3"><a href="https://github.com/YPermitin" target="_blank" class="mr-[15px] text-[32px]" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a></div></div><div class="bg-white dark:bg-slate-800 dark:border-none border-slate-100 shadow-lg border md:rounded-[8px] px-[15px] py-[10px] mb-[30px] overflow-hidden"><p class="border-b border-gray-300 pb-2 mb-3 font-medium w-full">Поделиться</p><div class="flex flex-wrap items-center"><a class="mr-3" aria-label="facebook-share" href="https://www.facebook.com/sharer/sharer.php?u=https://ypermitin.github.io" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-92.4 233.5h-63.9c-50.1 0-59.8 23.8-59.8 58.8v77.1h119.6l-15.6 120.7h-104V912H539.2V602.2H434.9V481.4h104.3v-89c0-103.3 63.1-159.6 155.3-159.6 44.2 0 82.1 3.3 93.2 4.8v107.9z"></path></svg></a><a class="mr-3" aria-label="twitter-share" href="http://twitter.com/share?text=Check out this article!! &amp;url=https://ypermitin.github.io&amp;hashtags=webdevelopment,javacript,javascriptdaily,webdevelopmenttutorial,tutorial" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm215.3 337.7c.3 4.7.3 9.6.3 14.4 0 146.8-111.8 315.9-316.1 315.9-63 0-121.4-18.3-170.6-49.8 9 1 17.6 1.4 26.8 1.4 52 0 99.8-17.6 137.9-47.4-48.8-1-89.8-33-103.8-77 17.1 2.5 32.5 2.5 50.1-2a111 111 0 0 1-88.9-109v-1.4c14.7 8.3 32 13.4 50.1 14.1a111.13 111.13 0 0 1-49.5-92.4c0-20.7 5.4-39.6 15.1-56a315.28 315.28 0 0 0 229 116.1C492 353.1 548.4 292 616.2 292c32 0 60.8 13.4 81.1 35 25.1-4.7 49.1-14.1 70.5-26.7-8.3 25.7-25.7 47.4-48.8 61.1 22.4-2.4 44-8.6 64-17.3-15.1 22.2-34 41.9-55.7 57.6z"></path></svg></a><a class="mr-3" aria-label="linkedin-share" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://ypermitin.github.io&amp;title=Check out this article!!&amp;source=LinkedIn" target="popup"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[23px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"></path></svg></a><button class="mr-3" name="copy-link" aria-label="copy-link"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="text-[30px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z"></path><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243z"></path></svg></button></div><div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded fixed flex transition-all right-[10px] -bottom-20 opacity-0" role="alert"><strong class="font-bold">Link Copied</strong><span class="pl-5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="pt-1 text-[18px] cursor-pointer" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"></path></svg></span></div></div><div class="bg-white dark:bg-slate-800 dark:border-none border-slate-100 shadow-lg border md:rounded-[8px] px-[15px] py-[10px] mb-[30px] overflow-hidden"><p class="border-b border-gray-300 pb-2 mb-3 font-medium w-full">Другие статьи</p><div class="flex flex-wrap"><div class="mb-3 cursor-pointer lg:w-1/3 md:w-1/2 w-full md:pr-2" href="/blog/.NET/2024-07/processes-under-control/"><div class=" rounded-[3px] dark:bg-slate-800 border border-slate-200 dark:border-slate-900 flex items-center overflow-hidden shadow-lg hover:shadow-md "><div class="object-cover shrink-0"><img src="/imp_assets/.NET/2024-07/processes-under-control/logo.png" class="w-[120px] h-[70px] mr-2 object-cover" alt="Берем процессы под контроль в .NET"/></div><div class="pr-1 text-[16px] hover:text-blue-500 font-semibold">Берем процессы под контроль в .NET</div></div></div><div class="mb-3 cursor-pointer lg:w-1/3 md:w-1/2 w-full md:pr-2" href="/blog/.NET/2024-06/detect-devices-with-charp/"><div class=" rounded-[3px] dark:bg-slate-800 border border-slate-200 dark:border-slate-900 flex items-center overflow-hidden shadow-lg hover:shadow-md "><div class="object-cover shrink-0"><img src="/imp_assets/.NET/2024-06/detect-devices-with-charp/logo.png" class="w-[120px] h-[70px] mr-2 object-cover" alt="Поиск устройств в сети с .NET (C#)"/></div><div class="pr-1 text-[16px] hover:text-blue-500 font-semibold">Поиск устройств в сети с .NET (C#)</div></div></div><div class="mb-3 cursor-pointer lg:w-1/3 md:w-1/2 w-full md:pr-2" href="/blog/.NET/2024-05/game-trainer-on-csharp-or-cpp/"><div class=" rounded-[3px] dark:bg-slate-800 border border-slate-200 dark:border-slate-900 flex items-center overflow-hidden shadow-lg hover:shadow-md "><div class="object-cover shrink-0"><img src="/imp_assets/.NET/2024-05/game-trainer-on-csharp-or-cpp/logo.png" class="w-[120px] h-[70px] mr-2 object-cover" alt="Управляем игровым миром с помощью C++ / C#"/></div><div class="pr-1 text-[16px] hover:text-blue-500 font-semibold">Управляем игровым миром с помощью C++ / C#</div></div></div><a class="cursor-pointer hover:text-blue-500 block text-sm py-3 px-2 text-center dark:bg-slate-900 bg-blue-500 rounded text-white font-bold hover:!text-blue-900 dark:hover:!text-slate-400 transition-all" href="/blog/?author=YPermitin"><p>Все статьи от автора: <!-- -->YPermitin</p></a></div></div></div></div></section><div class="dark:bg-slate-900 dark:text-white bg-slate-100 text-black"><div class="md:container flex items-center md:justify-center justify-around flex-wrap md:text-[14px] text-[12px] py-5"><p class="my-0 mr-[10px] md:mr-3">Copyright © <!-- -->2024<!-- --> <!-- -->Убежище инженера</p></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/DevOps/2020-10/update-zabbix-4.0-to-5.0","query":{},"buildId":"YQm1KLnUPuRbgh1UDWeUw","nextExport":true,"autoExport":true,"isFallback":false,"dynamicIds":[8765,3220,935,7355,7651],"scriptLoader":[]}</script></body></html>