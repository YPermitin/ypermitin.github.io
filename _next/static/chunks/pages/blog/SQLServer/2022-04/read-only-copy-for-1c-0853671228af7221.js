(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6367],{54546:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/SQLServer/2022-04/read-only-copy-for-1c",function(){return a(19912)}])},19912:function(e,n,a){"use strict";a.r(n);var s=a(85893),r=a(97037);a(67294);var t=a(13803),i=a(46416);n.default=()=>(0,s.jsxs)(r.Xg,{blogcentered:!0,children:[(0,s.jsx)(r.xv,{title:!0,className:"mt-10 md:text",children:"Старая проблема"}),(0,s.jsx)(r.xv,{p:!0,children:"Любовь к монолитам идет от самой фирмы “1С” и простирается на большинство ее партнеров и клиентов. Многие информационные системы на базе платформы 1С построены в виде единого монолита, где ведется как оперативная работа и выполнение различных регламентных операций, так и сбор разного рода отчетности."}),(0,s.jsx)(r.xv,{p:!0,children:"У многих архитекторов и разработчиков, имеющих дело с платформой 1С (по крайней мере которых я знаю) есть стойкое видение, что монолит лучше разрозненных баз, т.к. исключает проблемы интеграции, проще идет разработка, нет проблем согласованности изменений между частями системы, меньше проблем с администрированием, да и вообще разделение на сервисы это “модное” зло и так далее."}),(0,s.jsx)(r.xv,{p:!0,children:"Для небольших систем это не критично, но если в базе работают сотня и больше пользователей, то монолит может начать сбоить, т.к. OLTP и OLAP нагрузки начинают конкурировать друг с другом за ресурсы. Обычно не в пользу первой."}),(0,s.jsx)(r.xv,{p:!0,children:"Отсюда и появляется проблема с производительностью и надежностью. Особенно в периоды закрытия месяца и подобных “особых” периодов. Тормозит ли ваша база в период закрытия или годовой отчетности? Если да, то сочувствую. Думаю, у Вас есть архитектурные проблемы. Или проблемы с железом и пора добавить 6 ТБ оперативной памяти! (это шутка, пощадите ваших админов!)."}),(0,s.jsx)(r.xv,{p:!0,children:"Ниже мы поговорим о путях решения подобных проблем, рассмотрим некоторые варианты. Основное направление - это вынос отчетной, OLAP нагрузки из основной базы, чтобы никакая отчетность больше не влияла на оперативную работу. Альтернативный путь разбивания монолита на сервисы рассматривать не будем, оставим это для другой истории."}),(0,s.jsx)(r.xv,{title:!0,className:"mt-10 md:text",children:"Первое, что приходит в голову"}),(0,s.jsx)(r.xv,{p:!0,children:"Разработчики 1С тут же предлагают сделать копию информационной базы и отправлять в нее данные основной базы с помощью стандартных или доработанных обменов данными с некоторой периодичностью (это и планы обмена, и регистрация изменений в регистре сведений и так далее). Эту копию использовать как обычными клиентскими сеансами (тонкий и толстый клиенты), так и опубликовать из нее веб-сервис и запрашивать данные через него."}),(0,s.jsx)(r.xv,{p:!0,children:"Этот вариант мы рассматривать не будем, так как он имеет существенные недостатки, с которыми придется героически бороться:"}),(0,s.jsxs)(r.aV,{children:[(0,s.jsx)("li",{children:"Снижение производительности и параллельности работы пользователей, особенно при использовании планов обмена."}),(0,s.jsx)("li",{children:"Повышенная нагрузка на сервер 1С как основной базы, так и копии, ведь все операции нужно более-менее дублировать."}),(0,s.jsx)("li",{children:"Сложность в сопровождении из-за потенциальных ошибок в обмене данными, ошибок в конфигурации и так далее."})]}),(0,s.jsxs)(r.xv,{p:!0,children:["Для небольших баз это все может быть не критичным, но нужна ли для них копия",":)"]}),(0,s.jsx)(r.xv,{p:!0,children:"Если вы считаете, что обмен средствами 1С все же хороший вариант для больших баз, то рекомендую здесь на ИС ознакомиться с опытом коллег."}),(0,s.jsx)(r.xv,{p:!0,children:"В общем, этот вариант только для фанатов 1С. Бесстрашных и упрямых."}),(0,s.jsx)(r.xv,{title:!0,className:"mt-10 md:text",children:"Какие еще варианты"}),(0,s.jsxs)(r.xv,{p:!0,children:["В статье ",(0,s.jsx)("b",{children:(0,s.jsx)("u",{children:(0,s.jsx)(r.e9,{newTab:!0,href:"/pages/blog/DevOps/2019-04/copy-database-for-1c-ways.tsx",children:"“Копия базы 1С для отчетов. Или как выжить с тяжелой отчетностью”"})})})," мы рассматривали разные способы создания копии базы данных для отчетности:"]}),(0,s.jsxs)(r.aV,{children:[(0,s.jsx)("li",{children:"Создание копии через обычное бэкапирование."}),(0,s.jsx)("li",{children:"Через репликацию средствами СУБД, в примере был SQL Server."}),(0,s.jsx)("li",{children:"Онлайн-копии через механизм групп высокой доступности AlwaysOn, реализованном также в SQL Server. Для PostgreSQL такое также возможно через потоковую репликацию."})]}),(0,s.jsx)(r.xv,{p:!0,children:"Кроме этого можно создавать копию через механизм доставки жарнала транзакций с учетом всех ограничений этого механизма."}),(0,s.jsx)(r.xv,{p:!0,children:"Бэкапирование создает копию, которую платформа 1С может использовать без ограничений, т.к. в базу все также возможна запись данных, но актуальность данных будет сильно страдать в такой базе."}),(0,s.jsxs)(r.xv,{p:!0,children:["Репликация и AlwaysOn позволяют создать копию базы данных практически в онлайн режиме, но она будет доступна только для чтения. По умолчанию платформа 1С с такими базами работать нормально не сможет. Особенности работы платформы 1С с базами только для чтения ",(0,s.jsx)("b",{children:(0,s.jsx)("u",{children:(0,s.jsx)(r.e9,{newTab:!0,href:"https://github.com/YPermitin/SQLServerTools/blob/master/SQL-Server-AlwaysOn/SQL%20Server%20AlwaysOn/%D0%9D%D0%B5%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D1%8B%D0%B5%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8%20%D0%BF%D1%80%D0%B8%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B5%20%D1%81%20AlwaysOn.md",children:"описаны в этой инструкции"})})}),". Самые простые способы подружить платформу 1С с такими базами это:"]}),(0,s.jsxs)(r.aV,{children:[(0,s.jsx)("li",{children:"Использовать толстый клиент обычного приложения, предварительно убрав из конфигурации выполнение операций записи при запуске клиента."}),(0,s.jsx)("li",{children:"Опубликовать веб-сервисы и через них обращаться к этой копии."})]}),(0,s.jsx)(r.xv,{p:!0,children:"Также есть более “правильные”, но дорогие способы работы с копиями базы в режиме только для чтения, при этом в более удобном виде:"}),(0,s.jsxs)(r.aV,{children:[(0,s.jsxs)("li",{children:["Компания ",(0,s.jsx)("b",{children:(0,s.jsx)("u",{children:(0,s.jsx)(r.e9,{newTab:!0,href:"https://www.softpoint.ru/",children:"Softpoint"})})})," реализовала готовый продукт ",(0,s.jsx)("b",{children:(0,s.jsx)("u",{children:(0,s.jsx)(r.e9,{newTab:!0,href:"https://www.softpoint.ru/solutions/data-cluster/",children:"Data Cluster"})})}),", которая позволяет выполнять балансировку запросов между серверами. Другими словами, это промежуточное ПО позволяет отправлять читающие запросы на онлайн-копии базы данных, причем это происходит незаметно для клиента базы данных. В том числе и для платформы 1С."]}),(0,s.jsx)("li",{children:"Сама фирма “1С” реализовала механизм копий баз данных, доступный с лицензией КОРП. Также позволяет создавать копии баз данных и отправлять выполнением запросов на различных серверах."})]}),(0,s.jsx)(r.xv,{p:!0,children:"Но можно пойти и другим путем, который даст больший контроль над процессом создания и использования копий, а также не требует покупки лицензий стороннего ПО или дополнительных лицензий."}),(0,s.jsx)(r.xv,{title:!0,className:"mt-10 md:text",children:"Выбираем способ создания копии базы"}),(0,s.jsx)(r.xv,{p:!0,children:"Первое, что мы выберем - это способ создания копии базы данных. Тут исходим из того, что доступно."}),(0,s.jsx)(r.xv,{p:!0,children:"Для SQL Server:"}),(0,s.jsxs)(r.aV,{children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("b",{children:(0,s.jsx)("u",{children:(0,s.jsx)(r.e9,{newTab:!0,href:"https://learn.microsoft.com/ru-ru/sql/database-engine/log-shipping/about-log-shipping-sql-server?view=sql-server-ver16",children:"Доставка логов транзакций"})})})," (доступен в редакциях Standard и Enterprise)"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("b",{children:(0,s.jsx)("u",{children:(0,s.jsx)(r.e9,{newTab:!0,href:"https://github.com/YPermitin/SQLServerTools/tree/master/SQL-Server-Replication-And-High-Availability",children:"Репликация данных "})})})," (различные способы) (обычно все варианты доступны в Standard и Enterprise, но есть исключения)"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("b",{children:(0,s.jsx)("u",{children:(0,s.jsx)(r.e9,{newTab:!0,href:"https://github.com/YPermitin/SQLServerTools/tree/master/SQL-Server-AlwaysOn",children:"Группы высокой доступности AlwaysOn"})})})," (полный функционал доступен в Enterprise, но ограниченный функционал доступен и в Standard)"]})]}),(0,s.jsx)(r.xv,{p:!0,children:"Для PostgreSQL:"}),(0,s.jsxs)(r.aV,{children:[(0,s.jsx)("li",{children:(0,s.jsx)("b",{children:(0,s.jsx)("u",{children:(0,s.jsx)(r.e9,{newTab:!0,href:"https://wiki.postgresql.org/wiki/Streaming_Replication",children:"Потоковая репликация"})})})}),(0,s.jsx)("li",{children:(0,s.jsx)("b",{children:(0,s.jsx)("u",{children:(0,s.jsx)(r.e9,{newTab:!0,href:"https://www.postgresql.org/docs/current/logical-replication.html",children:"Логическая репликация"})})})})]}),(0,s.jsx)(r.xv,{p:!0,children:"В нашем случае выберем механизм групп высокой доступности AlwaysOn из SQL Server. Будем создавать онлайн-копию базы только для чтения именно этим способом. Информацию по настройке AlwaysOn можете посмотреть здесь."}),(0,s.jsx)(r.xv,{p:!0,children:"Вы можете выбрать любой другой подходящий способ. Главное создать копию в режиме “только для чтения”."}),(0,s.jsx)(r.xv,{title:!0,className:"mt-10 md:text",children:"Почему платформа не работает"}),(0,s.jsx)(r.xv,{p:!0,children:"Прежде чем что-то делать нужно ответить на вопрос: “Почему платформа 1С не работает с базами в режиме только для чтения?”."}),(0,s.jsx)(r.xv,{p:!0,children:"Если попытаться добавить такую базы в кластер 1С и запустить клиентское приложение, то с высокой вероятностью Вы получите такую ошибку."}),(0,s.jsx)(r.xv,{p:!0,children:(0,s.jsx)("i",{children:"Невосстановимая ошибка Ошибка при выполнении запроса POST к ресурсу /e1cib/modules/call: по причине: Соединение с сервером баз данных непригодно для использования после разрыва соединения администратором и будет переустановлено. Microsoft SQL Server Native Client 11.0: Failed to update database “YourDatabaseName” because the database is read-only. HRESULT=80004005, SQLSrvr: SQLSTATE=25000, state=2, Severity=10, native=3906, line=1"})}),(0,s.jsx)(r.xv,{p:!0,children:"Причина проста - платформа пытается записать изменения в служебные таблицы, например в “_SystemSettings” таким запросом:"}),(0,s.jsx)(t.Z,{code:"\nINSERT INTO dbo._SystemSettings (\n    _UserId,\n    _ObjectKey,\n    _SettingsKey,\n    _Version,\n    _SettingsPresentation,\n    _SettingsData,\n    _DataSeparationUse16249,\n    _DataSeparationUse16250,\n    _Fld2293,\n    _Fld774) \nVALUES(@P1,@P2,@P3,@P4,@P5,@P6,@P7,@P8,@P9,@P10) \n                ",className:"my-5",language:"sql"}),(0,s.jsx)(r.xv,{p:!0,children:"Такую же ошибку можно получить и при явных операциях изменения данных над объектами базы (справочников, документов и так далее)."}),(0,s.jsx)(r.xv,{p:!0,children:"Больше всего шансов поймать такую ошибку при использовании клиента в управляемом приложении, т.к. операций записи изменений там происходят гораздо чаще. Например, в таблицу историй действий пользователей “_UsersWorkHistory”, в которой сохраняется информация об использовании форм пользователем. В обычном приложении эта таблица не используется."}),(0,s.jsx)(r.xv,{p:!0,children:"Вот список служебных таблиц, в которые платформа 1С может попытаться выполнить запись, даже если никаких действий в базе 1С не выполнять:"}),(0,s.jsxs)(r.aV,{children:[(0,s.jsx)("li",{children:"V8Users"}),(0,s.jsx)("li",{children:"DBSchema"}),(0,s.jsx)("li",{children:"SchemaStorage"}),(0,s.jsx)("li",{children:"Params"}),(0,s.jsx)("li",{children:"Files"}),(0,s.jsx)("li",{children:"_FrmDtSettings"}),(0,s.jsx)("li",{children:"DepotFiles"}),(0,s.jsx)("li",{children:"IBVersion"}),(0,s.jsx)("li",{children:"Config"}),(0,s.jsx)("li",{children:"ConfigCAS"}),(0,s.jsx)("li",{children:"ConfigCASSave"}),(0,s.jsx)("li",{children:"ConfigSave"}),(0,s.jsx)("li",{children:"_UsersWorkHistory"}),(0,s.jsx)("li",{children:"_SystemSettings"}),(0,s.jsx)("li",{children:"_DynListSettings"}),(0,s.jsx)("li",{children:"_CommonSettings"}),(0,s.jsx)("li",{children:"_ExtensionsInfo"}),(0,s.jsx)("li",{children:"_ExtensionsInfoNGS"}),(0,s.jsx)("li",{children:"_ExtensionsRestruct"}),(0,s.jsx)("li",{children:"_ExtensionsRestructNGS"}),(0,s.jsx)("li",{children:"_YearOffset"})]}),(0,s.jsx)(r.xv,{p:!0,children:"Получается, что если мы сможем показать платформе 1С, что запись в эти таблицы возможна без каких-либо ошибок, то проблем с работой в базах с режимом “только для чтения” не будет."}),(0,s.jsx)(r.xv,{title:!0,className:"mt-10 md:text",children:"Хитрый ход"}),(0,s.jsx)(r.xv,{p:!0,children:"Но как можно “обмануть” платформы 1С? Ведь копия базы недоступна для изменения. Но выход есть всегда!"}),(0,s.jsx)(r.xv,{p:!0,children:"Мы можем создать новую базу данных на том же сервере, рядом с базой реплики, и создать копии перечисленных выше таблиц, перенеся в них данные из реплики. Остальные таблицы мы создавать не будем, вместо этого создадим одноименные представления, которые будут ссылаться на настоящие таблицы в базе данных реплики."}),(0,s.jsx)(r.xv,{p:!0,children:"Например, у нас есть база “BSL-ORIG” на основном сервере SRV-SQL-1. Подключена к серверу 1С обычным образом, все работает штатно. Через механизм групп высокой доступности AlwaysOn сделана копия этой базы на SRV-SQL-2. Копия, конечно же, доступна только для чтения."}),(0,s.jsx)(r.Ee,{className:"my-4",src:"/public/imp_assets/SQLServer/2022-04/read-only-copy-for-1c/1. Настраиваем репликацию.png",alt:"Настраиваем репликацию",size:i.h2.MEDIUM}),(0,s.jsx)(r.xv,{p:!0,children:"Создаем пустую базу на SRV-SQL-2, назовем ее “BSL_COPY”. Она и будет располагать все необходимые объекты базы. И именно к ней будет обращаться сервер 1С для работы."}),(0,s.jsx)(r.xv,{p:!0,children:"Но прежде, чем пустить платформу 1С в огород базу нужно выполнить подготовительные действия."}),(0,s.jsx)(r.xv,{subtitle:!0,className:"mt-10 md:text",children:"1. Удаляем все существующие объекты в базе"}),(0,s.jsx)(r.xv,{p:!0,children:"На всякий случай удалим все существующие объекты, т.к. мы их будем создавать заново. Действие имеет смысл при обновлении объектов, например, если была обновлена конфигурация 1С в оригинальной базе или изменилась структура базы данных после реструктуризации. Обычно эти два шага идут рядом."}),(0,s.jsx)(t.Z,{code:"\n-- Удаление всех представлений\nDECLARE @name VARCHAR(128)\nDECLARE @SQL VARCHAR(254)\n\nSELECT @name = (SELECT TOP 1 [name] FROM sysobjects WHERE [type] = 'V' AND category = 0 ORDER BY [name])\n\nWHILE @name IS NOT NULL\nBEGIN\n    SELECT @SQL = 'DROP VIEW [dbo].[' + RTRIM(@name) +']'\n    EXEC (@SQL)\n    SELECT @name = (SELECT TOP 1 [name] FROM sysobjects WHERE [type] = 'V' AND category = 0 AND [name] > @name ORDER BY [name])\nEND\nGO\n\n-- Удаление всех таблиц\nDECLARE @name VARCHAR(128)\nDECLARE @SQL VARCHAR(254)\n\nSELECT @name = (SELECT TOP 1 [name] FROM sysobjects WHERE [type] = 'U' AND category = 0 ORDER BY [name])\n\nWHILE @name IS NOT NULL\nBEGIN\n    SELECT @SQL = 'DROP TABLE [dbo].[' + RTRIM(@name) +']'\n    EXEC (@SQL)\n    SELECT @name = (SELECT TOP 1 [name] FROM sysobjects WHERE [type] = 'U' AND category = 0 AND [name] > @name ORDER BY [name])\nEND\nGO\n                ",className:"my-5",language:"sql"}),(0,s.jsxs)(r.xv,{p:!0,children:["Не запустите этот скрипт на другой базе, он безвозвратно удалит все объекты ",":)"]}),(0,s.jsx)(r.xv,{subtitle:!0,className:"mt-10 md:text",children:"2. Создаем таблицы"}),(0,s.jsx)(r.xv,{p:!0,children:"Как уже говорилось выше, нужно “объяснить” платформе 1С, что эта база доступна для работы. Именно поэтому некоторые объекты из исходной базы нужно перенести как есть, то есть в виде таблиц. При этом мы сохраним возможность записи в эти таблицы."}),(0,s.jsx)(r.xv,{p:!0,children:"Некоторые объекты, например, таблицы с конфигурацией базы данных, по факту не будут использоваться для записи. Но если сделать их представлениями платформа все равно не сможет с ними работать из-за своих “особых” внутренностей. Поэтому некоторые таблицы переносятся как есть."}),(0,s.jsx)(r.xv,{p:!0,children:"Ну и не забываем, что нужно не только создать таблицы, но и заполнить их из реплики."}),(0,s.jsx)(t.Z,{code:"\n-- !!! Эти параметры настраиваются перед запуском !!!\n-- Имя оригинальной базы данных (реплики)\nDECLARE @originalDatabaseName sysname = 'BSL-ORIG';\n-- Имя адаптированной базы данных, где нужно создать объекты\nDECLARE @adaptiveDatabaseName sysname = 'BSL-COPY';\n\nDECLARE @tableName sysname;\nDECLARE tables_cursor CURSOR  \nFOR SELECT\n	[name]\nFROM SYSOBJECTS\nWHERE xtype = 'U'\n	-- Список обрабатываемых таблиц\n	AND [name] IN (\n		'V8Users',\n		'DBSchema',\n		'SchemaStorage',\n		'Params',\n		'Files',\n		'_FrmDtSettings',\n		'DepotFiles',\n		'IBVersion',\n		'Config',\n		'ConfigCAS',\n		'ConfigCASSave',\n		'ConfigSave',\n		'_UsersWorkHistory',\n		'_SystemSettings',\n		'_DynListSettings',\n		'_CommonSettings',\n		'_ExtensionsInfo',\n		'_ExtensionsInfoNGS',\n		'_ExtensionsRestruct',\n		'_ExtensionsRestructNGS',\n		'_YearOffset'\n	);\nOPEN tables_cursor;\n\nFETCH NEXT FROM tables_cursor INTO @tableName;\n\nWHILE @@FETCH_STATUS = 0  \nBEGIN\n	DECLARE @tableNameFull SYSNAME\n	SELECT @tableNameFull = 'dbo.' + @tableName\n\n	DECLARE \n		  @object_name SYSNAME\n		, @object_id INT\n\n	SELECT \n		  @object_name = '[' + s.name + '].[' + o.name + ']'\n		, @object_id = o.[object_id]\n	FROM sys.objects o WITH (NOWAIT)\n	JOIN sys.schemas s WITH (NOWAIT) ON o.[schema_id] = s.[schema_id]\n	WHERE s.name + '.' + o.name = @tableNameFull\n		AND o.[type] = 'U'\n		AND o.is_ms_shipped = 0;\n\n	DECLARE @SQL NVARCHAR(MAX) = '';	\n	DECLARE @SQLTRANSFER NVARCHAR(MAX) = '';	\n	\n\n	WITH index_column AS \n	(\n		SELECT \n			  ic.[object_id]\n			, ic.index_id\n			, ic.is_descending_key\n			, ic.is_included_column\n			, c.name\n		FROM sys.index_columns ic WITH (NOWAIT)\n		JOIN sys.columns c WITH (NOWAIT) ON ic.[object_id] = c.[object_id] AND ic.column_id = c.column_id\n		WHERE ic.[object_id] = @object_id\n	),\n	fk_columns AS \n	(\n		 SELECT \n			  k.constraint_object_id\n			, cname = c.name\n			, rcname = rc.name\n		FROM sys.foreign_key_columns k WITH (NOWAIT)\n		JOIN sys.columns rc WITH (NOWAIT) ON rc.[object_id] = k.referenced_object_id AND rc.column_id = k.referenced_column_id \n		JOIN sys.columns c WITH (NOWAIT) ON c.[object_id] = k.parent_object_id AND c.column_id = k.parent_column_id\n		WHERE k.parent_object_id = @object_id\n	)\n	SELECT @SQL = 'USE [' + CAST(@adaptiveDatabaseName as nvarchar(max)) + '];\n\n	IF EXISTS (SELECT * FROM SYSOBJECTS WHERE name=''' + CAST(@tableNameFull as nvarchar(max)) + ''' AND xtype=''U'')\n	BEGIN\n		DROP TABLE [dbo].[' + CAST(@tablename as nvarchar(max)) + '];\n	END\n		CREATE TABLE ' + @object_name + CHAR(13) + '(' + CHAR(13) + STUFF((\n		SELECT CHAR(9) + ', [' + c.name + '] ' + \n			CASE WHEN c.is_computed = 1\n				THEN 'AS ' + cc.[definition] \n				ELSE UPPER(tp.name) + \n					CASE WHEN tp.name IN ('varchar', 'char', 'varbinary', 'binary', 'text')\n						   THEN '(' + CASE WHEN c.max_length = -1 THEN 'MAX' ELSE CAST(c.max_length AS VARCHAR(5)) END + ')'\n						 WHEN tp.name IN ('nvarchar', 'nchar', 'ntext')\n						   THEN '(' + CASE WHEN c.max_length = -1 THEN 'MAX' ELSE CAST(c.max_length / 2 AS VARCHAR(5)) END + ')'\n						 WHEN tp.name IN ('datetime2', 'time2', 'datetimeoffset') \n						   THEN '(' + CAST(c.scale AS VARCHAR(5)) + ')'\n						 WHEN tp.name = 'decimal' \n						   THEN '(' + CAST(c.[precision] AS VARCHAR(5)) + ',' + CAST(c.scale AS VARCHAR(5)) + ')'\n						ELSE ''\n					END +\n					CASE WHEN c.collation_name IS NOT NULL THEN ' COLLATE ' + c.collation_name ELSE '' END +\n					CASE WHEN c.is_nullable = 1 THEN ' NULL' ELSE ' NOT NULL' END +\n					CASE WHEN dc.[definition] IS NOT NULL THEN ' DEFAULT' + dc.[definition] ELSE '' END + \n					CASE WHEN ic.is_identity = 1 THEN ' IDENTITY(' + CAST(ISNULL(ic.seed_value, '0') AS CHAR(1)) + ',' + CAST(ISNULL(ic.increment_value, '1') AS CHAR(1)) + ')' ELSE '' END \n			END + CHAR(13)\n		FROM sys.columns c WITH (NOWAIT)\n		JOIN sys.types tp WITH (NOWAIT) ON c.user_type_id = tp.user_type_id\n		LEFT JOIN sys.computed_columns cc WITH (NOWAIT) ON c.[object_id] = cc.[object_id] AND c.column_id = cc.column_id\n		LEFT JOIN sys.default_constraints dc WITH (NOWAIT) ON c.default_object_id != 0 AND c.[object_id] = dc.parent_object_id AND c.column_id = dc.parent_column_id\n		LEFT JOIN sys.identity_columns ic WITH (NOWAIT) ON c.is_identity = 1 AND c.[object_id] = ic.[object_id] AND c.column_id = ic.column_id\n		WHERE c.[object_id] = @object_id\n		ORDER BY c.column_id\n		FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, CHAR(9) + ' ')\n		+ ISNULL((SELECT CHAR(9) + ', CONSTRAINT [' + k.name + '] PRIMARY KEY (' + \n						(SELECT STUFF((\n							 SELECT ', [' + c.name + '] ' + CASE WHEN ic.is_descending_key = 1 THEN 'DESC' ELSE 'ASC' END\n							 FROM sys.index_columns ic WITH (NOWAIT)\n							 JOIN sys.columns c WITH (NOWAIT) ON c.[object_id] = ic.[object_id] AND c.column_id = ic.column_id\n							 WHERE ic.is_included_column = 0\n								 AND ic.[object_id] = k.parent_object_id \n								 AND ic.index_id = k.unique_index_id     \n							 FOR XML PATH(N''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, ''))\n				+ ')' + CHAR(13)\n				FROM sys.key_constraints k WITH (NOWAIT)\n				WHERE k.parent_object_id = @object_id \n					AND k.[type] = 'PK'), '') + ')'  + CHAR(13)\n		+ ISNULL((SELECT (\n			SELECT CHAR(13) +\n				 'ALTER TABLE ' + @object_name + ' WITH' \n				+ CASE WHEN fk.is_not_trusted = 1 \n					THEN ' NOCHECK' \n					ELSE ' CHECK' \n				  END + \n				  ' ADD CONSTRAINT [' + fk.name  + '] FOREIGN KEY(' \n				  + STUFF((\n					SELECT ', [' + k.cname + ']'\n					FROM fk_columns k\n					WHERE k.constraint_object_id = fk.[object_id]\n					FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '')\n				   + ')' +\n				  ' REFERENCES [' + SCHEMA_NAME(ro.[schema_id]) + '].[' + ro.name + '] ('\n				  + STUFF((\n					SELECT ', [' + k.rcname + ']'\n					FROM fk_columns k\n					WHERE k.constraint_object_id = fk.[object_id]\n					FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '')\n				   + ')'\n				+ CASE \n					WHEN fk.delete_referential_action = 1 THEN ' ON DELETE CASCADE' \n					WHEN fk.delete_referential_action = 2 THEN ' ON DELETE SET NULL'\n					WHEN fk.delete_referential_action = 3 THEN ' ON DELETE SET DEFAULT' \n					ELSE '' \n				  END\n				+ CASE \n					WHEN fk.update_referential_action = 1 THEN ' ON UPDATE CASCADE'\n					WHEN fk.update_referential_action = 2 THEN ' ON UPDATE SET NULL'\n					WHEN fk.update_referential_action = 3 THEN ' ON UPDATE SET DEFAULT'  \n					ELSE '' \n				  END \n				+ CHAR(13) + 'ALTER TABLE ' + @object_name + ' CHECK CONSTRAINT [' + fk.name  + ']' + CHAR(13)\n			FROM sys.foreign_keys fk WITH (NOWAIT)\n			JOIN sys.objects ro WITH (NOWAIT) ON ro.[object_id] = fk.referenced_object_id\n			WHERE fk.parent_object_id = @object_id\n			FOR XML PATH(N''), TYPE).value('.', 'NVARCHAR(MAX)')), '')\n		+ ISNULL(((SELECT\n			 CHAR(13) + 'CREATE' + CASE WHEN i.is_unique = 1 THEN ' UNIQUE' ELSE '' END \n					+ ' NONCLUSTERED INDEX [' + i.name + '] ON ' + @object_name + ' (' +\n					STUFF((\n					SELECT ', [' + c.name + ']' + CASE WHEN c.is_descending_key = 1 THEN ' DESC' ELSE ' ASC' END\n					FROM index_column c\n					WHERE c.is_included_column = 0\n						AND c.index_id = i.index_id\n					FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '') + ')'  \n					+ ISNULL(CHAR(13) + 'INCLUDE (' + \n						STUFF((\n						SELECT ', [' + c.name + ']'\n						FROM index_column c\n						WHERE c.is_included_column = 1\n							AND c.index_id = i.index_id\n						FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '') + ')', '')  + CHAR(13)\n			FROM sys.indexes i WITH (NOWAIT)\n			WHERE i.[object_id] = @object_id\n				AND i.is_primary_key = 0\n				AND i.[type] = 2\n			FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)')\n		), '')\n\n\n\n	SELECT\n		@SQLTRANSFER = \n	N'USE [' + CAST(@adaptiveDatabaseName as nvarchar(max)) + '];\n\n	DELETE FROM [' + CAST(@adaptiveDatabaseName as nvarchar(max)) + '].[dbo].[' + CAST(@tablename as nvarchar(max)) + '];\n\n	INSERT INTO [' + CAST(@adaptiveDatabaseName as nvarchar(max)) + '].[dbo].[' + CAST(@tablename as nvarchar(max)) + '] \n	(' + \n	STUFF(\n	(SELECT N',' + c.name\n	FROM\n		sys.columns AS c\n		INNER JOIN sys.types tp ON tp.system_type_id = c.system_type_id AND tp.user_type_id = c.user_type_id\n	WHERE \n		c.OBJECT_ID = OBJECT_ID(@tableNameFull)\n		AND NOT tp.name = 'timestamp'\n	ORDER BY\n		column_id\n	FOR XML PATH(''), TYPE).value('.',N'nvarchar(max)')\n	,1,1,N'')\n	+ N') \n	SELECT \n	' + \n	STUFF(\n	(SELECT N',' + c.name\n	FROM\n		sys.columns AS c\n		INNER JOIN sys.types tp ON tp.system_type_id = c.system_type_id AND tp.user_type_id = c.user_type_id\n	WHERE \n		c.OBJECT_ID = OBJECT_ID(@tableNameFull)\n		AND NOT tp.name = 'timestamp'\n	ORDER BY\n		column_id\n	FOR XML PATH(''), TYPE).value('.',N'nvarchar(max)')\n	,1,1,N'')\n	+ N'\n	FROM [' + CAST(@originalDatabaseName as nvarchar(max)) + '].[dbo].[' + CAST(@tablename as nvarchar(max)) + '];\n\n	';\n\n	-- Выполняем команды создания объектов в контексте адаптированной базы данных\n	EXECUTE sp_executesql @SQL\n	-- Затем переносим данные из исходной таблицы в созданную\n	EXECUTE sp_executesql @SQLTRANSFER\n\n	FETCH NEXT FROM tables_cursor INTO @tableName;\nEND\nCLOSE tables_cursor;  \nDEALLOCATE tables_cursor;\n                ",className:"my-5",language:"sql"}),(0,s.jsx)(r.xv,{p:!0,children:"По факту эта команда создает таблицы из оригинальной реплики (по структуре), переносит туда данные. Индексы, конечно, также переносятся."}),(0,s.jsx)(r.xv,{subtitle:!0,className:"mt-10 md:text",children:"3. Создаем представления, ссылающиеся на оригинальные таблицы из реплики"}),(0,s.jsx)(r.xv,{p:!0,children:"Этот шаг может казаться простым, но на самом деле нет!"}),(0,s.jsx)(r.xv,{p:!0,children:"Создать представление, которое ссылается на оригинальную таблицу базы не сложно. Но мы пойдем дальше и сделаем защиту, чтобы при вставке новых значений, удалении или обновлении существующих - SQL Server ничего не делал. Да, он сделает вид, что выполнил операцию и вернет платформе сигнал об успехе, но по факту ничего не произойдет."}),(0,s.jsx)(r.xv,{p:!0,children:"Это позволит избежать множества ошибок при запуске клиента 1С, т.к. современные конфигурации при запуске выполняют множество операций записи в базу данных, обновления каких-либо наборов регистра сведений и так далее. Иначе пришлось бы вносить изменения в программный код 1С, а мы этого попытаемся максимально избежать."}),(0,s.jsxs)(r.xv,{p:!0,children:["Да, последнее не всегда сработает! Например, если с такой защитой попытаться записать НОВЫЙ документ, то возникнет ошибка SDBL. Но это уже мелочи, потому что вряд ли кто-то записывает документы при запуске клиента или при формировании отчетов. Правда ведь, Вы не из этих людей? ",":)"]}),(0,s.jsx)(r.xv,{p:!0,children:"Сам скрипт нужно запускать в контексте оригинальной реплики. Не забудьте обновить параметры."}),(0,s.jsx)(t.Z,{code:"\n-- !!! Эти параметры настраиваются перед запуском !!!\n-- Имя оригинальной базы данных (реплики)\nDECLARE @originalDatabaseName sysname = 'BSL-ORIG';\n-- Имя адаптированной базы данных, где нужно создать объекты\nDECLARE @adaptiveDatabaseName sysname = 'BSL-COPY';\n\nDECLARE @dropView nvarchar(max);\nDECLARE @createView nvarchar(max);\nDECLARE @createTriggerInsteadOfInsert nvarchar(max);\nDECLARE @createTriggerInsteadOfUpdate nvarchar(max);\nDECLARE @createTriggerInsteadOfDelete nvarchar(max);\nDECLARE @dropTriggerInsteadOfInsert nvarchar(max);\nDECLARE @dropTriggerInsteadOfUpdate nvarchar(max);\nDECLARE @dropTriggerInsteadOfDelete nvarchar(max);\n\nDECLARE cmds CURSOR FOR\nSELECT\n-- Удаление существующих представлений\nN'USE [' + CAST(@adaptiveDatabaseName as nvarchar(max)) + '];\nIF EXISTS(\n	SELECT 1 FROM sys.objects \n	WHERE name = N''' + t.name + N''' AND type = N''V'') \nBEGIN \n	DROP VIEW [' + t.name + '] \nEND' AS [DropViewIfExistCommand],\n\n-- Создание представления\nN'CREATE VIEW [' + t.name + N'] \nAS \nSELECT \n	' + \nSTUFF(\n(SELECT N',' + c.name\nFROM\n	sys.columns AS c\nWHERE \n	c.OBJECT_ID = t.OBJECT_ID\nORDER BY\n	column_id\nFOR XML PATH(''), TYPE).value('.',N'nvarchar(max)')\n,1,1,N'')\n+ N' \nFROM [' + CAST(@originalDatabaseName as nvarchar(max)) + '].[dbo].[' + t.name + N'];\n' AS [CreateViewCommand],\n\n-- Создание триггера запрета вставки значений\nN'CREATE TRIGGER [dbo].[read_only_' + t.name + N'_insert]\n   ON  [dbo].[' + t.name + N']\n   INSTEAD OF INSERT\nAS \nBEGIN\n	SET NOCOUNT ON;\n	\n    -- При добавлении ничего не выполняем\nEND\n' AS [CreateTriggerBreakInsertCommand],\n\n-- Удалить триггер запрета вставки значений, если существует\nN'DROP TRIGGER IF EXISTS [read_only_' + t.name + N'_insert];' AS [DropTriggerIfExistBreakInsertCommand],\n\n-- Создание триггера запрета обновления значений\nN'CREATE TRIGGER [dbo].[read_only_' + t.name + N'_update]\n   ON  [dbo].[' + t.name + N']\n   INSTEAD OF UPDATE\nAS \nBEGIN\n	SET NOCOUNT ON;\n\n    -- При обновлении ничего не выполняем\nEND\n' AS [CreateTriggerBreakUpdateCommand],\n\n-- Удалить триггер запрета вставки значений, если существует\nN'USE [' + CAST(@adaptiveDatabaseName as nvarchar(max)) + '];\nDROP TRIGGER IF EXISTS [read_only_' + t.name + N'_update];' AS [DropTriggerIfExistBreakUpdateCommand],\n\n-- Создание триггера запрета удаления значений\nN'CREATE TRIGGER [dbo].[read_only_' + t.name + N'_delete]\n   ON  [dbo].[' + t.name + N']\n   INSTEAD OF DELETE\nAS \nBEGIN\n	SET NOCOUNT ON;\n\n    -- При удалении ничего не выполняем\nEND\n' AS [CreateTriggerBreakDeleteCommand],\n\n-- Удалить триггер запрета вставки значений, если существует\nN'DROP TRIGGER IF EXISTS [read_only_' + t.name + N'_delete];' AS [DropTriggerIfExistBreakDeleteCommand]\n\nFROM sys.tables AS t\n-- Исключаем список таблиц, которые были перенесены \"как есть\"\nWHERE NOT t.[name] IN (\n		'V8Users',\n		'DBSchema',\n		'SchemaStorage',\n		'Params',\n		'Files',\n		'_FrmDtSettings',\n		'DepotFiles',\n		'IBVersion',\n		'Config',\n		'ConfigCAS',\n		'ConfigCASSave',\n		'ConfigSave',\n		'_UsersWorkHistory',\n		'_SystemSettings',\n		'_DynListSettings',\n		'_CommonSettings',\n		'_ExtensionsInfo',\n		'_ExtensionsInfoNGS',\n		'_ExtensionsRestruct',\n		'_ExtensionsRestructNGS',\n		'_YearOffset'\n);\nOPEN cmds;\n\nFETCH NEXT FROM cmds INTO @dropView, @createView, \n	@createTriggerInsteadOfInsert, @dropTriggerInsteadOfInsert,\n	@createTriggerInsteadOfUpdate, @dropTriggerInsteadOfUpdate,\n	@createTriggerInsteadOfDelete, @dropTriggerInsteadOfDelete;\n\nWHILE @@FETCH_STATUS = 0  \nBEGIN\n	\n	declare @currentCmd nvarchar(max);\n\n	-- Удаление существующего представления\n	SET @currentCmd =\n'declare @textCmd nvarchar(max) = CAST('' ' + CAST(REPLACE(@dropView,'''','''''') as nvarchar(max)) + ' '' as nvarchar(max));\nEXECUTE [' + CAST(@adaptiveDatabaseName as nvarchar(max)) + '].[sys].sp_executesql @textCmd'\n	EXECUTE sp_executesql @currentCmd\n\n	-- Создание представления\n	SET @currentCmd =\n'declare @textCmd nvarchar(max) = CAST('' ' + CAST(REPLACE(@createView,'''','''''') as nvarchar(max)) + ' '' as nvarchar(max));\nEXECUTE [' + CAST(@adaptiveDatabaseName as nvarchar(max)) + '].[sys].sp_executesql @textCmd'\n	EXECUTE sp_executesql @currentCmd\n\n	-- Создание защиты от вставки новых значений\n	SET @currentCmd =\n'declare @textCmd nvarchar(max) = CAST('' ' + CAST(REPLACE(@dropTriggerInsteadOfInsert,'''','''''') as nvarchar(max)) + ' '' as nvarchar(max));\nEXECUTE [' + CAST(@adaptiveDatabaseName as nvarchar(max)) + '].[sys].sp_executesql @textCmd'\n	EXECUTE sp_executesql @currentCmd\n\n	SET @currentCmd =\n'declare @textCmd nvarchar(max) = CAST('' ' + CAST(REPLACE(@createTriggerInsteadOfInsert,'''','''''') as nvarchar(max)) + ' '' as nvarchar(max));\nEXECUTE [' + CAST(@adaptiveDatabaseName as nvarchar(max)) + '].[sys].sp_executesql @textCmd'\n	EXECUTE sp_executesql @currentCmd\n	\n	-- Создание защиты от изменения данных\n	SET @currentCmd =\n'declare @textCmd nvarchar(max) = CAST('' ' + CAST(REPLACE(@dropTriggerInsteadOfUpdate,'''','''''') as nvarchar(max)) + ' '' as nvarchar(max));\nEXECUTE [' + CAST(@adaptiveDatabaseName as nvarchar(max)) + '].[sys].sp_executesql @textCmd'\n	EXECUTE sp_executesql @currentCmd\n\n	SET @currentCmd =\n'declare @textCmd nvarchar(max) = CAST('' ' + CAST(REPLACE(@createTriggerInsteadOfUpdate,'''','''''') as nvarchar(max)) + ' '' as nvarchar(max));\nEXECUTE [' + CAST(@adaptiveDatabaseName as nvarchar(max)) + '].[sys].sp_executesql @textCmd'\n	EXECUTE sp_executesql @currentCmd\n\n	-- Создание защиты от удаления данных\n	SET @currentCmd =\n'declare @textCmd nvarchar(max) = CAST('' ' + CAST(REPLACE(@dropTriggerInsteadOfDelete,'''','''''') as nvarchar(max)) + ' '' as nvarchar(max));\nEXECUTE [' + CAST(@adaptiveDatabaseName as nvarchar(max)) + '].[sys].sp_executesql @textCmd'\n	EXECUTE sp_executesql @currentCmd\n\n	SET @currentCmd =\n'declare @textCmd nvarchar(max) = CAST('' ' + CAST(REPLACE(@createTriggerInsteadOfDelete,'''','''''') as nvarchar(max)) + ' '' as nvarchar(max));\nEXECUTE [' + CAST(@adaptiveDatabaseName as nvarchar(max)) + '].[sys].sp_executesql @textCmd'\n	EXECUTE sp_executesql @currentCmd\n\n	FETCH NEXT FROM cmds INTO @dropView, @createView, \n		@createTriggerInsteadOfInsert, @dropTriggerInsteadOfInsert,\n		@createTriggerInsteadOfUpdate, @dropTriggerInsteadOfUpdate,\n		@createTriggerInsteadOfDelete, @dropTriggerInsteadOfDelete;\nEND\nCLOSE cmds;  \nDEALLOCATE cmds;\n                ",className:"my-5",language:"sql"}),(0,s.jsx)(r.xv,{title:!0,className:"mt-10 md:text",children:"Готовность №1"}),(0,s.jsx)(r.xv,{p:!0,children:"Готово! Наша “заглушка” реплики готова для использования."}),(0,s.jsx)(r.Ee,{className:"my-4",src:"/public/imp_assets/SQLServer/2022-04/read-only-copy-for-1c/2. Реплика настроена.png",alt:"Реплика настроена",size:i.h2.MEDIUM}),(0,s.jsx)(r.xv,{p:!0,children:"Все аналогичные действия как-раз выполняются инструментом “Мастер создания копии информационной базы для отчетности”, который Вы можете использовать в качестве шаблона для своей разработки."}),(0,s.jsx)(r.xv,{p:!0,children:"Попробуем в ней поработать."}),(0,s.jsx)(r.xv,{title:!0,className:"mt-10 md:text",children:"Тестовый запуск"}),(0,s.jsx)(r.xv,{p:!0,children:"Добавим в кластер 1С информационную базу, которая будет ссылаться на нашу “базу-заглушку”. Запускаем тонкий клиент и … барабанная дробь!"}),(0,s.jsx)(r.Ee,{className:"my-4",src:"/public/imp_assets/SQLServer/2022-04/read-only-copy-for-1c/3. Тестовый запуск!.gif",alt:"Тестовый запуск!",size:i.h2.MEDIUM}),(0,s.jsx)(r.xv,{p:!0,children:"Клиентское приложение запустилось без ошибок! Мы даже “походили” по разделам и некоторым объектам. Попробуем изменить какие-нибудь данные."}),(0,s.jsx)(r.Ee,{className:"my-4",src:"/public/imp_assets/SQLServer/2022-04/read-only-copy-for-1c/4. Работа с записью в базу.gif",alt:"Работа с записью в базу",size:i.h2.MEDIUM}),(0,s.jsx)(r.xv,{p:!0,children:"И ничего не произошло, наша защита изменений отработала! Сформируем какой-нибудь отчет для очистки совести."}),(0,s.jsx)(r.Ee,{className:"my-4",src:"/public/imp_assets/SQLServer/2022-04/read-only-copy-for-1c/5. Формируем отчет на копии.gif",alt:"Формируем отчет на копии",size:i.h2.MEDIUM}),(0,s.jsx)(r.xv,{p:!0,children:"Дело сделано!"}),(0,s.jsx)(r.xv,{title:!0,className:"mt-10 md:text",children:"Вместо заключения"}),(0,s.jsx)(r.xv,{p:!0,children:"В самом начале мы говорили про монолиты и решения проблем производительности в них. С помощью таких копий баз данных мы можем выполнять горизонтальное масштабирование базы за счет новых серверов. И это прекрасно! Наверное."}),(0,s.jsx)(r.xv,{p:!0,children:"Теперь мы можем использовать базы 1С в режиме “только для чтения” в привычном режиме, запускать клиентов 1С туда. Что это значит:"}),(0,s.jsxs)(r.aV,{children:[(0,s.jsx)("li",{children:"Можно создавать копии баз на других серверах и переносить туда работу пользователей, которые не изменяют данные в базе. Как побочный эффект мы получим защиту от изменения данных. Для аудиторов, например, отличный вариант."}),(0,s.jsx)("li",{children:"Можно опубликовать такую базу на веб-сервере, добавить необходимые веб-сервисы или HTTP-сервисы и через них получать данные для использования в основной базе. Таким образом можно организовать масштабирование системы."}),(0,s.jsx)("li",{children:"Данный подход может работать на любой версии платформы 1С от версии 8.0 до последних релизов. На скриншотах выше все примеры сделаны на 8.3.20.1710."}),(0,s.jsx)("li",{children:"Срабатывание защиты от изменений может вызвать непонимание пользователей, ведь никаких сообщений им не выводится. Поэтому рекомендуется сделать изменение прав доступа пользователям в копии так, чтобы само редактирование не было доступно срадствами платформы 1С. Плюс изменить заголовок приложения, чтобы было понятно, что это копия."}),(0,s.jsxs)("li",{children:["Не забудьте отключить регламентные задания в копии базы. Если они там не нужны явно ",":)"]})]}),(0,s.jsx)(r.Ee,{className:"my-4",src:"/public/imp_assets/SQLServer/2022-04/read-only-copy-for-1c/6. Пример распределенных реплик.png",alt:"Пример распределенных реплик",size:i.h2.MEDIUM}),(0,s.jsx)(r.xv,{p:!0,children:"Можно придумать также множество нестандартных применений для такой работы с базой:"}),(0,s.jsxs)(r.aV,{children:[(0,s.jsx)("li",{children:"В базе-заглушке можно создавать представления СУБД с понятными наименованиями, которые будут ссылаться на таблицы реплики. Интеграция таких инструментов как PowerBI теперь не потребуют обращения к оперативной базе данных."}),(0,s.jsx)("li",{children:"Так как таблицы конфигурации в базе-заглушке доступны для изменения, то можно в такой базе обновить конфигурацию, если изменения не влияют на структуру данных. То есть можно обновлять конфигурацию и проверять работу еще до применения изменений на основной базе."}),(0,s.jsxs)("li",{children:["Если используется AlwaysOn, то можно использовать ",(0,s.jsx)("b",{children:(0,s.jsx)("u",{children:(0,s.jsx)(r.e9,{newTab:!0,href:"https://learn.microsoft.com/en-us/sql/relational-databases/databases/database-snapshots-sql-server?view=sql-server-ver16",children:"снапшоты в реплике на определенные моменты времени"})})}),". Тогда можно получить копии базы на утро, например, и работать с ними. Может быть полезно, если людям нужна стабильная версия данных на момент времени для сбора отчетности. А пересоздавая снапшот в режиме скользящего окна, можно каждый день иметь актуальный срез базы данных на определенный момент времени."]}),(0,s.jsxs)("li",{children:["Если стоит задача создания копий распределенных, например в разных городах, то можно создать реплику с помощью ",(0,s.jsx)("b",{children:(0,s.jsx)("u",{children:(0,s.jsx)(r.e9,{newTab:!0,href:"https://github.com/YPermitin/SQLServerTools/blob/master/SQL-Server-AlwaysOn/SQL%20Server%20AlwaysOn/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0%20%D1%80%D0%B0%D1%81%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D0%B5%D0%BD%D0%BD%D1%8B%D1%85%20%D0%B3%D1%80%D1%83%D0%BF%D0%BF%20%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BD%D0%BE%D1%81%D1%82%D0%B8%20AlwaysOn.md",children:"распределенной группы доступности AlwaysOn"})})})," в отделенной точке и сделать для нее базу-заглушку. Так люди географически отдаленные от основной базы смогут работать с ней максимально эффективно. Смотрите схему выше, теперь это возможно и с информационными базами 1С."]}),(0,s.jsxs)("li",{children:["В примерах мы используем SQL Server, но все справедливо и для PostgreSQL со своими нюансами. О последнем примеров не планирую. У кого “красные глаза”, тот сам знает, как это все организовать по аналогии ",":)"]}),(0,s.jsx)("li",{children:"И много других применений."})]}),(0,s.jsx)(r.xv,{p:!0,children:"Есть ли какие-то минусы у этого подхода? Конечно! Усложнение сопровождения и необходимость в понимании работы СУБД. Если Вы не хотите выходить из зоны комфорта 1С, то это явно не для Вас."}),(0,s.jsx)(r.xv,{p:!0,children:"Почему не сделать платный / готовый инструмент, который упростит настройку и создание таких копий баз? Мне это не интересно. Организация поддержки и консультаций - это не мое. Но вся информация теперь есть у Вас, действуйте!"}),(0,s.jsx)(r.xv,{p:!0,children:"Спасибо, что дочитали до конца. Удачи в делах и хорошего настроения! Вперед к свершениям!"})]})},12250:function(e,n,a){"use strict";var s,r;a.d(n,{b:function(){return s}}),(r=s||(s={})).Min="350px",r.Standard="700px",r.Large="1000x",r.Unlimited=""},13803:function(e,n,a){"use strict";var s=a(37340),r=a(85893),t=a(67294),i=a(14965),c=a(54951),l=a(41686),E=a(12250);function d(){let e=(0,s._)(["\n        text-align: left;\n        overflow: hidden;\n        font-size: 14px;\n        border-radius: 6px;\n        overflow: auto;\n\n        & .token-line {\n            line-height: 1.3em;\n            height: 1.3em;\n        }\n    "]);return d=function(){return e},e}function m(){let e=(0,s._)(["\n        max-height: ","\n    "]);return m=function(){return e},e}n.Z=e=>{let{code:n,className:s,language:x,maxHeight:o=E.b.Standard}=e;(void 0!==a.g?a.g:window).Prism=i.p1,a(61354),a(79016),a(2731),a(35266),a(92927),a(51315),a(57874),a(86862);let S=null!=o?o:E.b.Standard,T=l.ZP.pre(d()),N=(0,l.ZP)(T)(m(),S);return(0,r.jsx)("div",{className:(0,c.GF)("bg-blue-500 md:p-1 p-2",s),children:(0,r.jsx)("div",{className:"shadow-lg",children:(0,r.jsx)(i.y$,{theme:i.np.vsDark,code:n.trim(),language:null!=x?x:x="tsx",children:e=>{let{className:n,style:a,tokens:s,getLineProps:i,getTokenProps:c}=e;return(0,r.jsx)(N,{className:n,style:a,children:s.map((e,n)=>(0,t.createElement)("div",{...i({line:e,key:n}),key:Math.random()},e.map((e,n)=>(0,t.createElement)("span",{...c({token:e,key:n}),key:Math.random()}))))})}})})})}},97037:function(e,n,a){"use strict";a.d(n,{Ee:function(){return c},Xg:function(){return t},Y7:function(){return m},aV:function(){return E},e9:function(){return d},o_:function(){return x},tf:function(){return o},ty:function(){return l},xv:function(){return i}});var s=a(5152),r=a.n(s);let t=r()(()=>Promise.all([a.e(549),a.e(4738),a.e(4838),a.e(1664),a.e(1274)]).then(a.bind(a,91274)),{loadableGenerated:{webpack:()=>[91274]}}),i=r()(()=>Promise.all([a.e(4454),a.e(7897)]).then(a.bind(a,97897)),{loadableGenerated:{webpack:()=>[97897]}}),c=r()(()=>Promise.all([a.e(3536),a.e(2726)]).then(a.bind(a,2726)),{loadableGenerated:{webpack:()=>[2726]}}),l=r()(()=>Promise.all([a.e(549),a.e(378)]).then(a.bind(a,90378)),{loadableGenerated:{webpack:()=>[90378]}}),E=r()(()=>Promise.all([a.e(9300),a.e(7200)]).then(a.bind(a,7200)),{loadableGenerated:{webpack:()=>[7200]}}),d=r()(()=>Promise.all([a.e(1664),a.e(8681)]).then(a.bind(a,28681)),{loadableGenerated:{webpack:()=>[28681]}});r()(()=>a.e(2857).then(a.bind(a,22857)),{loadableGenerated:{webpack:()=>[22857]}});let m=r()(()=>Promise.all([a.e(2004),a.e(3070)]).then(a.bind(a,63070)),{loadableGenerated:{webpack:()=>[63070]}}),x=r()(()=>Promise.all([a.e(162),a.e(3959),a.e(6050),a.e(239),a.e(727)]).then(a.bind(a,32215)),{loadableGenerated:{webpack:()=>[32215]}}),o=r()(()=>Promise.all([a.e(162),a.e(1664),a.e(3959),a.e(6050),a.e(4205)]).then(a.bind(a,84205)),{loadableGenerated:{webpack:()=>[84205]}})}},function(e){e.O(0,[4104,2888,9774,179],function(){return e(e.s=54546)}),_N_E=e.O()}]);