(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9810],{73204:function(e,n,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/DevOps/2022-05/install-valheim-server-ubuntu-20-04",function(){return s(50480)}])},50480:function(e,n,s){"use strict";s.r(n);var l=s(85893),i=s(44853);s(67294);var r=s(37547),a=s(93218),d=s(44877),t=s(42967),c=s(47168),h=s(78148),x=s(74313);n.default=()=>(0,l.jsxs)(i.Xg,{blogcentered:!0,children:[(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Настройка портов"}),(0,l.jsx)(i.xv,{p:!0,children:"Должны быть открыты порты по UDP:"}),(0,l.jsx)(x.Z,{code:"\n2456 2457 2458 27060\n                ",className:"my-5",language:"text"}),(0,l.jsx)(i.xv,{p:!0,children:"При использовании UFW (Uncomplicated Firewall) делаем так:"}),(0,l.jsx)(x.Z,{code:"\nsudo ufw allow 2456/udp\nsudo ufw allow 2457/udp\nsudo ufw allow 2458/udp\nsudo ufw allow 27060/udp\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Подготовка операционной системы"}),(0,l.jsx)(i.xv,{p:!0,children:"Некоторые шаги для общей настройки сервера."}),(0,l.jsx)(i.xv,{subtitle:!0,className:"mt-10 md:text",children:"Настройка часового пояса"}),(0,l.jsx)(i.xv,{p:!0,children:"Первым делом проверяем текущую дату и время, а также часовой пояс на сервере."}),(0,l.jsx)(x.Z,{code:"\ntimedatectl\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"При необходимости меняем часовой пояс, чтобы он больше подходил для клиентов сервера."}),(0,l.jsx)(x.Z,{code:"\nsudo timedatectl set-timezone Europe/Moscow\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Список всех доступных часовых поясов смотрим здесь так."}),(0,l.jsx)(x.Z,{code:"\ntimedatectl list-timezones\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{subtitle:!0,className:"mt-10 md:text",children:"Установка обновлений"}),(0,l.jsx)(i.xv,{p:!0,children:"Тут все стандартно. Проверяем наличие обновлений пакетов и устанавливаем обновления."}),(0,l.jsx)(x.Z,{code:"\nsudo apt update\nsudo apt upgrade\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Установка Valheim Server"}),(0,l.jsx)(i.xv,{p:!0,children:"Для установки воспользуемся проектом LinuxGSM. Сначала нам нужно установить все необходимые компоненты."}),(0,l.jsx)(x.Z,{code:"\nsudo dpkg --add-architecture i386; sudo apt update; sudo apt install curl wget file tar bzip2 gzip unzip bsdmainutils python util-linux ca-certificates binutils bc jq tmux netcat lib32gcc1 lib32stdc++6 steamcmd\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(x.Z,{code:"\nsudo apt remove --purge nodejs npm\ncurl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -\nsudo apt update && sudo apt install -y nodejs\nnpm install gamedig -g\nsudo npm install gamedig -g\nsudo npm update -g\nsudo npm list -g gamedig\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Переходим в каталог пользователя, от которого будет работать сервер, и создаем каталог для файлов приложения."}),(0,l.jsx)(x.Z,{code:"\ncd /home/<username>\nmkdir linuxgsm\ncd linuxgsm\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"После этого запускаем непосредственно установку сервера Valheim."}),(0,l.jsx)(x.Z,{code:"\nwget -O linuxgsm.sh https://linuxgsm.sh && chmod +x linuxgsm.sh && bash linuxgsm.sh vhserver\n./vhserver install\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Готово!"}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Настройка сервера Valheim"}),(0,l.jsx)(i.xv,{p:!0,children:"Переходим в каталог с файлами конфигурации сервера."}),(0,l.jsx)(x.Z,{code:"\ncd ~/lgsm/config-lgsm/vhserver\nls\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Делаем бэкап текущего файла конфигурации и заменяем конфигурацию стандартной."}),(0,l.jsx)(x.Z,{code:"\nmv common.cfg common.cfg.old\ncp _default.cfg common.cfg\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Далее открываем файл конфигурации в любимом редакторе и меняем его под себя."}),(0,l.jsx)(x.Z,{code:"\nmcedit common.cfg\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Настройки, которые нужно поменять в первую очередь:"}),(0,l.jsxs)(i.aV,{children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"servername"})," - имя сервера."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"serverpassword"})," - пароль для входа на сервер."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"port"})," - порт сервера. По умолчанию 2456."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"gameworld"})," - имя игрового мира. По умолчанию совпадает с именем сервера."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"public"})," - поставить 1, если сервер должен быть виден сообществу."]})]}),(0,l.jsx)(i.xv,{p:!0,children:"И некоторые необязательные настройки:"}),(0,l.jsxs)(i.aV,{children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"stats"})," - позволить собирать статистику использования проекту LinuxGSM."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"updateonstart"})," - обновление сервера при старте. Рекомендую включить."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"Alert settings"})," - настройка уведомлений о событиях сервера, в т.ч. в Телеграм. Смотрите официальную документацию по каждому каналу доставки сообщений."]})]}),(0,l.jsxs)(i.xv,{p:!0,children:["Также обратить внимание на настройки бэкапирования. ",(0,l.jsx)("b",{children:(0,l.jsx)("u",{children:(0,l.jsx)(i.e9,{newTab:!0,href:"https://docs.linuxgsm.com/",children:"Подробная информация в официальной документации."})})})]}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Настройка запуска сервера"}),(0,l.jsx)(i.xv,{p:!0,children:"Для автоматического запуска игрового сервера воспользуемся возможностями systemd."}),(0,l.jsx)(x.Z,{code:"\nsudo mcedit /etc/systemd/system/vhserver.service\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Файл должен иметь примерно такое содержимое (поправьте пути к файлам искриптам)."}),(0,l.jsx)(x.Z,{code:"\n[Unit]\nDescription=LinuxGSM Valheim Server\nAfter=network-online.target\nWants=network-online.target\n\n[Service]\nType=forking\nUser=<user>\nWorkingDirectory=/home/<user>/linuxgsm\nRemainAfterExit=yes \nExecStart=/home/<user>/linuxgsm/vhserver start\nExecStop=/home/<user>/linuxgsm/vhserver stop\nRestart=no\n\n[Install]\nWantedBy=multi-user.target\n                ",className:"my-5",language:"text"}),(0,l.jsx)(i.xv,{p:!0,children:"Замените нужным значением, т.е. именем пользователя, от которого будет работать игровой сервер."}),(0,l.jsx)(i.xv,{p:!0,children:"После этого обновляем настройки systemd и включаем службу."}),(0,l.jsx)(x.Z,{code:"\nsudo systemctl daemon-reload\nsudo systemctl enable vhserver.service\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Теперь сервер запускается автоматически!"}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Бэкапирование"}),(0,l.jsx)(i.xv,{p:!0,children:"Для выполнения бэкапа сервера достаточно выполнить команду."}),(0,l.jsx)(x.Z,{code:"\n/home/user/linuxgsm/vhserver backup\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Сервер будет остановлен и все файлы будут сохранены в архив по адресу “/home/user/linuxgsm/lgsm/backup”. Далее можно отправлять их в облако для надежности."}),(0,l.jsx)(i.xv,{p:!0,children:"Есть нюанс! По умолчанию файлы игрокового мира находятся вне каталога сервера Valheim. Если сам сервер мы установили в “/home/user/linuxgsm”, то файлы игрового мира находятся в “/home/user/.config/unity3d/IronGate/Valheim/worlds”."}),(0,l.jsx)(i.xv,{p:!0,children:"Рекомендую остановить сервер, переместить каталог “/home/user/.config/unity3d” в “/home/user/linuxgsm/unity3d”, а в файле “/home/user/linuxgsm/lgsm/config-lgsm/vhserver/common.cfg” изменить параметр “savedir” на новое значение."}),(0,l.jsx)(i.xv,{p:!0,children:"После запустить сервер. Тогда бэкап игрового сервера будет включать и файлы игрового мира."}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Уведомления о действиях на сервере"}),(0,l.jsx)(i.xv,{p:!0,children:"Можно настроить уведомления в Telegram-канал о действиях на сервере:"}),(0,l.jsxs)(i.aV,{children:[(0,l.jsx)("li",{children:"Вход/выход пользователя на сервер"}),(0,l.jsx)("li",{children:"Респаун игроков"}),(0,l.jsx)("li",{children:"Смерть игроков"}),(0,l.jsx)("li",{children:"Событие общего сна на сервере, когда ночное время пропускается."}),(0,l.jsx)("li",{children:(0,l.jsx)("b",{children:(0,l.jsx)("u",{children:(0,l.jsx)(i.e9,{newTab:!0,href:"https://valheim.fandom.com/wiki/Events",children:"Случайные события."})})})}),(0,l.jsx)("li",{children:"Запуск сервера"}),(0,l.jsx)("li",{children:"Остановка сервера"})]}),(0,l.jsxs)(i.xv,{p:!0,children:["Для этого воспользуйтесь проектом ",(0,l.jsx)("b",{children:(0,l.jsx)("u",{children:(0,l.jsx)(i.e9,{newTab:!0,href:"https://github.com/Whiskey24/valheim-notify",children:"valheim-notify"})})})," от ",(0,l.jsx)("b",{children:(0,l.jsx)("u",{children:(0,l.jsx)(i.e9,{newTab:!0,href:"https://github.com/Whiskey24",children:"Whiskey24"})})}),"."]}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Команды сервера"}),(0,l.jsx)(i.xv,{p:!0,children:"Только администраторы сервера могут запускать эти команды."}),(0,l.jsxs)(r.b,{"aria-label":"Команды сервера Valheim",children:[(0,l.jsxs)(a.J,{children:[(0,l.jsx)(d.j,{children:"Command"}),(0,l.jsx)(d.j,{children:"Args"}),(0,l.jsx)(d.j,{children:"Description"})]}),(0,l.jsxs)(t.y,{children:[(0,l.jsxs)(c.g,{children:[(0,l.jsx)(h.X,{children:"help"}),(0,l.jsx)(h.X,{children:" "}),(0,l.jsx)(h.X,{children:"Список всех доступных команд"})]},"1"),(0,l.jsxs)(c.g,{children:[(0,l.jsx)(h.X,{children:"kick"}),(0,l.jsx)(h.X,{children:"name/ip/userID"}),(0,l.jsx)(h.X,{children:"Отключить пользователя"})]},"2"),(0,l.jsxs)(c.g,{children:[(0,l.jsx)(h.X,{children:"ban"}),(0,l.jsx)(h.X,{children:"name/ip/userID"}),(0,l.jsx)(h.X,{children:"Забанить пользователя"})]},"3"),(0,l.jsxs)(c.g,{children:[(0,l.jsx)(h.X,{children:"unban"}),(0,l.jsx)(h.X,{children:"/ip/userID"}),(0,l.jsx)(h.X,{children:"Отменить бан пользователя"})]},"4"),(0,l.jsxs)(c.g,{children:[(0,l.jsx)(h.X,{children:"banned"}),(0,l.jsx)(h.X,{children:" "}),(0,l.jsx)(h.X,{children:"Список забаненых пользователей"})]},"5"),(0,l.jsxs)(c.g,{children:[(0,l.jsx)(h.X,{children:"ping"}),(0,l.jsx)(h.X,{children:" "}),(0,l.jsx)(h.X,{children:"Проверить пинг сервера для диагностики задержек"})]},"6"),(0,l.jsxs)(c.g,{children:[(0,l.jsx)(h.X,{children:"info"}),(0,l.jsx)(h.X,{children:" "}),(0,l.jsx)(h.X,{children:"Системная информация"})]},"7")]})]}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Полезные ссылки"}),(0,l.jsxs)(i.aV,{children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:(0,l.jsx)("u",{children:(0,l.jsx)(i.e9,{newTab:!0,href:"https://jp-powers.com/building-a-dedicated-valheim-server-on-ubuntu-server-20-04/",children:"Building a Dedicated Valheim Server on Ubuntu Server 20.04"})})})," - самая подробная инструкция по настройке выделенного сервера Valheim."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:(0,l.jsx)("u",{children:(0,l.jsx)(i.e9,{newTab:!0,href:"https://ag.hyperxgaming.com/article/11422/valheim-server-commands-list",children:"Valheim server commands list"})})})," - список команд сервера."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:(0,l.jsx)("u",{children:(0,l.jsx)(i.e9,{newTab:!0,href:"https://gist.github.com/mattiasghodsian/c988e8c8954be46f35c33311f26f0c50",children:"Valheim Dedicated Server Setup on Ubuntu 20.04.1 LTS"})})})," - еще одна краткая инструкция по настройке выделенного сервера Valheim."]})]})]})},87855:function(e,n,s){"use strict";var l,i;s.d(n,{b:function(){return l}}),(i=l||(l={})).Min="350px",i.Standard="700px",i.Large="1000x",i.Unlimited=""},74313:function(e,n,s){"use strict";var l=s(37340),i=s(85893),r=s(67294),a=s(14965),d=s(41240),t=s(41686),c=s(87855);function h(){let e=(0,l._)(["\n        text-align: left;\n        overflow: hidden;\n        font-size: 14px;\n        border-radius: 6px;\n        overflow: auto;\n\n        & .token-line {\n            line-height: 1.3em;\n            height: 1.3em;\n        }\n    "]);return h=function(){return e},e}function x(){let e=(0,l._)(["\n        max-height: ","\n    "]);return x=function(){return e},e}n.Z=e=>{let{code:n,className:l,language:m,maxHeight:u=c.b.Standard}=e;(void 0!==s.g?s.g:window).Prism=a.p1,s(61354),s(79016),s(35266),s(92927),s(51315),s(57874),s(86862);let o=null!=u?u:c.b.Standard,j=t.ZP.pre(h()),g=(0,t.ZP)(j)(x(),o);return(0,i.jsx)("div",{className:(0,d.GF)("bg-blue-500 md:p-1 p-2",l),children:(0,i.jsx)("div",{className:"shadow-lg",children:(0,i.jsx)(a.y$,{theme:a.np.vsDark,code:n.trim(),language:null!=m?m:m="tsx",children:e=>{let{className:n,style:s,tokens:l,getLineProps:a,getTokenProps:d}=e;return(0,i.jsx)(g,{className:n,style:s,children:l.map((e,n)=>(0,r.createElement)("div",{...a({line:e,key:n}),key:Math.random()},e.map((e,n)=>(0,r.createElement)("span",{...d({token:e,key:n}),key:Math.random()}))))})}})})})}},44853:function(e,n,s){"use strict";s.d(n,{Ee:function(){return d},Xg:function(){return r},Y7:function(){return x},aV:function(){return c},e9:function(){return h},o_:function(){return m},tf:function(){return u},ty:function(){return t},xv:function(){return a}});var l=s(5152),i=s.n(l);let r=i()(()=>Promise.all([s.e(9686),s.e(4738),s.e(4838),s.e(1664),s.e(8765)]).then(s.bind(s,28765)),{loadableGenerated:{webpack:()=>[28765]}}),a=i()(()=>Promise.all([s.e(9511),s.e(935)]).then(s.bind(s,30935)),{loadableGenerated:{webpack:()=>[30935]}}),d=i()(()=>Promise.all([s.e(328),s.e(7651)]).then(s.bind(s,47651)),{loadableGenerated:{webpack:()=>[47651]}}),t=i()(()=>Promise.all([s.e(9686),s.e(6979)]).then(s.bind(s,16979)),{loadableGenerated:{webpack:()=>[16979]}}),c=i()(()=>Promise.all([s.e(4159),s.e(7355)]).then(s.bind(s,87355)),{loadableGenerated:{webpack:()=>[87355]}}),h=i()(()=>Promise.all([s.e(1664),s.e(3220)]).then(s.bind(s,53220)),{loadableGenerated:{webpack:()=>[53220]}});i()(()=>s.e(3140).then(s.bind(s,43140)),{loadableGenerated:{webpack:()=>[43140]}});let x=i()(()=>Promise.all([s.e(2004),s.e(736)]).then(s.bind(s,50736)),{loadableGenerated:{webpack:()=>[50736]}}),m=i()(()=>Promise.all([s.e(8331),s.e(8876),s.e(7354),s.e(839),s.e(5394),s.e(5533)]).then(s.bind(s,48641)),{loadableGenerated:{webpack:()=>[48641]}}),u=i()(()=>Promise.all([s.e(8331),s.e(1664),s.e(7354),s.e(839),s.e(8496)]).then(s.bind(s,48496)),{loadableGenerated:{webpack:()=>[48496]}})}},function(e){e.O(0,[6443,8331,552,8876,7173,2888,9774,179],function(){return e(e.s=73204)}),_N_E=e.O()}]);