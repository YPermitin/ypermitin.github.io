(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9810],{3204:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/DevOps/2022-05/install-valheim-server-ubuntu-20-04",function(){return n(9021)}])},9021:function(e,s,n){"use strict";n.r(s);var l=n(5893),i=n(9305);n(7294);var r=n(1639),a=n(8754),d=n(5632),c=n(3906),t=n(6789),h=n(1652),x=n(850);s.default=()=>(0,l.jsxs)(i.Xg,{blogcentered:!0,children:[(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Настройка портов"}),(0,l.jsx)(i.xv,{p:!0,children:"Должны быть открыты порты по UDP:"}),(0,l.jsx)(x.Z,{code:"\n2456 2457 2458 27060\n                ",className:"my-5",language:"text"}),(0,l.jsx)(i.xv,{p:!0,children:"При использовании UFW (Uncomplicated Firewall) делаем так:"}),(0,l.jsx)(x.Z,{code:"\nsudo ufw allow 2456/udp\nsudo ufw allow 2457/udp\nsudo ufw allow 2458/udp\nsudo ufw allow 27060/udp\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Подготовка операционной системы"}),(0,l.jsx)(i.xv,{p:!0,children:"Некоторые шаги для общей настройки сервера."}),(0,l.jsx)(i.xv,{subtitle:!0,className:"mt-10 md:text",children:"Настройка часового пояса"}),(0,l.jsx)(i.xv,{p:!0,children:"Первым делом проверяем текущую дату и время, а также часовой пояс на сервере."}),(0,l.jsx)(x.Z,{code:"\ntimedatectl\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"При необходимости меняем часовой пояс, чтобы он больше подходил для клиентов сервера."}),(0,l.jsx)(x.Z,{code:"\nsudo timedatectl set-timezone Europe/Moscow\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Список всех доступных часовых поясов смотрим здесь так."}),(0,l.jsx)(x.Z,{code:"\ntimedatectl list-timezones\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{subtitle:!0,className:"mt-10 md:text",children:"Установка обновлений"}),(0,l.jsx)(i.xv,{p:!0,children:"Тут все стандартно. Проверяем наличие обновлений пакетов и устанавливаем обновления."}),(0,l.jsx)(x.Z,{code:"\nsudo apt update\nsudo apt upgrade\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Установка Valheim Server"}),(0,l.jsx)(i.xv,{p:!0,children:"Для установки воспользуемся проектом LinuxGSM. Сначала нам нужно установить все необходимые компоненты."}),(0,l.jsx)(x.Z,{code:"\nsudo dpkg --add-architecture i386; sudo apt update; sudo apt install curl wget file tar bzip2 gzip unzip bsdmainutils python util-linux ca-certificates binutils bc jq tmux netcat lib32gcc1 lib32stdc++6 steamcmd\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(x.Z,{code:"\nsudo apt remove --purge nodejs npm\ncurl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -\nsudo apt update && sudo apt install -y nodejs\nnpm install gamedig -g\nsudo npm install gamedig -g\nsudo npm update -g\nsudo npm list -g gamedig\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Переходим в каталог пользователя, от которого будет работать сервер, и создаем каталог для файлов приложения."}),(0,l.jsx)(x.Z,{code:"\ncd /home/<username>\nmkdir linuxgsm\ncd linuxgsm\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"После этого запускаем непосредственно установку сервера Valheim."}),(0,l.jsx)(x.Z,{code:"\nwget -O linuxgsm.sh https://linuxgsm.sh && chmod +x linuxgsm.sh && bash linuxgsm.sh vhserver\n./vhserver install\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Готово!"}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Настройка сервера Valheim"}),(0,l.jsx)(i.xv,{p:!0,children:"Переходим в каталог с файлами конфигурации сервера."}),(0,l.jsx)(x.Z,{code:"\ncd ~/lgsm/config-lgsm/vhserver\nls\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Делаем бэкап текущего файла конфигурации и заменяем конфигурацию стандартной."}),(0,l.jsx)(x.Z,{code:"\nmv common.cfg common.cfg.old\ncp _default.cfg common.cfg\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Далее открываем файл конфигурации в любимом редакторе и меняем его под себя."}),(0,l.jsx)(x.Z,{code:"\nmcedit common.cfg\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Настройки, которые нужно поменять в первую очередь:"}),(0,l.jsxs)(i.aV,{children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"servername"})," - имя сервера."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"serverpassword"})," - пароль для входа на сервер."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"port"})," - порт сервера. По умолчанию 2456."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"gameworld"})," - имя игрового мира. По умолчанию совпадает с именем сервера."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"public"})," - поставить 1, если сервер должен быть виден сообществу."]})]}),(0,l.jsx)(i.xv,{p:!0,children:"И некоторые необязательные настройки:"}),(0,l.jsxs)(i.aV,{children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"stats"})," - позволить собирать статистику использования проекту LinuxGSM."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"updateonstart"})," - обновление сервера при старте. Рекомендую включить."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"Alert settings"})," - настройка уведомлений о событиях сервера, в т.ч. в Телеграм. Смотрите официальную документацию по каждому каналу доставки сообщений."]})]}),(0,l.jsxs)(i.xv,{p:!0,children:["Также обратить внимание на настройки бэкапирования. ",(0,l.jsx)("b",{children:(0,l.jsx)("u",{children:(0,l.jsx)(i.e9,{newTab:!0,href:"https://docs.linuxgsm.com/",children:"Подробная информация в официальной документации."})})})]}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Настройка запуска сервера"}),(0,l.jsx)(i.xv,{p:!0,children:"Для автоматического запуска игрового сервера воспользуемся возможностями systemd."}),(0,l.jsx)(x.Z,{code:"\nsudo mcedit /etc/systemd/system/vhserver.service\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Файл должен иметь примерно такое содержимое (поправьте пути к файлам искриптам)."}),(0,l.jsx)(x.Z,{code:"\n[Unit]\nDescription=LinuxGSM Valheim Server\nAfter=network-online.target\nWants=network-online.target\n\n[Service]\nType=forking\nUser=<user>\nWorkingDirectory=/home/<user>/linuxgsm\nRemainAfterExit=yes \nExecStart=/home/<user>/linuxgsm/vhserver start\nExecStop=/home/<user>/linuxgsm/vhserver stop\nRestart=no\n\n[Install]\nWantedBy=multi-user.target\n                ",className:"my-5",language:"text"}),(0,l.jsx)(i.xv,{p:!0,children:"Замените нужным значением, т.е. именем пользователя, от которого будет работать игровой сервер."}),(0,l.jsx)(i.xv,{p:!0,children:"После этого обновляем настройки systemd и включаем службу."}),(0,l.jsx)(x.Z,{code:"\nsudo systemctl daemon-reload\nsudo systemctl enable vhserver.service\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Теперь сервер запускается автоматически!"}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Бэкапирование"}),(0,l.jsx)(i.xv,{p:!0,children:"Для выполнения бэкапа сервера достаточно выполнить команду."}),(0,l.jsx)(x.Z,{code:"\n/home/user/linuxgsm/vhserver backup\n                ",className:"my-5",language:"bash"}),(0,l.jsx)(i.xv,{p:!0,children:"Сервер будет остановлен и все файлы будут сохранены в архив по адресу “/home/user/linuxgsm/lgsm/backup”. Далее можно отправлять их в облако для надежности."}),(0,l.jsx)(i.xv,{p:!0,children:"Есть нюанс! По умолчанию файлы игрокового мира находятся вне каталога сервера Valheim. Если сам сервер мы установили в “/home/user/linuxgsm”, то файлы игрового мира находятся в “/home/user/.config/unity3d/IronGate/Valheim/worlds”."}),(0,l.jsx)(i.xv,{p:!0,children:"Рекомендую остановить сервер, переместить каталог “/home/user/.config/unity3d” в “/home/user/linuxgsm/unity3d”, а в файле “/home/user/linuxgsm/lgsm/config-lgsm/vhserver/common.cfg” изменить параметр “savedir” на новое значение."}),(0,l.jsx)(i.xv,{p:!0,children:"После запустить сервер. Тогда бэкап игрового сервера будет включать и файлы игрового мира."}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Уведомления о действиях на сервере"}),(0,l.jsx)(i.xv,{p:!0,children:"Можно настроить уведомления в Telegram-канал о действиях на сервере:"}),(0,l.jsxs)(i.aV,{children:[(0,l.jsx)("li",{children:"Вход/выход пользователя на сервер"}),(0,l.jsx)("li",{children:"Респаун игроков"}),(0,l.jsx)("li",{children:"Смерть игроков"}),(0,l.jsx)("li",{children:"Событие общего сна на сервере, когда ночное время пропускается."}),(0,l.jsx)("li",{children:(0,l.jsx)("b",{children:(0,l.jsx)("u",{children:(0,l.jsx)(i.e9,{newTab:!0,href:"https://valheim.fandom.com/wiki/Events",children:"Случайные события."})})})}),(0,l.jsx)("li",{children:"Запуск сервера"}),(0,l.jsx)("li",{children:"Остановка сервера"})]}),(0,l.jsxs)(i.xv,{p:!0,children:["Для этого воспользуйтесь проектом ",(0,l.jsx)("b",{children:(0,l.jsx)("u",{children:(0,l.jsx)(i.e9,{newTab:!0,href:"https://github.com/Whiskey24/valheim-notify",children:"valheim-notify"})})})," от ",(0,l.jsx)("b",{children:(0,l.jsx)("u",{children:(0,l.jsx)(i.e9,{newTab:!0,href:"https://github.com/Whiskey24",children:"Whiskey24"})})}),"."]}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Команды сервера"}),(0,l.jsx)(i.xv,{p:!0,children:"Только администраторы сервера могут запускать эти команды."}),(0,l.jsxs)(r.b,{"aria-label":"Команды сервера Valheim",children:[(0,l.jsxs)(a.J,{children:[(0,l.jsx)(d.j,{children:"Command"}),(0,l.jsx)(d.j,{children:"Args"}),(0,l.jsx)(d.j,{children:"Description"})]}),(0,l.jsxs)(c.y,{children:[(0,l.jsxs)(t.g,{children:[(0,l.jsx)(h.X,{children:"help"}),(0,l.jsx)(h.X,{children:" "}),(0,l.jsx)(h.X,{children:"Список всех доступных команд"})]},"1"),(0,l.jsxs)(t.g,{children:[(0,l.jsx)(h.X,{children:"kick"}),(0,l.jsx)(h.X,{children:"name/ip/userID"}),(0,l.jsx)(h.X,{children:"Отключить пользователя"})]},"2"),(0,l.jsxs)(t.g,{children:[(0,l.jsx)(h.X,{children:"ban"}),(0,l.jsx)(h.X,{children:"name/ip/userID"}),(0,l.jsx)(h.X,{children:"Забанить пользователя"})]},"3"),(0,l.jsxs)(t.g,{children:[(0,l.jsx)(h.X,{children:"unban"}),(0,l.jsx)(h.X,{children:"/ip/userID"}),(0,l.jsx)(h.X,{children:"Отменить бан пользователя"})]},"4"),(0,l.jsxs)(t.g,{children:[(0,l.jsx)(h.X,{children:"banned"}),(0,l.jsx)(h.X,{children:" "}),(0,l.jsx)(h.X,{children:"Список забаненых пользователей"})]},"5"),(0,l.jsxs)(t.g,{children:[(0,l.jsx)(h.X,{children:"ping"}),(0,l.jsx)(h.X,{children:" "}),(0,l.jsx)(h.X,{children:"Проверить пинг сервера для диагностики задержек"})]},"6"),(0,l.jsxs)(t.g,{children:[(0,l.jsx)(h.X,{children:"info"}),(0,l.jsx)(h.X,{children:" "}),(0,l.jsx)(h.X,{children:"Системная информация"})]},"7")]})]}),(0,l.jsx)(i.xv,{title:!0,className:"mt-10 md:text",children:"Полезные ссылки"}),(0,l.jsxs)(i.aV,{children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:(0,l.jsx)("u",{children:(0,l.jsx)(i.e9,{newTab:!0,href:"https://jp-powers.com/building-a-dedicated-valheim-server-on-ubuntu-server-20-04/",children:"Building a Dedicated Valheim Server on Ubuntu Server 20.04"})})})," - самая подробная инструкция по настройке выделенного сервера Valheim."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:(0,l.jsx)("u",{children:(0,l.jsx)(i.e9,{newTab:!0,href:"https://ag.hyperxgaming.com/article/11422/valheim-server-commands-list",children:"Valheim server commands list"})})})," - список команд сервера."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:(0,l.jsx)("u",{children:(0,l.jsx)(i.e9,{newTab:!0,href:"https://gist.github.com/mattiasghodsian/c988e8c8954be46f35c33311f26f0c50",children:"Valheim Dedicated Server Setup on Ubuntu 20.04.1 LTS"})})})," - еще одна краткая инструкция по настройке выделенного сервера Valheim."]})]})]})},850:function(e,s,n){"use strict";n.d(s,{Z:function(){return h}});var l=n(5893),i=n(7294),r=n(4965),a=n(4275),d=n(7340);function c(){let e=(0,d._)(["\n  text-align: left;\n  overflow: hidden;\n  font-size: 14px;\n  border-radius: 6px;\n  overflow: auto;\n  max-height: 350px;\n\n  & .token-line {\n    line-height: 1.3em;\n    height: 1.3em;\n  }\n"]);return c=function(){return e},e}let t=n(964).ZP.pre(c());var h=e=>{let{code:s,className:d,language:c}=e;return(void 0!==n.g?n.g:window).Prism=r.p1,n(1354),n(9016),n(5266),n(2927),n(1315),n(7874),n(6862),(0,l.jsx)("div",{className:(0,a.GF)("bg-blue-500 md:p-5 p-2",d),children:(0,l.jsx)("div",{className:"shadow-lg",children:(0,l.jsx)(r.y$,{theme:r.np.vsDark,code:s,language:null!=c?c:c="tsx",children:e=>{let{className:s,style:n,tokens:r,getLineProps:a,getTokenProps:d}=e;return(0,l.jsx)(t,{className:s,style:n,children:r.map((e,s)=>(0,i.createElement)("div",{...a({line:e,key:s}),key:Math.random()},e.map((e,s)=>(0,i.createElement)("span",{...d({token:e,key:s}),key:Math.random()}))))})}})})})}},9305:function(e,s,n){"use strict";n.d(s,{Ee:function(){return d},Xg:function(){return r},aV:function(){return t},e9:function(){return h},o_:function(){return x},ty:function(){return c},xv:function(){return a}});var l=n(5152),i=n.n(l);let r=i()(()=>Promise.all([n.e(4838),n.e(4738),n.e(4817),n.e(1664),n.e(7167)]).then(n.bind(n,7167)),{loadableGenerated:{webpack:()=>[7167]}}),a=i()(()=>n.e(9179).then(n.bind(n,9179)),{loadableGenerated:{webpack:()=>[9179]}}),d=i()(()=>n.e(1974).then(n.bind(n,1974)),{loadableGenerated:{webpack:()=>[1974]}}),c=i()(()=>n.e(8547).then(n.bind(n,8547)),{loadableGenerated:{webpack:()=>[8547]}}),t=i()(()=>n.e(6806).then(n.bind(n,6806)),{loadableGenerated:{webpack:()=>[6806]}}),h=i()(()=>Promise.all([n.e(1664),n.e(1465)]).then(n.bind(n,1465)),{loadableGenerated:{webpack:()=>[1465]}});i()(()=>n.e(567).then(n.bind(n,567)),{loadableGenerated:{webpack:()=>[567]}}),i()(()=>Promise.all([n.e(2004),n.e(4139)]).then(n.bind(n,4139)),{loadableGenerated:{webpack:()=>[4139]}});let x=i()(()=>Promise.all([n.e(5507),n.e(7472),n.e(584),n.e(7870)]).then(n.bind(n,7870)),{loadableGenerated:{webpack:()=>[7870]}})}},function(e){e.O(0,[1102,5507,433,2888,9774,179],function(){return e(e.s=3204)}),_N_E=e.O()}]);