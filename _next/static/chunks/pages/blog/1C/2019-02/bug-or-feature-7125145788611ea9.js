(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3470],{91099:function(e,n,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/1C/2019-02/bug-or-feature",function(){return l(5982)}])},5982:function(e,n,l){"use strict";l.r(n);var i=l(85893),s=l(97037);l(67294);var r=l(13803),d=l(46416),c=l(12306),x=l(93218),t=l(44877),h=l(42967),j=l(47168),a=l(78148);n.default=()=>(0,i.jsxs)(s.Xg,{blogcentered:!0,children:[(0,i.jsxs)(s.xv,{textAlign:d.PH.RIGHT,quote:!0,children:["Ошибок не существует, просто счастливые случайности.",(0,i.jsx)("br",{}),"(с) Роберт \xabБоб\xbb Норман Росс"]}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Рассмотрим несколько случаев неожиданного поведения платформы 1С, а также что с этим можно cделать."}),(0,i.jsx)(s.xv,{title:!0,className:"mt-10 md:text",children:"Содержание"}),(0,i.jsxs)(s.aV,{children:[(0,i.jsx)("li",{children:(0,i.jsx)(s.e9,{href:"#bug-or-feature",children:(0,i.jsx)("b",{children:(0,i.jsx)("u",{children:"Баг или фича?"})})})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.e9,{href:"#excellent-math",children:(0,i.jsx)("b",{children:(0,i.jsx)("u",{children:"Отличная математика"})})})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.e9,{href:"#date-with-ms",children:(0,i.jsx)("b",{children:(0,i.jsx)("u",{children:"Дата с миллисекундами"})})})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.e9,{href:"#reg-meaning",children:(0,i.jsx)("b",{children:(0,i.jsx)("u",{children:"Регистр не имеет значения"})})})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.e9,{href:"#invisible-command",children:(0,i.jsx)("b",{children:(0,i.jsx)("u",{children:"Невидимая команда"})})})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.e9,{href:"#recursive-mayhem",children:(0,i.jsx)("b",{children:(0,i.jsx)("u",{children:"Рекурсивный беспредел"})})})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.e9,{href:"#loss-columns",children:(0,i.jsx)("b",{children:(0,i.jsx)("u",{children:"Внезапная пропажа колонок"})})})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.e9,{href:"#indexing-hell",children:(0,i.jsx)("b",{children:(0,i.jsx)("u",{children:"Индексированный ад"})})})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.e9,{href:"#void-diff",children:(0,i.jsx)("b",{children:(0,i.jsx)("u",{children:"NULL или Неопределено или ПустаяСсылка"})})})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.e9,{href:"#normal",children:(0,i.jsx)("b",{children:(0,i.jsx)("u",{children:"Это норма"})})})})]}),(0,i.jsxs)("section",{id:"section-bug-or-feature",children:[(0,i.jsx)(s.xv,{id:"bug-or-feature",title:!0,className:"mt-10 md:text",children:"Баг или фича?"}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:'Длительное время работая с платформой 1С и решениями на ее основе? приходится встречаться с ее неожиданным поведением в самых разных ситуациях. Странные результаты алгоритмов, непонятные ошибки, вылеты приложения, невероятное поведение клиентского интерфейса, некорректные данные в регистрах, странные результаты при выгрузке данных и многое другое. Одним словом - "магия".'}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Ниже будут несколько примеров с подробным описанием, чтобы Вы могли попробовать подобное у себя. Все что здесь описано будет актуальным для версии 8.3.13.1690 и, почти уверен, для версий ниже."})]}),(0,i.jsxs)("section",{id:"section-excellent-math",children:[(0,i.jsx)(s.xv,{id:"excellent-math",title:!0,className:"mt-10 md:text",children:"Отличная математика"}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Начнем с простого случая - округлением дробных чисел при работе с ними во временных таблицах. Звучит странно. Меньше слов - больше кода!"}),(0,i.jsx)(r.Z,{code:'\nЧисло1 = 0.000102410434234235348573456378465353465;\nЧисло2 = 0.564004435745654732352330006506040060406;\n	\nЗапрос = Новый Запрос;\nЗапрос.Текст = \n	"ВЫБРАТЬ\n	|	&Число1 КАК Число1,\n	|	&Число2 КАК Число2\n	|ПОМЕСТИТЬ ВТ\n	|;\n	|\n	|ВЫБРАТЬ\n	|	ВТ.Число1 КАК Число1,\n	|	ВТ.Число2 КАК Число2\n	|ИЗ\n	|	ВТ КАК ВТ";	\nЗапрос.УстановитьПараметр("Число1", Число1);\nЗапрос.УстановитьПараметр("Число2", Число2);	\nВыборка = Запрос.Выполнить().Выбрать();\nВыборка.Следующий();\n\nЧисло1Корректное = Выборка.Число1 = Число1;\nСообщить("Проверка числа 1: " + Число1Корректное);\nЧисло2Корректное = Выборка.Число2 = Число2;\nСообщить("Проверка числа 2: " + Число2Корректное);\n                    ',className:"my-5",language:"bsl"}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:'Как думаете, какой результат мы получим? Хотя что спрашивать, если бы числа после передачи их в запрос не изменились бы, то в примеры бы это не попало. В обоих случаях результат проверки будет отрицательным. Так происходит потому что при создании временных таблиц платформа (Внимание!) почти всегда создает числовое поле с типом "NUMERIC(37, 37)" для чисел. Вот так это выглядит на стороне SQL-сервера.'}),(0,i.jsx)(r.Z,{code:"\nCREATE TABLE #tt1 (\n	_Q_000_F_000 NUMERIC(37, 37), \n	_Q_000_F_001 NUMERIC(37, 37)\n)\n\nINSERT INTO #tt1 WITH(TABLOCK) \n	(_Q_000_F_000, _Q_000_F_001) \nSELECT\n	0.0001024104342342353485734563784653534,\n	0.5640044357456547323523300065060400604\n;\n\nSELECT \n	T1._Q_000_F_000, \n	T1._Q_000_F_001 \nFROM #tt1 T1 WITH(NOLOCK)\n                    ",className:"my-5",language:"sql"}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:'В нашем случае количество цифр в дробной части - 39, то есть число "обрезается" до 37 цифр в дробной части. В более ранних версиях платформы, например 8.3.6, количество цифр в дробной части было вообще 8 и можно было очень долго разбираться, почему запрос отрабатывает не так как надо. Подобное поведение также замечено и в файловом режиме работы. На PostgreSQL не пробовал.'}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Зачем нужно оперировать такими числами? На практике встречался с задачами расчета доли в какой-либо сумме и в некоторых ситуациях такая точность была очень важна. Также могут быть задачи установки приоритета для операций, в которых округление может сыграть злую шутку."}),(0,i.jsxs)(s.xv,{textAlign:d.PH.JUSTIFY,children:["Обходные решения тут также простые:",(0,i.jsxs)(s.aV,{type:d.RH.number,children:[(0,i.jsx)("li",{children:"Если нужна высокая точность в расчете, то эту бизнес-логику придется перенести на сторону платформы, а не использовать для этого сервер СУБД."}),(0,i.jsx)("li",{children:"Если задача позволяет, то можно попытаться перенести часть цифр из дробной части в целую, умножив к примеру на 100000."})]}),"В любом случае, с такими ситуациями встречаешься не каждый день."]})]}),(0,i.jsxs)("section",{id:"section-date-with-ms",children:[(0,i.jsx)(s.xv,{id:"date-with-ms",title:!0,className:"mt-10 md:text",children:"Дата с миллисекундами"}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Все мы знаем, что к дате можно прибавлять целое число секунд и пользуемся этим довольно часто. Например, вот так."}),(0,i.jsx)(r.Z,{code:'\nТекДата = ТекущаяДата();\nНачалоСледующегоМесяца = КонецМесяца(ТекДата) + 1;\nСообщить("Начало следующего месяца: " + НачалоСледующегоМесяца);\n                    ',className:"my-5",language:"bsl"}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Отлично, но что будет если мы прибавим дробное число к дате. Вот интересный пример."}),(0,i.jsx)(r.Z,{code:'\nДатаОбычная = Дата(2019,2,1);\nДатаСтранная = ДатаОбычная + 0.001;\nСравнениеДат1 = ДатаСтранная = ДатаОбычная;\nСообщить("Вариант с датами 1: " + СравнениеДат1);\n	\nДатаСтранная = ДатаСтранная - 0.001;\nСравнениеДат2 = ДатаСтранная = ДатаОбычная;\nСообщить("Вариант с датами 2: " + СравнениеДат2);\n                    ',className:"my-5",language:"bsl"}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"В первом случае даты будут не равны, а во втором равны. То есть фактически даты в 1С поддерживают миллисекунды! Если оперировать не миллисекундами, а микросекундами, то мы сразу увидим, что даты их не поддерживают."}),(0,i.jsx)(r.Z,{code:'\nДатаОбычная = Дата(2019,2,1);\nДатаСтранная = ДатаОбычная + 0.000001;\nСравнениеДат1 = ДатаСтранная = ДатаОбычная;\nСообщить("Вариант с датами 1: " + СравнениеДат1);\n\nДатаСтранная = ДатаСтранная - 0.000001;\nСравнениеДат2 = ДатаСтранная = ДатаОбычная;\nСообщить("Вариант с датами 2: " + СравнениеДат2);	\n                    ',className:"my-5",language:"bsl"}),(0,i.jsxs)(s.xv,{textAlign:d.PH.JUSTIFY,children:["В обоих случаях результат сравнения будет ",(0,i.jsx)("b",{children:"Истина"}),"."]}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:'На сколько мне известно, подобное поведение никак не документировано, а при разработке в программном коде невозможно определить содержит ли дата миллисекунды. В итоге можно нарваться на ситуацию, когда в алгоритме сравниваются две даты, но они не равны, хотя в отладке "на глаз" ничем не отличаются.'}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Поэтому, берегите время. И будьте с ним осторожны!"}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"P.S. Определить имеются ли в дате миллисекунды все же можно, но способ не очевидный. Можно из даты вычесть в точности такую же новую дату. Там можно получить дробное число, которое покажет наличие миллисекунд."})]}),(0,i.jsxs)("section",{id:"section-reg-meaning",children:[(0,i.jsx)(s.xv,{id:"reg-meaning",title:!0,className:"mt-10 md:text",children:"Регистр не имеет значения"}),(0,i.jsxs)(s.xv,{textAlign:d.PH.JUSTIFY,children:["Платформа по умолчанию для информационных баз использует регистронезависимую проверку паролей пользователей. Трудно назвать это поведение неожиданным, т.к. этот момент прописан в справке, но кто ее читает. ",":)"]}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:'Только представьте, служба безопасности требует по регламенту установки сложных паролей вида "aQfxFA352Ga", а по факту регистр букв в нем не будет иметь значение. Пароль "1ABC" эквивалентен паролям "1AbC", "1abc" и т.д.'}),(0,i.jsxs)(s.xv,{textAlign:d.PH.JUSTIFY,children:["Исправить эту ситуацию просто, нужно лишь поставить проверку сложности паролей через конфигуратор:",(0,i.jsxs)("b",{children:['"Администрирование" ',"->",' "Параметры информационной базы" ',"->",'  "Проверка сложности паролей пользователей"']}),". В этом случае будет задействована регистрозависимая проверка паролей."]})]}),(0,i.jsxs)("section",{id:"section-invisible-command",children:[(0,i.jsx)(s.xv,{id:"invisible-command",title:!0,className:"mt-10 md:text",children:"Невидимая команда"}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Еще одно очень интересное поведение платформы - это выполнение глобальной команды без параметров, даже если связанный с ней элемент формы невидим."}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Суть этого поведения заключается в том, что в конфигурацию можно добавить глобальную непараметризированную команду, назначить ей сочетание клавиш и.... ее можно будет выполнять, даже если на форме она будет невидима."}),(0,i.jsx)(s.Ee,{className:"my-4",src:"/public/imp_assets/1C/2019-02/bug-or-feature/invisible-command.png",alt:"Невидимая команда",size:d.h2.MEDIUM})]}),(0,i.jsxs)("section",{id:"section-recursive-mayhem",children:[(0,i.jsx)(s.xv,{id:"recursive-mayhem",title:!0,className:"mt-10 md:text",children:"Рекурсивный беспредел"}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Еще одна особенность - это контроль рекурсивного вызова процедур и функций. Например, попытайтесь выполнить такой код на сервере."}),(0,i.jsx)(r.Z,{code:"\n&НаКлиенте\nПроцедура НачатьРекурсиюНаСервере(Команда)\n	\n	// Вызываем сервер\n	НачатьРекурсиюНаСервереНаСервере();\n	\nКонецПроцедуры\n\n&НаСервере\nПроцедура НачатьРекурсиюНаСервереНаСервере()\n	\n	// И начинаем рекурсию\n	НачатьРекурсиюНаСервереНаСервере();\n	\nКонецПроцедуры\n                    ",className:"my-5",language:"bsl"}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"В этом случае платформа обязательно отловит ошибку и выведет исключение."}),(0,i.jsx)(s.Ee,{className:"my-4",src:"/public/imp_assets/1C/2019-02/bug-or-feature/recursive-mayhem.png",alt:"Рекурсивный беспредел",size:d.h2.FUll}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Если же вы попытаетесь запустить бесконечную рекурсию на клиенте подобным образом."}),(0,i.jsx)(r.Z,{code:"\n&НаКлиенте\nПроцедура НачатьРекурсию(Команда)\n	\n	// Точка входа в рекунсию\n	НачатьРекурсиюНаКлиенте();\n	\nКонецПроцедуры\n\n&НаКлиенте\nПроцедура НачатьРекурсиюНаКлиенте()\n	\n	// И продолжаем вызов, еще и еще\n	НачатьРекурсиюНаКлиенте();\n	\nКонецПроцедуры\n                    ",className:"my-5",language:"bsl"}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"То получите аварийное завершение работы клиентского приложения без объяснения причины."}),(0,i.jsx)(s.Ee,{className:"my-4",src:"/public/imp_assets/1C/2019-02/bug-or-feature/error-dump.png",alt:"Дамп при ошибке",size:d.h2.XS}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Не берусь судить нормально ли это, но было бы удобнее получить более внятную информацию."}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"P.S. В технологическом журнале можно найти более подробную информацию, но это не всегда можно сделать быстро на клиентских машинах."})]}),(0,i.jsxs)("section",{id:"section-loss-columns",children:[(0,i.jsx)(s.xv,{id:"loss-columns",title:!0,className:"mt-10 md:text",children:"Внезапная пропажа колонок"}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Занимательная ситуация - Вы обновляете модифицированную конфигурацию, все прошло хорошо. На Ваш взгляд ошибок быть не может, конфигурацию знаете как свои пять пальцев, а релиз от поставщика изменил всего несколько объектов в базе и они никак не связаны с доработками. Применяете изменения и идете спать (ну, базу же обновляют обычно в нерабочее время)."}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:'На следующее утро Вам звонок, что в некотором документе пропала колонка "Артикул" в табличной части документа. Вы с хорошим настроением (что может быть лучше раннего начала дня после вечерней работы) начинаете перепроверять все ли правильно перенесено при обновлении и ... ничего не находите.'}),(0,i.jsxs)(s.xv,{textAlign:d.PH.JUSTIFY,children:["После более подробного анализа выяснилось следующее:",(0,i.jsxs)(s.aV,{children:[(0,i.jsx)("li",{children:'В документе была выведена колонка "Артикул" от другого реквизита "Объект" по ссылке, как это возможно сделать в управляемой форме.'}),(0,i.jsx)("li",{children:'До обновления тип реквизита "Объект" был "СправочникСсылка.Номенклатура".'}),(0,i.jsx)("li",{children:'После обновления тип стал составным, т.к. к нему добавился тип "СправочникСсылка.ГруппаНоменклатуры".'})]})]}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"И вот в этом то и проблема, что от составных типов данных вывод реквизитов через ссылку недоступен. Причем сравнение в конфигураторе такое не покажет, т.к. этот объект вообще может быть без изменений, а если открыть форму в конфигураторе, то тоже не сразу будет заметно, что эта колонка уже не рабочая. Среди элементов формы она присутствует, и идентифицировать ошибку можно только посмотреть ее свойства - там не будет связи с данными."}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Но кто будет проверять все колонки вручную, да еще и в не измененных при обновлении объектах. И вот приходится искать альтернативные решения, делать костыли, ведь пропавшая колонка так важна..."})]}),(0,i.jsxs)("section",{id:"section-indexing-hell",children:[(0,i.jsx)(s.xv,{id:"indexing-hell",title:!0,className:"mt-10 md:text",children:"Индексированный ад"}),(0,i.jsxs)(s.xv,{textAlign:d.PH.JUSTIFY,children:["В ",(0,i.jsx)(s.e9,{newTab:!0,href:"/pages/blog/SQLServer/2018-11/custom-index-for-1C.tsx",children:(0,i.jsx)("b",{children:(0,i.jsx)("u",{children:"одной из прошлых"})})})," статей уже шла речь о недостатках структуры индексов баз 1С и некоторые способы их решения. Но там речь не шла об избыточных индексах, которые создает платформа. Вот тут то мы пример и приведем."]}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:'Во многих конфигурациях есть справочник "Контрагенты" и подчиненный владельцу "ДоговорыКонтрагентов". У обоих справочников включена иерархия. Проблема заключается в том, что при такой комбинации настроек платформа создает множество избыточных индексов. Далее пример.'}),(0,i.jsxs)(s.xv,{textAlign:d.PH.JUSTIFY,children:['Справочник "ДоговорыКонтрагентов" подчиненный справочнику "Контрагенты", имеет множество реквизитов, 4 из которых проиндексированы:',(0,i.jsxs)(s.aV,{children:[(0,i.jsx)("li",{children:"Организация - индексирован с доп. упорядочиванием для списков."}),(0,i.jsx)("li",{children:"ДатаНачалаДействия - индексирован"}),(0,i.jsx)("li",{children:"ДатаОкончанияДействия - индексирован"}),(0,i.jsx)("li",{children:"Менеджер - индексирован с доп. упорядочиванием для списков."})]}),"Из-за включенного подчинения по владельцу и иерархии платформа создает настоящую коллекцию индексов, состав которых схожий."]}),(0,i.jsxs)(c.b,{"aria-label":"Стандартные индексы платформы 1С",children:[(0,i.jsxs)(x.J,{children:[(0,i.jsx)(t.j,{children:"Имя индекса"},"Name"),(0,i.jsx)(t.j,{children:"Состав полей"},"Keys")]}),(0,i.jsxs)(h.y,{children:[(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_ByPredefinedIDNotUniq"}),(0,i.jsx)(a.X,{children:"ИмяПредопределенныхДанных"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_OwnerCode"}),(0,i.jsx)(a.X,{children:"Владелец + Код + Ссылка"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_OwnerDescr"}),(0,i.jsx)(a.X,{children:"Владелец + Наименование + Ссылка"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_ParentCode"}),(0,i.jsx)(a.X,{children:"Родитель + ЭтоГруппа + Код + Ссылка + Владелец"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_ParentDescr"}),(0,i.jsx)(a.X,{children:"Родитель + Владелец + ЭтоГруппа + Наименование + Ссылка"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_Code"}),(0,i.jsx)(a.X,{children:"Код + Ссылка"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_Descr"}),(0,i.jsx)(a.X,{children:"Наименование + Ссылка"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_ByOwnerFieldFld28"}),(0,i.jsx)(a.X,{children:"Владелец + Организация + Наименование + Ссылка + ПометкаУдаления + Менеджер"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_ByParentFieldFld28"}),(0,i.jsx)(a.X,{children:"Владелец + Родитель + ЭтоГруппа + Организация + Наименование + Ссылка + ПометкаУдаления + Менеджер"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_ByFieldFld28"}),(0,i.jsx)(a.X,{children:"Организация + Наименование + Ссылка + ПометкаУдаления + Менеджер"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_ByOwnerFieldFld55"}),(0,i.jsx)(a.X,{children:"Владелец + ДатаНачалаДействия + Ссылка"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_ByParentFieldFld55"}),(0,i.jsx)(a.X,{children:"Владелец + Родитель + ЭтоГруппа + ДатаНачалаДействия + Ссылка"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_ByFieldFld55"}),(0,i.jsx)(a.X,{children:"ДатаНачалаДействия + Ссылка"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_ByOwnerFieldFld56"}),(0,i.jsx)(a.X,{children:"Владелец + ДатаОкончанияДействия + Ссылка"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_ByParentFieldFld56"}),(0,i.jsx)(a.X,{children:"Владелец + Родитель + ЭтоГруппа + ДатаОкончанияДействия + Ссылка"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_ByFieldFld56"}),(0,i.jsx)(a.X,{children:"ДатаОкончанияДействия + Ссылка"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_ByOwnerFieldFld57"}),(0,i.jsx)(a.X,{children:"Владелец + Менеджер + Наименование + Ссылка + ПометкаУдаления + Организация"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_ByParentFieldFld57"}),(0,i.jsx)(a.X,{children:"Владелец + Родитель + ЭтоГруппа + Менеджер + Наименование + Ссылка + ПометкаУдаления + Организация"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"_Reference27_ByFieldFld57"}),(0,i.jsx)(a.X,{children:"Менеджер + Наименование + Ссылка + ПометкаУдаления + Организация"})]}),(0,i.jsxs)(j.g,{children:[(0,i.jsx)(a.X,{children:"PK___Referen__AC8ED0C46C28FEE5"}),(0,i.jsx)(a.X,{children:"Ссылка"})]})]})]}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:'Вот тут то и начинается самое интересное. Индексы очень тяжелые, а большинство из них избыточно. Например, индексы "_Reference27_ByOwnerFieldFld28", "_Reference27_ByParentFieldFld28" избыточны. В большинстве случаев достаточно индекса только по полю "Владелец", которое ускорит поиск договоров по конкретному контрагенту. Конечно, бывает у одно контрагента огромное количество договоров, но это отдельная ситуация. То же самое можно сказать про индексы "_Reference27_ByOwnerFieldFld56", "_Reference27_ByParentFieldFld56" и некоторых других. Все усугубляется еще и тем, что поля с индексированием с доп. упорядочиванием добавляются в другие индексы, что во многих случаях тоже избыточно. В идеале было бы не плохо иметь возможность настраивать необходимость индексов для таких ситуаций, но пока эта возможность отсутствует.'}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:'Сейчас это выглядит как создание индексов "на всякий случай", причем индексов тяжелых как в обслуживании, так и по занимаемому месту на диске.'}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:'Есть случаи, когда на проектах приходилось либо удалять избыточные индексы бессовестным нерекомендуемым фирмой "1С" способом через SQL, чтобы производительность работы со справочником находилась на приемлемом уровне. Вы можете также взглянуть на современные конфигурации, например ERP - справочник "ДоговорыКонтрагентов" больше не подчинен справочнику "Контрагенты" через владельца, вместо этого в справочнике есть реквизит "Контрагент" с ссылкой на владельца. Иерархия у справочника также отключена.'})]}),(0,i.jsxs)("section",{id:"section-void-diff",children:[(0,i.jsx)(s.xv,{id:"void-diff",title:!0,className:"mt-10 md:text",children:"NULL или Неопределено или ПустаяСсылка"}),(0,i.jsxs)(s.xv,{textAlign:d.PH.JUSTIFY,children:["Есть такая особенность у регистров бухгалтерии - значениями субконто, если там составной тип, могут быть конкретная ссылка (в т.ч. и пустая), неопределено и NULL. ",(0,i.jsx)(s.e9,{href:"https://its.1c.ru/db/metod8dev/content/3357/hdoc",newTab:!0,children:(0,i.jsx)("b",{children:(0,i.jsx)("u",{children:"Вот немного информации"})})}),"."]}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:'Все это может привести к некоторым странностями при формировании отчетов, когда вроде бы сгруппированные записи двоятся, хотя аналитика одинаковая. Или может быть случай, когда и месяц может не закрыться. Вообщем, настоящее "веселье".'}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Согласно официальной документации, значение Неопределено может появиться в тех случаях, когда значение составного типа субконто не было установлено явно. В типовых конфигурациях для исправления подобных случаев в регистрах бухгалтерии используют такой алгоритм перед записью."}),(0,i.jsx)(r.Z,{code:"\nПроцедура ПривестиПустыеЗначенияСубконтоСоставногоТипа(Проводки)\n	\n	КэшВидыСоставныхСубконто = Новый Соответствие;\n	\n	Для Каждого Проводка Из Проводки Цикл\n		\n		Для Каждого Субконто Из Проводка.СубконтоДт Цикл\n			\n			Если НЕ ЗначениеЗаполнено(Субконто.Значение) \n				И Субконто.Значение <> Неопределено \n				И СоставнойТипСубконто(Субконто.Ключ, КэшВидыСоставныхСубконто) Тогда\n				Проводка.СубконтоДт.Вставить(Субконто.Ключ, Неопределено);\n			КонецЕсли;\n			\n		КонецЦикла;\n		\n		Для Каждого Субконто Из Проводка.СубконтоКт Цикл\n			\n			Если НЕ ЗначениеЗаполнено(Субконто.Значение) \n				И Субконто.Значение <> Неопределено \n				И СоставнойТипСубконто(Субконто.Ключ, КэшВидыСоставныхСубконто) Тогда\n				Проводка.СубконтоКт.Вставить(Субконто.Ключ, Неопределено);\n			КонецЕсли;\n			\n		КонецЦикла;\n				\n	КонецЦикла;\n	\nКонецПроцедуры\n                    ",className:"my-5",language:"bsl"}),(0,i.jsxs)(s.xv,{textAlign:d.PH.JUSTIFY,children:['Все пустые значения приводятся к Неопределено. Поэтому если Вы не записываете набор в режиме "ОбменДанными.Загрузка", то ошибиться теперь в аналитике будет сложнее. С другой стороны есть еще обмены данными, которые до сих пор создают очень интересные ошибки при заполнении субконто. А про кастомные обработки с инфостарта вообще молчу ',":)"]}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:'Что касается значения NULL - то это интересный случай, когда у счетов "на лету" меняют состав субконто. Например, добавляя субконто к счету, по которому учет ведется уже много лет, платформа заполняет значение этого субконто для проводок прошлых периодов значением NULL. Это нужно учитывать при проведении таких опасных операций.'}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"Будьте осторожны при изменении счетов, это может привести к новым приключениям. В любом случае, эти проблемы решаются не сложно, путем написания корректировочных обработок для таких движений. Подобные случаи часто всплывают в период закрытия месяца, когда исправления нужно было внести еще вчера."})]}),(0,i.jsxs)("section",{id:"section-normal",children:[(0,i.jsx)(s.xv,{id:"normal",title:!0,className:"mt-10 md:text",children:"Это норма"}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"На этом все. Многие подобные пасхалки давно известны сообществу, а многие и вовсе задокументированы на ИТС. Но если баг / фича задокументированы, это не значит что они перестали ими быть."}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"В абсолютном большинстве случаев возникающие проблемы из-за описанных выше особенностей платформы легко решить. Сложность только в том, что вопросы возникают не сразу во время разработки или тестирования, а спустя время. Иногда даже годы."}),(0,i.jsx)(s.xv,{textAlign:d.PH.JUSTIFY,children:"В публикации описаны не все возможные пасхалки платформы, их гораздо больше. Например, если обратиться к механизму СКД или начать обсуждение обширной темы работы через веб-клиент, то можно сделать десятки публикаций."})]})]})},12250:function(e,n,l){"use strict";var i,s;l.d(n,{b:function(){return i}}),(s=i||(i={})).Min="350px",s.Standard="700px",s.Large="1000x",s.Unlimited=""},13803:function(e,n,l){"use strict";var i=l(37340),s=l(85893),r=l(67294),d=l(14965),c=l(54951),x=l(41686),t=l(12250);function h(){let e=(0,i._)(["\n        text-align: left;\n        overflow: hidden;\n        font-size: 14px;\n        border-radius: 6px;\n        overflow: auto;\n\n        & .token-line {\n            line-height: 1.3em;\n            height: 1.3em;\n        }\n    "]);return h=function(){return e},e}function j(){let e=(0,i._)(["\n        max-height: ","\n    "]);return j=function(){return e},e}n.Z=e=>{let{code:n,className:i,language:a,maxHeight:o=t.b.Standard}=e;(void 0!==l.g?l.g:window).Prism=d.p1,l(61354),l(79016),l(2731),l(35266),l(92927),l(51315),l(57874),l(86862);let g=null!=o?o:t.b.Standard,m=x.ZP.pre(h()),u=(0,x.ZP)(m)(j(),g);return(0,s.jsx)("div",{className:(0,c.GF)("bg-blue-500 md:p-1 p-2",i),children:(0,s.jsx)("div",{className:"shadow-lg",children:(0,s.jsx)(d.y$,{theme:d.np.vsDark,code:n.trim(),language:null!=a?a:a="tsx",children:e=>{let{className:n,style:l,tokens:i,getLineProps:d,getTokenProps:c}=e;return(0,s.jsx)(u,{className:n,style:l,children:i.map((e,n)=>(0,r.createElement)("div",{...d({line:e,key:n}),key:Math.random()},e.map((e,n)=>(0,r.createElement)("span",{...c({token:e,key:n}),key:Math.random()}))))})}})})})}},97037:function(e,n,l){"use strict";l.d(n,{Ee:function(){return c},Xg:function(){return r},Y7:function(){return j},aV:function(){return t},e9:function(){return h},o_:function(){return a},tf:function(){return o},ty:function(){return x},xv:function(){return d}});var i=l(5152),s=l.n(i);let r=s()(()=>Promise.all([l.e(549),l.e(4738),l.e(4838),l.e(1664),l.e(1274)]).then(l.bind(l,91274)),{loadableGenerated:{webpack:()=>[91274]}}),d=s()(()=>Promise.all([l.e(4454),l.e(7897)]).then(l.bind(l,97897)),{loadableGenerated:{webpack:()=>[97897]}}),c=s()(()=>Promise.all([l.e(3536),l.e(2726)]).then(l.bind(l,2726)),{loadableGenerated:{webpack:()=>[2726]}}),x=s()(()=>Promise.all([l.e(549),l.e(378)]).then(l.bind(l,90378)),{loadableGenerated:{webpack:()=>[90378]}}),t=s()(()=>Promise.all([l.e(9300),l.e(7200)]).then(l.bind(l,7200)),{loadableGenerated:{webpack:()=>[7200]}}),h=s()(()=>Promise.all([l.e(1664),l.e(8681)]).then(l.bind(l,28681)),{loadableGenerated:{webpack:()=>[28681]}});s()(()=>l.e(2857).then(l.bind(l,22857)),{loadableGenerated:{webpack:()=>[22857]}});let j=s()(()=>Promise.all([l.e(2004),l.e(3070)]).then(l.bind(l,63070)),{loadableGenerated:{webpack:()=>[63070]}}),a=s()(()=>Promise.all([l.e(162),l.e(3959),l.e(6050),l.e(239),l.e(727)]).then(l.bind(l,32215)),{loadableGenerated:{webpack:()=>[32215]}}),o=s()(()=>Promise.all([l.e(162),l.e(1664),l.e(3959),l.e(6050),l.e(4205)]).then(l.bind(l,84205)),{loadableGenerated:{webpack:()=>[84205]}})}},function(e){e.O(0,[4104,162,7810,9162,2888,9774,179],function(){return e(e.s=91099)}),_N_E=e.O()}]);